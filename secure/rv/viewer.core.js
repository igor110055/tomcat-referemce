/*
 *+------------------------------------------------------------------------+
 *| Licensed Materials - Property of IBM
 *| IBM Cognos Products: Viewer
 *| (C) Copyright IBM Corp. 2014
 *|
 *| US Government Users Restricted Rights - Use, duplication or
 *| disclosure restricted by GSA ADP Schedule Contract with IBM Corp.
 *|
 *+------------------------------------------------------------------------+
 */
 function CViewerHelper(){
this.m_oCV=null;
};
CViewerHelper.prototype.getCVObjectRef=function(){
return this.getCV().getObjectId();
};
CViewerHelper.prototype.getCV=function(){
if(this.m_oCV){
return this.m_oCV;
}
return window;
};
CViewerHelper.prototype.getCVId=function(){
var _1="";
if(this.m_oCV){
_1=this.m_oCV.getId();
}
return _1;
};
CViewerHelper.prototype.setCV=function(_2){
this.m_oCV=_2;
};
function CObserver(_3){
this.m_subject=_3;
this.m_observers=[];
};
function CObserver_attach(_4,_5,_6){
if(_4==null||typeof _4.update!="function"){
alert("Notification Frame Work Error : attach failed");
return false;
}
var _7=new CState(this.m_subject,_4,_5?_5:null,_6?_6:null);
this.m_observers[this.m_observers.length]=_7;
return true;
};
function CObserver_detach(_8){
};
function CObserver_hasObserver(_9){
var _a=false;
for(var _b=0;_b<this.m_observers.length;_b++){
if(this.m_observers[_b].getObserver()==_9){
_a=true;
break;
}
}
return _a;
};
function CObserver_notify(_c){
var i=0;
if(typeof _c!="undefined"&&_c!=null){
for(i=0;i<this.m_observers.length;++i){
if(this.m_observers[i].getEvt()==_c){
var _e=this.m_observers[i].getObserver();
var _f=this.m_observers[i].getCallback();
var _10=_e.update;
_e.update=_f;
_e.update(this.m_observers[i]);
_e.update=_10;
}
}
}else{
for(i=0;i<this.m_observers.length;++i){
this.m_observers[i].getObserver().update(this.m_observers[i].getSubject());
}
}
};
CObserver.prototype.attach=CObserver_attach;
CObserver.prototype.detach=CObserver_detach;
CObserver.prototype.notify=CObserver_notify;
CObserver.prototype.hasObserver=CObserver_hasObserver;
function CState(_11,_12,_13,evt){
this.m_subject=_11;
this.m_observer=_12;
this.m_callback=_13;
this.m_evt=evt;
};
function CState_getObserver(){
return this.m_observer;
};
function CState_getCallback(){
return this.m_callback;
};
function CState_getSubject(){
return this.m_subject;
};
function CState_getEvt(){
return this.m_evt;
};
CState.prototype.getObserver=CState_getObserver;
CState.prototype.getCallback=CState_getCallback;
CState.prototype.getSubject=CState_getSubject;
CState.prototype.getEvt=CState_getEvt;
function CParameterValueStringOperators(_15,_16,_17,_18){
this.m_sBetween=_15;
this.m_sNotBetween=_16;
this.m_sLessThan=_17;
this.m_sGreaterThan=_18;
};
function CParameterValues(){
this.m_parameterValues=new CDictionary();
};
CParameterValues.prototype.length=function(){
var _19=this.m_parameterValues.keys();
if(typeof _19=="undefined"||_19==null){
return 0;
}
return _19.length;
};
CParameterValues.prototype.getParameterValue=function(_1a){
if(typeof _1a!="string"||_1a==""){
return null;
}
if(this.m_parameterValues.exists(_1a)){
return this.m_parameterValues.get(_1a);
}
return null;
};
CParameterValues.prototype.getAt=function(_1b){
if(_1b<this.length()){
var _1c=this.m_parameterValues.keys();
if(this.m_parameterValues.exists(_1c[_1b])){
return this.m_parameterValues.get(_1c[_1b]);
}
}
return null;
};
CParameterValues.prototype.addParameterValue=function(_1d,_1e){
var _1f=this.getParameterValue(_1d);
if(_1f==null){
_1f=new CParameterValue();
_1f.setName(_1d);
}
_1f.addParmValueItem(_1e);
this.m_parameterValues.add(_1d,_1f);
};
CParameterValues.prototype.removeParameterValue=function(_20){
return (this.m_parameterValues.remove(_20)!=null);
};
CParameterValues.prototype.removeSimpleParmValueItem=function(_21,_22){
var _23=this.getParameterValue(_21);
if(_23==null){
return false;
}
return _23.removeSimpleParmValueItem(_22);
};
CParameterValues.prototype.addSimpleParmValueItem=function(_24,_25,_26,_27){
if(typeof _24!="string"||_24==""){
return null;
}
if(typeof _25!="string"||_25==""){
return null;
}
if(typeof _26!="string"){
return null;
}
if(typeof _27!="string"||(_27!="false"&&_27!="true")){
return null;
}
var _28=null;
if(this.m_parameterValues.exists(_24)==false){
_28=new CParameterValue(_24);
this.m_parameterValues.add(_24,_28);
}
_28=this.m_parameterValues.get(_24);
if(typeof _28=="undefined"||_28==null){
return null;
}
var _29=_28.getParmValueItems();
for(var _2a=0;_2a<_29.length;++_2a){
var _2b=_29[_2a];
if(_2b.getDisplayValue()==_26&&_2b.getUseValue()==_25){
return;
}
}
return _28.addSimpleParmValueItem(_25,_26,_27);
};
CParameterValues.prototype.getSimpleParmValueItem=function(_2c,_2d){
var _2e=this.getParameterValue(_2c);
if(_2e!=null){
return _2e.getSimpleParmValueItem(_2d);
}
return null;
};
CParameterValues.prototype.load=function(_2f){
return this.loadWithOptions(_2f,true);
};
CParameterValues.prototype.loadWithOptions=function(_30,_31){
try{
var _32=_30.childNodes;
for(var _33=0;_33<_32.length;++_33){
var _34=_32[_33];
if(_34.nodeType==3){
continue;
}
var _35=new CParameterValue();
if(_35.load(_34)){
var _36=_35.name();
if(_36!=""){
if(_31==true||_36.indexOf("credential:")!=0){
this.m_parameterValues.add(_36,_35);
}
}
}else{
delete _35;
}
}
}
catch(e){
return false;
}
return true;
};
CParameterValues.prototype.buildXML=function(_37,_38,_39){
var _3a=_38.createElement(_39);
_37.XMLBuilderSetAttributeNodeNS(_3a,"xmlns:xs","http://www.w3.org/2001/XMLSchema");
_37.XMLBuilderSetAttributeNodeNS(_3a,"xmlns:bus","http://developer.cognos.com/schemas/bibus/3/");
_37.XMLBuilderSetAttributeNodeNS(_3a,"xmlns:xsd","http://www.w3.org/2001/XMLSchema");
_37.XMLBuilderSetAttributeNodeNS(_3a,"xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance");
_37.XMLBuilderSetAttributeNodeNS(_3a,"SOAP-ENC:arrayType","bus:parameterValue[]","http://schemas.xmlsoap.org/soap/encoding/");
_37.XMLBuilderSetAttributeNodeNS(_3a,"xsi:type","SOAP-ENC:Array","http://www.w3.org/2001/XMLSchema-instance");
_38.documentElement.appendChild(_3a);
var _3b=this.m_parameterValues.keys();
for(var _3c=0;_3c<_3b.length;++_3c){
if(this.m_parameterValues.exists(_3b[_3c])){
var _3d=this.m_parameterValues.get(_3b[_3c]);
_3d.generateXML(_37,_3a);
}
}
return _3a;
};
CParameterValues.prototype.generateXML=function(_3e,_3f,_40){
var _41="parameterValues";
if(typeof _40!="undefined"&&_40!=null){
_41=_40;
}
XMLBuilderSerializeNode(this.buildXML(_3e,_3f,_41));
return XMLBuilderSerializeNode(_3f);
};
function CParameterValue(_42){
this.m_name=_42;
this.m_parmValueItems=[];
};
CParameterValue.prototype.name=function(){
return this.m_name;
};
CParameterValue.prototype.setName=function(_43){
this.m_name=_43;
};
CParameterValue.prototype.getParmValueItems=function(){
return this.m_parmValueItems;
};
CParameterValue.prototype.length=function(){
return this.m_parmValueItems.length;
};
CParameterValue.prototype.addParmValueItem=function(_44){
this.m_parmValueItems.push(_44);
};
CParameterValue.prototype.addSimpleParmValueItem=function(_45,_46,_47){
if(typeof _45!="string"||_45==""){
return null;
}
if(typeof _46!="string"){
return null;
}
if(typeof _47!="string"||(_47!="false"&&_47!="true")){
return null;
}
var _48=new CSimpleParmValueItem(_45,_46,_47);
this.m_parmValueItems.push(_48);
return _48;
};
CParameterValue.prototype.removeSimpleParmValueItem=function(_49){
if(typeof _49!="string"||_49==""){
return false;
}
var _4a=[];
var _4b=false;
for(var _4c=0;_4c<this.length();++_4c){
var _4d=this.m_parmValueItems[_4c];
if(_4d instanceof CSimpleParmValueItem){
if(_4d.getUseValue()==_49){
_4b=true;
continue;
}
}
_4a.push(_4d);
}
this.m_parmValueItems=_4a;
return _4b;
};
CParameterValue.prototype.getSimpleParmValueItem=function(_4e){
if(typeof _4e!="string"||_4e==""){
return null;
}
for(var _4f=0;_4f<this.length();++_4f){
var _50=this.m_parmValueItems[_4f];
if(_50 instanceof CSimpleParmValueItem){
if(_50.getUseValue()==_4e){
return _50;
}
}
}
return null;
};
CParameterValue.prototype.load=function(_51){
var _52=_51.getAttributeNode("xsi:type");
if(_52==null||_52.nodeValue!="bus:parameterValue"){
return false;
}
var _53=XMLHelper_FindChildByTagName(_51,"name",false);
if(_53==null){
return false;
}
this.m_name=XMLHelper_GetText(_53);
if(this.m_name==""){
return false;
}
var _54=XMLHelper_FindChildByTagName(_51,"value",false);
if(_54==null){
return false;
}
var _55=_54.getAttributeNode("xsi:type");
if(_55==null||_55.nodeValue!="SOAP-ENC:Array"){
return false;
}
var _56=_54.getAttributeNode("SOAP-ENC:arrayType");
if(_56==null||_56.nodeValue.indexOf("bus:parmValueItem[")==-1){
return false;
}
var _57=_54.childNodes;
for(var _58=0;_58<_57.length;++_58){
var _59=_57[_58];
if(_59.nodeType==3){
continue;
}
var _5a=_59.getAttributeNode("xsi:type");
if(_5a!=null){
var _5b;
var _5c;
switch(_5a.nodeValue){
case "bus:simpleParmValueItem":
_5b=new CSimpleParmValueItem("","","");
break;
case "bus:boundRangeParmValueItem":
_5b=new CBoundRangeParmValueItem();
break;
case "bus:unboundedEndRangeParmValueItem":
_5b=new CUnboundedEndRangeParmValueItem();
break;
case "bus:unboundedStartRangeParmValueItem":
_5b=new CUnboundedStartRangeParmValueItem();
break;
case "bus:hierarchicalParmValueItem":
_5b=new CHierarchicalParmValueItem();
break;
default:
return false;
}
_5c=_5b.load(_59);
if(_5c){
this.m_parmValueItems.push(_5b);
}else{
delete _5b;
}
}
}
return true;
};
CParameterValue.prototype.generateXML=function(_5d,_5e){
var _5f=_5e.ownerDocument;
var _60=_5f.createElement("item");
_5d.XMLBuilderSetAttributeNodeNS(_60,"xsi:type","bus:parameterValue","http://www.w3.org/2001/XMLSchema-instance");
_5e.appendChild(_60);
var _61=_5d.XMLBuilderCreateElementNS("http://developer.cognos.com/schemas/bibus/3/","bus:name",_5f);
_5d.XMLBuilderSetAttributeNodeNS(_61,"xsi:type","xs:string","http://www.w3.org/2001/XMLSchema-instance");
_61.appendChild(_5f.createTextNode(this.m_name));
_60.appendChild(_61);
var _62=_5d.XMLBuilderCreateElementNS("http://developer.cognos.com/schemas/bibus/3/","bus:value",_5f);
_5d.XMLBuilderSetAttributeNodeNS(_62,"SOAP-ENC:arrayType","bus:parmValueItem[]","http://schemas.xmlsoap.org/soap/encoding/");
_5d.XMLBuilderSetAttributeNodeNS(_62,"xsi:type","SOAP-ENC:Array","http://www.w3.org/2001/XMLSchema-instance");
_60.appendChild(_62);
for(var _63=0;_63<this.m_parmValueItems.length;++_63){
if(typeof this.m_parmValueItems[_63].generateXML!="undefined"){
this.m_parmValueItems[_63].generateXML(_5d,_62);
}
}
};
CParameterValue.prototype.toString=function(_64){
var _65="";
for(var _66=0;_66<this.m_parmValueItems.length;++_66){
if(_65!=""){
_65+=", ";
}
if(typeof this.m_parmValueItems[_66].toString!="undefined"){
_65+=this.m_parmValueItems[_66].toString(_64);
}
}
return _65;
};
function CParmValueItem(){
this.initialize("true");
};
CParmValueItem.prototype.getInclusiveValue=function(){
return this.m_inclusiveValue;
};
CParmValueItem.prototype.setInclusiveValue=function(_67){
this.m_inclusiveValue=_67;
};
CParmValueItem.prototype.initialize=function(_68){
this.m_inclusiveValue=_68;
};
CParmValueItem.prototype.load=function(_69){
this.m_inclusiveValue="true";
var _6a=XMLHelper_FindChildByTagName(_69,"inclusive",false);
if(_6a!=null){
var _6b=XMLHelper_GetText(_6a);
if(_6b=="true"||_6b=="false"){
this.m_inclusiveValue=_6b;
}
}
};
CParmValueItem.prototype.generateXML=function(_6c,_6d){
var _6e=_6d.ownerDocument;
var _6f=_6c.XMLBuilderCreateElementNS("http://developer.cognos.com/schemas/bibus/3/","bus:inclusive",_6e);
_6c.XMLBuilderSetAttributeNodeNS(_6f,"xsi:type","xs:boolean","http://www.w3.org/2001/XMLSchema-instance");
_6f.appendChild(_6e.createTextNode(this.m_inclusiveValue));
_6d.appendChild(_6f);
};
function CSimpleParmValueItem(_70,_71,_72){
CSimpleParmValueItem.baseclass.initialize.call(this,_72);
this.m_useValue=_70;
this.m_displayValue=_71;
};
CSimpleParmValueItem.prototype=new CParmValueItem();
CSimpleParmValueItem.prototype.constructor=CSimpleParmValueItem;
CSimpleParmValueItem.baseclass=CParmValueItem.prototype;
CSimpleParmValueItem.prototype.getUseValue=function(){
return this.m_useValue;
};
CSimpleParmValueItem.prototype.getDisplayValue=function(){
return this.m_displayValue;
};
CSimpleParmValueItem.prototype.getParmValueItem=function(){
return this.m_parmValueItem;
};
CSimpleParmValueItem.prototype.setDisplayValue=function(_73){
this.m_displayValue=_73;
};
CSimpleParmValueItem.prototype.setUseValue=function(_74){
this.m_useValue=_74;
};
CSimpleParmValueItem.prototype.toString=function(_75){
return this.getDisplayValue();
};
CSimpleParmValueItem.prototype.load=function(_76){
CSimpleParmValueItem.baseclass.load.call(this,_76);
var _77=XMLHelper_FindChildByTagName(_76,"use",false);
if(_77==null){
return false;
}
var _78=XMLHelper_GetText(_77);
if(_78==""){
return false;
}
this.m_useValue=_78;
var _79=XMLHelper_FindChildByTagName(_76,"display",false);
if(_79!=null){
this.m_displayValue=XMLHelper_GetText(_79);
}
return true;
};
CSimpleParmValueItem.prototype.generateXML=function(_7a,_7b){
var _7c=_7b.ownerDocument;
var _7d=_7c.createElement("item");
_7a.XMLBuilderSetAttributeNodeNS(_7d,"xsi:type","bus:simpleParmValueItem","http://www.w3.org/2001/XMLSchema-instance");
_7b.appendChild(_7d);
CSimpleParmValueItem.baseclass.generateXML.call(this,_7a,_7d);
var _7e=_7a.XMLBuilderCreateElementNS("http://developer.cognos.com/schemas/bibus/3/","bus:use",_7c);
_7a.XMLBuilderSetAttributeNodeNS(_7e,"xsi:type","xs:string","http://www.w3.org/2001/XMLSchema-instance");
_7e.appendChild(_7c.createTextNode(this.m_useValue));
_7d.appendChild(_7e);
var _7f=_7a.XMLBuilderCreateElementNS("http://developer.cognos.com/schemas/bibus/3/","bus:display",_7c);
_7a.XMLBuilderSetAttributeNodeNS(_7f,"xsi:type","xs:string","http://www.w3.org/2001/XMLSchema-instance");
_7f.appendChild(_7c.createTextNode(this.m_displayValue));
_7d.appendChild(_7f);
};
function CBoundRangeParmValueItem(){
CBoundRangeParmValueItem.baseclass.initialize.call(this,"true");
this.m_start=null;
this.m_end=null;
};
CBoundRangeParmValueItem.prototype=new CParmValueItem();
CBoundRangeParmValueItem.prototype.constructor=CBoundRangeParmValueItem;
CBoundRangeParmValueItem.baseclass=CParmValueItem.prototype;
CBoundRangeParmValueItem.prototype.setStart=function(_80){
this.m_start=_80;
};
CBoundRangeParmValueItem.prototype.getStart=function(){
return this.m_start;
};
CBoundRangeParmValueItem.prototype.setEnd=function(end){
this.m_end=end;
};
CBoundRangeParmValueItem.prototype.getEnd=function(){
return this.m_end;
};
CBoundRangeParmValueItem.prototype.toString=function(_82){
return CViewerCommon.getMessage(_82.m_sBetween,[this.m_start.getDisplayValue(),this.m_end.getDisplayValue()]);
};
CBoundRangeParmValueItem.prototype.load=function(_83){
CBoundRangeParmValueItem.baseclass.load.call(this,_83);
this.m_start=new CSimpleParmValueItem("","","");
this.m_start.load(XMLHelper_FindChildByTagName(_83,"start",false));
this.m_end=new CSimpleParmValueItem("","","");
this.m_end.load(XMLHelper_FindChildByTagName(_83,"end",false));
return true;
};
CBoundRangeParmValueItem.prototype.generateXML=function(_84,_85){
var _86=_85.ownerDocument;
var _87=_86.createElement("item");
_84.XMLBuilderSetAttributeNodeNS(_87,"xsi:type","bus:boundRangeParmValueItem","http://www.w3.org/2001/XMLSchema-instance");
_85.appendChild(_87);
CBoundRangeParmValueItem.baseclass.generateXML.call(this,_84,_87);
var _88=_84.XMLBuilderCreateElementNS("http://developer.cognos.com/schemas/bibus/3/","bus:start",_86);
_87.appendChild(_88);
this.m_start.generateXML(_84,_88);
var _89=_84.XMLBuilderCreateElementNS("http://developer.cognos.com/schemas/bibus/3/","bus:end",_86);
_87.appendChild(_89);
this.m_end.generateXML(_84,_89);
};
function CUnboundedStartRangeParmValueItem(){
CUnboundedStartRangeParmValueItem.baseclass.initialize.call(this,"true");
this.m_end=null;
};
CUnboundedStartRangeParmValueItem.prototype=new CParmValueItem();
CUnboundedStartRangeParmValueItem.prototype.constructor=CUnboundedStartRangeParmValueItem;
CUnboundedStartRangeParmValueItem.baseclass=CParmValueItem.prototype;
CUnboundedStartRangeParmValueItem.prototype.setEnd=function(end){
this.m_end=end;
};
CUnboundedStartRangeParmValueItem.prototype.getEnd=function(){
return this.m_end;
};
CUnboundedStartRangeParmValueItem.prototype.load=function(_8b){
CUnboundedStartRangeParmValueItem.baseclass.load.call(this,_8b);
this.m_end=new CSimpleParmValueItem("","","");
this.m_end.load(XMLHelper_FindChildByTagName(_8b,"end",false));
return true;
};
CUnboundedStartRangeParmValueItem.prototype.generateXML=function(_8c,_8d){
var _8e=_8d.ownerDocument;
var _8f=_8e.createElement("item");
_8c.XMLBuilderSetAttributeNodeNS(_8f,"xsi:type","bus:unboundedStartRangeParmValueItem","http://www.w3.org/2001/XMLSchema-instance");
_8d.appendChild(_8f);
CUnboundedStartRangeParmValueItem.baseclass.generateXML.call(this,_8c,_8f);
var _90=_8c.XMLBuilderCreateElementNS("http://developer.cognos.com/schemas/bibus/3/","bus:end",_8e);
_8f.appendChild(_90);
this.m_end.generateXML(_8c,_90);
};
CUnboundedStartRangeParmValueItem.prototype.toString=function(_91){
return _91.m_sLessThan+" "+this.m_end.getDisplayValue();
};
function CUnboundedEndRangeParmValueItem(){
CUnboundedEndRangeParmValueItem.baseclass.initialize.call(this,"true");
this.m_start=null;
};
CUnboundedEndRangeParmValueItem.prototype=new CParmValueItem();
CUnboundedEndRangeParmValueItem.prototype.constructor=CUnboundedEndRangeParmValueItem;
CUnboundedEndRangeParmValueItem.baseclass=CParmValueItem.prototype;
CUnboundedEndRangeParmValueItem.prototype.setStart=function(_92){
this.m_start=_92;
};
CUnboundedEndRangeParmValueItem.prototype.getStart=function(){
return this.m_start;
};
CUnboundedEndRangeParmValueItem.prototype.load=function(_93){
CUnboundedEndRangeParmValueItem.baseclass.load.call(this,_93);
this.m_start=new CSimpleParmValueItem("","","");
this.m_start.load(XMLHelper_FindChildByTagName(_93,"start",false));
return true;
};
CUnboundedEndRangeParmValueItem.prototype.generateXML=function(_94,_95){
var _96=_95.ownerDocument;
var _97=_96.createElement("item");
_94.XMLBuilderSetAttributeNodeNS(_97,"xsi:type","bus:unboundedEndRangeParmValueItem","http://www.w3.org/2001/XMLSchema-instance");
_95.appendChild(_97);
CUnboundedEndRangeParmValueItem.baseclass.generateXML.call(this,_94,_97);
var _98=_94.XMLBuilderCreateElementNS("http://developer.cognos.com/schemas/bibus/3/","bus:start",_96);
_97.appendChild(_98);
this.m_start.generateXML(_94,_98);
};
CUnboundedEndRangeParmValueItem.prototype.toString=function(_99){
return _99.m_sGreaterThan+" "+this.m_start.getDisplayValue();
};
function CHierarchicalParmValueItem(){
CHierarchicalParmValueItem.baseclass.initialize.call(this,"true");
this.m_value=null;
this.m_subNodes=[];
};
CHierarchicalParmValueItem.prototype=new CParmValueItem();
CHierarchicalParmValueItem.prototype.constructor=CHierarchicalParmValueItem;
CHierarchicalParmValueItem.baseclass=CParmValueItem.prototype;
CHierarchicalParmValueItem.prototype.getValue=function(){
return this.m_value;
};
CHierarchicalParmValueItem.prototype.getSubNodes=function(){
return this.m_subNodes;
};
CHierarchicalParmValueItem.prototype.setValue=function(_9a){
this.m_value=_9a;
};
CHierarchicalParmValueItem.prototype.setSubNodes=function(_9b){
this.m_subNodes=_9b;
};
CHierarchicalParmValueItem.prototype.load=function(_9c){
CHierarchicalParmValueItem.baseclass.load.call(this,_9c);
this.m_value=new CSimpleParmValueItem("","","");
this.m_value.load(XMLHelper_FindChildByTagName(_9c,"value",false));
var _9d=XMLHelper_FindChildByTagName(_9c,"subNodes",false);
if(_9d==null){
return false;
}
var _9e=_9d.getAttributeNode("xsi:type");
if(_9e==null||_9e.nodeValue!="SOAP-ENC:Array"){
return false;
}
var _9f=_9d.getAttributeNode("SOAP-ENC:arrayType");
if(_9f==null||_9f.nodeValue!="bus:hierarchicalParmValueItem[]"){
return false;
}
var _a0=_9d.childNodes;
for(var _a1=0;_a1<_a0.length;++_a1){
var _a2=new CHierarchicalParmValueItem();
_a2.load(_a0[_a1]);
this.m_subNodes.push(_a2);
}
return true;
};
CHierarchicalParmValueItem.prototype.generateXML=function(_a3,_a4){
var _a5=_a4.ownerDocument;
var _a6=_a5.createElement("item");
_a3.XMLBuilderSetAttributeNodeNS(_a6,"xsi:type","bus:hierarchicalParmValueItem","http://www.w3.org/2001/XMLSchema-instance");
_a4.appendChild(_a6);
CHierarchicalParmValueItem.baseclass.generateXML.call(this,_a3,_a6);
var _a7=_a3.XMLBuilderCreateElementNS("http://developer.cognos.com/schemas/bibus/3/","bus:value",_a5);
_a6.appendChild(_a7);
this.m_value.generateXML(_a3,_a7);
var _a8=_a3.XMLBuilderCreateElementNS("http://developer.cognos.com/schemas/bibus/3/","bus:subNodes",_a5);
_a3.XMLBuilderSetAttributeNodeNS(_a8,"SOAP-ENC:arrayType","bus:hierarchicalParmValueItem[]","http://schemas.xmlsoap.org/soap/encoding/");
_a3.XMLBuilderSetAttributeNodeNS(_a8,"xsi:type","SOAP-ENC:Array","http://www.w3.org/2001/XMLSchema-instance");
_a6.appendChild(_a8);
for(var _a9=0;_a9<this.m_subNodes.length;++_a9){
this.m_subNodes[_a9].generateXML(_a3,_a8);
}
};
CHierarchicalParmValueItem.prototype.toString=function(){
return "";
};
function XMLParser(s,_ab){
if(s==null){
return null;
}
if(/^\s*</.test(s)){
s=s.replace(/^\s*/,"");
if(s.charAt(1)=="/"){
var _ac=new RegExp("^</"+_ab.getName()+"\\s*>","gi");
if(!_ac.test(s)){
alert("invalid XML "+_ab.getName()+"\n"+s);
return null;
}
return XMLParser(s.replace(RegExp.lastMatch,""),_ab.parentNode);
}else{
var _ad=/^\s*<([\w:\-_\.]+)/;
if(_ad.test(s)){
var _ae=RegExp.$1;
var e=new XMLElement(_ae,_ab);
var _b0=new RegExp("^<"+_ae+"[^>]*>");
s=s.replace(_b0,"");
var _b1=RegExp.lastMatch;
var _b2=/([\w:\-_\.]+)="([^"]*)"/gi;
var _b3=_b1.match(_b2);
if(_b3!=null){
for(var i=0;i<_b3.length;i++){
var _b5=_b3[i];
(/([\w:\-_\.]+)\s*=\s*"(.*)"/).test(_b5);
e.setAttribute(RegExp.$1,RegExp.$2);
}
}
if(!(/\/>$/).test(_b1)){
XMLParser(s,e);
return e;
}else{
XMLParser(s,_ab);
return e;
}
}
}
}else{
if(s&&_ab){
var _b6=new RegExp("([^<]*)</"+_ab.getName()+"\\s*[^>]*>","gi");
_b6.test(s);
var _b7=RegExp.$1;
_ab.setValue(_b7);
return (XMLParser(s.replace(_b7,""),_ab));
}
}
return null;
};
function XMLElement(s,_b9){
this.nodeName=s;
this.nodeValue="";
this.attributes=[];
this.childNodes=[];
this.parentNode=_b9;
if(this.parentNode){
this.parentNode.appendChild(this);
}
};
XMLElement.prototype.appendChild=function(e){
this.childNodes[this.childNodes.length]=e;
};
XMLElement.prototype.hasChildNodes=function(){
if(this.childNodes.length>0){
return true;
}else{
return false;
}
};
XMLElement.prototype.findChildByName=function(n,_bc){
if(this.getName()==n){
return (this);
}
for(var i=0;i<this.childNodes.length;i++){
if(this.childNodes[i].getName()==n){
return this.childNodes[i];
}
}
if(_bc!=false){
for(i=0;i<this.childNodes.length;i++){
var _be=this.childNodes[i].findChildByName(n,_bc);
if(_be){
return _be;
}
}
}
return null;
};
XMLElement.prototype.findChildWithAttribute=function(_bf,val){
for(var i=0;i<this.childNodes.length;i++){
if(this.childNodes[i].getAttribute(_bf)==val){
return this.childNodes[i];
}
}
return null;
};
XMLElement.prototype.getElementsByTagName=function(s,_c3){
var a=[];
for(var i=0;i<this.childNodes.length;i++){
if(this.childNodes[i].getName()==s){
a[a.length]=this.childNodes[i];
}
}
if(_c3!=false){
for(i=0;i<this.childNodes.length;i++){
var _c6=this.childNodes[i].getElementsByTagName(s);
for(var j=0;j<_c6.length;j++){
a[a.length]=_c6[j];
}
}
}
return a;
};
XMLElement.prototype.getName=function(){
return this.nodeName;
};
XMLElement.prototype.getValue=function(){
return this.nodeValue;
};
XMLElement.prototype.setAttribute=function(a,v){
this.attributes["_"+a]=v;
};
XMLElement.prototype.setValue=function(v){
this.nodeValue=v;
};
XMLElement.prototype.getAttribute=function(a){
var _cc="";
if(typeof sXmlDecode=="function"){
_cc=sXmlDecode(this.attributes["_"+a]);
}else{
_cc=this.attributes["_"+a];
}
return (_cc==null?"":_cc);
};
XMLElement.prototype.toString=function(){
var s="<"+this.getName();
for(var i in this.attributes){
s+=" "+i.substring(1)+"=\""+this.attributes[i]+"\"";
}
s+=">"+this.getValue();
for(var j=0;j<this.childNodes.length;j++){
s+=this.childNodes[j].toString();
}
s+="</"+this.getName()+">";
return s;
};
function XMLBuilderLoadXMLFromString(_d0,_d1){
var _d2=null;
if(typeof DOMParser!="undefined"){
_d2=new DOMParser().parseFromString(_d0,"application/xml");
}else{
if(typeof ActiveXObject!="undefined"){
try{
_d2=new ActiveXObject("Microsoft.XMLDOM");
_d2.loadXML(_d0);
}
catch(e){
}
}
}
return _d2;
};
function XMLBuilderCreateXMLDocument(_d3,_d4,_d5){
var _d6=null;
_d4=_d4||"";
_d5=_d5||null;
if(document.implementation&&document.implementation.createDocument){
if(typeof _d4=="undefined"){
_d4="http://www.w3.org/2000/xmlns/";
}
_d6=document.implementation.createDocument(_d4,_d3,_d5);
}else{
if(typeof ActiveXObject!="undefined"){
try{
_d6=new ActiveXObject("Microsoft.XMLDOM");
var _d7=_d6.createNode(1,_d3,_d4);
_d6.appendChild(_d7);
}
catch(e){
}
}
}
return _d6;
};
function XMLBuilderCreateElementNS(_d8,_d9,_da){
var _db=null;
if(typeof _da.createElementNS!="undefined"){
if(typeof _d8=="undefined"){
_d8="http://www.w3.org/2000/xmlns/";
}
_db=_da.createElementNS(_d8,_d9);
}else{
if(typeof _da.createNode!="undefined"){
_db=_da.createNode(1,_d9,_d8);
}
}
return _db;
};
function XMLBuilderSetAttributeNodeNS(_dc,_dd,_de,_df){
if(typeof _dc.setAttributeNS!="undefined"){
if(typeof _df=="undefined"){
_df="http://www.w3.org/2000/xmlns/";
}
_dc.setAttributeNS(_df,_dd,_de);
}else{
if(typeof _dc.ownerDocument!="undefined"&&typeof _dc.ownerDocument.createNode!="undefined"){
var _e0=_dc.ownerDocument.createNode(2,_dd,_df);
_e0.nodeValue=_de;
_dc.setAttributeNode(_e0);
}
}
};
function XMLBuilderSerializeNode(_e1){
var _e2="";
if(typeof XMLSerializer!="undefined"){
try{
_e2=new XMLSerializer().serializeToString(_e1);
}
catch(e){
}
}else{
if(typeof _e1=="object"&&typeof _e1.xml!="undefined"){
_e2=_e1.xml;
}
}
return _e2.replace(/^\s+/g,"").replace(/\s+$/g,"");
};
function XMLHelper_GetText(_e3,_e4){
var _e5="";
var _e6=_e3.childNodes;
for(var i=0;i<_e6.length;++i){
if(_e6[i].nodeType==3){
_e5+=_e6[i].nodeValue;
}else{
if(_e6[i].nodeName=="Value"){
_e5+=_e6[i].getAttribute("display");
}else{
if(_e4){
_e5+=XMLHelper_GetText(_e6[i],true);
}
}
}
}
return _e5;
};
function XMLHelper_GetLocalName(_e8){
if(typeof _e8.baseName!="undefined"){
return _e8.baseName;
}
return _e8.localName;
};
function XMLHelper_FindChildByTagName(_e9,_ea,_eb){
if(typeof _eb=="undefined"||(_eb!=true&&_eb!=false)){
_eb=true;
}
if(XMLHelper_GetLocalName(_e9)==_ea){
return (_e9);
}
var i;
for(i=0;i<_e9.childNodes.length;i++){
if(XMLHelper_GetLocalName(_e9.childNodes[i])==_ea){
return _e9.childNodes[i];
}
}
if(_eb!=false){
for(i=0;i<_e9.childNodes.length;i++){
var _ed=XMLHelper_FindChildByTagName(_e9.childNodes[i],_ea,_eb);
if(_ed){
return _ed;
}
}
}
return null;
};
function XMLHelper_FindChildrenByTagName(_ee,_ef,_f0){
if(typeof _f0=="undefined"||(_f0!=true&&_f0!=false)){
_f0=true;
}
var _f1=[];
var _f2=_ee.childNodes;
for(var _f3=0;_f3<_f2.length;_f3++){
if(XMLHelper_GetLocalName(_f2[_f3])==_ef){
_f1[_f1.length]=_f2[_f3];
}
if(_f0===true){
var _f4=XMLHelper_FindChildrenByTagName(_f2[_f3],_ef,_f0);
if(_f4.length>0){
_f1=_f1.concat(_f4);
}
}
}
return _f1;
};
function XMLHelper_GetFirstChildElement(oEl){
var _f6=null;
if(oEl&&oEl.childNodes&&oEl.childNodes.length){
for(var i=0;i<oEl.childNodes.length;i++){
if(oEl.childNodes[i].nodeType==1){
_f6=oEl.childNodes[i];
break;
}
}
}
return _f6;
};
function XMLHelper_FindChildrenByAttribute(_f8,_f9,_fa,_fb,_fc){
if(typeof _fb=="undefined"||(_fb!=true&&_fb!=false)){
_fb=true;
}
if(typeof _fa!="string"&&typeof _fa!="number"){
_fa=null;
}else{
_fa=_fa.toString();
}
var _fd=[];
var _fe=_f8.childNodes;
for(var _ff=0;_ff<_fe.length;_ff++){
var _100=_fe[_ff];
if(_100.nodeType==1){
var _101=_100.getAttribute(_f9);
if(_101!==null){
if(_fa===null||_101==_fa){
if(_fc){
return [_100];
}else{
_fd[_fd.length]=_100;
}
}
}
if(_fb===true){
var _102=XMLHelper_FindChildrenByAttribute(_100,_f9,_fa,_fb,_fc);
if(_102.length>0){
if(_fc){
if(_102.length==1){
return _102;
}else{
return [_102[0]];
}
}else{
_fd=_fd.concat(_102);
}
}
}
}
}
return _fd;
};
var DICTIONARY_INVALID_KEY=-1;
var DICTIONARY_SUCCESS=1;
function CDictionary(){
this.m_aValues={};
};
function CDictionary_add(sKey,_104){
if(typeof sKey!="string"&&typeof sKey!="number"){
return DICTIONARY_INVALID_KEY;
}
this.m_aValues[sKey]=_104;
return DICTIONARY_SUCCESS;
};
function CDictionary_exists(sKey){
if(typeof sKey!="string"&&typeof sKey!="number"){
return false;
}
return (typeof this.m_aValues[sKey]!="undefined");
};
function CDictionary_get(sKey){
if(typeof sKey!="string"&&typeof sKey!="number"){
return null;
}
if(this.exists(sKey)===true){
return this.m_aValues[sKey];
}else{
return null;
}
};
function CDictionary_keys(){
var _107=[];
for(var _108 in this.m_aValues){
_107.push(_108);
}
return _107.sort();
};
function CDictionary_remove(sKey){
if(typeof sKey!="string"&&typeof sKey!="number"){
return DICTIONARY_INVALID_KEY;
}
var _10a=this.get(sKey);
delete this.m_aValues[sKey];
return _10a;
};
function CDictionary_removeAll(){
this.m_aValues=[];
return DICTIONARY_SUCCESS;
};
function CDictionary_append(_10b){
if(_10b instanceof CDictionary&&_10b.keys().length>0){
var _10c=_10b.keys();
for(var _10d=0;_10d<_10c.length;_10d++){
this.add(_10c[_10d],_10b.get(_10c[_10d]));
}
}
};
CDictionary.prototype.add=CDictionary_add;
CDictionary.prototype.exists=CDictionary_exists;
CDictionary.prototype.get=CDictionary_get;
CDictionary.prototype.keys=CDictionary_keys;
CDictionary.prototype.remove=CDictionary_remove;
CDictionary.prototype.removeAll=CDictionary_removeAll;
CDictionary.prototype.append=CDictionary_append;
function CognosTabControl(_10e,_10f){
this._init();
this._outsideContainer=_10e;
this._callback=_10f;
};
CognosTabControl.prototype._init=function(){
this._tabs=null;
this._tabControlNode=null;
this._scrollButtonsVisible=false;
this._scrollLeftButton=null;
this._scrollRightButton=null;
this._selectedTab=null;
this._wrapperDiv=null;
this._topContainer=null;
this._seperator=null;
this._isSavedOutput=false;
this._isHighContrast=false;
};
CognosTabControl.prototype.destroy=function(){
if(this._wrapperDiv){
this._wrapperDiv.parentNode.removeChild(this._wrapperDiv);
delete this._wrapperDiv;
this._wrapperDiv=null;
}
};
CognosTabControl.prototype.setHighContrast=function(_110){
this._isHighContrast=_110;
};
CognosTabControl.prototype.isHighContrast=function(){
return this._isHighContrast;
};
CognosTabControl.prototype.setSpaceSaverContainer=function(node){
this._spaceSaverContainer=node;
};
CognosTabControl.prototype.useAbsolutePosition=function(_112){
this._useAbsolutePosition=_112;
};
CognosTabControl.prototype.setScrollAttachNode=function(node){
this._scrollAttachNode=node;
};
CognosTabControl.prototype.setIsSavedOutput=function(_114){
this._isSavedOutput=_114;
};
CognosTabControl.prototype.isSavedOutput=function(){
return this._isSavedOutput;
};
CognosTabControl.prototype.getSelectedTabId=function(){
if(this._selectedTab){
return this._selectedTab.getId();
}
return null;
};
CognosTabControl.prototype.getSelectedTab=function(){
return this._selectedTab?this._selectedTab:null;
};
CognosTabControl.prototype.isTopAligned=function(){
return this._isTopAligned;
};
CognosTabControl.prototype.getWrapperDiv=function(){
return this._wrapperDiv;
};
CognosTabControl.prototype.getVisibleWidth=function(){
var _115=this._scrollRightButton?this._scrollRightButton.getWidth()+11:0;
return this._wrapperDiv.clientWidth-_115;
};
CognosTabControl.prototype.getMaxRightScroll=function(){
var _116=this._scrollRightButton?this._scrollRightButton.getWidth()+11:0;
return this._totalWrapperWidth+_116+8-this._wrapperDiv.clientWidth;
};
CognosTabControl.prototype.hide=function(){
this._topContainer.style.display="none";
};
CognosTabControl.prototype.resetPosition=function(){
if(this._useAbsolutePosition===true){
this._outsideContainer.srollLeft="0px";
this._outsideContainer.scrollTop="0px";
this._topContainer.style.top="";
this._topContainer.style.bottom="";
this._topContainer.style.left="0px";
if(this._isTopAligned){
this._topContainer.style.top="0px";
}else{
this._topContainer.style.bottom="0px";
}
}
};
CognosTabControl.prototype.render=function(_117){
this._updateTabInfo(_117);
if(!this._tabControlNode){
var _118=this;
var _119=this._scrollAttachNode?this._scrollAttachNode:this._outsideContainer;
if(window.attachEvent){
window.attachEvent("onresize",function(){
_118.onResize();
});
if(this._useAbsolutePosition===true){
_119.attachEvent("onscroll",function(){
_118.onContainerScroll();
});
}
}else{
window.addEventListener("resize",function(){
_118.onResize();
},false);
if(this._useAbsolutePosition===true){
_119.addEventListener("scroll",function(){
_118.onContainerScroll();
},false);
}
}
this._outsideContainer.originalClassName=this._outsideContainer.className;
this._outsideContainer.className=this._outsideContainer.className+(this._isTopAligned?" ct_controlTop":" ct_controlBottom");
this._topContainer=document.createElement("div");
this._topContainer.className="ct_wrapperDiv";
if(this._useAbsolutePosition===true){
this._topContainer.style.width="100%";
this._topContainer.style.position="absolute";
this._topContainer.style.left="0px";
if(this._isTopAligned){
this._topContainer.style.top="0px";
}else{
this._topContainer.style.bottom="0px";
}
}
if(this._isTopAligned&&this._outsideContainer.firstChild){
this._outsideContainer.insertBefore(this._topContainer,this._outsideContainer.firstChild);
}else{
this._outsideContainer.appendChild(this._topContainer);
}
this._wrapperDiv=document.createElement("div");
this._wrapperDiv.setAttribute("role","presentation");
this._wrapperDiv.className="ct_wrapperDiv";
this._topContainer.appendChild(this._wrapperDiv);
this._tabControlNode=document.createElement("div");
this._tabControlNode.setAttribute("role","tablist");
this._tabControlNode.className="ct_control";
this._wrapperDiv.appendChild(this._tabControlNode);
this._totalWrapperWidth=0;
for(var i=0;i<this._tabs.length;i++){
var tab=this._tabs[i];
tab.render(this._tabControlNode);
this._totalWrapperWidth+=this._tabs[i].getWidth();
}
var _11c=0;
if(this._tabs[0]){
_11c=this._tabs[0].getHeight();
}
this._wrapperDiv.style.height=_11c+5+"px";
if(this._spaceSaverContainer){
this.spaceSaverDiv=document.createElement("div");
this.spaceSaverDiv.style.height=_11c+5+"px";
this.spaceSaverDiv.style.position="relative";
this.spaceSaverDiv.style.display="block";
this._spaceSaverContainer.appendChild(this.spaceSaverDiv);
}
this._createSeperator();
}else{
this.resetPosition();
}
this._topContainer.style.display="";
this.onResize();
this.selectTab(_117.currentTabId,false);
if(this._selectedTab){
this._selectedTab.scrollIntoView();
this.updateScrollButtons();
}
};
CognosTabControl.prototype.onContainerScroll=function(){
var _11d=this._scrollAttachNode?this._scrollAttachNode:this._topContainer;
this._topContainer.style.left=_11d.scrollLeft+"px";
if(this._isTopAligned){
this._topContainer.style.top=_11d.scrollTop+"px";
}else{
this._topContainer.style.bottom=(-_11d.scrollTop)+"px";
}
};
CognosTabControl.prototype._resetTabControl=function(){
if(this._outsideContainer.originalClassName){
this._outsideContainer.className=this._outsideContainer.originalClassName;
}else{
this._outsideContainer.className="";
}
if(this._topContainer){
var node=this._outsideContainer.removeChild(this._topContainer);
node=null;
}
this._init();
};
CognosTabControl.prototype._updateTabInfo=function(_11f){
this._isTopAligned=_11f.position=="topLeft"?true:false;
var tabs=_11f.tabs;
if(this._tabs){
if(this._tabs.length!=tabs.length){
this._resetTabControl();
}else{
for(var i=0;i<this._tabs.length;i++){
if(tabs[i].id!=this._tabs[i].getId()){
this._resetTabControl();
break;
}
}
}
}
if(!this._tabs){
this._tabs=[];
if(!tabs){
return;
}
for(var ii=0;ii<tabs.length;ii++){
var tab=new CognosTab(tabs[ii],this,ii);
this._tabs.push(tab);
}
}
};
CognosTabControl.prototype.getScrollPos=function(){
return this._wrapperDiv.scrollLeft;
};
CognosTabControl.prototype.scrollTo=function(_124){
this._wrapperDiv.scrollLeft=_124;
this.updateScrollButtons();
};
CognosTabControl.prototype.onResize=function(evt){
if(this._wrapperDiv.offsetWidth<this._totalWrapperWidth){
this._showScrollButtons();
this.updateScrollButtons();
if(this._selectedTab){
this._selectedTab.scrollIntoView();
}
if(this._scrollRightButton.isDisabled()){
this.scrollTo(this.getMaxRightScroll());
}
}else{
this._hideScrollButtons();
this.scrollTo(0);
}
};
CognosTabControl.prototype._showScrollButtons=function(){
if(this._scrollButtonsVisible){
return;
}
if(!this._scrollLeftButton){
var _126=0;
if(this._tabs[0]){
_126=this._tabs[0].getHeight();
}
this._scrollLeftButton=new CognosScrollButton("left",_126,this);
this._scrollLeftButton.render(this._topContainer);
this._scrollRightButton=new CognosScrollButton("right",_126,this);
this._scrollRightButton.render(this._topContainer);
}
this._scrollButtonsVisible=true;
this._scrollLeftButton.show();
this._scrollRightButton.show();
this._tabControlNode.style.left=this._scrollLeftButton.getWidth()-2+"px";
};
CognosTabControl.prototype.updateScrollButtons=function(){
if(this._scrollLeftButton){
this._scrollLeftButton.update();
}
if(this._scrollRightButton){
this._scrollRightButton.update();
}
};
CognosTabControl.prototype._hideScrollButtons=function(){
if(!this._scrollButtonsVisible){
return;
}
this._scrollButtonsVisible=false;
this._tabControlNode.style.left="0px";
this._scrollLeftButton.hide();
this._scrollRightButton.hide();
};
CognosTabControl.prototype._createSeperator=function(){
this._seperator=document.createElement("div");
this._seperator.setAttribute("role","presendation");
this._seperator.setAttribute("style","");
this._seperator.className="ct_verticalLine";
this._seperator.setAttribute("role","presentation");
this._tabControlNode.appendChild(this._seperator);
};
CognosTabControl.prototype.selectTab=function(_127,_128,evt){
if(!evt){
evt=window.event;
}
for(var i=0;i<this._tabs.length;i++){
var tab=this._tabs[i];
var _12c=tab.getId()==_127;
tab.select(_12c);
if(_12c){
this._selectedTab=tab;
if(_128&&this._callback){
this._callback(_127);
}
}
if(_128){
tab.focus(_12c);
}
}
if(evt&&window.stopEventBubble){
window.stopEventBubble(evt);
}
return false;
};
CognosTabControl.prototype.handleKeyDown=function(evt,_12e){
if(!evt){
evt=window.event;
}
if(!evt){
return;
}
if(evt.keyCode=="39"||evt.keyCode=="37"){
if(evt.keyCode=="39"){
_12e++;
if(_12e>=this._tabs.length){
_12e=0;
}
}else{
_12e--;
if(_12e<0){
_12e=this._tabs.length-1;
}
}
this._tabs[_12e].focus();
this._tabs[_12e].scrollIntoView();
}else{
if(evt.keyCode=="32"||evt.keyCode=="13"){
var _12f=this._tabs[_12e].getId();
this.selectTab(_12f,true);
}
}
};
function CognosTab(_130,_131,_132){
if(!_130){
return;
}
this._id=_130.id;
this._label=_130.label;
this._position=_132;
this._contentClassName=_130.className;
this._imgURL=_130.img;
this._selected=false;
this._tabControl=_131;
this._outerTabDiv=null;
this._focusDiv=null;
};
CognosTab.prototype.getWidth=function(){
return this._outerTabDiv.offsetWidth+1;
};
CognosTab.prototype.getHeight=function(){
return this._outerTabDiv.clientHeight;
};
CognosTab.prototype.getId=function(){
return this._id;
};
CognosTab.prototype.select=function(_133){
if(_133!=this._selected){
this._selected=_133;
if(_133){
this.scrollIntoView();
}
if(this._outerTabDiv){
this._updateSelectedClass();
this._updateAriaSelected();
}
}
};
CognosTab.prototype.scrollIntoView=function(){
var _134=this._outerTabDiv.offsetLeft+this._outerTabDiv.clientWidth;
var _135=this._tabControl.getVisibleWidth();
var _136=this._tabControl.getScrollPos();
var _137=this._outerTabDiv.offsetLeft;
if(_137===0){
this._tabControl.scrollTo(0);
}else{
if((_137>=_136)&&(_134<=(_136+_135))){
}else{
if(_137<_136){
var _138=_137<3?0:_137-3;
this._tabControl.scrollTo(_138);
}else{
if(_134-_135>0||_134<_136){
this._tabControl.scrollTo(_134-_135+10);
}
}
}
}
};
CognosTab.prototype.render=function(_139){
if(!this._outerTabDiv){
var _13a=this._id;
var _13b=this._tabControl;
var tab=this;
this._outerTabDiv=document.createElement("div");
this._outerTabDiv.onmousedown=function(_13d){
_13b.selectTab(_13a,true,_13d);
};
this._outerTabDiv.onmouseover=function(){
this.className=this.className+" ct_highlight";
};
this._outerTabDiv.onmouseout=function(){
tab._updateSelectedClass();
};
this._outerTabDiv.setAttribute("style","");
this._outerTabDiv.setAttribute("role","presentation");
this._updateSelectedClass();
_139.appendChild(this._outerTabDiv);
var _13e=document.createElement("div");
_13e.className="ct_content";
_13e.setAttribute("role","presentation");
this._outerTabDiv.appendChild(_13e);
this._focusDiv=document.createElement("span");
this._focusDiv.innerHTML=this._label?this._label:"&nbsp;";
this._focusDiv.className="ct_text";
this._focusDiv.setAttribute("tabIndex",this._position===0?"0":"-1");
this._focusDiv.setAttribute("role","tab");
this._focusDiv.onkeydown=function(_13f){
_13b.handleKeyDown(_13f,tab._position);
};
this._updateAriaSelected();
_13e.appendChild(this._focusDiv);
if(this.isIE()&&this.getWidth()<75){
this._outerTabDiv.style.width="75px";
}
}else{
this._updateSelectedClass();
this._updateAriaSelected();
}
};
CognosTab.prototype.isIE=function(){
return (navigator.userAgent.indexOf("MSIE")!=-1||navigator.userAgent.indexOf("Trident")!=-1);
};
CognosTab.prototype.getFocusableDiv=function(){
return this._focusDiv;
};
CognosTab.prototype.focus=function(_140){
if(typeof _140==="undefined"){
_140=true;
}
this._focusDiv.setAttribute("tabIndex",_140?"0":"-1");
if(_140&&this._focusDiv.focus){
this._focusDiv.focus();
}
};
CognosTab.prototype._updateSelectedClass=function(){
this._outerTabDiv.className=this._selected?"ct_outerDiv ct_highlight ct_selected":"ct_outerDiv";
};
CognosTab.prototype._updateAriaSelected=function(){
this._focusDiv.setAttribute("aria-selected",this._selected?"true":"false");
};
function CognosScrollButton(_141,_142,_143){
this._direction=_141;
this._height=_142;
this._tabControl=_143;
this._disabled=true;
this._scrolling=false;
};
CognosScrollButton.prototype.getWidth=function(){
return this._scrollButtonDiv.offsetWidth+1;
};
CognosScrollButton.prototype.show=function(){
this._wrapperDiv.style.display="block";
};
CognosScrollButton.prototype.hide=function(){
this._wrapperDiv.style.display="none";
};
CognosScrollButton.prototype.update=function(){
var _144=this._tabControl.getWrapperDiv();
var _145=false;
if(this._direction=="left"){
if(_144.scrollLeft===0){
_145=true;
}
}else{
if(_144.scrollLeft>=(this._tabControl.getMaxRightScroll()-2)){
_145=true;
}
}
if(_145){
this._disable();
}else{
this._enable();
}
};
CognosScrollButton.prototype.isDisabled=function(){
return this._disabled;
};
CognosScrollButton.prototype._disable=function(){
this._disabled=true;
this._outerDiv.className="ct_outerDiv ct_scrollDisabled";
};
CognosScrollButton.prototype._enable=function(){
this._disabled=false;
this._outerDiv.className="ct_outerDiv ct_scrollEnabled";
};
CognosScrollButton.prototype.scroll=function(){
if(!this._scrolling){
this._scrolling=true;
var _146=this._tabControl.getWrapperDiv().clientWidth;
this._doAnimateScroll(_146,this._tabControl.getMaxRightScroll());
}
};
CognosScrollButton.prototype._doAnimateScroll=function(_147,_148){
if(_147>0){
var _149=10;
var _14a=this._tabControl.getWrapperDiv();
if(this._direction=="left"){
if(_14a.scrollLeft>_149){
this._tabControl.scrollTo(_14a.scrollLeft-_149);
}else{
this._tabControl.scrollTo(0);
this._scrolling=false;
return;
}
}else{
if(_14a.scrollLeft+_149<_148){
this._tabControl.scrollTo(_14a.scrollLeft+_149);
}else{
this._scrolling=false;
this._tabControl.scrollTo(_148);
this._tabControl.updateScrollButtons();
return;
}
}
_147-=_149;
var _14b=this;
setTimeout(function(){
_14b._doAnimateScroll(_147,_148);
},3);
}else{
this._scrolling=false;
this._tabControl.updateScrollButtons();
}
};
CognosScrollButton.prototype.isIE=function(){
return (navigator.userAgent.indexOf("MSIE")!=-1||navigator.userAgent.indexOf("Trident")!=-1);
};
CognosScrollButton.prototype.render=function(_14c){
this._scrollButtonDiv=document.createElement("div");
this._scrollButtonDiv.className="ct_scrollButton";
var _14d=-1;
if(this.isIE()&&document.compatMode!="CSS1Compat"){
_14d=1;
}
this._scrollButtonDiv.style.height=this._height+_14d+"px";
if(this._tabControl.isHighContrast()){
this._scrollButtonDiv.innerHTML=this._direction=="left"?"&laquo;":"&raquo;";
}
this._outerDiv=document.createElement("div");
this._outerDiv.className="ct_scrollDisabled";
this._outerDiv.appendChild(this._scrollButtonDiv);
this._outerDiv.style.height=this._height+"px";
var _14e=this;
this._outerDiv.onclick=function(){
_14e.scroll();
};
this._wrapperDiv=document.createElement("div");
this._wrapperDiv.style.height=this._height+"px";
this._wrapperDiv.className="ct_scroll "+(this._direction=="left"?"ct_left":"ct_right")+(this._tabControl.isHighContrast()?" a11y":"");
this._wrapperDiv.appendChild(this._outerDiv);
if(this._direction=="left"){
_14c.insertBefore(this._wrapperDiv,_14c.firstChild);
this._wrapperDiv.style.left="0px";
}else{
_14c.appendChild(this._wrapperDiv);
this._wrapperDiv.style.right="0px";
}
};
function ActionFactory(_14f){
this.m_cognosViewer=_14f;
};
ActionFactory.prototype.load=function(_150){
this.m_cognosViewer.loadExtra();
var _151=null;
try{
var _152=_150+"Action";
_151=eval("(typeof "+_152+"=='function'? new "+_152+"():null);");
if(_151){
_151.setCognosViewer(this.m_cognosViewer);
}
}
catch(exception){
_151=null;
}
return _151;
};
function ActionFactory_loadActionHandler(evt,_154){
var _155=getCtxNodeFromEvent(evt);
var _156=_154.getSelectionController();
var _157=null;
if(_155!==null){
var _158=_155.getAttribute("ctx");
_158=_158.split("::")[0].split(":")[0];
var _159=_155.getAttribute("type")!=null?_155:_155.parentNode;
var type=_159.getAttribute("type");
switch(type){
case "columnTitle":
var _15b=(_155.getAttribute("dttargets")!=null);
var _15c=(_159.getAttribute("CTNM")!=null&&_156.getMun(_158)!=""&&_156.getUsageInfo(_158)!="2");
if(_15b||_15c){
_157=_154.getAction("DrillUpDownOrThrough");
_157.init(_15b,_15c);
_157.updateDrillabilityInfo(_154,_155);
}else{
_157=_154.getAction("RenameDataItem");
}
break;
case "datavalue":
case "chartElement":
case "ordinalAxisLabel":
case "legendLabel":
case "legendTitle":
case "ordinalAxisTitle":
var _15b=(_155.getAttribute("dttargets")!=null);
var _15c=(_156.getHun(_158)!="");
if(_15b||_15c){
_157=_154.getAction("DrillUpDownOrThrough");
_157.init(_15b,_15c);
_157.updateDrillabilityInfo(_154,_155);
}
break;
}
}
if(_157===null){
_157=_154.getAction("Selection");
}
_157.setCognosViewer(_154);
return _157;
};
ActionFactory.prototype.destroy=function(){
delete this.m_cognosViewer;
};
function CSelectionDefaultStyles(_15d){
this.m_primarySelectionColor=null;
this.m_highContrastBorderStyle="solid";
this.m_secondarySelectionIsDisabled=false;
if(_15d){
this.m_selectionController=_15d;
this.m_oCognosViewer=_15d.m_oCognosViewer;
if(this.m_oCognosViewer){
var _15e=this.m_oCognosViewer.getUIConfig();
if(_15e){
if(_15e.getPrimarySelectionColor()){
this.m_primarySelectionColor=_15e.getPrimarySelectionColor();
}
if(!_15e.getShowSecondarySelection()){
this.m_secondarySelectionIsDisabledConfig=true;
}else{
if(_15e.getSeondarySelectionColor()){
this.m_secondarySelectionColor=_15e.getSeondarySelectionColor();
}
}
}
}
}
};
CSelectionDefaultStyles.prototype.getPrimarySelectionColor=function(_15f){
return this.m_primarySelectionColor;
};
CSelectionDefaultStyles.prototype.getSecondarySelectionColor=function(){
return this.m_secondarySelectionColor;
};
CSelectionDefaultStyles.prototype.getHighContrastBorderStyle=function(){
return this.m_highContrastBorderStyle;
};
CSelectionDefaultStyles.prototype.canApplyToSelection=function(_160){
return true;
};
CSelectionDefaultStyles.prototype.secondarySelectionIsDisabled=function(){
return this.m_secondarySelectionIsDisabled;
};
CSelectionDefaultStyles.prototype.setStyleForSelection=function(){
};
function CSelectionFilterStyles(_161){
this.m_selectionController=_161;
this.m_primarySelectionColor=this.m_primarySelectionFilterColor="#44BFDD";
this.m_primarySelectionFilterColorForMeasure=null;
this.m_secondarySelectionColor=null;
this.m_highContrastBorderStyle="dotted";
this.m_secondarySelectionIsDisabled=true;
};
CSelectionFilterStyles.prototype=new CSelectionDefaultStyles();
CSelectionFilterStyles.prototype.getPrimarySelectionColor=function(_162){
return this.m_primarySelectionColor;
};
CSelectionFilterStyles.prototype.getSecondarySelectionColor=function(){
return this.m_secondarySelectionColor;
};
CSelectionFilterStyles.prototype.getHighContrastBorderStyle=function(){
return this.m_highContrastBorderStyle;
};
CSelectionFilterStyles.prototype.secondarySelectionIsDisabled=function(){
return this.m_secondarySelectionIsDisabled;
};
CSelectionFilterStyles.prototype.canApplyToSelection=function(_163){
return !this.selectionHasOnlyMeasure(_163);
};
CSelectionFilterStyles.prototype.selectionHasOnlyMeasure=function(_164){
return (_164.length===1&&_164[0].length===1&&this.m_selectionController.isMeasure(_164[0][0]));
};
CSelectionFilterStyles.prototype.setStyleForSelection=function(_165){
this.m_primarySelectionColor=(this.selectionHasOnlyMeasure(_165))?null:this.m_primarySelectionFilterColor;
};
function CSelectionFilterContextMenuStyles(_166){
CSelectionDefaultStyles.call(this,_166);
this.m_secondarySelectionIsDisabled=true;
};
CSelectionFilterContextMenuStyles.prototype=new CSelectionDefaultStyles();
function CSelectionObject(){
this.initialize();
};
CSelectionObject.prototype.initialize=function(){
this.m_oCellRef={};
this.m_sColumnRef="";
this.m_sColumnName="";
this.m_aDataItems=[];
this.m_aUseValues=[];
this.m_aDisplayValues=[];
this.m_sCellTypeId="";
this.m_sLayoutType="";
this.m_sTag="";
this.m_aMuns=[];
this.m_aRefQueries=[];
this.m_aMetadataItems=[];
this.m_aDrillOptions=[];
this.m_selectionController={};
this.m_contextIds=[];
this.m_ctxAttributeString="";
this.m_fetchedContextIds=false;
this.m_selectedClass=[];
this.m_cutClass=[];
this.m_dataContainerType="";
this.m_oJsonContext=null;
};
CSelectionObject.prototype.isSelectionOnVizChart=function(){
return false;
};
CSelectionObject.prototype.getCellRef=function(){
return this.m_oCellRef;
};
CSelectionObject.prototype.getColumnRP_Name=function(){
if(this.m_oCellRef!=null){
return this.m_oCellRef.getAttribute("rp_name");
}
};
CSelectionObject.prototype.getColumnRef=function(){
return this.m_sColumnRef;
};
CSelectionObject.prototype.getColumnName=function(){
if(this.m_sColumnName==""){
if(this.m_selectionController.hasContextData()&&this.m_contextIds.length){
this.m_sColumnName=this.m_selectionController.getRefDataItem(this.m_contextIds[0][0]);
}
}
return this.m_sColumnName;
};
CSelectionObject.prototype.getDataItemDisplayValue=function(_167){
var _168=this.getDataItems();
var item="";
if(_168&&_168[0]&&_168[0][0]){
item=this.getDataItems()[0][0];
if(_167&&_167.itemInfo&&_167.itemInfo.length){
var _16a=_167.itemInfo;
for(var i=0;i<_16a.length;i++){
if(_16a[i].item===item&&_16a[i].itemLabel){
return _16a[i].itemLabel;
}
}
}
}
return item;
};
CSelectionObject.prototype.getDataItems=function(){
if(!this.m_aDataItems.length){
this.fetchContextIds();
for(var i=0;i<this.m_contextIds.length;++i){
this.m_aDataItems[this.m_aDataItems.length]=[];
for(var j=0;j<this.m_contextIds[i].length;++j){
var _16e=this.m_contextIds[i][j];
this.m_aDataItems[this.m_aDataItems.length-1].push(this.m_selectionController.isContextId(_16e)?this.m_selectionController.getRefDataItem(_16e):"");
}
}
}
return this.m_aDataItems;
};
CSelectionObject.prototype.getUseValues=function(){
if(!this.m_aUseValues.length){
this.fetchContextIds();
for(var i=0;i<this.m_contextIds.length;++i){
this.m_aUseValues[this.m_aUseValues.length]=[];
for(var j=0;j<this.m_contextIds[i].length;++j){
var _171=this.m_contextIds[i][j];
this.m_aUseValues[this.m_aUseValues.length-1].push(this.m_selectionController.isContextId(_171)?this.m_selectionController.getUseValue(_171):"");
}
}
}
return this.m_aUseValues;
};
CSelectionObject.prototype.getCellTypeId=function(){
return this.m_sCellTypeId;
};
CSelectionObject.prototype.getDisplayValues=function(){
return this.m_aDisplayValues;
};
CSelectionObject.prototype.getLayoutType=function(){
return this.m_sLayoutType;
};
CSelectionObject.prototype.getTag=function(){
return this.m_sTag;
};
CSelectionObject.prototype.getMuns=function(){
if(!this.m_aMuns.length){
this.fetchContextIds();
for(var i=0;i<this.m_contextIds.length;++i){
this.m_aMuns[this.m_aMuns.length]=[];
for(var j=0;j<this.m_contextIds[i].length;++j){
var _174=this.m_contextIds[i][j];
this.m_aMuns[this.m_aMuns.length-1].push(this.m_selectionController.isContextId(_174)?this.m_selectionController.getMun(_174):"");
}
}
}
return this.m_aMuns;
};
CSelectionObject.prototype.getRefQueries=function(){
if(!this.m_aRefQueries.length){
this.fetchContextIds();
for(var i=0;i<this.m_contextIds.length;++i){
this.m_aRefQueries[this.m_aRefQueries.length]=[];
for(var j=0;j<this.m_contextIds[i].length;++j){
var _177=this.m_contextIds[i][j];
this.m_aRefQueries[this.m_aRefQueries.length-1].push(this.m_selectionController.isContextId(_177)?this.m_selectionController.getRefQuery(_177):"");
}
}
}
return this.m_aRefQueries;
};
CSelectionObject.prototype.getDimensionalItems=function(_178){
var _179=[];
this.fetchContextIds();
for(var i=0;i<this.m_contextIds.length;++i){
_179[_179.length]=[];
for(var j=0;j<this.m_contextIds[i].length;++j){
var _17c=this.m_contextIds[i][j];
var _17d="";
if(this.m_selectionController.isContextId(_17c)){
switch(_178){
case "hun":
_17d=this.m_selectionController.getHun(_17c);
break;
case "lun":
_17d=this.m_selectionController.getLun(_17c);
break;
case "dun":
_17d=this.m_selectionController.getDun(_17c);
break;
}
}
_179[_179.length-1].push(_17d);
}
}
return _179;
};
CSelectionObject.prototype.getMetadataItems=function(){
if(!this.m_aMetadataItems.length){
this.fetchContextIds();
for(var i=0;i<this.m_contextIds.length;++i){
this.m_aMetadataItems[this.m_aMetadataItems.length]=[];
for(var j=0;j<this.m_contextIds[i].length;++j){
var _180=this.m_contextIds[i][j];
var _181="";
if(this.m_selectionController.isContextId(_180)){
var sLun=this.m_selectionController.getLun(_180);
var sHun=this.m_selectionController.getHun(_180);
if(sLun&&sLun!=""){
_181=sLun;
}else{
if(sHun&&sHun!=""){
_181=sHun;
}else{
_181=this.m_selectionController.getQueryModelId(_180);
}
}
}
this.m_aMetadataItems[this.m_aMetadataItems.length-1].push(_181);
}
}
}
return this.m_aMetadataItems;
};
CSelectionObject.prototype.getDrillOptions=function(){
if(!this.m_aDrillOptions.length){
this.fetchContextIds();
for(var i=0;i<this.m_contextIds.length;++i){
this.m_aDrillOptions[this.m_aDrillOptions.length]=[];
for(var j=0;j<this.m_contextIds[i].length;++j){
var _186=this.m_contextIds[i][j];
this.m_aDrillOptions[this.m_aDrillOptions.length-1].push(this.m_selectionController.isContextId(_186)?this.m_selectionController.getDrillFlag(_186):0);
}
}
}
return this.m_aDrillOptions;
};
CSelectionObject.prototype.getSelectedContextIds=function(){
return this.m_contextIds;
};
CSelectionObject.prototype.fetchContextIds=function(){
if(!this.m_fetchedContextIds&&this.m_contextIds.length&&this.m_selectionController.hasContextData()){
var _187=[];
for(var i=0;i<this.m_contextIds.length;i++){
for(var j=0;j<this.m_contextIds[i].length;j++){
_187.push(this.m_contextIds[i][j]);
}
}
this.m_selectionController.fetchContextData(_187);
this.m_fetchedContextIds=true;
}
};
CSelectionObject.prototype.setSelectionController=function(sc){
if(sc){
this.m_selectionController=sc;
}
};
CSelectionObject.prototype.getLayoutElementId=function(){
return this.m_layoutElementId;
};
CSelectionObject.prototype.hasContextInformation=function(){
for(var i=0;i<this.m_contextIds.length;i++){
for(var j=0;j<this.m_contextIds[i].length;j++){
if(this.m_contextIds[i][j].length>0){
return true;
}
}
}
return false;
};
CSelectionObject.prototype.isHomeCell=function(){
var _18d=this.getCellRef().className;
if(_18d&&(_18d=="xm"||_18d.indexOf("xm ")!=-1||_18d.indexOf(" xm")!=-1)){
return true;
}
return false;
};
CSelectionObject.prototype.getDataContainerType=function(){
return this.m_dataContainerType;
};
CSelectionObject.prototype.getContextJsonObject=function(_18e,_18f){
if(this.m_oJsonContext===null){
var _190={};
var _191=[];
var _192=null;
this.getDataItems();
this.getUseValues();
if(this.m_contextIds.length==0){
return null;
}
var i=0,j=0;
var _195=this._getBestPossibleItemName(this.m_aDataItems[i][j],this.m_contextIds[i][j],_18e);
_192=_195;
this._populateJsonContextObj(_195,this.m_aUseValues[i][j],_18e.getDisplayValue(this.m_contextIds[i][j]),_18e.getMun(this.m_contextIds[i][j]),_190,_191);
j++;
for(;i<this.m_aDataItems.length;i++,j=0){
for(;j<this.m_aDataItems[i].length;j++){
_195=this._getBestPossibleItemName(this.m_aDataItems[i][j],this.m_contextIds[i][j],_18e);
if(!_192){
_192=_195;
}
this._populateJsonContextObj(_195,this.m_aUseValues[i][j],_18e.getDisplayValue(this.m_contextIds[i][j]),_18e.getMun(this.m_contextIds[i][j]),_190,_191);
}
}
this.m_oJsonContext=this._createGenericPayloadStructureJson(_192,_190,_191,_18f);
}
return this.m_oJsonContext;
};
CSelectionObject.prototype._getBestPossibleItemName=function(_196,_197,_198){
var _199=null;
if(_198.isMeasure(_197)){
if(!_198.isValidColumnTitle(this.m_oCellRef)){
if(!_198.isRelational([_197])){
_199=_198.getCCDManager().GetBestPossibleDimensionMeasureName(_197);
}
return (_199)?_199:_196;
}
}
_199=_198.getCCDManager().GetBestPossibleItemName(_197);
return (_199)?_199:_196;
};
CSelectionObject.prototype._isTypeColumnTitle=function(){
if(this.m_oCellRef&&typeof this.m_oCellRef.getAttribute=="function"){
return (this.m_oCellRef.getAttribute("type")==="columnTitle");
}
return false;
};
CSelectionObject.prototype._populateJsonContextObj=function(_19a,_19b,_19c,mun,_19e,_19f){
if(_19e&&_19f&&_19a&&typeof _19e[_19a]=="undefined"){
var _1a0=_19c?_19c:_19b;
_19e[_19a]=[_1a0];
var _1a1={};
if(_19c){
_1a1["caption"]=_19c;
}
if(mun){
_1a1["mun"]=mun;
}
if(_19b){
_1a1["use"]=_19b;
}
_19f.push(_1a1);
}
};
CSelectionObject.prototype._createGenericPayloadStructureJson=function(_1a2,_1a3,_1a4,_1a5){
if(_1a2&&_1a3&&_1a4){
var _1a6=(_1a5)?_1a5:".";
var _1a7={};
_1a7[_1a6]={"values":_1a4};
var obj={"com.ibm.widget.context":{"values":_1a3},"com.ibm.widget.context.report.select":{"select":{"selectedItem":_1a2,"itemSpecification":_1a7}}};
return obj;
}
return null;
};
CSelectionObject.prototype.populateSelectionPayload=function(_1a9,_1aa,_1ab){
this.getDataItems();
this.getUseValues();
if(this.m_contextIds.length==0){
return false;
}
_1ab=((_1ab===undefined)?false:_1ab);
var _1ac=this.m_selectionController;
for(var i=0,j=0;i<this.m_aDataItems.length;i++,j=0){
var _1af=(_1ab?1:this.m_aDataItems[i].length);
for(;j<_1af;j++){
if(!_1ac.isMeasure(this.m_contextIds[i][j])){
var _1b0=this.m_aDataItems[i][j];
this._populateItemInSelectionPayload(_1b0,this.m_aUseValues[i][j],_1ac.getDisplayValue(this.m_contextIds[i][j]),_1ac.getMun(this.m_contextIds[i][j]),_1a9,_1aa);
}
}
}
return true;
};
CSelectionObject.prototype._populateItemInSelectionPayload=function(_1b1,_1b2,_1b3,mun,_1b5,_1b6){
if(_1b5&&_1b1){
var _1b7=_1b2?_1b2:_1b3;
if(_1b5[_1b1]){
_1b5[_1b1].push(_1b7);
}else{
_1b5[_1b1]=[_1b7];
}
var _1b8={};
_1b8["caption"]=_1b7;
if(mun){
_1b8["mun"]=mun;
}
var _1b9=_1b6[_1b1];
if(!_1b9){
_1b9={"values":[]};
_1b6[_1b1]=_1b9;
}
_1b9.values.push(_1b8);
}
};
CSelectionObject.prototype.getCtxAttributeString=function(){
return this.m_ctxAttributeString;
};
CSelectionObject.prototype.isDataValueOrChartElement=function(){
return (this.m_sLayoutType==="datavalue"||this.m_sLayoutType==="chartElement");
};
CSelectionObject.prototype.marshal=function(_1ba,_1bb){
if(!this.m_oJsonForMarshal){
var _1bc={};
var _1bd=[];
var _1be=null;
this.getDataItems();
this.getUseValues();
if(this.m_contextIds.length==0){
return null;
}
var i=0,j=0;
if(this.m_contextIds[i][j].length==0){
var _1c1=false;
do{
for(;j<this.m_contextIds[i].length;j++){
if(this.m_contextIds[i][j].length>0){
_1c1=true;
break;
}
}
if(!_1c1){
j=0;
i++;
}
}while(!_1c1);
}
var _1c2=this._getBestPossibleItemName(this.m_aDataItems[i][j],this.m_contextIds[i][j],_1ba);
var _1c3=_1ba.isMeasure(this.m_contextIds[i][j]);
var _1c4=this._getBestPossibleItemReference(this.m_contextIds[i][j],_1c3,_1ba.getCCDManager());
var _1c5=_1ba.getCCDManager().GetQuery(this.m_contextIds[i][j]);
var _1c6=this.isDataValueOrChartElement();
var _1c7=this._populateJsonForMarshal(_1c2,_1c4,_1c3,this.m_aUseValues[i][j],_1ba.getDisplayValue(this.m_contextIds[i][j]),_1ba.getMun(this.m_contextIds[i][j]),_1c6);
j++;
var _1c8=[];
for(;i<this.m_aDataItems.length;i++,j=0){
for(;j<this.m_aDataItems[i].length;j++){
_1c2=this._getBestPossibleItemName(this.m_aDataItems[i][j],this.m_contextIds[i][j],_1ba);
_1c3=_1ba.isMeasure(this.m_contextIds[i][j]);
_1c4=this._getBestPossibleItemReference(this.m_contextIds[i][j],_1c3,_1ba.getCCDManager());
var _1c9=this._populateJsonForMarshal(_1c2,_1c4,_1c3,this.m_aUseValues[i][j],_1ba.getDisplayValue(this.m_contextIds[i][j]),_1ba.getMun(this.m_contextIds[i][j]));
if(_1c9){
_1c8.push(_1c9);
}
}
}
var lid=(typeof this.getArea=="function")?getImmediateLayoutContainerId(this.getArea()):getImmediateLayoutContainerId(this.getCellRef());
if(lid&&lid.indexOf(_1bb)>0){
lid=lid.substring(0,lid.indexOf(_1bb)-1);
}
this.m_oJsonForMarshal={"lid":lid,"query":_1c5,"selectedItem":_1c7,"context":_1c8};
}
return this.m_oJsonForMarshal;
};
CSelectionObject.prototype._populateJsonForMarshal=function(_1cb,_1cc,_1cd,_1ce,_1cf,mun,_1d1){
if(_1cb){
var _1d2={};
_1d2["itemName"]=_1cb;
_1d2["isMeasure"]=_1cd?"true":"false";
_1d2["mdProperty"]=_1cc.mdProperty;
_1d2["mdValue"]=_1cc.mdValue;
_1d2["isDataValueOrChartElement"]=_1d1?"true":"false";
if(mun){
_1d2["mun"]=mun;
}
if(_1ce){
_1d2["use"]=_1ce;
}
return _1d2;
}
return null;
};
CSelectionObject.prototype._getBestPossibleItemReference=function(_1d3,_1d4,_1d5){
var _1d6=null;
var _1d7=null;
if(_1d4){
_1d7="i";
_1d6=_1d5.GetQMID(_1d3);
if(_1d6==null){
_1d7="m";
_1d6=_1d5.GetMUN(_1d3);
}
if(_1d6==null){
_1d7="r";
_1d6=_1d5.GetRDIValue(_1d3);
}
}else{
_1d7="l";
_1d6=_1d5.GetLUN(_1d3);
if(_1d6==null){
_1d7="h";
_1d6=_1d5.GetHUN(_1d3);
}
if(_1d6==null){
_1d7="i";
_1d6=_1d5.GetQMID(_1d3);
}
if(_1d6==null){
_1d7="r";
_1d6=_1d5.GetRDIValue(_1d3);
}
}
return {"mdProperty":_1d7,"mdValue":_1d6};
};
CSelectionChartObject.prototype=new CSelectionObject();
CSelectionChartObject.prototype.constructor=CSelectionChartObject;
CSelectionChartObject.baseclass=CSelectionObject.prototype;
function CSelectionChartObject(){
CSelectionChartObject.baseclass.initialize.call(this);
this.m_chartArea=null;
this.m_context="";
this.m_chartCtxAreas=[];
this.m_selectedVizChart=false;
};
CSelectionChartObject.prototype.isSelectionOnVizChart=function(){
return this.m_selectedVizChart;
};
CSelectionChartObject.prototype.setSelectionOnVizChart=function(_1d8){
var _1d9=this.m_selectionController.getSelectedChartImageFromChartArea(_1d8);
if(_1d9){
this.m_selectedVizChart=_1d9.parentNode.getAttribute("vizchart")=="true"?true:false;
}
};
CSelectionChartObject.prototype.getArea=function(){
return this.m_chartArea;
};
CSelectionChartObject.prototype.getContext=function(){
return this.m_context;
};
CSelectionChartObject.prototype.getCtxAreas=function(){
return this.m_chartCtxAreas;
};
CSelectionChartObject.prototype.setCtxAreas=function(_1da){
this.m_chartCtxAreas=_1da;
};
CSelectionChartObject.prototype.getCtxAttributeString=function(){
return this.m_context;
};
function CChartHelper(_1db,_1dc,_1dd){
var _1de=_1db.parentNode;
this.m_selectionObjectFactory=_1dc;
this.m_map=_1de;
_1dd.loadExtra();
this.imageMapHighlighter=new CImageMapHighlight(_1de,_1dd.sWebContentRoot);
this.initialize();
};
CChartHelper.prototype.initialize=function(){
this.buildMapCtxAreas();
this.m_chartCtxNodes={};
};
CChartHelper.prototype.buildMapCtxAreas=function(){
var _1df={};
var _1e0=this.m_map.childNodes;
var _1e1=_1e0.length;
var _1e2=null;
for(var i=0;i<_1e1;i++){
var a=_1e0[i];
_1e2=a.getAttribute("ctx");
if(_1e2){
if(_1df[_1e2]){
_1df[_1e2].push(a);
}else{
_1df[_1e2]=[a];
}
}
}
this.m_ctxAreas=_1df;
};
CChartHelper.prototype.getChartNode=function(_1e5){
if(!this.isAreaInitialized(_1e5)){
var _1e6=_1e5.parentNode;
this.m_map=_1e6;
this.initialize();
this.imageMapHighlighter.initialize(_1e6);
}
var _1e7=_1e5.getAttribute("ctx");
if(!this.m_chartCtxNodes[_1e7]){
this.m_chartCtxNodes[_1e7]=this.m_selectionObjectFactory.getSelectionChartObject(_1e5);
this.m_chartCtxNodes[_1e7].setCtxAreas(this.m_ctxAreas[_1e7]);
}
return this.m_chartCtxNodes[_1e7];
};
CChartHelper.prototype.isAreaInitialized=function(_1e8){
return this.imageMapHighlighter.isAreaInitialized(_1e8);
};
CChartHelper.prototype.getImageMapHighlighter=function(){
return this.imageMapHighlighter;
};
function CSelectionObjectFactory(_1e9){
this.m_selectionController=_1e9;
};
CSelectionObjectFactory.prototype.getSelectionController=function(){
return this.m_selectionController;
};
CSelectionObjectFactory.prototype.getChildSpans=function(_1ea){
var _1eb=[];
for(var i=0;i<_1ea.childNodes.length;i++){
var _1ed=_1ea.childNodes[i];
if(!_1ed.getAttribute||_1ed.getAttribute("skipSelection")!="true"){
_1eb.push(_1ea.childNodes[i]);
}
}
var _1ee=_1ea;
var _1ef="";
while(!_1ef&&_1ee){
_1ef=_1ee.attributes?_1ee.attributes["LID"]:"";
_1ee=_1ee.parentNode;
}
_1ef=_1ef?_1ef.value:"";
var _1f0=[];
while(_1eb.length>0){
var _1ed=_1eb.pop();
var lid=_1ed.attributes?_1ed.attributes["LID"]:"";
lid=lid?lid.value:"";
if(!lid||lid==_1ef){
if(_1ed.nodeName.toLowerCase()=="span"){
_1f0.push(_1ed);
}else{
for(i=0;i<_1ed.childNodes.length;i++){
_1eb.push(_1ed.childNodes[i]);
}
}
}
}
return _1f0;
};
CSelectionObjectFactory.prototype.getSelectionObject=function(_1f2,_1f3){
var _1f4=new CSelectionObject();
try{
_1f4.setSelectionController(this.getSelectionController());
_1f4.m_oCellRef=_1f2;
_1f4.m_sColumnRef=_1f2.getAttribute("cid");
_1f4.m_sCellTypeId=_1f2.getAttribute("uid");
_1f4.m_sLayoutType=_1f2.getAttribute("type");
_1f4.m_sTag=_1f2.getAttribute("tag");
_1f4.m_layoutElementId=this.getLayoutElementId(_1f2);
_1f4.m_dataContainerType=this.getContainerType(_1f2);
if(typeof cf!="undefined"){
var _1f5=cf.cfgGet("MiniQueryObj");
if(_1f5){
var _1f6=_1f5.findChildWithAttribute("tag",_1f4.m_sTag);
if(_1f6&&_1f6.getAttribute("id")!=null){
_1f4.m_sColumnName=_1f6.getAttribute("id");
}
}
}
var _1f7=this.getChildSpans(_1f2);
if(_1f7.length>0){
for(var i=0;i<_1f7.length;i++){
var _1f9=_1f7[i];
if(_1f9.nodeType==1&&_1f9.nodeName.toLowerCase()=="span"&&_1f9.style.visibility!="hidden"){
var _1fa=null;
if(_1f2.getAttribute("ctx")!=null&&_1f2.getAttribute("ctx")!=""){
_1fa=_1f2;
}else{
if(_1f9.getAttribute("ctx")!=null&&_1f9.getAttribute("ctx")!=""){
_1fa=_1f9;
}else{
if(_1f9.getAttribute("dtTargets")&&_1f9.childNodes&&_1f9.childNodes.length){
for(var _1fb=0;_1fb<_1f9.childNodes.length;_1fb++){
if(_1f9.childNodes[_1fb].nodeType==1&&_1f9.childNodes[_1fb].style.visibility!="hidden"){
_1fa=_1f9.childNodes[_1fb];
}
}
}else{
for(var _1fc=0;_1fc<_1f9.childNodes.length;_1fc++){
var _1fd=_1f9.childNodes[_1fc];
if(typeof _1fd.getAttribute!="undefined"&&_1fd.getAttribute("ctx")!=null&&_1fd.getAttribute("ctx")!=""){
_1fa=_1fd;
break;
}
}
}
}
}
var _1fe="";
if(_1fa&&_1fa.getAttribute("ctx")){
_1fe=_1fa.getAttribute("ctx");
}
_1f4.m_aDisplayValues[_1f4.m_aDisplayValues.length]=this.getSelectionController().getDisplayValue(_1fe,_1f2.parentNode);
if(typeof _1f3!="undefined"&&_1f3!=_1fe){
continue;
}
_1f4=this.processCTX(_1f4,_1fe);
}
}
}else{
if(_1f2.getAttribute("ctx")!=null&&_1f2.getAttribute("ctx")!=""&&_1f4.m_sLayoutType=="datavalue"){
_1f4=this.processCTX(_1f4,_1f2.getAttribute("ctx"));
}
}
this.getSelectionController().processColumnTitleNode(_1f4);
}
catch(ex){
}
return _1f4;
};
CSelectionObjectFactory.prototype.processCTX=function(_1ff,_200){
if(typeof _200!="string"||_200.length==0){
return _1ff;
}
var ctx;
if(typeof _1ff.m_contextIds=="object"&&_1ff.m_contextIds!==null&&_1ff.m_contextIds.length>0){
var _202=_200.split("::");
for(ctx=0;ctx<_1ff.m_contextIds.length;++ctx){
try{
if(_202[ctx]){
_1ff.m_contextIds[ctx]=_1ff.m_contextIds[ctx].concat(_202[ctx].split(":"));
}
}
catch(e){
}
}
}else{
_1ff.m_contextIds=this.m_selectionController.m_oCognosViewer.getReportContextHelper().processCtx(_200);
}
_1ff.m_ctxAttributeString=_200;
return _1ff;
};
CSelectionObjectFactory.prototype.getSecondarySelectionObject=function(tag,_204,_205){
if(!_205){
_205=document;
}
var _206=new CSelectionObject();
_206.setSelectionController(this.getSelectionController());
_206.m_oCellRef=null;
_206.m_sColumnRef=null;
_206.m_sCellTypeId=null;
_206.refQuery="";
var _207=_205.getElementsByTagName("td");
for(var i=0;i<_207.length;i++){
var _209=_207[i].getAttribute("tag");
if(_209!=null&&_209!=""){
if(tag==_209){
var _20a=_207[i].className;
if(_20a!=null&&_209!=""){
if((_204=="columnTitle"&&_20a=="lt")||(_204=="datavalue"&&_20a=="lc")){
_206.m_sColumnRef=_207[i].getAttribute("cid");
_206.m_sCellTypeId=_207[i].getAttribute("uid");
break;
}
}
}
}
}
if(_206.m_sCellTypeId==null){
return null;
}
return _206;
};
CSelectionObjectFactory.prototype.getSelectionChartObject=function(_20b){
var _20c="";
if(_20b.getAttribute("flashChart")!=null){
if(typeof _20b.getCtx!="undefined"){
try{
_20c=_20b.getCtx();
}
catch(e){
_20c="";
}
}
}else{
_20c=_20b.getAttribute("ctx");
}
var _20d=new CSelectionChartObject();
_20d.setSelectionController(this.getSelectionController());
if(_20c!=null){
_20d.m_contextIds=_20c.split("::");
for(var ctx=0;ctx<_20d.m_contextIds.length;++ctx){
_20d.m_contextIds[ctx]=_20d.m_contextIds[ctx].split(":");
}
}
_20d.m_layoutElementId=this.getLayoutElementId(_20b);
_20d.m_sLayoutType=_20b.getAttribute("type");
_20d.m_chartArea=_20b;
_20d.m_context=_20c;
_20d.setSelectionOnVizChart(_20b);
return _20d;
};
CSelectionObjectFactory.prototype.getContainerTypeFromClass=function(_20f){
var _210="";
switch(_20f){
case "ls":
_210="list";
break;
case "xt":
_210="crosstab";
break;
case "rt":
_210="repeaterTable";
break;
}
return _210;
};
CSelectionObjectFactory.prototype.getContainerType=function(el){
var type="";
if(el){
if(el.className){
type=this.getContainerTypeFromClass(el.className);
}
if(!type){
var _213=el.parentNode;
if(_213){
type=this.getContainerType(_213);
}
}
}
return type;
};
CSelectionObjectFactory.prototype.getLayoutElementId=function(el){
var id="";
var _216=this.getSelectionController().getNamespace();
if(el){
if(el.getAttribute&&el.getAttribute("chartcontainer")=="true"){
for(var _217=0;_217<el.childNodes.length;_217++){
var _218=el.childNodes[_217];
if(_218.nodeName.toLowerCase()=="img"&&_218.getAttribute("lid")!=null){
return _218.getAttribute("lid");
}
}
}
id=(el.getAttribute&&el.getAttribute("LID"))||"";
if(!id){
var _219=el.parentNode;
if(_219){
id=this.getLayoutElementId(_219);
}
}else{
if(el.tagName.toUpperCase()=="MAP"){
id=id.replace(_216,"");
id=_216+id;
var _21a="#"+id;
var _21b=getElementsByAttribute(el.parentNode,"IMG","usemap",_21a);
if(_21b.length>0){
id=_21b[0].getAttribute("LID");
}
}
}
}
return id;
};
function CSelectionController(_21c,_21d){
this.m_bSelectionBasedFeaturesEnabled=false;
this.m_bDrillUpDownEnabled=false;
this.m_bModelDrillThroughEnabled=false;
this.m_oCognosViewer=null;
this.m_bSavedSelections=false;
if(_21d){
this.m_oCognosViewer=_21d;
}
this.initialize(_21c);
this.FILTER_SELECTION_STYLE=0;
this.FILTER_SELECTION_CONTEXT_MENU_STYLE=1;
};
CSelectionController.prototype.initialize=function(_21e){
this.m_sNamespace=_21e;
this.m_aCutColumns=[];
this.m_aSelectedObjects=[];
this.m_selectedClass=[];
this.m_cutClass=[];
this.m_oObserver=new CObserver(this);
this.m_bSelectionArraysSetup=false;
this.m_aSelectionHoverNodes=[];
this.m_bUsingCCDManager=false;
this.m_aReportMetadataArray=[];
this.m_aReportContextDataArray=[];
this.m_oCDManager=new CCDManager();
this.m_oSelectionObjectFactory=new CSelectionObjectFactory(this);
this.m_selectedChartArea=null;
this.m_selectedChartNodes=[];
this.m_selectionContainerMap=null;
this.m_chartHelpers={};
if(this.m_oCognosViewer!=null){
this.m_oCDManager.SetCognosViewer(this.m_oCognosViewer);
}
this.m_maxSecondarySelection=-1;
this.c_usageMeasure="2";
this.m_ccl_dateTypes={59:"dateTime",60:"interval"};
this.m_selectionStyles=new CSelectionDefaultStyles(this);
this.m_originalSelectionStyles=this.m_selectionStyles;
this.m_bAllowHorizontalDataValueSelection=false;
};
CSelectionController.prototype.secondarySelectionIsDisabled=function(){
return this.m_selectionStyles.secondarySelectionIsDisabled();
};
CSelectionController.prototype.getPrimarySelectionColor=function(){
return this.m_selectionStyles.getPrimarySelectionColor();
};
CSelectionController.prototype.getHighContrastBorderStyle=function(){
return this.m_selectionStyles.getHighContrastBorderStyle();
};
CSelectionController.prototype.getSecondarySelectionColor=function(){
return this.m_selectionStyles.getSecondarySelectionColor();
};
CSelectionController.prototype.resetSelectionStyles=function(){
this.setSelectionStyles();
};
CSelectionController.prototype.setSelectionStyles=function(_21f){
switch(_21f){
case this.FILTER_SELECTION_STYLE:
if(!this.m_selectionFilterStyles){
this.m_selectionFilterStyles=new CSelectionFilterStyles(this);
}
this.m_selectionStyles=this.m_selectionFilterStyles;
break;
case this.FILTER_SELECTION_CONTEXT_MENU_STYLE:
if(!this.m_selectionFilterContextMenuStyles){
this.m_selectionFilterContextMenuStyles=new CSelectionFilterContextMenuStyles(this);
}
this.m_selectionStyles=this.m_selectionFilterContextMenuStyles;
break;
default:
this.m_selectionStyles=this.m_originalSelectionStyles;
}
};
CSelectionController.prototype.resetAllowHorizontalDataValueSelection=function(){
this.m_bAllowHorizontalDataValueSelection=false;
};
CSelectionController.prototype.setAllowHorizontalDataValueSelection=function(_220){
this.m_bAllowHorizontalDataValueSelection=_220;
};
CSelectionController.prototype.allowHorizontalDataValueSelection=function(){
return this.m_bAllowHorizontalDataValueSelection;
};
CSelectionController.prototype.clearSelectionData=function(){
this.m_aSelectedObjects=[];
this.m_selectedChartNodes=[];
this.m_oSelectedDrillThroughImage=null;
this.m_oSelectedDrillThroughSingleton=null;
};
CSelectionController.prototype.getCCDManager=function(){
return this.m_oCDManager;
};
CSelectionController.prototype.getCtxIdFromDisplayValue=function(_221){
if(!this.m_bUsingCCDManager){
var _222=this.getReportContextDataArray();
var _223=1;
for(var _224 in _222){
var _225=_222[_224];
if(_225[_223]==_221){
return _224;
}
}
return "";
}else{
var sId=this.m_oCDManager.GetContextIdForDisplayValue(_221);
return (sId==null)?"":sId;
}
};
CSelectionController.prototype.getCtxIdFromMetaData=function(sLun,sHun,_229){
return this.m_oCDManager.getContextIdForMetaData(sLun,sHun,_229);
};
CSelectionController.prototype.replaceNamespaceForSharedTM1DimensionOnly=function(lun,hun,mun){
var sLun=lun;
var sHun=hun;
if(mun&&mun.indexOf("->:[TM].")>0){
sLun=this.m_oCDManager._replaceNamespaceForSharedTM1DimensionOnly(lun);
sHun=this.m_oCDManager._replaceNamespaceForSharedTM1DimensionOnly(hun);
}
return {"lun":sLun,"hun":sHun};
};
CSelectionController.prototype.getCtxIdFromMun=function(sMun){
if(!this.m_bUsingCCDManager){
var _230=this.getReportMetadataArray();
var _231=0;
for(var sKey in _230){
var _233=_230[sKey];
if(_233[_231]==sMun){
var _234=2;
var _235=this.getReportContextDataArray();
for(var _236 in _235){
var _237=_235[_236];
if(_237[_234]==sKey){
return _236;
}
}
}
}
return "";
}else{
var sId=this.m_oCDManager.GetContextIdForMUN(sMun);
return (sId==null)?"":sId;
}
};
CSelectionController.prototype.canDrillDown=function(_239){
var _23a=this.getDrillFlagForMember(_239);
return (_23a==3||_23a==2);
};
CSelectionController.prototype.canDrillUp=function(_23b){
var _23c=this.getDrillFlagForMember(_23b);
return (_23c==3||_23c==1);
};
CSelectionController.prototype.getQueryModelId=function(_23d){
var qmid="";
if(!this.m_bUsingCCDManager){
var _23f=this.m_aReportContextDataArray[_23d];
if(_23f&&typeof _23f[3]!="undefined"){
var _240=_23f[3];
var _241=this.m_aReportMetadataArray[_240];
if(typeof _241!="undefined"&&typeof _241[1]!="undefined"&&_241[1]=="I"){
qmid=_241[0];
}
}
}else{
qmid=this.m_oCDManager.GetQMID(_23d);
}
return qmid;
};
CSelectionController.prototype.getRefQuery=function(_242){
if(!this.m_bUsingCCDManager){
return this.getMetaDataItemUseValue(4,_242);
}else{
var _243=this.m_oCDManager.GetQuery(_242);
return (_243==null)?"":_243;
}
};
CSelectionController.prototype.getRefDataItem=function(_244){
return this.m_oCognosViewer.getReportContextHelper().getRefDataItem(_244);
};
CSelectionController.prototype.getMun=function(_245){
return this.m_oCognosViewer.getReportContextHelper().getMun(_245);
};
CSelectionController.prototype.getHun=function(_246){
if(!this.m_bUsingCCDManager){
var sHun=null;
var _248=this.getRDI(_246);
if(_248&&_248.length>4&&_248[1]=="R"){
var _249=_248[4];
var _24a=this.getReportMetadataArray();
_248=_24a[_249];
}
if(_248&&_248.length>1&&_248[1]=="H"){
sHun=_248[0];
}
return sHun;
}else{
return this.m_oCDManager.GetHUN(_246);
}
};
CSelectionController.prototype.fetchContextData=function(_24b,_24c){
var _24d=0;
if(this.m_bUsingCCDManager){
_24d=this.m_oCDManager.FetchContextData(_24b,_24c);
}
return _24d;
};
CSelectionController.prototype.getMetaDataItem=function(sKey){
var _24f=this.getReportMetadataArray();
if(typeof _24f[sKey]!="undefined"){
return _24f[sKey];
}
return null;
};
CSelectionController.prototype.getContextDataItem=function(_250){
var _251=this.getReportContextDataArray();
if(typeof _251[_250]!="undefined"){
return _251[_250];
}
return null;
};
CSelectionController.prototype.getMetaDataItemUseValue=function(_252,_253){
var _254=this.getContextDataItem(_253);
if(_254!=null){
var _255=_254[_252];
if(_255!=""){
var _256=this.getMetaDataItem(_255);
if(_256!=null){
return _256[0];
}
}
}
return "";
};
CSelectionController.prototype.getRDI=function(_257){
var _258=this.getContextDataItem(_257);
if(_258!=null){
var _259=_258[0];
if(_259!=""){
var _25a=this.getMetaDataItem(_259);
if(_25a!=null){
return _25a;
}
}
}
};
CSelectionController.prototype.getNamespace=function(){
return this.m_sNamespace;
};
CSelectionController.prototype.setSelectionBasedFeaturesEnabled=function(_25b){
this.m_bSelectionBasedFeaturesEnabled=_25b;
};
CSelectionController.prototype.getSelectionBasedFeaturesEnabled=function(){
return this.m_bSelectionBasedFeaturesEnabled;
};
CSelectionController.prototype.setDrillUpDownEnabled=function(_25c){
this.m_bDrillUpDownEnabled=_25c;
};
CSelectionController.prototype.getDrillUpDownEnabled=function(){
return this.m_bDrillUpDownEnabled;
};
CSelectionController.prototype.setModelDrillThroughEnabled=function(_25d){
this.m_bModelDrillThroughEnabled=_25d;
};
CSelectionController.prototype.getBookletItemForCurrentSelection=function(){
var _25e=this.getAllSelectedObjects();
if(_25e&&_25e.length>0){
var _25f=_25e[0];
if(_25f.hasContextInformation()){
var _260=this.m_oCDManager.GetBIValue(_25f.m_contextIds[0][0]);
if(!_260){
return null;
}
return _260;
}
}
return null;
};
CSelectionController.prototype.getModelPathForCurrentSelection=function(){
var _261=null;
var _262=this.getBookletItemForCurrentSelection();
if(_262){
var _261=this.m_oCDManager.getModelPathFromBookletItem(_262);
}
return _261;
};
CSelectionController.prototype.getModelDrillThroughEnabled=function(){
var _263=this.getBookletItemForCurrentSelection();
if(_263){
var _264=this.m_oCDManager.GetBookletModelBasedDrillThru(_263);
return _264==1?true:false;
}else{
return this.m_bModelDrillThroughEnabled;
}
};
CSelectionController.prototype.clearSelectedObjects=function(_265){
try{
if(!_265){
_265=document;
}
this.updateUI(_265,this.getSelections(),true,false);
this.m_aSelectedObjects=[];
if(typeof this.onSelectionChange=="function"){
this.onSelectionChange();
}
return true;
}
catch(e){
return false;
}
};
CSelectionController.prototype.resetSelections=function(_266){
try{
if(!_266){
_266=document;
}
if(this.hasSelectedChartNodes()){
this.resetChartSelections(_266);
}
this.m_oSelectedDrillThroughImage=null;
this.m_oSelectedDrillThroughSingleton=null;
if(this.getSelections()){
this.updateUI(_266,this.getSelections(),true,false);
this.updateUI(_266,this.getCutColumns(),true,false);
this.m_aCutColumns=[];
this.m_aSelectedObjects=[];
this.m_selectedClass=[];
this.m_cutClass=[];
if(typeof this.onSelectionChange=="function"){
this.onSelectionChange();
}
}
return true;
}
catch(e){
return false;
}
};
CSelectionController.prototype.resetChartSelections=function(_267){
var _268=this.m_chartHelpers;
for(var _269 in _268){
if(_268[_269]){
var _26a=_268[_269].getImageMapHighlighter();
if(_26a.hideAllAreas){
_26a.hideAllAreas();
}
}
}
this.m_selectedChartNodes=[];
this.m_selectionContainerMap=null;
};
CSelectionController.prototype.addSelectionObject=function(_26b,_26c){
try{
if(!_26c){
_26c=document;
}
var _26d=_26b.getCellRef();
if(this.isCellSelected(_26d)!==true||(typeof _26d!="object"||_26d===null)){
if(this.isColumnCut(_26b.getTag())!==true){
this.m_aSelectedObjects[this.m_aSelectedObjects.length]=_26b;
if(typeof this.onSelectionChange=="function"){
this.onSelectionChange();
}
this.updateUI(_26c,this.getSelections(),false,false);
}
}
return true;
}
catch(e){
return false;
}
};
CSelectionController.prototype.removeSelectionObject=function(_26e,_26f){
try{
if(!_26f){
_26f=document;
}
var _270=[];
var _271;
for(_271=0;_271<this.m_aSelectedObjects.length;_271++){
var _272=this.m_aSelectedObjects[_271].getCellRef();
var _273=_26e.getCellRef();
if(typeof _272=="object"&&typeof _273=="object"&&_272!==null&&_273!==null){
if(_272==_273){
_270[_270.length]=_271;
}
}
}
if(_270.length>0){
this.updateUI(_26f,this.getSelections(),true,false);
var _274=[];
for(_271=0;_271<this.m_aSelectedObjects.length;_271++){
var _275=true;
for(var j=0;j<_270.length;j++){
if(_271==_270[j]){
_275=false;
}
}
if(_275){
_274[_274.length]=this.m_aSelectedObjects[_271];
}
}
this.m_aSelectedObjects=_274;
this.updateUI(_26f,this.getSelections(),false,false);
}
if(typeof this.onSelectionChange=="function"){
this.onSelectionChange();
}
return true;
}
catch(e){
return false;
}
};
CSelectionController.prototype.isSavedCellSelected=function(_277){
return this.isCellSelectedHelper(_277,this.getSavedSelectedObjects());
};
CSelectionController.prototype.isCellSelected=function(_278){
return this.isCellSelectedHelper(_278,this.getSelections());
};
CSelectionController.prototype.isCellSelectedHelper=function(_279,_27a){
try{
for(var i=0;i<_27a.length;i++){
var _27c=_27a[i].getCellRef();
if(typeof _27c=="object"&&_27c!==null){
if(_27c==_279){
return true;
}
}
}
}
catch(e){
}
return false;
};
CSelectionController.prototype.isColumnSelected=function(_27d){
try{
for(var i=0;i<this.m_aSelectedObjects.length;i++){
if(this.m_aSelectedObjects[i].getTag()==_27d){
return true;
}
}
}
catch(e){
}
return false;
};
CSelectionController.prototype.isColumnCut=function(_27f){
try{
for(var i=0;i<this.m_aCutColumns.length;i++){
if(this.m_aCutColumns[i].getTag()==_27f){
return true;
}
}
}
catch(e){
}
return false;
};
CSelectionController.prototype.getSelections=function(){
return this.m_aSelectedObjects;
};
CSelectionController.prototype.selectSingleDomNode=function(_281){
this.clearSelectedObjects();
var _282=this.getSelectionObjectFactory().getSelectionObject(_281);
var _283=null;
if(isIE()){
_283=_281.document;
}else{
_283=_281.ownerDocument;
}
this.addSelectionObject(_282,_283);
};
CSelectionController.prototype.hasCutColumns=function(){
if(this.m_aCutColumns.length===0){
return false;
}else{
return true;
}
};
CSelectionController.prototype.setCutColumns=function(_284,_285){
try{
if(!_285){
_285=document;
}
this.updateUI(_285,this.getSelections(),true,false);
this.updateUI(_285,this.getCutColumns(),true,1);
this.m_aCutColumns=[];
if(_284===true){
for(var i=0;i<this.m_aSelectedObjects.length;i++){
this.m_aCutColumns[i]=this.m_aSelectedObjects[i];
}
this.m_aSelectedObjects=[];
}
this.updateUI(_285,this.getCutColumns(),false,2);
return true;
}
catch(e){
return false;
}
};
CSelectionController.prototype.getCutColumns=function(){
return this.m_aCutColumns;
};
CSelectionController.prototype.getObservers=function(){
return this.m_oObserver;
};
CSelectionController.prototype.attachObserver=function(_287){
this.m_oObserver.attach(_287);
};
CSelectionController.prototype.onSelectionChange=function(){
this.getObservers().notify();
};
CSelectionController.prototype.getSelectedColumns=function(_288){
var _289=[];
if(typeof _288=="undefined"){
_288=this.getSelections();
}
var _28a=_288.length;
for(var i=0;i<_28a;i++){
var _28c=_288[i];
var _28d=true;
for(var j=0;j<_289.length;j++){
if(_289[j][0]==_28c.getColumnRef()&&_289[j][1]==_28c.getCellTypeId()){
_28d=false;
break;
}
}
if(_28d){
_289[_289.length]=[_28c.getColumnRef(),_28c.getCellTypeId(),_28c.getLayoutType(),_28c.getTag(),_28c.getColumnName()];
}
}
return _289;
};
CSelectionController.prototype.getAllSelectedObjectsWithUniqueCTXIDs=function(){
var _28f=[];
var _290=this.getAllSelectedObjects();
for(var i=0;i<_290.length;i++){
var _292=false;
var _293=_290[i];
for(var ii=0;ii<_28f.length;ii++){
if(_293.m_contextIds[0][0]==_28f[ii].m_contextIds[0][0]){
_292=true;
break;
}
}
if(!_292){
_28f.push(_293);
}
}
return _28f;
};
CSelectionController.prototype.getAllSelectedObjects=function(){
var _295=this.getSelections();
if(this.hasSelectedChartNodes()){
_295=_295.concat(this.getSelectedChartNodes());
}
return _295;
};
CSelectionController.prototype.getSelectedColumnIds=function(_296){
var _297=[];
if(typeof _296=="undefined"){
_296=this.getSelections();
}
var _298=this.getSelectedColumns(_296);
for(var _299=0;_299<_298.length;_299++){
var _29a=true;
for(var _29b=0;_29b<_297.length;_29b++){
if(_297[_29b]==_298[_299][4]){
_29a=false;
break;
}
}
if(_29a){
_297[_297.length]=_298[_299][4];
}
}
return _297;
};
var STYLE_SELECTION={};
CSelectionController.prototype.selecting=function(c,_29d){
var _29e="."+c+_29d;
var doc=document;
var _2a0=document.getElementById("CVIFrame"+this.m_sNamespace);
if(_2a0){
doc=_2a0.contentWindow.document;
}
var _2a1=doc.createElement("style");
_2a1.setAttribute("type","text/css");
if(_2a1.styleSheet){
_2a1.styleSheet.cssText=_29e;
}else{
_2a1.appendChild(doc.createTextNode(_29e));
}
doc.getElementsByTagName("head").item(0).appendChild(_2a1);
STYLE_SELECTION[c]=_2a1;
};
CSelectionController.prototype.deselecting=function(_2a2){
for(var i=0;i<_2a2.length;++i){
if(STYLE_SELECTION[_2a2[i]]){
var node=STYLE_SELECTION[_2a2[i]];
node.parentNode.removeChild(node);
STYLE_SELECTION[_2a2[i]]=null;
}
}
if(isIE()&&typeof this.m_oCognosViewer.m_viewerFragment!="undefined"){
var _2a5=document.getElementById("CVReport"+this.m_oCognosViewer.getId());
if(_2a5!=null){
var _2a6=_2a5.style.display;
_2a5.style.display="none";
_2a5.style.display=_2a6;
}
}
};
CSelectionController.prototype.showViewerContextMenu=function(){
if(this.hasSelectedChartNodes()){
return true;
}
if(this.m_aSelectedObjects&&this.m_aSelectedObjects.length>0){
return true;
}
return false;
};
function getStyleFromClass(c){
for(var i=0;i<document.styleSheets.length;i++){
var ss=document.styleSheets[i];
var _2aa=(ss.cssRules?ss.cssRules:ss.rules);
for(var j=0;j<_2aa.length;j++){
var cr=_2aa[j];
var _2ad=new RegExp("\\b"+c+"\\b","g");
if(cr.selectorText&&cr.selectorText.match(_2ad)){
return cr;
}
}
}
return 0;
};
CSelectionController.prototype.canUpdateSelection=function(_2ae){
return this.m_selectionStyles.canApplyToSelection(_2ae);
};
CSelectionController.prototype.setStyleForSelection=function(_2af){
return this.m_selectionStyles.setStyleForSelection(_2af);
};
CSelectionController.prototype.updateUI=function(_2b0,_2b1,_2b2,_2b3){
if(!_2b0){
_2b0=document;
}
try{
if(_2b1&&_2b1.length>0){
var _2b4,_2b5,_2b6;
if(_2b3==1||_2b3==2){
if(_2b2){
this.deselecting(this.m_cutClass);
}else{
var _2b7=getStyleFromClass("cutSelection").style.color;
var _2b8=getStyleFromClass("cutSelection").style.backgroundColor;
_2b4=_2b1.length;
for(_2b5=0;_2b5<_2b4;_2b5++){
_2b6=_2b1[_2b5].getCellRef();
var _2b9="cutQS"+_2b6.getAttribute("cid");
this.selecting(_2b9,"\n{ background-color: "+_2b8+"; color: "+_2b7+";}\n");
this.m_cutClass.push(_2b9);
}
}
}else{
if(this.m_oCognosViewer){
this.findSelectionURLs();
_2b6="";
_2b4=_2b1.length;
for(_2b5=0;_2b5<_2b4;_2b5++){
_2b6=_2b1[_2b5].getCellRef();
if(_2b6.getAttribute("oldClassName")!=null){
_2b6.className=_2b6.getAttribute("oldClassName");
_2b6.removeAttribute("oldClassName");
}
this.setStyleForSelection(_2b1[_2b5].m_contextIds);
if(!this.secondarySelectionIsDisabled()||_2b2){
var _2ba=document.getElementById("CVReport"+this.getNamespace());
var _2bb=getElementsByAttribute(_2ba,["td","th"],"name",_2b6.getAttribute("name"),this.m_maxSecondarySelection);
for(var _2bc=0;_2bc<_2bb.length;_2bc++){
var cell=_2bb[_2bc];
if(_2b2){
this.restoreOldBackgroundImage(cell);
}else{
if(cell.getAttribute("oldBackgroundImageStyle")==null){
this.saveOldCellStyles(cell);
this.setSecondarySelectionStyles(cell);
}
}
}
}
this.saveOldCellStyles(_2b6);
if(_2b2){
this.restoreOldBackgroundImage(_2b6);
if(this.m_oCognosViewer.isHighContrast()){
this.restoreOldBorder(_2b6);
this.restoreOldPadding(_2b6);
}
}else{
this.setPrimarySelectionStyles(_2b6);
if(this.m_oCognosViewer.isHighContrast()){
var size=getBoxInfo(_2b6,true);
this.saveOldBorder(_2b6);
this.saveOldPadding(_2b6,size);
var _2bf=3;
var _2c0=size.borderTopWidth+size.paddingTop-_2bf;
var _2c1=size.borderBottomWidth+size.paddingBottom-_2bf;
var _2c2=size.borderLeftWidth+size.paddingLeft-_2bf;
var _2c3=size.borderRightWidth+size.paddingRight-_2bf;
_2b6.style.border=_2bf+"px "+this.getHighContrastBorderStyle()+" black";
_2b6.style.padding=_2c0+"px "+_2c3+"px "+_2c1+"px "+_2c2+"px";
}
}
}
}
}
}
return true;
}
catch(e){
return false;
}
};
CSelectionController.prototype.findSelectionURLs=function(){
if(!(this.sS_backgroundImageURL&&this.pS_backgroundImageURL)){
if(this.m_oCognosViewer.isBux||isSafari()||this.m_oCognosViewer.isMobile()){
this.pS_backgroundImageURL="url(../common/images/selection_primary.png)";
this.sS_backgroundImageURL="url(../common/images/selection_secondary.png)";
}else{
this.pS_backgroundImageURL=this.getBackgroundImage(getStyleFromClass("primarySelection"));
this.sS_backgroundImageURL=this.getBackgroundImage(getStyleFromClass("secondarySelection"));
}
}
};
CSelectionController.prototype.setSelectedChartImgArea=function(_2c4){
var _2c5=true;
var _2c6=_2c4.getAttribute("rsvpChart");
var _2c7=_2c4.parentNode.getAttribute("chartContainer");
if(_2c6!="true"&&_2c7!="true"){
this.m_selectedChartNodes=[];
_2c5=false;
}else{
var _2c8=this.getSelectionObjectFactory().getSelectionChartObject(_2c4);
this.m_selectedChartNodes=[_2c8];
}
return _2c5;
};
CSelectionController.prototype.setSelectedChartArea=function(_2c9,e){
var _2cb=typeof this.m_oCognosViewer.isBux!=="undefined";
var _2cc=false;
if(_2c9!==null){
if(_2c9.tagName=="IMG"){
_2cc=this.setSelectedChartImgArea(_2c9);
}else{
if(_2c9.nodeName=="AREA"&&_2c9.attributes["ctx"]){
_2cc=true;
if(_2cb){
this.setBuxSelectedChartArea(_2c9,e);
}else{
this.m_selectedChartNodes=[this.getSelectionObjectFactory().getSelectionChartObject(_2c9)];
}
}
}
if(_2cc){
this.getObservers().notify();
}
}
return _2cc;
};
CSelectionController.prototype.setBuxSelectedChartArea=function(_2cd,e){
var _2cf=this.getChartHelper(_2cd);
var _2d0=_2cf.getChartNode(_2cd);
this.setStyleForSelection(_2d0.m_contextIds);
var _2d1=_2cf.getImageMapHighlighter();
_2d1.setFillColour(this.getPrimarySelectionColor());
_2d1.setStrokeColour(this.getPrimarySelectionColor());
if(typeof e=="undefined"){
e={};
}
if(this.ctrlKeyPressed(e)||this.shiftKeyPressed(e)){
if(_2d1.isAreaHighlighted(_2cd)){
_2d1.hideAreas(_2d0.getCtxAreas());
var _2d2=_2cd.getAttribute("ctx");
var _2d3=this.m_selectedChartNodes.length;
for(var i=0;i<_2d3;i++){
var _2d5=this.m_selectedChartNodes[i];
if(_2d2==_2d5.getContext()){
this.m_selectedChartNodes.splice(i,1);
break;
}
}
}else{
this.updateSelectionContainer(_2cd);
_2d1.highlightAreas(_2d0.getCtxAreas(),true);
this.m_selectedChartNodes.push(_2d0);
}
}else{
if(this.hasSavedSelectedChartNodes()){
var _2d6=this.m_savedSelectedChartNodes.length;
var _2d7=this.m_savedSelectedChartNodes;
for(var i=0;i<_2d6;i++){
var area=_2d7[i].getArea();
var _2d9=this.getSavedChartHelper(area);
var _2da=_2d9.getImageMapHighlighter();
var _2db=_2da.getAreaId(area);
if(_2d1.getAreaId(_2cd)===_2db){
_2da.hideAreaById(_2db+this.m_savedPrimarySelectionColor);
break;
}
}
}
this.updateSelectionContainer(_2cd);
_2d1.highlightAreas(_2d0.getCtxAreas());
this.m_selectedChartNodes=[_2d0];
}
};
CSelectionController.prototype.updateSelectionContainer=function(_2dc){
var _2dd=_2dc.parentNode;
if(this.m_selectionContainerMap&&this.m_selectionContainerMap.name!=_2dd.name){
var _2de=this.getChartHelper(_2dc).getImageMapHighlighter();
_2de.hideAllAreas();
}
this.m_selectionContainerMap=_2dd;
};
CSelectionController.prototype.getChartHelper=function(_2df){
var _2e0=_2df.parentNode;
var _2e1=_2e0.name;
if(!this.m_chartHelpers[_2e1]){
this.m_chartHelpers[_2e1]=new CChartHelper(_2df,this.getSelectionObjectFactory(),this.m_oCognosViewer);
}
return this.m_chartHelpers[_2e1];
};
CSelectionController.prototype.getSavedChartHelper=function(_2e2){
var _2e3=_2e2.parentNode;
var _2e4=_2e3.name;
return this.m_savedChartHelpers[_2e4];
};
CSelectionController.prototype.getSelectedChartArea=function(){
return this.m_selectedChartArea;
};
CSelectionController.prototype.getSelectedChartNodes=function(){
return this.m_selectedChartNodes;
};
CSelectionController.prototype.hasSelectedChartNodes=function(){
return this.m_selectedChartNodes&&this.m_selectedChartNodes.length&&this.m_selectedChartNodes.length>0;
};
CSelectionController.prototype.getSelectedChartImage=function(){
var _2e5=null;
if(this.hasSelectedChartNodes()){
var _2e6=this.m_selectedChartNodes[0];
_2e5=_2e6.getArea();
}
if(_2e5===null){
return null;
}
if(_2e5.tagName=="IMG"){
return _2e5;
}
return this.getSelectedChartImageFromChartArea(_2e5);
};
CSelectionController.prototype.getSelectedChartImageFromChartArea=function(_2e7){
var _2e8=_2e7.parentNode;
var _2e9="#"+_2e8.getAttribute("name");
return this.checkChildrenForChart(_2e8.parentNode,_2e9);
};
CSelectionController.prototype.checkChildrenForChart=function(_2ea,_2eb){
var _2ec=_2ea.firstChild;
while(_2ec!==null){
if(!_2ec.tagName){
return null;
}else{
if(_2ec.tagName=="IMG"&&_2ec.getAttribute("usemap")==_2eb){
return _2ec;
}else{
if(_2ec.tagName==="DIV"||_2ec.tagName==="SPAN"){
var _2ed=this.checkChildrenForChart(_2ec,_2eb);
if(_2ed){
return _2ed;
}
}
}
}
_2ec=_2ec.nextSibling;
}
return null;
};
CSelectionController.prototype.downloadSelectedChartImage=function(_2ee){
var _2ef=this.getSelectedChartImage();
if(_2ef!==null){
var _2f0=this.getDocumentFromImage(_2ef);
var _2f1=_2ef.name.replace(".","_");
var _2f2=_2f1.substr(5);
var _2f3="?m_name=";
_2f3+=_2f2;
_2f3+="&format=png&b_action=xts.run&m=portal/download.xts&m_obj=";
if(isIE()){
_2f1=_2f0.parentWindow.eval("graphicSrc"+_2f2);
}else{
_2f1=_2f0.defaultView.eval("graphicSrc"+_2f2);
}
var _2f4="";
if(typeof _2f1!="undefined"&&_2f1!==null){
var _2f5=_2f1.split("&");
if(_2f5.length===0){
return;
}
if(_2f1.indexOf("/repository/")<0){
for(var i=0;i<_2f5.length;++i){
var _2f7=_2f5[i];
var _2f8=_2f7.indexOf("=");
if(_2f8!=-1){
var _2f9=_2f7.substr(0,_2f8);
var _2fa=_2f7.slice(_2f8+1);
if(_2f9=="search"){
_2f4+=_2fa;
break;
}
}
}
}
if(_2f4==""){
_2f3=_2ef.getAttribute("src");
if(_2f3.indexOf("?")!=-1){
_2f3+="&download=true";
}else{
_2f3+="?download=true";
}
}
if(typeof getConfigFrame=="function"){
_2f3+=_2f4;
_2f3=getConfigFrame().constructGETRequestParamsString(_2f3);
window.open(_2f3,"_blank","width=0,height=0");
}else{
_2f3=constructGETRequestParamsString(_2f3);
_2f3+=_2f4;
var _2fb=this.m_oCognosViewer.getGateway();
var _2fc=document.getElementById("CVIFrame"+this.m_sNamespace);
if(_2fc){
var _2fd=_2fc.src;
if(_2fd.indexOf("repository")>=0&&_2f3.indexOf("repository")<0){
var _2fe=_2fd.indexOf("content");
_2f3=_2fd.substring(0,_2fe)+_2f3;
}
}
if(_2f3.indexOf(_2fb)==-1){
var _2ff=document.forms["formWarpRequest"+_2ee];
_2f3=_2ff.action+_2f3;
}
if(typeof window.detachLeavingRV=="function"){
window.detachLeavingRV();
}
location.href=_2f3;
if(typeof window.attachLeavingRV=="function"){
setTimeout(window.attachLeavingRV,100);
}
}
}
}
};
CSelectionController.prototype.getDocumentFromImage=function(_300){
var _301=null;
if(_300.ownerDocument){
_301=_300.ownerDocument;
}else{
_301=_300.document;
}
return _301;
};
CSelectionController.prototype.shouldExecutePageClickedOnMouseDown=function(e){
var _303=this.getSelections();
if(_303.length>1){
if(this.m_oCognosViewer.envParams["ui.action"]!=="view"){
var node=getNodeFromEvent(e);
try{
while(node&&(node.nodeType==3||(node.getAttribute&&node.getAttribute("uid")===null))){
node=node.parentNode;
}
}
catch(ex){
}
var _305=this.getSelectionObjectFactory().getContainerType(node);
if(_305==="list"){
for(var i=0;i<_303.length;i++){
if(_303[i].m_oCellRef==node){
return false;
}
}
}
}
}
return true;
};
CSelectionController.prototype.getContainerType=function(){
var _307="";
if(this.hasSelectedChartNodes()){
_307="chart";
}else{
if(this.getDataContainerType()==="list"){
_307="list";
}else{
_307="crosstab";
}
}
return _307;
};
CSelectionController.prototype.getDisplayValues=function(){
var _308={};
var _309=this.getAllSelectedObjects()[0];
if(_309){
var _30a=_309.getSelectedContextIds();
if(_30a){
for(var axis=0;axis<_30a.length;axis++){
var _30c=[];
var _30d=_30a[axis];
for(var _30e=0;_30e<_30d.length;_30e++){
var _30f=_30d[_30e];
var _310=this.getDisplayValue(_30f);
_30c.push(_310);
if(axis===0){
break;
}
}
var _311="";
switch(axis){
case 0:
_311="selected";
break;
case 1:
_311="rows";
break;
default:
_311="columns";
}
_308[_311]=_30c;
}
}
}
return _308;
};
CSelectionController.prototype.getChartTooltip=function(){
var _312=this.getAllSelectedObjects()[0];
if(_312){
var area=_312.getArea();
if(area){
var _314=area.getAttribute("title");
if(_314&&_314.length>0){
return area.getAttribute("title");
}
}
}
return "";
};
CSelectionController.prototype.pageClickedForMobile=function(e){
this.pageClicked(e);
var _316=this.getAllSelectedObjects().length;
if(_316==0){
var node=getNodeFromEvent(e,true);
if(!node){
return false;
}
if(node.nodeName.toLowerCase()=="img"&&node.getAttribute("dttargets")){
this.selectDrillThroughImage(node);
return true;
}else{
if(node.getAttribute("dttargets")){
this.selectDrillThroughSingleton(node);
return true;
}else{
if(node.parentNode&&node.parentNode.getAttribute("dttargets")){
this.selectDrillThroughSingleton(node.parentNode);
return true;
}
}
}
return false;
}
return true;
};
CSelectionController.prototype.clearSavedSelections=function(){
this.m_bSavedSelections=false;
if(this.hasSavedSelectedObjects()){
this.updateUI(null,this.getSavedSelectedObjects(),true,false);
delete (this.m_aSavedSelectedObjects);
}
if(this.hasSavedSelectedChartNodes()){
var _318=this.m_savedChartHelpers;
for(var _319 in _318){
if(_318[_319]){
var _31a=_318[_319].getImageMapHighlighter();
if(_31a.hideAllAreas){
_31a.hideAllAreas();
}
}
}
delete this.m_savedChartHelpers;
delete this.m_savedSelectedChartNodes;
}
};
CSelectionController.prototype.hasSavedSelectedChartNodes=function(){
return (this.m_savedSelectedChartNodes&&this.m_savedSelectedChartNodes.length>0);
};
CSelectionController.prototype.getSavedSelectedChartNodes=function(){
return this.m_savedSelectedChartNodes;
};
CSelectionController.prototype.saveSelections=function(){
this.m_savedSelectionStyles=this.m_selectionStyles;
if(this.m_aSelectedObjects.length>0){
this.m_aSavedSelectedObjects=[];
var _31b=this.m_aSelectedObjects.length;
var temp=[];
for(var i=0;i<_31b;i++){
if(this.isMeasure(this.m_aSelectedObjects[i].m_contextIds[0][0])){
temp.push(this.m_aSelectedObjects[i]);
}else{
this.m_aSavedSelectedObjects.push(this.m_aSelectedObjects[i]);
}
}
this.m_aSelectedObjects=temp;
}
if(this.hasSelectedChartNodes()){
this.m_savedChartHelpers=this.m_chartHelpers;
this.m_chartHelpers={};
this.m_savedSelectedChartNodes=[];
var _31e=this.m_selectedChartNodes.length;
var temp=[];
for(var i=0;i<_31e;i++){
if(this.isMeasure(this.m_selectedChartNodes[i].m_contextIds[0][0])){
var _31f=this.m_selectedChartNodes[i].getArea();
var _320=this.getImageMapName(_31f);
this.m_chartHelpers[_320]=this.m_savedChartHelpers[_320];
delete this.m_savedChartHelpers[_320];
temp.push(this.m_selectedChartNodes[i]);
}else{
this.m_savedSelectedChartNodes.push(this.m_selectedChartNodes[i]);
}
}
this.m_selectedChartNodes=temp;
}
this.m_bSavedSelections=true;
};
CSelectionController.prototype.hasSavedSelections=function(){
return this.m_bSavedSelections;
};
CSelectionController.prototype.hasSavedSelectedObjects=function(){
return (this.m_aSavedSelectedObjects&&this.m_aSavedSelectedObjects.length>0)||this.hasSavedSelectedChartNodes();
};
CSelectionController.prototype.getSavedSelectedObjects=function(){
return this.m_aSavedSelectedObjects;
};
CSelectionController.prototype.getImageMapName=function(_321){
var _322=_321.parentNode;
return _322.name;
};
CSelectionController.prototype.repaintBUXSelectedChartArea=function(_323,_324,_325){
var _326={};
var _327=_323.length;
for(var i=0;i<_327;i++){
var _329=_323[i].getArea();
var _32a=this.getImageMapName(_329);
var _32b;
if(!_326[_32a]){
_32b=(_324)?this.getSavedChartHelper(_329):this.getChartHelper(_329);
_326[_32a]=_32b;
var _32c=_32b.getImageMapHighlighter();
_32c.hideAllAreas();
_32c.setFillColour(this.getPrimarySelectionColor());
_32c.setStrokeColour(this.getPrimarySelectionColor());
}else{
_32b=_326[_32a];
}
var _32d=_323[i].m_contextIds;
if(_325&&_32d.length===1&&_32d[0].length===1&&this.isMeasure(_32d[0][0])){
continue;
}
_32c.highlightAreas(_323[i].getCtxAreas(),1);
}
};
CSelectionController.prototype.repaintSavedSelections=function(){
var _32e=this.m_selectionStyles;
this.m_selectionStyles=this.m_savedSelectionStyles;
var _32f=this.getSavedSelectedChartNodes();
var _330=false;
if(_32f&&_32f.length>0){
bIsChart=true;
}else{
_32f=this.getSavedSelectedObjects();
}
this.repaintSelectionsHelper(_32f,true,_330);
this.resetSelectionStyles();
this.m_selectionStyles=_32e;
};
CSelectionController.prototype.repaintSelections=function(){
var _331=this.getSelectedChartNodes();
var _332=false;
if(_331&&_331.length>0){
_332=true;
}else{
_331=this.getSelections();
}
this.repaintSelectionsHelper(_331,false,_332);
};
CSelectionController.prototype.repaintSelectionsHelper=function(_333,_334,_335){
try{
if(_335){
this.repaintBUXSelectedChartArea(_333,_334);
}else{
this.updateUI(document,_333,true,false);
this.updateUI(document,_333,false,false);
}
}
catch(e){
return false;
}
};
CSelectionController.prototype.resetAll=function(){
this.resetSelectionStyles();
this.clearSavedSelections();
this.resetSelections();
this.resetAllowHorizontalDataValueSelection();
};
CSelectionController.prototype.pageClicked=function(e){
try{
var node=getNodeFromEvent(e);
if(this.m_aSelectedObjects.length>0&&!this.shiftKeyPressed(e)&&!this.ctrlKeyPressed(e)){
var _338=node;
if(!_338.getAttribute("uid")){
var _339=_338.parentNode;
if(_339&&_339.nodeType==1&&typeof _339.getAttribute!="undefined"&&_339.getAttribute("uid")!=null){
_338=_339;
}
}
if(this.isCellSelected(_338)){
if(typeof this.m_oCognosViewer.isBux!=="undefined"){
this.repaintSelections();
}
if(e.button!==0){
return false;
}
}
}
if(node.tagName&&node.tagName.toUpperCase()=="INPUT"){
return true;
}
if((e.keyCode!=null)&&(e.keyCode!=13)&&(e.keyCode!=32)&&(e.keyCode!=27)&&(e.keyCode!=0)&&(e.keyCode!=121)&&(e.keyCode!=93)){
return false;
}
var _33a=getDocumentFromEvent(e);
if(!this.hasContextData()||!this.hasMetadata()){
if(node.nodeName=="AREA"||node.nodeName=="IMG"||(typeof node.getAttribute=="function"&&node.getAttribute("flashChart")!=null)){
this.setSelectedChartArea(node,e);
}
this.getObservers().notify();
return false;
}
if(typeof node.selectedCell!="undefined"){
var _33b=node;
node=node.selectedCell;
_33b.removeAttribute("selectedCell");
}
if(typeof cf!="undefined"&&typeof cf.hidePickers=="function"){
cf.hidePickers();
}
if(e.keyCode==27){
if(typeof g_reportSelectionController!="undefined"){
g_reportSelectionController.clearSelections();
}
this.resetSelections(_33a);
}else{
if(node.nodeName=="AREA"||node.nodeName=="IMG"||(typeof node.getAttribute!="undefined"&&node.getAttribute("flashChart")!=null)){
if(e.button!==2||this.getAllSelectedObjects().length<=1||typeof this.m_oCognosViewer.isBux==="undefined"){
this.selectNode(node,e);
this.setSelectedChartArea(node,e);
}
}else{
if(!(node.firstChild==null&&node.cellIndex==0&&node.parentNode.rowIndex==0&&node.getAttribute("cid")==null)){
var _33c=this.m_oCognosViewer.getViewerWidget();
this.selectNode(node,e);
}
}
}
if(window.gViewerLogger){
window.gViewerLogger.addContextInfo(this);
}
}
catch(e){
}
};
CSelectionController.prototype.getSelectionObjectFactory=function(){
return this.m_oSelectionObjectFactory;
};
CSelectionController.prototype.isDrillLinkOnCrosstabCell=function(node){
return (node.getAttribute("ctx")==null&&node.parentNode.getAttribute("dtTargets")!=null);
};
CSelectionController.prototype.selectObject=function(sMun,sLun,sHun,_341){
var _342=this.getCtxIdFromMun(sMun);
if(_342==""){
_342=this.getCtxIdFromMetaData(sLun,sHun,_341);
}
if(_342!=null&&this.m_oCDManager.GetUsage(_342)!="2"){
var _343=document.getElementById("rt"+this.getNamespace());
if(_343!=null){
var _344=getElementsByAttribute(_343,"*","ctx",_342);
if(_344&&_344.length===0){
var _345=new RegExp("(^|:)"+_342+"(:|$)","i");
_344=getElementsByAttribute(_343,"*","ctx",_342,-1,_345);
}
var _346=null;
if(_344!=null&&_344.length>0){
_346=new CSelectionObject();
_346.setSelectionController(this);
_346.m_sColumnRef=_344[0].getAttribute("cid");
_346.m_sCellTypeId=_344[0].getAttribute("uid");
_346.m_sLayoutType=_344[0].getAttribute("type");
_346.m_sTag=_344[0].getAttribute("tag");
_346.m_layoutElementId=this.m_oSelectionObjectFactory.getLayoutElementId(_344[0]);
_346.m_dataContainerType=this.m_oSelectionObjectFactory.getContainerType(_344[0]);
_346.m_contextIds=[[_342]];
this.m_aSelectedObjects[this.m_aSelectedObjects.length]=_346;
}else{
var _347=getElementsByAttribute(_343,"*","flashChart","true");
if(_347!=null){
for(var _348=0;_348<_347.length;++_348){
var ldx=_347[_348].getLDX();
if(ldx.indexOf("<ctx>"+_342+"</ctx>")!=-1){
_346=new CSelectionObject();
_346.setSelectionController(this);
var lid=_347[_348].getAttribute("lid");
_346.m_layoutElementId=lid.replace(this.m_oCognosViewer.getId(),"");
_346.m_dataContainerType="chart";
_346.m_contextIds=[[_342]];
this.m_aSelectedObjects[this.m_aSelectedObjects.length]=_346;
}
}
}
}
}
}
};
CSelectionController.prototype.buildSelectionObject=function(node,e){
var _34d=null;
try{
while(node.nodeType==3){
node=node.parentNode;
}
if(this.isDrillLinkOnCrosstabCell(node)){
node=node.parentNode;
}
var ctx=node.getAttribute("ctx");
var uid=node.getAttribute("uid");
if((uid==null)&&((ctx!=null)||(node.parentNode&&node.parentNode.nodeType==1&&typeof node.parentNode.getAttribute!="undefined"&&node.parentNode.getAttribute("uid")!=null))){
if(node.nodeName=="IMG"&&(node.src.indexOf("SM=")>-1||(isIE()>-1&&node.src.indexOf("space.gif")>-1))){
return null;
}
node=node.parentNode;
if((node.className.toUpperCase()=="BLOCK"&&node.nodeName.toUpperCase()=="DIV")||(node.getAttribute("dtTargets")!=null)){
node=node.parentNode;
}
uid=node.getAttribute("uid");
}
if(uid!=null){
var _350=node.childNodes;
for(var i=0;i<_350.length;i++){
if(_350[i].nodeName.toUpperCase()=="TABLE"&&(_350[i].className=="ls"||_350[i].className=="xt")){
var trs=_350[i].rows;
for(var j=0;j<trs.length;j++){
var tds=trs[j].cells;
for(var k=0;k<tds.length;k++){
if(tds[k].getAttribute("uid")!=null){
return null;
}
}
}
}
}
if(node.className.toUpperCase()=="REPEATERTABLECELL"&&ctx!=null){
_34d=this.getSelectionObjectFactory().getSelectionObject(node,ctx);
}else{
_34d=this.getSelectionObjectFactory().getSelectionObject(node);
}
}
}
catch(e){
}
return _34d;
};
CSelectionController.prototype.shiftKeyPressed=function(e){
if(e.keyCode=="121"){
return false;
}
if(isSafari()){
if(e.button!=2){
return e.shiftKey?e.shiftKey:false;
}else{
return false;
}
}
return e.shiftKey?e.shiftKey:false;
};
CSelectionController.prototype.ctrlKeyPressed=function(e){
if(isSafari()){
if(e.button!=2){
return e.ctrlKey?e.ctrlKey:false;
}else{
return false;
}
}
return e.ctrlKey?e.ctrlKey:false;
};
CSelectionController.prototype.isSelectionsPreviouslySaved=function(_358){
var _359=false;
if(!this.m_aSavedSelectedObjects||!this.m_aSavedSelectedObjects.length||!_358||!_358.length){
return false;
}
for(var i=0;i<_358.length;i++){
if(this.isSavedCellSelected(_358[i].getCellRef())){
return true;
}
}
return false;
};
CSelectionController.prototype.selectNode=function(node,e){
try{
while(node.nodeType==3){
node=node.parentNode;
}
if(this.isDrillLinkOnCrosstabCell(node)){
node=node.parentNode;
}
var _35d=null;
if(isIE()){
_35d=node.document;
}else{
_35d=node.ownerDocument;
}
var ctx=node.getAttribute("ctx");
var uid=node.getAttribute("uid");
var _360=false;
if(typeof e=="undefined"){
e={};
}
var _361=false;
if(typeof g_reportSelectionController!="undefined"){
_361=this.checkForReportElementNode(node);
}
if((ctx==null&&uid==null&&node.parentNode.nodeType==1&&node.parentNode.getAttribute("uid")==null&&_361==false)||(!this.ctrlKeyPressed(e)&&!this.shiftKeyPressed(e))){
if(this.getSelections().length>0){
_360=true;
}
if(this.hasCutColumns()==true){
this.clearSelectedObjects(_35d);
}else{
this.resetSelections(_35d);
this.repaintSavedSelections();
if(typeof cf!="undefined"&&typeof cf.removeAllSelectionsFromCfgVariables=="function"){
cf.removeAllSelectionsFromCfgVariables();
}
this.m_oCognosViewer.setCurrentNodeFocus(null);
}
if(this.ctrlKeyPressed(e)||this.shiftKeyPressed(e)){
clearTextSelection(_35d);
}
if(typeof g_reportSelectionController!="undefined"&&_361==false){
if(g_reportSelectionController.getSelections().length>0){
_360=true;
}
g_reportSelectionController.clearSelections();
}
}
var _362=node.getAttribute("dtTargets")?node:null;
var _363=(node.nodeName.toLowerCase()==="area");
if((uid==null)&&((ctx!=null)||(node.parentNode&&node.parentNode.nodeType==1&&typeof node.parentNode.getAttribute!="undefined"))){
if(node.nodeName=="IMG"&&(node.src.indexOf("SM=")>-1||(isIE()>-1&&node.src.indexOf("space.gif")>-1))){
return false;
}
node=node.parentNode;
_362=(!_362&&node.getAttribute("dtTargets"))?node:_362;
if((node.className.toUpperCase()=="BLOCK"&&node.nodeName.toUpperCase()=="DIV")||(node.getAttribute("dtTargets")!=null)){
node=node.parentNode;
}
_362=(!_362&&typeof node.getAttribute!="undefined"&&node.getAttribute("dtTargets"))?node:_362;
uid=(typeof node.getAttribute!="undefined")?node.getAttribute("uid"):null;
if(uid==null&&node.nodeName.toLowerCase()=="span"&&node.parentNode.nodeName.toLowerCase()=="td"){
node=node.parentNode;
uid=node.getAttribute("uid");
}
}
if(uid!=null){
var _364=node.childNodes;
for(var i=0;i<_364.length;i++){
if(_364[i].nodeName.toUpperCase()=="TABLE"&&(_364[i].className=="ls"||_364[i].className=="xt")){
var trs=_364[i].rows;
for(var j=0;j<trs.length;j++){
var tds=trs[j].cells;
for(var k=0;k<tds.length;k++){
if(tds[k].getAttribute("uid")!=null){
return false;
}
}
}
}
}
var _36a;
if(node.className.toUpperCase()=="REPEATERTABLECELL"&&ctx!=null){
_36a=this.getSelectionObjectFactory().getSelectionObject(node,ctx);
}else{
_36a=this.getSelectionObjectFactory().getSelectionObject(node);
}
if(this.isCellSelected(node)==false){
if(this.shiftKeyPressed(e)){
var _36b=this.getSelections();
if(_36b.length>0){
var _36c=_36b[_36b.length-1];
if(_36c.getLayoutType()==_36a.getLayoutType()&&(_36c.getCellRef().parentNode.parentNode==_36a.getCellRef().parentNode.parentNode)){
if(this.cellsAreInSameColumn(_36c.getCellRef(),_36a.getCellRef())){
this.selectVertical(_36c,_36a,_35d);
}else{
if(_36c.getCellRef().parentNode.rowIndex==_36a.getCellRef().parentNode.rowIndex){
this.selectHorizontal(_36c,_36a,_35d);
}
}
}
}
clearTextSelection(_35d);
}else{
if(this.ctrlKeyPressed(e)){
clearTextSelection(_35d);
}
}
this.addSelectionObject(_36a,_35d);
if(typeof cf!="undefined"&&typeof cf.addSelectionToCfgVariables=="function"){
cf.addSelectionToCfgVariables(_36a.getColumnName());
}
this.m_oCognosViewer.setCurrentNodeFocus(node);
}else{
if(this.ctrlKeyPressed(e)){
this.removeSelectionObject(_36a,_35d);
if(typeof cf!="undefined"&&typeof cf.removeSelectionFromCfgVariables=="function"){
if(!this.isColumnSelected(_36a.getTag())){
cf.removeSelectionFromCfgVariables(_36a.getTag());
}
}
clearTextSelection(_35d);
}else{
if(this.shiftKeyPressed(e)){
clearTextSelection(_35d);
}
}
}
_360=true;
}else{
if(_361){
var _36d=null;
while((typeof node.id=="undefined"||node.id==null||node.id=="")&&node.parentNode!=null){
node=node.parentNode;
}
if(node.id=="reportTitle"){
_36d="TitleStyle";
}else{
if(node.id=="reportSubtitle"){
_36d="SubtitleStyle";
}else{
if(node.id.indexOf("reportFilter")==0){
_36d="FilterStyle";
}
}
}
if(_36d!=null){
selectReportElement(e,node.id,_36d);
_360=true;
}
}else{
if(_362!=null&&this.m_oCognosViewer&&this.m_oCognosViewer.isMobile()&&!_363){
var _36a=this.getSelectionObjectFactory().getSelectionObject(_362);
this.addSelectionObject(_36a,_35d);
}
}
}
if(_360==true&&(typeof cf!="undefined"&&typeof cf.refreshDialog=="function")){
cf.refreshDialog();
}
}
catch(ex){
}
};
CSelectionController.prototype.selectDrillThroughImage=function(node){
this.m_oSelectedDrillThroughImage=node;
};
CSelectionController.prototype.getSelectedDrillThroughImage=function(){
return this.m_oSelectedDrillThroughImage?this.m_oSelectedDrillThroughImage:null;
};
CSelectionController.prototype.selectDrillThroughSingleton=function(node){
this.m_oSelectedDrillThroughSingleton=node;
};
CSelectionController.prototype.getSelectDrillThroughSingleton=function(){
return this.m_oSelectedDrillThroughSingleton?this.m_oSelectedDrillThroughSingleton:null;
};
CSelectionController.prototype.getReportContextDataArray=function(){
return this.m_aReportContextDataArray;
};
CSelectionController.prototype.getReportMetadataArray=function(){
return this.m_aReportMetadataArray;
};
CSelectionController.prototype.setupContextDataArray=function(_370){
this.m_aReportContextDataArray=_370;
};
CSelectionController.prototype.setupMetaDataArray=function(_371){
this.m_aReportMetadataArray=_371;
};
CSelectionController.prototype.addContextData=function(_372){
this.m_aSelectedObjects=[];
this.m_oCDManager.SetContextData(_372);
if(!this.m_bUsingCCDManager){
this.m_bUsingCCDManager=true;
}
for(var i=0;i<this.m_selectedClass.length;++i){
this.deselecting(this.m_selectedClass);
}
};
CSelectionController.prototype.addMetaData=function(_374){
this.m_aSelectedObjects=[];
this.m_oCDManager.SetMetadata(_374);
if(!this.m_bUsingCCDManager){
this.m_bUsingCCDManager=true;
}
};
CSelectionController.prototype.getDrillFlag=function(_375){
var _376="";
if(!this.m_bUsingCCDManager){
var _377=this.m_aReportContextDataArray[_375];
var _378=_377[0];
var _379=this.m_aReportMetadataArray[_378];
if(typeof _379!="undefined"&&typeof _379[3]!="undefined"){
_376=_379[3];
}
}else{
_376=this.m_oCDManager.GetDrillFlag(_375);
}
return _376;
};
CSelectionController.prototype.getDrillFlagForMember=function(_37a){
var _37b="0";
if(!this.m_bUsingCCDManager){
var _37c=this.getContextDataItem(_37a);
if(_37c!=null){
var _37d=_37c[2];
if(_37d!=""){
var _37e=_37c[0];
var _37f=this.getMetaDataItem(_37e);
if(_37f!=null){
_37b=_37f[3];
}
}
}
}else{
_37b=this.m_oCDManager.GetDrillFlagForMember(_37a);
}
return (_37b==null)?0:_37b;
};
CSelectionController.prototype.getDataType=function(_380){
var _381=null;
if(!this.m_bUsingCCDManager){
var _382=this.getRDI(_380);
if(_382&&_382.length>2){
_381=parseInt(_382[2],10);
}
}else{
_381=parseInt(this.m_oCDManager.GetDataType(_380),10);
}
return _381;
};
CSelectionController.prototype.getUsageInfo=function(_383){
if(this.m_bUsingCCDManager){
return this.m_oCDManager.GetUsage(_383);
}
};
CSelectionController.prototype.isMeasure=function(_384){
return (this.getUsageInfo(_384)==this.c_usageMeasure);
};
CSelectionController.prototype.getDepth=function(_385){
var _386=null;
if(!this.m_bUsingCCDManager){
var _387=this.getRDI(_385);
if(_387&&_387.length>5&&_387[1]=="R"){
_386=_387[5];
}
}else{
_386=this.m_oCDManager.GetDepth(_385);
}
return _386;
};
CSelectionController.prototype.getUseValue=function(_388){
var _389="";
if(!this.m_bUsingCCDManager){
var _38a=this.m_aReportContextDataArray[_388];
if(typeof _38a[1]!="undefined"){
_389=_38a[1];
}
}else{
_389=this.m_oCDManager.GetDisplayValue(_388);
}
return _389;
};
CSelectionController.prototype.getTextValue=function(_38b){
var _38c=null;
for(var _38d=0;_38d<_38b.length;_38d++){
if(_38b[_38d].style.visisbility!="hidden"){
if(isIE()){
_38c=_38b[_38d].innerText;
}else{
_38c=_38b[_38d].textContent;
}
var _38e=_38b[_38d].nextSibling;
while(_38e!=null){
if(_38e.nodeName.toUpperCase()=="SPAN"&&_38e.style.visibility!="hidden"){
if(isIE()){
_38c+=_38e.innerText;
}else{
_38c+=_38e.textContent;
}
}
_38e=_38e.nextSibling;
}
break;
}
}
return _38c;
};
CSelectionController.prototype.getDisplayValueFromDOM=function(_38f,_390){
var _391=null;
var _392;
var _393=new RegExp("(^|\\s)"+_38f+"(\\s|$|:)","i");
if(typeof _390!="undefined"){
_392=getElementsByAttribute(_390,["span","td","th"],"ctx",_38f,1,_393);
}else{
var _394=document.getElementById("CVIFrame"+this.m_sNamespace);
if(typeof _394=="undefined"||_394==null){
var _395=document.getElementById("RVContent"+this.m_sNamespace);
if(typeof _395=="undefined"||_395==null){
_392=getElementsByAttribute(document.body,["span","td","th"],"ctx",_38f,1,_393);
}else{
_392=getElementsByAttribute(_395,["span","td","th"],"ctx",_38f,1,_393);
}
}else{
_392=getElementsByAttribute(_394.contentWindow.document.body,["span","td","th"],"ctx",_38f,1,_393);
}
}
var _396;
if(_392.length>0&&(_392[0].nodeName.toUpperCase()=="TD"||_392[0].nodeName.toUpperCase()=="TH")){
_396=_392[0].childNodes;
}else{
_396=_392;
}
if(_396.length==0||(_396[0].className.indexOf("chart_area")==-1&&_396[0].className.indexOf("bux-comment")==-1)){
_391=this.getTextValue(_396);
}
return _391;
};
CSelectionController.prototype.getDisplayValue=function(_397,_398){
var _399=this.getDisplayValueFromDOM(_397,_398);
if(_399==null){
_399=this.getUseValue(_397);
}
return _399;
};
CSelectionController.prototype.getDun=function(_39a){
if(this.m_bUsingCCDManager){
return this.m_oCDManager.GetDUN(_39a);
}else{
var _39b=this.m_aReportContextDataArray[_39a];
if(_39b&&typeof _39b[5]!="undefined"){
var _39c=_39b[5];
var _39d=this.m_aReportMetadataArray[_39c];
if(typeof _39d!="undefined"&&typeof _39d[1]!="undefined"&&_39d[1]=="D"){
return _39d[0];
}
}
}
};
CSelectionController.prototype.getPun=function(_39e){
if(this.m_bUsingCCDManager){
return this.m_oCDManager.GetPUN(_39e);
}
};
CSelectionController.prototype.getLun=function(_39f){
var lun="";
if(!this.m_bUsingCCDManager){
var _3a1=this.m_aReportContextDataArray[_39f];
if(_3a1&&typeof _3a1[3]!="undefined"){
var _3a2=_3a1[3];
var _3a3=this.m_aReportMetadataArray[_3a2];
if(typeof _3a3!="undefined"&&typeof _3a3[1]!="undefined"&&_3a3[1]=="L"){
lun=_3a3[0];
}
}
}else{
lun=this.m_oCDManager.GetLUN(_39f);
}
return lun;
};
CSelectionController.prototype.isContextId=function(_3a4){
var _3a5=false;
if(!this.m_bUsingCCDManager){
var _3a6=this.m_aReportContextDataArray[_3a4];
_3a5=(typeof _3a6=="object");
}else{
this.m_oCDManager.FetchContextData([_3a4]);
_3a5=this.m_oCDManager.ContextIdExists(_3a4);
}
return _3a5;
};
CSelectionController.prototype.hasContextData=function(){
var _3a7=false;
if(!this.m_bUsingCCDManager){
if(this.m_aReportContextDataArray&&this.m_aReportContextDataArray.length&&this.m_aReportContextDataArray.length()>0){
return true;
}
}else{
_3a7=this.m_oCDManager.HasContextData();
}
return _3a7;
};
CSelectionController.prototype.hasMetadata=function(){
var _3a8=false;
if(!this.m_bUsingCCDManager){
if(this.m_aReportMetadataArray&&this.m_aReportMetadataArray.length&&this.m_aReportMetadataArray.length()>0){
return true;
}
}else{
_3a8=this.m_oCDManager.HasMetadata();
}
return _3a8;
};
CSelectionController.prototype.getDifferentCellIndex=function(_3a9,_3aa,_3ab){
for(var i=0;i<_3a9.cells.length;i++){
if(this.getSelectionObjectFactory().getSelectionObject(_3a9.cells[i]).getLayoutType()=="datavalue"){
break;
}
}
if(_3ab=="relative"){
return (_3aa-i);
}else{
if(_3ab=="actual"){
return (_3aa+i);
}
}
};
CSelectionController.prototype.cellsAreInSameColumn=function(_3ad,_3ae){
if(_3ad.parentNode.rowIndex==_3ae.parentNode.rowIndex){
return false;
}
if(_3ad.getAttribute("cid")===null){
if(_3ad.getAttribute("uid")===_3ae.getAttribute("uid")){
if(_3ad.getAttribute("type")!="datavalue"){
return true;
}else{
if(this.getDifferentCellIndex(_3ad.parentNode,_3ad.cellIndex,"relative")==this.getDifferentCellIndex(_3ae.parentNode,_3ae.cellIndex,"relative")){
return true;
}
}
}else{
return false;
}
}else{
if(_3ad.getAttribute("cid")===_3ae.getAttribute("cid")){
return true;
}else{
return false;
}
}
};
CSelectionController.prototype.selectVertical=function(_3af,_3b0,_3b1){
if(!_3b1){
_3b1=document;
}
var _3b2=_3af.getCellRef().parentNode;
var _3b3,i;
var _3b5=(_3af.getCellRef().parentNode.rowIndex<_3b0.getCellRef().parentNode.rowIndex);
var _3b6=(_3af.getCellRef().parentNode.cells.length-_3af.getCellRef().cellIndex);
while(_3b2.rowIndex!=_3b0.getCellRef().parentNode.rowIndex){
if(_3b5){
_3b2=_3b2.nextSibling;
}else{
_3b2=_3b2.previousSibling;
}
if(_3b2==null){
break;
}
if(_3b2.cells.length>=_3b6){
for(i=0;i<_3b2.cells.length;i++){
if((_3b2.cells[i].getAttribute("type")==_3af.getLayoutType())&&this.cellsAreInSameColumn(_3af.getCellRef(),_3b2.cells[i])){
_3b3=this.getSelectionObjectFactory().getSelectionObject(_3b2.cells[i]);
if(this.addSelectionObject(_3b3,_3b1)){
if(typeof cf!="undefined"&&typeof cf.addSelectionToCfgVariables=="function"){
cf.addSelectionToCfgVariables(_3b3.getColumnName());
}
}
break;
}
}
}
}
};
CSelectionController.prototype.selectHorizontal=function(_3b7,_3b8,_3b9){
var _3ba="";
if(_3b7.getColumnRef()==null){
if(_3b7.getCellRef().getAttribute("uid")==_3b8.getCellRef().getAttribute("uid")){
_3ba=_3b7.getCellRef().getAttribute("uid");
}else{
return;
}
}
var _3bb,_3bc;
var _3bd=_3b8.getCellRef().parentNode;
var _3be;
if(_3b8.getCellRef().cellIndex<_3b7.getCellRef().cellIndex){
_3bb=_3b8.getCellRef().cellIndex;
_3bc=_3b7.getCellRef().cellIndex;
}else{
_3bc=_3b8.getCellRef().cellIndex;
_3bb=_3b7.getCellRef().cellIndex;
}
for(var i=_3bb+1;i<_3bc;i++){
if(((_3b7.getColumnRef()!=null)&&(_3b7.getLayoutType()==_3b8.getLayoutType())&&(_3b7.getLayoutType()!="datavalue")||this.allowHorizontalDataValueSelection())||((_3b7.getColumnRef()==null)&&(_3bd.cells[i].getAttribute("uid")==_3ba))){
_3be=this.getSelectionObjectFactory().getSelectionObject(_3bd.cells[i]);
if(this.addSelectionObject(_3be,_3b9)){
if(typeof cf!="undefined"&&typeof cf.addSelectionToCfgVariables=="function"){
cf.addSelectionToCfgVariables(_3be.getColumnName());
}
}
}
}
};
CSelectionController.prototype.pageDoubleClicked=function(e){
try{
var node=getNodeFromEvent(e);
if(typeof node.selectedCell!="undefined"){
var _3c2=node;
node=node.selectedCell;
_3c2.removeAttribute("selectedCell");
}
while(node.nodeType==3){
node=node.parentNode;
}
var ctx=node.getAttribute("ctx");
var uid=node.getAttribute("uid");
if((ctx!=null)||(node.parentNode.nodeType==1&&node.parentNode.getAttribute("uid")!=null)){
node=node.parentNode;
if(node.className.toUpperCase()=="BLOCK"&&node.nodeName.toUpperCase()=="DIV"){
node=node.parentNode;
}
uid=node.getAttribute("uid");
}
if(uid!=null&&node.firstChild!=null&&(node.getAttribute("type")=="columnTitle"||node.getAttribute("type")=="section")){
if(typeof goWindowManager!="undefined"&&goWindowManager&&typeof goWindowManager.getApplicationFrame=="function"){
goWindowManager.getFeatureManager().launchFeature("Rename");
}
}
if(typeof g_reportSelectionController!="undefined"){
g_reportSelectionController.clearSelections();
}
}
catch(ex){
}
};
CSelectionController.prototype.getSelectionHoverNodes=function(){
return this.m_aSelectionHoverNodes;
};
CSelectionController.prototype.setSelectionHoverNodes=function(_3c5){
this.m_aSelectionHoverNodes=_3c5;
};
CSelectionController.prototype.addSelectionHoverNode=function(node){
this.m_aSelectionHoverNodes[this.m_aSelectionHoverNodes.length]=node;
};
CSelectionController.prototype.pageHover=function(e){
try{
var node=getNodeFromEvent(e);
while(node.nodeType==3){
node=node.parentNode;
}
if((node.getAttribute("ctx")!=null)||(node.parentNode.nodeType==1&&node.parentNode.getAttribute("uid")!=null)){
if(node.parentNode.nodeName.toLowerCase()!="tr"){
node=node.parentNode;
}
}
var _3c9=this.getSelectionHoverNodes();
var _3ca=this.getAllSelectedObjects().length;
if(!(_3c9.length==1&&_3c9[0]==node)){
for(var i=0;i<_3c9.length;i++){
this.sortIconHover(_3c9[i],true);
if(_3ca==0){
this.pageChangeHover(_3c9[i],true);
}
}
this.setSelectionHoverNodes([]);
if(_3ca==0){
this.sortIconHover(node,false);
if(this.pageChangeHover(node,false)){
this.addSelectionHoverNode(node);
}
}else{
if(this.sortIconHover(node,false)){
this.addSelectionHoverNode(node);
}
}
}
}
catch(ex){
}
};
CSelectionController.prototype.sortIconHover=function(node,_3cd){
if(!this.isValidColumnTitle(node)){
return false;
}
var _3ce=this.getSortImgNode(node);
if(_3ce!=null&&_3ce!="undefined"){
if(_3ce.getAttribute("sortOrder")==="nosort"){
if(_3cd){
_3ce.style.visibility="hidden";
}else{
_3ce.style.visibility="visible";
}
}
return true;
}
return false;
};
CSelectionController.prototype.isValidColumnTitle=function(node){
if(node&&node.parentNode){
var uid=node.getAttribute("uid");
if(uid!=null&&(!(node.firstChild==null&&node.cellIndex==0&&node.parentNode.rowIndex==0&&node.getAttribute("cid")==null))&&(node.getAttribute("type")=="columnTitle"||node.getAttribute("type")=="section")){
return true;
}
}
return false;
};
CSelectionController.prototype.pageChangeHover=function(node,_3d2){
try{
if((node.getAttribute("ctx")!=null)||(node.parentNode&&node.parentNode.nodeType==1&&node.parentNode.getAttribute("uid")!=null)){
if(node.parentNode.nodeName.toLowerCase()!="tr"){
node=node.parentNode;
}
}
if(this.isValidColumnTitle(node)){
var _3d3=this.isColumnSelected(node.getAttribute("tag"));
if(!_3d3){
_3d3=this.isColumnCut(node.getAttribute("tag"));
}
if(!_3d3){
if(_3d2){
if(node.getAttribute("oldClassName")!=null){
node.className=node.getAttribute("oldClassName");
node.removeAttribute("oldClassName");
}
this.restoreOldBackgroundImage(node);
}else{
if(node.getAttribute("oldClassName")!=null){
node.className=node.getAttribute("oldClassName");
}else{
node.setAttribute("oldClassName",node.className);
}
if(node.getAttribute("oldBackgroundImageStyle")!=null){
node.style.backgroundImage=node.getAttribute("oldBackgroundImageStyle");
}else{
this.saveOldCellStyles(node);
}
node.className+=" hoverSelection";
return true;
}
}
}
}
catch(ex){
}
return false;
};
CSelectionController.prototype.getSortImgNode=function(node){
var _3d5=node.getElementsByTagName("img");
for(var i=0;i<_3d5.length;i++){
var sId=_3d5[i].id.toString();
if(sId!=null&&sId.length>0&&sId.indexOf("sortimg")>=0){
node=_3d5[i];
return node;
}
}
return null;
};
CSelectionController.prototype.restoreOldPadding=function(node){
if(node&&node.style&&node.getAttribute("oldPaddingStyle")!=null){
if(node.getAttribute("oldPaddingStyle").length>0){
node.style.padding=node.getAttribute("oldPaddingStyle");
}
node.removeAttribute("oldPaddingStyle");
}
};
CSelectionController.prototype.saveOldPadding=function(node,size){
if(node&&node.getAttribute("oldPaddingStyle")==null){
node.setAttribute("oldPaddingStyle",size.paddingTop+"px "+size.paddingRight+"px "+size.paddingBottom+"px "+size.paddingLeft+"px");
}
};
CSelectionController.prototype.saveOldBorder=function(node){
if(node&&node.getAttribute("oldBorderStyle")==null){
node.setAttribute("oldBorderStyle",node.style.border);
}
};
CSelectionController.prototype.restoreOldBorder=function(node){
if(node&&node.style&&node.getAttribute("oldBorderStyle")!=null){
if(node.getAttribute("oldBorderStyle").length>0){
node.style.border=node.getAttribute("oldBorderStyle");
}else{
node.style.borderColor=node.style.borderWidth=node.style.borderStyle="";
}
node.removeAttribute("oldBorderStyle");
}
};
CSelectionController.prototype.setPrimarySelectionStyles=function(cell){
if(this.getPrimarySelectionColor()){
cell.style.backgroundColor=this.getPrimarySelectionColor();
}else{
cell.style.backgroundImage=this.pS_backgroundImageURL;
cell.style.backgroundRepeat="repeat";
}
};
CSelectionController.prototype.setSecondarySelectionStyles=function(cell){
if(this.getSecondarySelectionColor()){
cell.style.backgroundColor=this.getSecondarySelectionColor();
}else{
cell.style.backgroundImage=this.sS_backgroundImageURL;
cell.style.backgroundRepeat="repeat";
}
};
CSelectionController.prototype.saveOldCellStyles=function(node){
if(node&&node.getAttribute("oldBackgroundImageStyle")==null){
node.setAttribute("oldBackgroundColor",this.getStyleProperty(node,"backgroundColor"));
node.setAttribute("oldBackgroundImageStyle",this.getBackgroundImage(node));
node.setAttribute("oldBackgroundRepeat",this.getStyleProperty(node,"backgroundRepeat"));
node.style.backgroundImage="";
node.style.backgroundRepeat="";
}
};
CSelectionController.prototype.restoreOldBackgroundImage=function(node){
if(node&&node.style&&node.getAttribute("oldBackgroundImageStyle")!=null){
node.style.backgroundImage=node.getAttribute("oldBackgroundImageStyle");
node.removeAttribute("oldBackgroundImageStyle");
node.style.backgroundRepeat=node.getAttribute("oldBackgroundRepeat");
node.removeAttribute("oldBackgroundRepeat");
node.style.backgroundColor=node.getAttribute("oldBackgroundColor");
node.removeAttribute("oldBackgroundColor");
}
};
CSelectionController.prototype.getStyleProperty=function(node,_3e2){
if(node&&node.style&&node.style[_3e2]){
return node.style[_3e2];
}
return "";
};
CSelectionController.prototype.getBackgroundImage=function(node){
if(node&&node.style){
return node.style.backgroundImage;
}
return "";
};
CSelectionController.prototype.pageContextClicked=function(e){
var node=getNodeFromEvent(e);
if(typeof node.selectedCell!="undefined"){
var _3e6=node;
node=node.selectedCell;
_3e6.removeAttribute("selectedCell");
}
while(node!=null&&node.tagName!="TD"){
node=node.parentNode;
}
if(node!=null){
var _3e7=this.getBackgroundImage(node);
this.findSelectionURLs();
if(this.getSelections().length==0||_3e7!=this.pS_backgroundImageURL){
this.pageClicked(e);
}
}
if(typeof populateContextMenu!="undefined"){
populateContextMenu();
moveContextMenu(e);
}
var _3e8=false;
if(this.showViewerContextMenu()){
if(typeof e.preventDefault=="function"){
e.preventDefault();
}
_3e8=true;
}
return _3e8;
};
CSelectionController.prototype.chartContextMenu=function(e){
if(!this.hasSelectedChartNodes()){
return;
}
if(typeof populateContextMenu!="undefined"){
populateContextMenu();
moveContextMenu(e);
}
if(typeof e.preventDefault=="function"){
e.preventDefault();
}
return false;
};
CSelectionController.prototype.titleAreaContextMenu=function(e,_3eb,sId){
if(typeof populateContextMenu!="undefined"){
goWindowManager.getApplicationFrame().cfgSet("contextMenuType",_3eb);
goWindowManager.getApplicationFrame().cfgSet("contextMenuId",sId);
populateContextMenu(_3eb.toUpperCase());
moveContextMenu(e,_3eb.toUpperCase());
}
if(typeof e.preventDefault=="function"){
e.preventDefault();
}
return false;
};
CSelectionController.prototype.selectionsAreAllSameType=function(){
var _3ed=this.getSelections();
if(_3ed.length>0){
var _3ee=_3ed[0].getLayoutType();
for(var i=1;i<_3ed.length;i++){
if(_3ee!=_3ed[i].getLayoutType()){
return 0;
}
}
return 1;
}
return -1;
};
CSelectionController.prototype.selectionsAreAllOnSameColumn=function(){
var _3f0=this.getSelections();
var i=0;
if(_3f0.length>0){
var _3f2=_3f0[0].getColumnRef();
if(_3f2!=null&&_3f2!=""){
for(i=1;i<_3f0.length;i++){
if(_3f2!=_3f0[i].getColumnRef()){
return false;
}
}
}else{
var _3f3=_3f0[0].getCellTypeId();
for(i=1;i<_3f0.length;i++){
if(_3f3!=_3f0[i].getCellTypeId()){
return false;
}
}
}
return true;
}
return false;
};
CSelectionController.prototype.checkForReportElementNode=function(node){
if(typeof node!="undefined"&&node!=null&&typeof node.className!="undefined"&&node.className!=null){
if(node.className=="tt"){
if(typeof node.parentNode!="undefined"&&node.parentNode!=null&&typeof node.parentNode.parentNode!="undefined"&&node.parentNode.parentNode!=null&&(node.parentNode.className=="reportSubtitleStyle"||node.parentNode.id=="reportTitleLink")){
node=node.parentNode.parentNode;
}else{
return false;
}
}else{
if(typeof node.parentNode!="undefined"&&node.parentNode!=null){
var _3f5=node.parentNode;
while(typeof _3f5!="undefined"&&_3f5!=null){
if(typeof _3f5.className!="undefined"&&_3f5.className!=null&&_3f5.className.substr(0,2)=="ft"){
node=_3f5;
break;
}else{
_3f5=_3f5.parentNode;
}
}
}else{
return false;
}
}
var _3f6=node.className.substr(0,2);
if(_3f6=="ta"||_3f6=="ts"||_3f6=="ft"){
return true;
}
}
return false;
};
CSelectionController.prototype.chartClicked=function(_3f7){
this.setSelectedChartArea(_3f7);
};
CSelectionController.prototype.processColumnTitleNode=function(_3f8){
if(!_3f8||!this.m_oCognosViewer.isBux){
return;
}
var _3f9=_3f8.getCellRef();
if(_3f9.getAttribute("contextAugmented")=="true"||"list"!=_3f8.getDataContainerType()||"columnTitle"!=_3f8.getLayoutType()){
return;
}
var _3fa=_3f8.getSelectedContextIds();
var _3fb=false;
if(typeof _3fa=="object"&&_3fa!=null&&_3fa.length>0){
if(this.isRelational(_3fa)&&this.getQueryModelId(_3fa[0][0])==null){
_3fb=true;
}else{
return;
}
}
var lid=_3f9.parentNode.parentNode.parentNode.getAttribute("lid");
var _3fd=_3f9.parentNode.nextSibling;
var _3fe=getChildElementsByAttribute(_3fd,"td","cid",_3f9.getAttribute("cid"));
var _3ff=null;
var _400=true;
var _401;
if(_3fe.length>0){
var _402=_3fe[0];
var _403=_402.childNodes.length;
for(var _404=0;_404<_403;_404++){
var _405=_402.childNodes[_404];
if(_405.getAttribute&&((_405.nodeName.toLowerCase()=="table"&&typeof _405.getAttribute("lid")=="string")||_405.nodeName.toLowerCase()=="map"||_405.nodeName.toLowerCase()=="img"||_405.getAttribute("chartcontainer")=="true")){
if(_404==0){
_400=false;
}
}else{
_401=[];
if(_405.nodeName.toLowerCase()=="span"){
_401.push(_405);
}
var _406=_405.getElementsByTagName?_405.getElementsByTagName("span"):[];
for(var _407=0;_407<_406.length;++_407){
if(lid==getImmediateLayoutContainerId(_406[_407])){
_401.push(_406[_407]);
}
}
for(var _408=0;_408<_401.length;++_408){
var _409=_401[_408];
if(_409.nodeType==1&&_409.nodeName.toLowerCase()=="span"&&_409.style.visibility!="hidden"){
if(_409.getAttribute("ctx")!=null&&_409.getAttribute("ctx")!=""){
_3ff=_409.getAttribute("ctx");
break;
}
}
}
}
}
}
if(_3ff!=null){
var _40a=_3ff.split("::")[0].split(":")[0];
if(!_3fb){
_401=_3f9.getElementsByTagName("span");
if(_401.length!=0){
var _40b=this.m_oCDManager.m_cd[_40a];
var _40c=this.getTextValue(_401);
var _40d={"u":_40c===null?"":_40c};
if(typeof _40b!="undefined"){
if(typeof _40b["r"]!="undefined"){
_40d.r=_40b["r"];
}
if(typeof _40b["q"]!="undefined"){
_40d.q=_40b["q"];
}
if(typeof _40b["i"]!="undefined"){
_40d.i=_40b["i"];
}
}
var _40e="cloned"+_40a;
this.m_oCDManager.m_cd[_40e]=_40d;
_401[0].setAttribute("ctx",_40e);
_3f8=this.getSelectionObjectFactory().processCTX(_3f8,_40e);
}
}else{
var qmid=this.getQueryModelId(_40a);
if(qmid==null){
}
if(qmid!=null){
var _410=_3fa[0][0];
this.m_oCDManager.m_cd[_410].i=this.m_oCDManager.m_cd[_40a].i;
return false;
}
}
}else{
_400=false;
}
if(!_400){
_3f9.setAttribute("canSort","false");
}
_3f9.setAttribute("contextAugmented","true");
};
CSelectionController.prototype.selectionsInSameDataContainer=function(){
try{
var _411=this.getAllSelectedObjects();
var _412=_411[0].getLayoutElementId();
for(var _413=1;_413<_411.length;_413++){
if(_412!=_411[_413].getLayoutElementId()){
return false;
}
}
}
catch(e){
return false;
}
return true;
};
CSelectionController.prototype.selectionsFromSameDataItem=function(){
try{
var _414=this.getAllSelectedObjects();
var _415=_414[0].getDataItems()[0][0];
for(var _416=1;_416<_414.length;_416++){
if(_415!=_414[_416].getDataItems()[0][0]){
return false;
}
}
}
catch(e){
return false;
}
return true;
};
CSelectionController.prototype.isRelational=function(_417){
try{
if(!_417){
var _418=this.getAllSelectedObjects()[0];
_417=_418.getSelectedContextIds();
}
for(var _419=0;_419<_417.length;_419++){
for(var _41a=0;_41a<_417[_419].length;_41a++){
var ctx=_417[_419][_41a];
var mun=this.getMun(ctx);
var lun=this.getLun(ctx);
var hun=this.getHun(ctx);
if(mun!=null&&typeof mun!="undefined"&&mun.length>0){
return false;
}
if(lun!=null&&typeof lun!="undefined"&&lun.length>0){
return false;
}
if(hun!=null&&typeof hun!="undefined"&&hun.length>0){
return false;
}
}
}
return true;
}
catch(e){
return true;
}
return true;
};
CSelectionController.prototype.getDataContainerType=function(){
try{
if(!this.getAllSelectedObjects()[0]){
return "";
}
return this.getAllSelectedObjects()[0].m_dataContainerType;
}
catch(e){
return "";
}
};
CSelectionController.prototype.areSelectionsColumnRowTitles=function(){
try{
var _41f=this.getAllSelectedObjects();
for(var _420=0;_420<_41f.length;_420++){
var _421=_41f[_420];
if(_421.getLayoutType()!="columnTitle"||_421.isHomeCell()){
return false;
}
}
}
catch(e){
return false;
}
return true;
};
CSelectionController.prototype.selectionsAreMeasures=function(){
try{
var _422=this.getAllSelectedObjects();
for(var _423=0;_423<_422.length;_423++){
var _424=_422[_423];
if(this.getUsageInfo(_424.getSelectedContextIds()[0][0])!=this.c_usageMeasure){
return false;
}
}
}
catch(e){
return false;
}
return true;
};
CSelectionController.prototype.selectionsNonMeasureWithMUN=function(){
var _425=this.getAllSelectedObjects();
if(_425.length==0){
return false;
}
for(var _426=0;_426<_425.length;_426++){
var _427=_425[0];
if(_427.getSelectedContextIds().length==0){
return false;
}
var _428=_427.getSelectedContextIds()[0][0];
var mun=this.getMun(_428);
var _42a=this.getUsageInfo(_428);
if(mun==null||typeof mun=="undefined"||mun.length==0||_42a==this.c_usageMeasure){
return false;
}
}
return true;
};
CSelectionController.prototype.areSelectionsMeasureOrCalculation=function(){
var _42b=this.getAllSelectedObjects();
if(_42b.length==0){
return false;
}
var _42c=this.selectionsHaveCalculationMetadata();
for(var _42d=0;_42d<_42b.length;_42d++){
var _42e=_42b[_42d];
var _42f=_42e.getSelectedContextIds()[0][0];
if(!this.isCalculationOrMeasure(_42f,_42c)){
return false;
}
}
return true;
};
CSelectionController.prototype.selectionsHaveCalculationMetadata=function(){
try{
var _430=this.getDataContainerType();
var _431=this.getAllSelectedObjects();
for(var _432=0;_432<_431.length;_432++){
var _433=_431[_432];
var _434=_433.getSelectedContextIds();
var _435=_434[0][0];
var sHun=this.getHun(_435);
if(!this.hasCalculationMetadata(_435,_434,_430)){
return false;
}
}
}
catch(e){
return false;
}
return true;
};
CSelectionController.prototype.isCalculationOrMeasure=function(_437,_438){
var mun=this.getMun(_437);
var _43a=this.getUsageInfo(_437);
if(!(((mun==null||typeof mun=="undefined"||mun.length==0)&&_438)||_43a==this.c_usageMeasure)){
return false;
}
return true;
};
CSelectionController.prototype.hasCalculationMetadata=function(_43b,_43c,_43d){
var sHun=this.getHun(_43b);
if(this.getUsageInfo(_43b)!=this.c_usageMeasure){
if((this.isRelational(_43c)&&this.getQueryModelId(_43b)!=null)||(!this.isRelational(_43c)&&_43d=="list"&&(sHun&&sHun!=""))){
return false;
}
}
return true;
};
CSelectionController.prototype.selectionsAreDateTime=function(){
try{
var _43f=this.getAllSelectedObjects();
for(var _440=0;_440<_43f.length;_440++){
var _441=_43f[_440];
var _442=_441.getSelectedContextIds();
var _443=_442[0][0];
var _444=this.getDataType(_443);
if(_444&&typeof this.m_ccl_dateTypes[_444]!=="undefined"){
return true;
}
}
}
catch(e){
return false;
}
return false;
};
CSelectionController.prototype.getSelectedObjectsJsonContext=function(){
try{
var _445=this.getAllSelectedObjects();
if(_445===null||_445.length<=0){
return null;
}
var _446=this.m_oCognosViewer.getModelPath();
var _447=[];
for(var i=0;i<_445.length;i++){
var obj=_445[i].getContextJsonObject(this,_446);
_447.push(obj);
}
return _447;
}
catch(e){
}
};
CSelectionController.prototype.destroy=function(){
delete this.m_oCognosViewer;
delete this.m_aCutColumns;
delete this.m_aSelectedObjects;
delete this.m_selectedClass;
delete this.m_cutClass;
if(this.m_oObserver&&this.m_oObserver.destroy){
this.m_oObserver.destroy();
}
delete this.m_oObserver;
delete this.m_aReportMetadataArray;
delete this.m_aReportContextDataArray;
if(this.m_oCDManager&&this.m_oCDManager.destroy){
this.m_oCDManager.destroy();
}
delete this.m_oCDManager;
if(this.m_oSelectionObjectFactory&&this.m_oSelectionObjectFactory.destroy){
this.m_oSelectionObjectFactory.destroy();
}
delete this.m_oSelectionObjectFactory;
delete this.m_selectedChartArea;
delete this.m_selectedChartNodes;
delete this.m_selectionContainerMap;
delete this.m_chartHelpers;
delete this.m_oJsonForMarshal;
if(this.hasSavedSelections()){
this.clearSavedSelections();
}
};
function clearTextSelection(_44a){
if(!_44a){
_44a=document;
}
try{
if(typeof _44a.selection=="object"&&_44a.selection!==null){
_44a.selection.empty();
}else{
if(typeof window.getSelection=="function"&&typeof window.getSelection()=="object"&&window.getSelection()!==null){
window.getSelection().removeAllRanges();
}
}
}
catch(e){
}
};
function CDrillThroughTarget(_44b,_44c,_44d,_44e,_44f,path,_451,_452,_453,_454,_455,_456){
this.m_label=_44b;
this.m_outputFormat=_44c;
this.m_outputLocale=_44d;
this.m_showInNewWindow=_44e;
this.m_method=_44f;
this.m_path=path;
this.m_bookmark=_451;
this.m_parameters=_452;
this.m_objectPaths=_453;
this.m_prompt="false";
this.m_dynamicDrillThrough=false;
this.m_parameterProperties=_456;
if(typeof _454!="undefined"&&_454!=null){
if(_454=="yes"){
this.m_prompt="true";
}else{
if(_454=="target"){
this.m_prompt="";
}
}
}
if(typeof _455!="undefined"&&_455!=null){
if(typeof _455=="string"){
_455=_455=="true"?true:false;
}
this.m_dynamicDrillThrough=_455;
}
};
function CDrillThroughTarget_getParameterProperties(){
return this.m_parameterProperties;
};
function CDrillThroughTarget_getLabel(){
return this.m_label;
};
function CDrillThroughTarget_getOutputFormat(){
return this.m_outputFormat;
};
function CDrillThroughTarget_getOutputLocale(){
return this.m_outputLocale;
};
function CDrillThroughTarget_getShowInNewWindow(){
return this.m_showInNewWindow;
};
function CDrillThroughTarget_getMethod(){
return this.m_method;
};
function CDrillThroughTarget_getPath(){
return this.m_path;
};
function CDrillThroughTarget_getBookmark(){
return this.m_bookmark;
};
function CDrillThroughTarget_getParameters(){
return this.m_parameters;
};
function CDrillThroughTarget_getObjectPaths(){
return this.m_objectPaths;
};
function CDrillThroughTarget_getPrompt(){
return this.m_prompt;
};
function CDrillThroughTarget_isDynamicDrillThrough(){
return this.m_dynamicDrillThrough;
};
CDrillThroughTarget.prototype.getLabel=CDrillThroughTarget_getLabel;
CDrillThroughTarget.prototype.getOutputFormat=CDrillThroughTarget_getOutputFormat;
CDrillThroughTarget.prototype.getOutputLocale=CDrillThroughTarget_getOutputLocale;
CDrillThroughTarget.prototype.getShowInNewWindow=CDrillThroughTarget_getShowInNewWindow;
CDrillThroughTarget.prototype.getMethod=CDrillThroughTarget_getMethod;
CDrillThroughTarget.prototype.getPath=CDrillThroughTarget_getPath;
CDrillThroughTarget.prototype.getBookmark=CDrillThroughTarget_getBookmark;
CDrillThroughTarget.prototype.getParameters=CDrillThroughTarget_getParameters;
CDrillThroughTarget.prototype.getObjectPaths=CDrillThroughTarget_getObjectPaths;
CDrillThroughTarget.prototype.getPrompt=CDrillThroughTarget_getPrompt;
CDrillThroughTarget.prototype.isDynamicDrillThrough=CDrillThroughTarget_isDynamicDrillThrough;
CDrillThroughTarget.prototype.getParameterProperties=CDrillThroughTarget_getParameterProperties;
function sXmlEncode(_457){
var _458=""+_457;
if((_458=="0")||((_457!=null)&&(_457!=false))){
_458=_458.replace(/&/g,"&amp;");
_458=_458.replace(/</g,"&lt;");
_458=_458.replace(/>/g,"&gt;");
_458=_458.replace(/"/g,"&quot;");
_458=_458.replace(/'/g,"&apos;");
}else{
if(_457==null){
_458="";
}
}
return _458;
};
function createFormField(name,_45a){
var _45b=document.createElement("input");
_45b.setAttribute("type","hidden");
_45b.setAttribute("name",name);
_45b.setAttribute("value",_45a);
return (_45b);
};
function setBackURLToCloseWindow(_45c){
var _45d=_45c.childNodes;
if(_45d){
for(var _45e=0;_45e<_45d.length;++_45e){
var _45f=_45d[_45e];
var _460=_45f.getAttribute("name");
if(_460&&_460=="ui.backURL"){
_45c.removeChild(_45f);
}
}
}
_45c.appendChild(createFormField("ui.backURL","javascript:window.close();"));
};
function doMultipleDrills(_461,cvId){
if(parent!=this&&parent.doMultipleDrills){
if(getCVId()!=""&&getCVId()!=cvId){
cvId=getCVId();
}
return parent.doMultipleDrills(_461,cvId);
}else{
if(window.gViewerLogger){
window.gViewerLogger.log("Drill Targets",_461,"text");
}
var oCV=null;
try{
oCV=getCognosViewerObjectRef(cvId);
}
catch(exception){
}
var _464=buildDrillForm(oCV);
addDrillEnvironmentFormFields(_464,oCV);
if(typeof oCV!="undefined"&&oCV!=null){
var _465=oCV.getModelPath();
_464.appendChild(createFormField("modelPath",_465));
var _466=oCV.getSelectionController();
var _467="";
if(typeof getViewerSelectionContext!="undefined"&&typeof CSelectionContext!="undefined"){
_467=getViewerSelectionContext(_466,new CSelectionContext(_465));
}
_464.appendChild(createFormField("drillContext",_467));
_464.appendChild(createFormField("modelDrillEnabled",_466.getModelDrillThroughEnabled()));
if(typeof document.forms["formWarpRequest"+oCV.getId()]["ui.object"]!="undefined"&&document.forms["formWarpRequest"+oCV.getId()]["ui.object"].value!=""){
_464.appendChild(createFormField("drillSource",document.forms["formWarpRequest"+oCV.getId()]["ui.object"].value));
}else{
if(typeof oCV.envParams["ui.spec"]!="undefined"){
_464.appendChild(createFormField("sourceSpecification",oCV.envParams["ui.spec"]));
}
}
}
_464.setAttribute("launchGotoPage","true");
_464.appendChild(createFormField("drillTargets",_461));
_464.appendChild(createFormField("invokeGotoPage","true"));
_464.appendChild(createFormField("m","portal/drillthrough.xts"));
_464.appendChild(createFormField("b_action","xts.run"));
var _468="winNAT_"+(new Date()).getTime();
var _469="..";
if(oCV!=null){
_469=oCV.getWebContentRoot();
var _46a=oCV.getExecutionParameters();
if(_46a!=""){
_464.appendChild(createFormField("encExecutionParameters",_46a));
}
}
if(!oCV||!oCV.launchGotoPageForIWidgetMobile(_464)){
if(oCV&&typeof oCV.launchGotoPage==="function"){
oCV.launchGotoPage(_464);
}else{
var _46b=_469+"/rv/blankDrillWin.html";
_464.target=_468;
window.open(_46b,_468);
}
}
}
};
function buildDrillForm(oCV){
var _46d=document.getElementById("drillForm");
if(_46d){
document.body.removeChild(_46d);
}
_46d=document.createElement("form");
if(typeof oCV!="undefined"&&oCV!=null){
var _46e=document.getElementById("formWarpRequest"+oCV.getId());
_46d.setAttribute("target",_46e.getAttribute("target"));
_46d.setAttribute("action",_46e.getAttribute("action"));
}else{
_46d.setAttribute("action",location.pathname);
}
_46d.setAttribute("id","drillForm");
_46d.setAttribute("name","drillForm");
_46d.setAttribute("method","post");
_46d.style.display="none";
document.body.appendChild(_46d);
return _46d;
};
function addDrillEnvironmentFormFields(_46f,oCV){
if(window.g_dfEmail){
_46f.appendChild(createFormField("dfemail",window.g_dfEmail));
}
if(oCV!=null){
_46f.appendChild(createFormField("cv.id",oCV.getId()));
if(typeof oCV.envParams["ui.sh"]!="undefined"){
_46f.appendChild(createFormField("ui.sh",oCV.envParams["ui.sh"]));
}
if(oCV.getViewerWidget()==null){
if(typeof oCV.envParams["cv.header"]!="undefined"){
_46f.appendChild(createFormField("cv.header",oCV.envParams["cv.header"]));
}
if(typeof oCV.envParams["cv.toolbar"]!="undefined"){
_46f.appendChild(createFormField("cv.toolbar",oCV.envParams["cv.toolbar"]));
}else{
var _471=oCV.getAdvancedServerProperty("VIEWER_PASS_PORTLET_TOOLBAR_STATE_ON_DRILLTHROUGH");
if(oCV.m_viewerFragment&&_471!=null&&_471===true){
var _472=oCV.m_viewerFragment.canShowToolbar()?"true":"false";
_46f.appendChild(createFormField("cv.toolbar",_472));
}
}
}
if(typeof oCV.envParams["ui.backURL"]!="undefined"){
_46f.appendChild(createFormField("ui.backURL",oCV.envParams["ui.backURL"]));
}
if(typeof oCV.envParams["ui.postBack"]!="undefined"){
_46f.appendChild(createFormField("ui.postBack",oCV.envParams["ui.postBack"]));
}
if(typeof oCV.envParams["savedEnv"]!="undefined"){
_46f.appendChild(createFormField("savedEnv",oCV.envParams["savedEnv"]));
}
if(typeof oCV.envParams["ui.navlinks"]!="undefined"){
_46f.appendChild(createFormField("ui.navlinks",oCV.envParams["ui.navlinks"]));
}
if(typeof oCV.envParams["lang"]!="undefined"){
_46f.appendChild(createFormField("lang",oCV.envParams["lang"]));
}
if(typeof oCV.envParams["ui.errURL"]!="undefined"){
_46f.appendChild(createFormField("ui.errURL",oCV.envParams["ui.errURL"]));
}
var _473="";
if(oCV.envParams["ui.routingServerGroup"]){
_473=oCV.envParams["ui.routingServerGroup"];
}
_46f.appendChild(createHiddenFormField("ui.routingServerGroup",_473));
}else{
_46f.appendChild(createFormField("cv.header","false"));
_46f.appendChild(createFormField("cv.toolbar","false"));
}
};
function appendReportHistoryObjects(oCV,_475){
if(oCV!=null&&typeof oCV.rvMainWnd!="undefined"&&_475!=null){
oCV.rvMainWnd.addCurrentReportToReportHistory();
var _476=oCV.rvMainWnd.saveReportHistoryAsXML();
_475.appendChild(createFormField("cv.previousReports",_476));
}
};
function doSingleDrill(_477,args,_479,_47a,_47b,_47c,_47d,_47e,cvId,_480,_481){
var _482="";
if(typeof cvId=="string"){
_482=cvId;
}
var oCV=null;
try{
oCV=getCognosViewerObjectRef(cvId);
}
catch(exception){
}
if(!oCV&&parent!=this&&parent.doSingleDrill){
if(getCVId()!=""&&getCVId()!=cvId){
cvId=getCVId();
}
return parent.doSingleDrill(_477,args,_479,_47a,_47b,_47c,_47d,_47e,cvId,_480,_481);
}else{
if(typeof _479=="undefined"){
_479="default";
}else{
if(_479=="execute"){
_479="run";
}
}
if(_479=="edit"&&oCV!=null&&typeof oCV.m_viewerFragment){
_477="_blank";
}
var _484=buildDrillForm(oCV);
var _485="<authoredDrillRequest>";
_485+="<param name=\"action\">"+sXmlEncode(_479)+"</param>";
_485+="<param name=\"target\">"+sXmlEncode(args[0][1])+"</param>";
_485+="<param name=\"format\">"+sXmlEncode(_47a)+"</param>";
_485+="<param name=\"locale\">"+sXmlEncode(_47b)+"</param>";
_485+="<param name=\"prompt\">"+sXmlEncode(_480)+"</param>";
_485+="<param name=\"dynamicDrill\">"+sXmlEncode(_481)+"</param>";
if(typeof oCV!="undefined"&&oCV!=null){
_485+="<param name=\"sourceTracking\">"+oCV.getTracking()+"</param>";
if(typeof document.forms["formWarpRequest"+oCV.getId()]["ui.object"]!="undefined"){
_485+="<param name=\"source\">"+sXmlEncode(document.forms["formWarpRequest"+oCV.getId()]["ui.object"].value)+"</param>";
}
var _486=oCV.getModelPath();
_485+="<param name=\"metadataModel\">"+sXmlEncode(_486)+"</param>";
_485+="<param name=\"selectionContext\">"+sXmlEncode(getViewerSelectionContext(oCV.getSelectionController(),new CSelectionContext(_486)))+"</param>";
if(typeof document.forms["formWarpRequest"+oCV.getId()]["ui.object"]!="undefined"&&document.forms["formWarpRequest"+oCV.getId()]["ui.object"].value!=""){
_485+="<param name=\"source\">"+sXmlEncode(document.forms["formWarpRequest"+oCV.getId()]["ui.object"].value)+"</param>";
}else{
if(typeof oCV.envParams["ui.spec"]!="undefined"){
_485+="<param name=\"sourceSpecification\">"+sXmlEncode(oCV.envParams["ui.spec"])+"</param>";
}
}
}
if(_47c!=""){
_485+="<param name=\"bookmark\">"+_47c+"</param>";
}
if(_479!="view"){
if(typeof _47d!="undefined"){
_485+="<param name=\"sourceContext\">"+sXmlEncode(_47d)+"</param>";
}
if(typeof _47e!="undefined"){
_485+="<param name=\"objectPaths\">"+sXmlEncode(_47e)+"</param>";
}
}
var _487=0;
_485+="<drillParameters>";
var _488=[];
for(_487=1;_487<args.length;_487++){
var sSel=args[_487][1];
if(_47a=="HTML"&&(sSel.indexOf("<selectChoices")==0)){
var _48a=XMLHelper_GetFirstChildElement(XMLHelper_GetFirstChildElement(XMLBuilderLoadXMLFromString(args[_487][1])));
if(_48a){
var sMun=_48a.getAttribute("mun");
if(sMun!=null&&sMun!=""){
_48a.setAttribute("useValue",sMun);
sSel="<selectChoices>"+XMLBuilderSerializeNode(_48a)+"</selectChoices>";
}
}
}
var _48c=args[_487][0];
var _48d=false;
for(var i=0;i<_488.length;i++){
var _48f=_488[i];
if(_48f.name===_48c&&_48f.value===sSel){
_48d=true;
break;
}
}
if(!_48d){
_488.push({"name":_48c,"value":sSel});
_485+="<param name=\""+sXmlEncode(_48c)+"\">"+sXmlEncode(sSel)+"</param>";
}
}
_485+="</drillParameters>";
_485+=getExecutionParamNode(oCV);
_485+="</authoredDrillRequest>";
_484.appendChild(createFormField("authoredDrill.request",_485));
_484.appendChild(createFormField("ui.action","authoredDrillThrough2"));
_484.appendChild(createFormField("b_action","cognosViewer"));
addDrillEnvironmentFormFields(_484,oCV);
if(!oCV||!oCV.executeDrillThroughForIWidgetMobile(_484)){
if(oCV&&typeof oCV.sendDrillThroughRequest==="function"){
oCV.sendDrillThroughRequest(_484);
}else{
if(_477==""&&oCV!=null&&typeof oCV.m_viewerFragment!="undefined"){
oCV.m_viewerFragment.raiseAuthoredDrillEvent(_485);
}else{
if((oCV!=null&&oCV.getViewerWidget()!=null)||_477!=""||_47a=="XLS"||_47a=="CSV"||_47a=="XLWA"||_47a=="singleXLS"){
setBackURLToCloseWindow(_484);
var _490="winNAT_"+(new Date()).getTime();
var _491="..";
if(oCV!=null){
_491=oCV.getWebContentRoot();
}
var _492=_491+"/rv/blankDrillWin.html";
if(_482){
_492+="?cv.id="+_482;
}
if(window.gViewerLogger){
window.gViewerLogger.log("Drill Specification",_485,"xml");
}
_484.target=_490;
newWindow=window.open(_492,_490);
}else{
appendReportHistoryObjects(oCV,_484);
if(window.gViewerLogger){
window.gViewerLogger.log("Drill Specification",_485,"xml");
}
_484.target="_self";
_484.submit();
if(oCV!=null){
setTimeout(getCognosViewerObjectRefAsString(oCV.getId())+".getRequestIndicator().show()",10);
}
}
}
}
}
}
};
function getExecutionParamNode(oCV){
var _494="";
if(typeof oCV!="undefined"&&oCV!=null){
var _495=oCV.getExecutionParameters();
if(_495!=""){
_494+="<param name=\"executionParameters\">";
_494+=sXmlEncode(_495);
_494+="</param>";
}
}
return _494;
};
function doSingleDrillThrough(_496,_497,cvId){
var _499=_496[0][0];
if(typeof _499=="undefined"||_499==null){
return;
}
var _49a=cvId&&window[cvId+"drillTargets"]?window[cvId+"drillTargets"][_499]:drillTargets[_499];
if(typeof _49a=="undefined"){
return;
}
if(_497!=""&&_49a.getPath()==""){
document.location="#"+_497;
}else{
var args=[];
args[args.length]=["ui.object",_49a.getPath()];
for(var _49c=1;_49c<_496.length;++_49c){
args[args.length]=_496[_49c];
}
var _49d="";
if(_49a.getShowInNewWindow()=="true"){
_49d="_blank";
}
var _49e=_49a.getParameters();
var _49f=_49a.getObjectPaths();
var _4a0=cvId;
if(!cvId){
_4a0=getCVId();
}
doSingleDrill(_49d,args,_49a.getMethod(),_49a.getOutputFormat(),_49a.getOutputLocale(),_497,_49e,_49f,_4a0,_49a.getPrompt(),false);
}
};
function getCVId(){
var _4a1="";
try{
_4a1=this.frameElement.id.substring("CVIFrame".length);
}
catch(exception){
}
return _4a1;
};
function doMultipleDrillThrough(_4a2,cvId){
var _4a4="<rvDrillTargets>";
for(var _4a5=0;_4a5<_4a2.length;++_4a5){
var _4a6=_4a2[_4a5];
if(_4a6.length<3){
continue;
}
var _4a7=_4a6[0];
if(typeof _4a7=="undefined"||_4a7==null){
continue;
}
var _4a8=_4a6[1];
if(typeof _4a8=="undefined"||_4a8==null){
continue;
}
var _4a9=cvId&&window[cvId+"drillTargets"]?window[cvId+"drillTargets"][_4a7]:drillTargets[_4a7];
if(typeof _4a9=="undefined"||_4a9==null){
continue;
}
if(_4a8===null||_4a8===""){
_4a8=_4a9.getLabel();
}
_4a4+="<drillTarget ";
_4a4+="outputFormat=\"";
_4a4+=_4a9.getOutputFormat();
_4a4+="\" ";
_4a4+="outputLocale=\"";
_4a4+=_4a9.getOutputLocale();
_4a4+="\" ";
_4a4+="label=\"";
_4a4+=sXmlEncode(_4a8);
_4a4+="\" ";
_4a4+="path=\"";
_4a4+=sXmlEncode(_4a9.getPath());
_4a4+="\" ";
_4a4+="showInNewWindow=\"";
_4a4+=_4a9.getShowInNewWindow();
_4a4+="\" ";
_4a4+="method=\"";
_4a4+=_4a9.getMethod();
_4a4+="\" ";
_4a4+="prompt=\"";
_4a4+=_4a9.getPrompt();
_4a4+="\" ";
_4a4+="dynamicDrill=\"";
_4a4+=_4a9.isDynamicDrillThrough();
_4a4+="\">";
for(var _4aa=2;_4aa<_4a6.length;++_4aa){
_4a4+=_4a6[_4aa];
}
_4a4+=_4a9.getParameters();
_4a4+=_4a9.getObjectPaths();
_4a4+="</drillTarget>";
}
_4a4+="</rvDrillTargets>";
if(!cvId){
cvId=getCVId();
}
doMultipleDrills(_4a4,cvId);
};
function CScriptLoader(_4ab){
this.m_oFiles={};
this.m_aScripts=[];
this.m_aDocumentWriters=[];
this.m_ajaxWarnings=[];
this.m_bIgnoreAjaxWarnings=false;
this.m_bHandleStylesheetLimit=false;
this.m_iInterval=20;
this.m_reFindCssPath=new RegExp("<link[^>]*href=\"([^\"]*)\"","i");
this.m_reFindInlineStyle=/<style\b(\s|.)*?<\/style>/gi;
this.m_reHasCss=/<link .*?>/gi;
this.m_reIsCss=/\.css$/i;
this.m_reIsJavascript=/\.js$/i;
this.m_reIsPromptingLocaleJavascript=/prompting.res.[promptingStrings|promptLocale].*\.js$/i;
this.m_reScriptTagClose=/\s*<\/script>.*?$/i;
this.m_reScriptTagOpen=/^.*?<script[^>]*>\s*/i;
this.m_reStyleTagClose=/(-|>|\s)*<\/style>\s*$/gi;
this.m_reStyleTagOpen=/^\s*<style[^>]*>(\s|<|!|-)*/gi;
this.m_reEscapedCharacters=/\\[\\"']/g;
this.m_reStringLiterals=/("|')[\s\S]*?\1/g;
this.m_sWebContentRoot=_4ab;
this.m_bHasCompletedExecution=false;
this.m_aScriptLoadQueue=[];
this.m_bBlockScriptLoading=false;
this.m_bUseScriptBlocking=false;
this.m_bBlockPromptingLocaleScripts=false;
this.m_aBlockedPromptingLocaleFileQueue=[];
};
CScriptLoader.prototype.hasCompletedExecution=function(){
return this.m_bHasCompletedExecution;
};
CScriptLoader.prototype.setHandlerStylesheetLimit=function(_4ac){
this.m_bHandleStylesheetLimit=_4ac;
};
CScriptLoader.prototype.executeScripts=function(_4ad,_4ae){
if(this.isReadyToExecute()){
for(var _4af=0;_4af<this.m_aScripts.length;_4af++){
if(this.m_aScripts[_4af]){
var _4b0=document.createElement("script");
_4b0.setAttribute("language","javascript");
_4b0.setAttribute("type","text/javascript");
this.addNamespaceAttribute(_4b0,_4ae);
_4b0.text=this.m_aScripts[_4af];
document.getElementsByTagName("head").item(0).appendChild(_4b0);
}
}
this.m_aScripts=[];
for(var idx=0;idx<this.m_aDocumentWriters.length;++idx){
var _4b2=this.m_aDocumentWriters[idx];
_4b2.execute();
}
this.m_aDocumentWriters=[];
if(!this.m_aScripts.length&&!this.m_aDocumentWriters.length){
if(typeof _4ad=="function"){
_4ad();
}
this.m_bHasCompletedExecution=true;
}else{
setTimeout(function(){
window.gScriptLoader.executeScripts(_4ad,_4ae);
},this.m_iInterval);
}
}else{
setTimeout(function(){
window.gScriptLoader.executeScripts(_4ad,_4ae);
},this.m_iInterval);
}
};
CScriptLoader.prototype.isReadyToExecute=function(){
for(var _4b3 in this.m_oFiles){
if(this.m_oFiles[_4b3]!="complete"){
return false;
}
}
if(this.m_aScriptLoadQueue.length>0){
return false;
}
return true;
};
CScriptLoader.prototype.loadCSS=function(_4b4,_4b5,_4b6,_4b7){
var aM=_4b4.match(this.m_reHasCss);
if(aM){
for(var i=0;i<aM.length;i++){
if(aM[i].match(this.m_reFindCssPath)){
var _4ba=RegExp.$1;
if(_4ba.indexOf("GlobalReportStyles")!=-1){
this.validateGlobalReportStyles(_4ba);
if(_4b6){
if(_4ba.indexOf("GlobalReportStyles.css")!=-1){
_4ba=_4ba.replace("GlobalReportStyles.css","GlobalReportStyles_10.css");
}
var _4bb=this.getGlobalReportStylesClassPrefix(_4ba);
_4ba=_4ba.replace(".css","_NS.css");
if(_4b5){
_4b5.className="buxReport "+_4bb;
}
}
}
this.loadObject(_4ba,_4b7);
}
_4b4=_4b4.replace(aM[i],"");
}
}
return _4b4;
};
CScriptLoader.prototype.getGlobalReportStylesClassPrefix=function(_4bc){
var _4bd=null;
if(_4bc.indexOf("GlobalReportStyles_10.css")!=-1){
_4bd="v10";
}else{
if(_4bc.indexOf("GlobalReportStyles_1.css")!=-1){
_4bd="v1";
}else{
if(_4bc.indexOf("GlobalReportStyles_none.css")!=-1){
_4bd="vnone";
}else{
if(_4bc.indexOf("GlobalReportStyles.css")!=-1){
_4bd="v8";
}
}
}
}
return _4bd;
};
CScriptLoader.prototype.validateGlobalReportStyles=function(_4be){
var _4bf=document.getElementsByTagName("link");
for(var i=0;i<_4bf.length;++i){
var _4c1=_4bf[i];
if(_4c1.getAttribute("href").indexOf("GlobalReportStyles")!=-1){
if(_4c1.getAttribute("href").toLowerCase()!=_4be.toLowerCase()){
var _4c2=_4be.split("/");
var _4c3=_4c1.getAttribute("href").split("/");
if(_4c2[_4c2.length-1]!=_4c3[_4c3.length-1]){
this.m_ajaxWarnings.push("Ajax response contains different versions of the GlobalReportStyles.css.");
}
}
break;
}
}
};
CScriptLoader.prototype.loadFile=function(_4c4,_4c5,_4c6){
var sURL="";
if(_4c4){
sURL=_4c4;
}
var _4c8=null;
if(typeof _4c5=="string"){
_4c8=_4c5;
}
var _4c9="POST";
if(_4c6=="GET"){
_4c9="GET";
}
var _4ca=null;
if(typeof ActiveXObject!="undefined"){
_4ca=new ActiveXObject("Msxml2.XMLHTTP");
}else{
_4ca=new XMLHttpRequest();
}
_4ca.open(_4c9,sURL,false);
_4ca.send(_4c8);
return _4ca.responseText;
};
function CScriptLoader_onReadyStateChange(){
if(typeof this.readyState=="undefined"){
this.readyState="complete";
}
if(this.readyState=="loaded"||this.readyState=="complete"){
var path=this.sFilePath;
if(!path&&this.getAttribute){
path=this.getAttribute("href");
}
window.gScriptLoader.setFileState(path,"complete");
window.gScriptLoader.m_bBlockScriptLoading=false;
if(this.sFilePath&&window.gScriptLoader.m_bBlockPromptingLocaleScripts&&this.sFilePath.match(window.gScriptLoader.m_reIsPromptingLocaleJavascript)){
window.gScriptLoader.m_bBlockPromptingLocaleScripts=false;
if(window.gScriptLoader.m_aBlockedPromptingLocaleFileQueue.length>0){
var _4cc=window.gScriptLoader.m_aBlockedPromptingLocaleFileQueue.shift();
window.gScriptLoader.loadObject(_4cc.sName,_4cc.sNamespaceId);
}
}
if(window.gScriptLoader.m_aScriptLoadQueue.length>0){
window.gScriptLoader.loadObject();
}
}
};
CScriptLoader.prototype.moveLinks=function(node){
if(!node){
return;
}
var _4ce=node.getAttribute("href");
if(!_4ce||this.m_oFiles[_4ce]){
return;
}
this.m_oFiles[_4ce]="complete";
document.getElementsByTagName("head").item(0).appendChild(node);
};
CScriptLoader.prototype.loadObject=function(_4cf,_4d0){
var _4d1=null;
if(typeof _4cf==="undefined"){
if(this.m_aScriptLoadQueue.length>0){
var _4d2=this.m_aScriptLoadQueue.shift();
_4cf=_4d2.name;
_4d0=_4d2.namespaceId;
}else{
return;
}
}
if(this.m_oFiles[_4cf]){
return;
}
if(this.m_bBlockScriptLoading){
this.m_aScriptLoadQueue.push({"name":_4cf,"namespaceId":_4d0});
}else{
if(_4cf.match(this.m_reIsCss)){
_4d1=document.createElement("link");
_4d1.setAttribute("rel","stylesheet");
_4d1.setAttribute("type","text/css");
_4d1.setAttribute("href",_4cf);
if(window.isIE&&window.isIE()){
_4d1.onreadystatechange=CScriptLoader_onReadyStateChange;
_4d1.onload=CScriptLoader_onReadyStateChange;
_4d1.onerror=CScriptLoader_onReadyStateChange;
this.m_oFiles[_4cf]="new";
}else{
this.m_oFiles[_4cf]="complete";
}
}else{
if(_4cf.match(this.m_reIsJavascript)){
if(_4cf.match(this.m_reIsPromptingLocaleJavascript)){
if(this.m_bBlockPromptingLocaleScripts){
this.m_aBlockedPromptingLocaleFileQueue.push({"sName":_4cf,"sNamespaceId":_4d0});
return;
}
this.m_bBlockPromptingLocaleScripts=true;
}
this.m_bBlockScriptLoading=this.m_bUseScriptBlocking;
_4d1=document.createElement("script");
_4d1.setAttribute("language","javascript");
_4d1.setAttribute("type","text/javascript");
_4d1.setAttribute("src",_4cf);
_4d1.sFilePath=_4cf;
_4d1.onreadystatechange=CScriptLoader_onReadyStateChange;
_4d1.onload=CScriptLoader_onReadyStateChange;
_4d1.onerror=CScriptLoader_onReadyStateChange;
this.addNamespaceAttribute(_4d1,_4d0);
this.m_oFiles[_4cf]="new";
}
}
if(_4d1){
document.getElementsByTagName("head").item(0).appendChild(_4d1);
}
}
};
CScriptLoader.prototype.loadScriptsFromDOM=function(_4d3,_4d4,_4d5){
if(!_4d3){
return;
}
var _4d6=_4d3.parentNode.getElementsByTagName("script");
while(_4d6.length>0){
var _4d7=_4d6[0];
if(_4d7.getAttribute("src")!=null&&_4d7.getAttribute("src").length>0){
this.loadObject(_4d7.getAttribute("src"),_4d4);
}else{
var _4d8=_4d7.innerHTML;
var _4d9=false;
if(_4d8.indexOf("document.write")!=-1){
var _4da=_4d8.replace(this.m_reEscapedCharacters,"").replace(this.m_reStringLiterals,"");
_4d9=(_4da.indexOf("document.write")!=-1);
}
if(_4d9){
if(_4d5){
var sId="CVScriptFromDOMPlaceHolder"+_4d6.length+_4d4;
var _4dc=_4d7.ownerDocument.createElement("span");
_4dc.setAttribute("id",sId);
_4d7.parentNode.insertBefore(_4dc,_4d7);
this.m_aDocumentWriters.push(new CDocumentWriter(sId,_4d8));
}
}else{
if(_4d8.length>0){
this.m_aScripts.push(_4d8);
}
}
}
_4d7.parentNode.removeChild(_4d7);
}
};
CScriptLoader.prototype.loadStyles=function(_4dd,_4de){
if(!_4dd||!_4dd.parentNode){
return;
}
var _4df=_4dd.parentNode.getElementsByTagName("style");
while(_4df.length>0){
var _4e0=_4df[0];
if(_4de){
this.addNamespaceAttribute(_4e0,_4de);
}
if(window.isIE&&window.isIE()&&window.getNavVer()<10){
if((document.getElementsByTagName("style").length+document.getElementsByTagName("link").length)>=30){
if(this.m_bHandleStylesheetLimit){
if(typeof window.gaRV_INSTANCES!="undefined"){
for(var i=0;i<window.gaRV_INSTANCES.length;i++){
window.gaRV_INSTANCES[i].cleanupStyles();
}
}
}
if((document.getElementsByTagName("style").length+document.getElementsByTagName("link").length)>=30){
if(typeof console!="undefined"&&console&&console.log){
console.log("Stylesheet limit reached.");
}
this.m_ajaxWarnings.push("Stylesheet limit reached.");
return;
}
}
}
document.getElementsByTagName("head").item(0).appendChild(_4e0);
}
};
CScriptLoader.prototype.loadAll=function(_4e2,_4e3,_4e4,_4e5){
this.m_bScriptLoaderCalled=true;
this.m_bHasCompletedExecution=false;
this.loadScriptsFromDOM(_4e2,_4e4,_4e5);
if(this.containsAjaxWarnings()){
return false;
}
this.loadStyles(_4e2,_4e4);
if(this.containsAjaxWarnings()){
return false;
}
this.executeScripts(_4e3,_4e4);
return true;
};
CScriptLoader.prototype.setFileState=function(_4e6,_4e7){
this.m_oFiles[_4e6]=_4e7;
};
CScriptLoader.prototype.containsAjaxWarnings=function(){
if(this.m_bIgnoreAjaxWarnings){
return false;
}else{
return (this.m_ajaxWarnings.length>0);
}
};
CScriptLoader.prototype.addNamespaceAttribute=function(_4e8,_4e9){
if(typeof _4e9==="string"){
_4e8.setAttribute("namespaceId",_4e9);
}
};
if(typeof window.gScriptLoader=="undefined"){
window.gScriptLoader=new CScriptLoader();
}
var InfoBarHelper={};
InfoBarHelper.getContainerId=function(oCV,_4eb){
var _4ec=oCV.getLayoutElement(_4eb);
var lid=_4ec.getAttribute("lid");
var _4ee=lid===null?"":lid;
_4ee=_4ee.replace(oCV.getViewerWidget().getViewerId(),"").replace("RAP_NDH_","");
return _4ee;
};
InfoBarHelper.infoBarRemoveFilter=function(_4ef,_4f0,_4f1,_4f2){
var oCV=eval("window.oCV"+_4ef);
if(typeof oCV!="undefined"){
var _4f4=this.getContainerId(oCV,_4f0);
oCV.executeAction("Filter",{type:"remove",id:_4f4,item:_4f1,details:_4f2});
}
};
InfoBarHelper.infoBarRemoveSlider=function(_4f5,_4f6){
var oCV=eval("window.oCV"+_4f5);
var _4f8={};
_4f8[_4f6]={blockedEvents:["*"]};
oCV.fireWidgetEvent("com.ibm.bux.widget.updateEventFilter",_4f8);
if(typeof oCV!="undefined"){
oCV.executeAction("UpdateDataFilter",{"filterPayload":"{ \"clientId\" :\""+_4f6+"\"}"});
}
};
InfoBarHelper.infoBarRemoveSort=function(_4f9,_4fa,_4fb,_4fc){
var oCV=eval("window.oCV"+_4f9);
if(typeof oCV!="undefined"){
var _4fe=this.getContainerId(oCV,_4fa);
if(_4fc=="true"){
oCV.executeAction("Sort",{order:"none",id:_4fe,item:_4fb,type:"label"});
}else{
oCV.executeAction("Sort",{order:"none",id:_4fe,item:_4fb});
}
}
};
dojo.provide("InfoBarBase");
dojo.declare("InfoBarBase",null,{constructor:function(_4ff){
this.m_cognosViewer=_4ff;
this.m_parameterValues=new CParameterValues();
var _500=XMLBuilderLoadXMLFromString(this.m_cognosViewer.getExecutionParameters());
if(_500.childNodes.length==1){
this.m_parameterValues.loadWithOptions(_500.childNodes[0],false);
}
this.m_parameterStringOperators=new CParameterValueStringOperators(RV_RES.IDS_JS_FILTER_BETWEEN,RV_RES.IDS_JS_FILTER_NOT_BETWEEN,RV_RES.IDS_JS_FILTER_LESS_THAN,RV_RES.IDS_JS_FILTER_GREATER_THAN,RV_RES.IDS_JS_INFOBAR_AND_TEXT,RV_RES.IDS_JS_FILTER_EXCLUDE);
this.c_SliderCheckboxParameterPrefix="BusinessInsight.";
this.m_containerInfo=null;
this.m_editableFilters=null;
this.m_editableSorts=null;
this.m_editableSliders=null;
this.m_id=null;
this.m_layoutIndex=null;
this.m_timingDetails=null;
},setContainerInfo:function(_501){
this.m_containerInfo=_501;
},setTimingDetails:function(_502){
this.m_timingDetails=_502;
},setEditableFilters:function(_503){
this.m_editableFilters=_503;
},setId:function(_504){
this.m_id=_504;
},getId:function(){
return this.m_id;
},hasPrompts:function(){
var _505=this.m_parameterValues.length();
for(var _506=0;_506<_505;++_506){
var _507=this.m_parameterValues.getAt(_506);
if(_507!==null&&_507.length()>0&&_507.name().indexOf(this.c_SliderCheckboxParameterPrefix)!==0){
return true;
}
}
return false;
},addPromptDetails:function(_508){
var _509="";
var _50a=(_508!==true);
if(this.hasPrompts()){
var _50b=this.m_id+"instructions "+this.m_id+"_promptString "+this.m_id+"_lockedString ";
for(var _50c=0,_50d=this.m_parameterValues.length();_50c<_50d;++_50c){
var _50e=_50b+this.m_id+_50c+"_promptDetail";
var _50f=this.m_parameterValues.getAt(_50c);
var _510=_50f.length();
if(_50f!==null&&_510>0&&_50f.name().indexOf(this.c_SliderCheckboxParameterPrefix)!==0){
_509+="<div class=\"infoBarDetailRow\" aria-labelledby=\""+_50e+"\" role=\"listitem\""+(!_50a?">":" tabindex=\"-1\">");
_509+="<table role=\"presentation\"><tr>";
_509+=this.addInfoBarIcon("infobar_filter.gif",true);
_509+="<td class=\"infoBarDetailsText\" role=\"presentation\" id=\""+this.m_id+_50c+"_promptDetail\">";
_509+="<span class=\"bibi\">";
_509+=html_encode(_50f.name());
_509+="</span>";
_509+=" : ";
_509+=_50f.toString(this.m_parameterStringOperators);
_509+="</td>";
_509+=(_50a?this.addInfoBarIcon("infobar_locked.gif",false):"");
_509+="</tr></table></div>";
}
}
}
return _509;
},getPromptDetailsInJSON:function(){
var _511=[];
if(this.hasPrompts()){
for(var _512=0,_513=this.m_parameterValues.length();_512<_513;++_512){
var _514=this.m_parameterValues.getAt(_512);
var _515=_514.length();
if(_514!==null&&_515>0&&_514.name().indexOf(this.c_SliderCheckboxParameterPrefix)!==0){
_511.push({"type":"prompt","label":_514.name(),"description":_514.toString(this.m_parameterStringOperators)});
}
}
}
return _511;
},addSliderDetails:function(_516){
var _517="";
var _518=(_516!==true);
if(this.m_containerInfo!==null&&this.m_editableSliders){
var _519=this.m_id+"instructions "+this.m_id+"_sliderString ";
var _51a=this.m_editableSliders.length;
for(var _51b=0;_51b<_51a;++_51b){
var _51c=_519+this.m_id+_51b+"_sliderDetail";
var _51d=this.m_editableSliders[_51b];
if(_51d&&_51d.name){
_517+="<div class=\"infoBarDetailRow\" type=\"slider\" aria-labelledby=\""+_51c+"\" role=\"listitem\""+(!_518?">":" tabindex=\"-1\">");
_517+="<table role=\"presentation\"><tr>";
if(typeof _51d.controlType!="undefined"&&_51d.controlType=="checkbox"){
_517+=this.addInfoBarIcon("infobar_select.gif",true);
}else{
_517+=this.addInfoBarIcon("infobar_slider.gif",true);
}
_517+="<td class=\"infoBarDetailsText\" role=\"presentation\" id=\""+this.m_id+_51b+"_sliderDetail\">";
_517+="<span class=\"bibi\">";
_517+=(_51d.label?_51d.label:_51d.name);
_517+=(_51d.attributeName)?(" - "+_51d.attributeName):"";
_517+="</span>";
_517+=" : ";
if(typeof _51d.values!="undefined"){
_517+=this.processFilterOperatorItems(_51d.values);
}else{
if(_51d.min==_51d.max){
_517+=_51d.min;
}else{
_517+=this.processFilterOperatorRange(RV_RES.IDS_JS_INFOBAR_BETWEEN_TEXT,_51d.min,_51d.max);
}
}
_517+="</td>";
_517+=(_518?this.addRemoveSliderButton(_51d.clientId):"");
_517+="</tr></table></div>";
}
}
}
return _517;
},getSliderDetailsInJSON:function(){
var _51e=[];
if(this.m_containerInfo!==null&&this.m_editableSliders){
var _51f=this.m_id+"instructions "+this.m_id+"_sliderString ";
var _520=this.m_editableSliders.length;
for(var _521=0;_521<_520;++_521){
var _522=this.m_editableSliders[_521];
if(_522&&_522.name){
var _523=(_522.label?_522.label:_522.name);
if(_522.attributeName){
_523+=(" "+_522.attributeName);
}
var _524="";
if(typeof _522.values!="undefined"){
_524+=this.processFilterOperatorItems(_522.values);
}else{
if(_522.min==_522.max){
_524+=_522.min;
}else{
_524+=this.processFilterOperatorRange(RV_RES.IDS_JS_INFOBAR_BETWEEN_TEXT,_522.min,_522.max);
}
}
_51e.push({"type":"slider","label":_523,"description":_524});
}
}
}
return _51e;
},hasLockedFilters:function(){
var _525=false;
if(this.m_containerInfo!==null&&typeof this.m_containerInfo.lockedFilters!=="undefined"){
var _526=this.m_containerInfo.lockedFilters.length;
for(var _527=0;_527<_526;++_527){
var _528=this.m_containerInfo.lockedFilters[_527];
if(typeof _528.staticText!="undefined"&&_528.staticText.charAt(0)!==" "){
_525=true;
}
}
}
return _525;
},addLockedFilterDetails:function(_529){
var _52a="";
var _52b=(_529!==true);
if(this.m_containerInfo!==null&&typeof this.m_containerInfo.lockedFilters!=="undefined"){
var _52c=this.m_id+"instructions "+this.m_id+"_filterString "+this.m_id+"_lockedString ";
var _52d=this.m_containerInfo.lockedFilters.length;
for(var _52e=0;_52e<_52d;++_52e){
var _52f=_52c+this.m_id+_52e+"_lockedFilterDetail";
var _530=this.m_containerInfo.lockedFilters[_52e];
if(typeof _530.staticText!="undefined"&&_530.staticText.charAt(0)!==" "){
_52a+="<div class=\"infoBarDetailRow\" aria-labelledby=\""+_52f+"\" role=\"listitem\""+(!_52b?">":" tabindex=\"-1\">");
_52a+="<table role=\"presentation\"><tr>";
_52a+=this.addInfoBarIcon("infobar_filter.gif",true);
_52a+="</td>";
_52a+="<td class=\"infoBarDetailsText\" role=\"presentation\" id=\""+this.m_id+_52e+"_lockedFilterDetail\">";
_52a+="<span class=\"bibi\">";
_52a+=html_encode(_530.staticText);
_52a+="</span>";
_52a+="</td>";
_52a+=(_52b?this.addInfoBarIcon("infobar_locked.gif",false):"");
_52a+="</tr></table></div>";
}
}
}
return _52a;
},addFilteredItemsDetails:function(_531){
var _532="";
var _533=(_531!==true);
if(this.m_editableFilters){
for(var _534=0,_535=this.m_editableFilters.length;_534<_535;++_534){
var _536=this.m_editableFilters[_534];
var _537=this.m_id+"instructions "+this.m_id+"_filterString "+this.m_id+_534+"_filterDetail";
var _538=(typeof _536.itemLabel=="string")?_536.itemLabel:_536.item;
_532+="<div class=\"infoBarDetailRow\" type=\"filter\" aria-labelledby=\""+_537+"\" role=\"listitem\""+(!_533?">":" tabindex=\"-1\">");
_532+="<table role=\"presentation\"><tr>";
_532+=this.addInfoBarIcon("infobar_filter.gif",true);
_532+="<td class=\"bibi infoBarDetailsText\" role=\"presentation\" id=\""+this.m_id+_534+"_filterDetail\">";
_532+=this.createHiddenSpan(this.m_id+_534+"_filterPosition",getCurrentPosistionString(this.m_cognosViewer,_534+1,_535));
_532+=html_encode(enforceTextDir(_538));
_532+=this.processFilterOperator(_536);
_532+="</td>";
_532+=(_533?this.addRemoveFilterButton(_536.item,this.processFilterDetails(_536)):"");
_532+="</tr></table></div>";
}
}
return _532;
},getFilteredItemsDetailsInJSON:function(){
var _539=[];
if(this.m_editableFilters){
for(var _53a=0,_53b=this.m_editableFilters.length;_53a<_53b;++_53a){
var _53c=this.m_editableFilters[_53a];
var _53d=(typeof _53c.itemLabel=="string")?_53c.itemLabel:_53c.item;
_539.push({"type":"filter","label":enforceTextDir(_53d)+this.processFilterOperator(_53c),"description":""});
}
}
return _539;
},addSortDetails:function(_53e){
var _53f="";
var _540=(_53e!==true);
if(this.m_editableSorts){
for(var _541=0,_542=this.m_editableSorts.length;_541<_542;++_541){
var _543=this.m_editableSorts[_541];
var _544=this.m_id+"instructions "+this.m_id+"_sortString "+this.m_id+_541+"_sortDetail";
_53f+="<div class=\"infoBarDetailRow\" type=\"sort\" aria-labelledby=\""+_544+"\" role=\"listitem\""+(!_540?">":" tabindex=\"-1\">");
_53f+="<table role=\"presentation\"><tr>";
_53f+=this.addInfoBarIcon("infobar_sort.gif",true);
var _545;
if(typeof _543.labels=="string"||typeof _543.valuesOf=="string"){
var _546=(typeof _543.labels=="string")?_543.labels:_543.valuesOf;
_545=(typeof _543.itemLabel=="string")?_543.itemLabel:_546;
_53f+="<td class=\"bibi infoBarDetailsText\" role=\"presentation\" id=\""+this.m_id+_541+"_sortDetail\">";
_53f+=this.createHiddenSpan(this.m_id+_541+"_sortPosition",getCurrentPosistionString(this.m_cognosViewer,_541+1,_542));
_53f+=html_encode(_545);
_53f+=" : ";
if(_543.byItems instanceof Array){
for(var _547=0;_547<_543.byItems.length;++_547){
_53f+=(_547>0)?" - ":"";
_53f+=_543.byItems[_547].item;
_53f+=", ";
_53f+=this.m_sortStrings[_543.byItems[_547].order];
}
}else{
if(typeof _543.valuesOf=="string"){
_53f+=this.m_sortStrings["byValue"];
}else{
_53f+=this.m_sortStrings["byLabel"];
}
_53f+=", ";
_53f+=this.m_sortStrings[_543.order];
}
_53f+="</td>";
_53f+=(_540?this.addRemoveSortButton(_546,"true"):"");
}else{
if(_543.valuesOf instanceof Array){
if(_543.valuesOf.length>0&&typeof _543.valuesOf[0].item=="string"){
_53f+="<td class=\"bibi infoBarDetailsText\" role=\"presentation\" id=\""+this.m_id+_541+"_sortDetail\">";
_53f+=this.createHiddenSpan(this.m_id+_541+"_sortPosition",getCurrentPosistionString(this.m_cognosViewer,_541+1,_542));
_545="";
if(typeof _543.itemLabel=="string"){
_545=_543.itemLabel;
}else{
for(var _548=0;_548<_543.valuesOf.length;++_548){
_545+=" - ";
_545+=_543.valuesOf[_548].item;
}
_545=_545.substring(3);
}
_53f+=_545;
_53f+=" : ";
_53f+=this.m_sortStrings["byValue"];
_53f+=", ";
_53f+=this.m_sortStrings[_543.order];
_53f+="</td>";
_53f+=(_540?this.addRemoveSortButton(_543.valuesOf[0].item,"false"):"");
}
}
}
_53f+="</tr></table></div>";
}
}
return _53f;
},addInfoBarIcon:function(_549,_54a){
return "<td class=\"infoBar"+(_54a?"Left":"Right")+"Icon\">"+"<img alt=\"\" src=\""+this.m_cognosViewer.getWebContentRoot()+"/rv/images/"+_549+"\"/>"+"</td>";
},createHiddenSpan:function(id,text){
return "<span style=\"display:none\" id=\""+id+"\"> "+text+" </span>";
},addRemoveFilterButton:function(item,_54e){
var _54f="";
var _550=this.m_cognosViewer.getViewerWidget();
if(!this.m_cognosViewer.isLimitedInteractiveMode()&&!_550.isConsumeUser()){
var _551=RV_RES.IDS_JS_DELETE;
var _552=this.m_id+"_delete";
_54f="<td class=\"infoBarRightIcon\" filterItem=\""+item+"\""+(_54e?" details=\""+_54e+"\"":"")+">"+"<button class=\"dijitStretch infoBarDeleteButton BUXNoPrint\" onclick=\"InfoBarHelper.infoBarRemoveFilter('"+this.m_cognosViewer.getId()+"',"+this.m_layoutIndex+",'"+item+"'"+(_54e?",'"+_54e+"'":"")+");\" aria-labelledby=\""+_552+"\" type=\"button\" role=\"button\" tabindex=\"0\" value=\"\" title=\""+_551+"\">"+"<span class=\"dijitInline infoBarIconDelete\" title=\""+_551+"\"></span>"+"<span class=\"dijitInline dijitDisplayNone infoBarDeleteButtonText\">x</span>"+"</button>"+"</td>";
}
return _54f;
},addRemoveSliderButton:function(_553){
var _554="";
var _555=this.m_cognosViewer.getViewerWidget();
if(!this.m_cognosViewer.isLimitedInteractiveMode()&&!_555.isConsumeUser()){
var _556=RV_RES.IDS_JS_DELETE;
var _557=this.m_id+"_delete";
_554="<td class=\"infoBarRightIcon\" slider=\""+_553+"\">"+"<button class=\"dijitStretch infoBarDeleteButton BUXNoPrint\" onclick=\"InfoBarHelper.infoBarRemoveSlider('"+this.m_cognosViewer.getId()+"','"+_553+"');\" aria-labelledby=\""+_557+"\" type=\"button\" role=\"button\" tabindex=\"0\" value=\"\" title=\""+_556+"\">"+"<span class=\"dijitInline infoBarIconDelete\" title=\""+_556+"\"></span>"+"<span class=\"dijitInline dijitDisplayNone infoBarDeleteButtonText\">x</span>"+"</button>"+"</td>";
}
return _554;
},addRemoveSortButton:function(item,_559){
var _55a="";
var _55b=this.m_cognosViewer.getViewerWidget();
if(!this.m_cognosViewer.isLimitedInteractiveMode()&&!this.m_cognosViewer.isBlacklisted("Sort")){
var _55c=RV_RES.IDS_JS_DELETE;
var _55d=this.m_id+"_delete";
_55a="<td class=\"infoBarRightIcon\" sortItem=\""+item+"\" byLabel=\""+_559+"\">"+"<button class=\"dijitStretch infoBarDeleteButton BUXNoPrint\" onclick=\"InfoBarHelper.infoBarRemoveSort('"+this.m_cognosViewer.getId()+"',"+this.m_layoutIndex+",'"+item+"','"+_559+"');\" aria-labelledby=\""+_55d+"\" type=\"button\" role=\"button\" tabindex=\"0\" value=\"\" title=\""+_55c+"\">"+"<span class=\"dijitInline infoBarIconDelete\" title=\""+_55c+"\"></span>"+"<span class=\"dijitInline dijitDisplayNone infoBarDeleteButtonText\">x</span>"+"</button>"+"</td>";
}
return _55a;
},processFilterOperator:function(_55e){
var _55f="";
if(typeof _55e["in"]!="undefined"){
_55f+=" "+CViewerCommon.getMessage(RV_RES.IDS_JS_INFOBAR_INCLUDE_TEXT,this.processFilterOperatorItems(_55e["in"]));
}else{
if(typeof _55e["notIn"]!="undefined"){
_55f+=" "+CViewerCommon.getMessage(RV_RES.IDS_JS_INFOBAR_EXCLUDE_TEXT,this.processFilterOperatorItems(_55e["notIn"]));
}else{
if(typeof _55e["range"]!="undefined"||typeof _55e["notRange"]!="undefined"){
var _560=typeof _55e["range"]!="undefined"?RV_RES.IDS_JS_INFOBAR_BETWEEN_TEXT:RV_RES.IDS_JS_INFOBAR_NOT_BETWEEN_TEXT;
var _561=typeof _55e["range"]!="undefined"?_55e["range"]:_55e["notRange"];
for(var _562=0;_562<_561.length;++_562){
var _563=_561[_562];
_55f+=" "+CViewerCommon.getMessage(_560,[_563.from,_563.to]);
}
}else{
if(typeof _55e["lessThan"]!="undefined"){
_55f+=" "+RV_RES.IDS_JS_FILTER_LESS_THAN+" "+_55e["lessThan"];
}else{
if(typeof _55e["lessThanEqual"]!="undefined"){
_55f+=" "+RV_RES.IDS_JS_FILTER_LESS_THAN_EQUAL+" "+_55e["lessThanEqual"];
}else{
if(typeof _55e["greaterThan"]!="undefined"){
_55f+=" "+RV_RES.IDS_JS_FILTER_GREATER_THAN+" "+_55e["greaterThan"];
}else{
if(typeof _55e["greaterThanEqual"]!="undefined"){
_55f+=" "+RV_RES.IDS_JS_FILTER_GREATER_THAN_EQUAL+" "+_55e["greaterThanEqual"];
}else{
if(typeof _55e["not"]!="undefined"&&_55e["not"]=="true"){
_55f+=" "+RV_RES.IDS_JS_FILTER_IS_NOT;
}
if(typeof _55e["endsWith"]!="undefined"){
_55f+=" "+RV_RES.IDS_JS_FILTER_ENDS_WITH+" "+_55e["endsWith"];
}else{
if(typeof _55e["beginsWith"]!="undefined"){
_55f+=" "+RV_RES.IDS_JS_FILTER_BEGINS_WITH+" "+_55e["beginsWith"];
}else{
if(typeof _55e["contains"]!="undefined"){
_55f+=" "+RV_RES.IDS_JS_FILTER_CONTAINS+" "+_55e["contains"];
}else{
if(typeof _55e["isMatchesSQLPatternFilter"]!="undefined"){
_55f+=" "+RV_RES.IDS_JS_FILTER_IS_MATCHES_SQLPATTERNFILTER+" "+_55e["isMatchesSQLPatternFilter"];
}
}
}
}
}
}
}
}
}
}
}
return _55f;
},processFilterDetails:function(_564){
return html_encode("["+dojo.toJson(_564)+"]");
},processFilterOperatorItems:function(_565){
var _566="";
for(var _567=0;_567<_565.length;++_567){
if(_567!==0){
_566+=(RV_RES.IDS_JS_LIST_SEPARATOR+" ");
}
_566+=enforceTextDir(_565[_567]);
}
return _566;
},processFilterOperatorRange:function(_568,_569,_56a){
if(typeof _569=="undefined"){
_569=" ";
}
if(typeof _56a=="undefined"){
_56a=" ";
}
return CViewerCommon.getMessage(_568,[_569,_56a]);
}});
dojo.declare("InfoBar",InfoBarBase,{constructor:function(_56b,_56c,_56d,_56e,_56f){
this.m_layoutElement=_56c;
this.m_containerInfo=_56d;
this.m_bRendered=false;
this.initializeEditableSorts(_56e);
this.initializeEditableFilters(_56e);
this.initializeEditableSliders(_56e);
this.m_id=_56f+_56b.getId();
this.m_layoutIndex=_56f;
this.m_sortStrings={byLabel:RV_RES.IDS_JS_SORTED_BY_LABEL,byValue:RV_RES.IDS_JS_SORTED_BY_VALUE,descending:RV_RES.IDS_JS_SORT_DESCENDING_ORDER,ascending:RV_RES.IDS_JS_SORT_ASCENDING_ORDER};
this.connections=[];
},getLayoutElement:function(){
var _570=this.m_layoutElement;
var _571=_570.getAttribute("lid");
if(_571==null){
_571=_570.getAttribute("pflid");
}
if(_571!==null){
if(_570.tagName.toUpperCase()=="MAP"){
var _572=_570.parentNode.childNodes;
for(var _573=0;_573<_572.length;++_573){
var _574=_572[_573].getAttribute("usemap");
if(_574!==null&&_574==("#"+this.m_cognosViewer.getId()+_571)){
return _572[_573];
}
}
}else{
if(_570.parentNode.getAttribute("chartcontainer")=="true"){
return _570.parentNode;
}
}
return _570;
}
return null;
},initializeEditableSorts:function(_575){
if(this.m_containerInfo!==null){
if(typeof this.m_containerInfo.sort!=="undefined"){
this.m_editableSorts=this.m_containerInfo.sort;
}
if(typeof _575!=="undefined"){
for(var i=0;i<_575.length;++i){
this.m_editableSorts=this.mergeChildInfo(this.m_editableSorts,_575[i].sort,"labels");
this.m_editableSorts=this.mergeChildInfo(this.m_editableSorts,_575[i].sort,"valuesOf");
}
}
}
},initializeEditableFilters:function(_577){
if(typeof this.m_containerInfo!=="undefined"&&this.m_containerInfo!==null){
if(typeof this.m_containerInfo.filter!=="undefined"){
this.m_editableFilters=this.m_containerInfo.filter;
}
if(typeof _577!=="undefined"){
for(var i=0;i<_577.length;++i){
this.m_editableFilters=this.mergeChildInfo(this.m_editableFilters,_577[i].filter,"item");
}
}
}
},initializeEditableSliders:function(_579){
if(typeof this.m_containerInfo!=="undefined"&&this.m_containerInfo!==null){
if(typeof this.m_containerInfo.sliders!=="undefined"){
this.m_editableSliders=this.m_containerInfo.sliders;
}
if(typeof _579!=="undefined"){
for(var i=0;i<_579.length;++i){
this.m_editableSliders=this.mergeChildInfo(this.m_editableSliders,_579[i].sliders,"name");
}
}
}
},mergeChildInfo:function(_57b,_57c,key){
if(typeof _57c!="undefined"){
if(typeof _57b==="undefined"||_57b===null){
_57b=_57c;
}else{
var _57e=[];
for(var i=0;i<_57b.length;++i){
_57e[_57b[i][key]]=_57b[i];
}
for(var j=0;j<_57c.length;++j){
var _581=_57c[j];
if(typeof _57e[_581[key]]=="undefined"){
_57b.push(_581);
_57e[_581.item]=_581;
}
}
}
}
return _57b;
},hasSomethingRendered:function(){
return this.m_bRendered;
},render:function(){
var _582=document.getElementById("infoBar"+this.m_id);
if(_582===null){
var _583=(this.m_containerInfo&&this.m_containerInfo.displayTypeId==="singleton")?true:false;
if(_583&&!this.m_editableFilters&&!this.m_editableSliders){
return;
}
if(this.m_timingDetails||this.m_editableSorts||this.m_editableFilters||this.m_editableSliders||this.hasPrompts()||this.hasLockedFilters()){
var _584=this.getLayoutElement();
var _585=document.createElement("div");
_585.setAttribute("dir",this.m_cognosViewer.getDirection()==="rtl"?"rtl":"ltr");
_582=document.createElement("div");
_582.className="infoBar";
_582.setAttribute("id","infoBar"+this.m_id);
_582.setAttribute("cvid",this.m_cognosViewer.getId());
_582.setAttribute("layoutid",this.m_id);
_582.setAttribute("containerid",this.m_layoutIndex);
_582.setAttribute("role","region");
_582.setAttribute("aria-label",RV_RES.IDS_JS_REPORT_INFO_TITLE);
if(_583){
dojo.style(_582,{opacity:"0.6"});
}
_582.appendChild(this.renderHeader());
_582.appendChild(this.renderDetails());
_585.appendChild(_582);
_584.parentNode.insertBefore(_585,_584);
this.connections.push(dojo.connect(_582,"onkeydown",this,this.onKeyDown));
this.connections.push(dojo.query(".infoBarHeader",_582).connect("onmousedown",this,this.toggle));
this.connections.push(dojo.query(".infoBarLeftIcon",_582).connect("onmousedown",this,this.ignoreEvent));
this.connections.push(dojo.query(".infoBarDetailsText",_582).connect("onmousedown",this,this.ignoreEvent));
this.connections.push(dojo.query(".infoBarLockedItems",_582).connect("onmousedown",this,this.ignoreEvent));
this.m_bRendered=true;
if(this.wasInfoBarExpanded(this.m_id)){
this.show();
}
}
}
},renderHeader:function(){
var _586=this.isFilterApplied();
var _587=this.isSortApplied();
var _588=document.createElement("div");
_588.id="infoBarHeader"+this.m_id;
_588.className="infoBarHeaderDiv";
var _589="<div role=\"presentation\" class=\"infoBarHeader BUXNoPrint\" style=\"width:100%\">"+this.addHeaderCloseButton()+this.addHeaderNavigationButton(_586,_587)+this.addHeaderText(_586,_587)+"</div>";
_588.innerHTML=_589;
return _588;
},addHeaderNavigationButton:function(_58a,_58b){
var _58c=RV_RES.IDS_JS_INFOBAR_EXPAND;
var _58d="infoBarIcon"+(_58a?"Filter":"")+(_58b?"Sort":"")+"Applied";
var _58e="infoBarHeaderButton"+this.m_id+" infoBarHeaderText"+this.m_id;
return "<button class=\"dijitStretch infoBarHeaderButton\" id=\"infoBarHeaderButton"+this.m_id+"\" aria-labelledby=\""+_58e+"\" type=\"button\" role=\"button\" tabindex=\"0\" value=\"\" title=\""+_58c+"\">"+"<span class=\"dijitInline "+_58d+"\" title=\""+_58c+"\"></span>"+"<span class=\"dijitInline dijitDisplayNone infoBarHeaderButtonText\">!</span>"+"</button>";
},addHeaderText:function(_58f,_590){
var _591=[];
if(_58f){
_591.push(RV_RES.IDS_JS_FILTER_APPLIED);
}
if(_590){
_591.push(RV_RES.IDS_JS_SORT_APPLIED);
}
return "<span class=\"infoBarHeaderText\" id=\"infoBarHeaderText"+this.m_id+"\">"+_591.join(", ")+"</span>";
},addHeaderCloseButton:function(){
var _592=RV_RES.IDS_JS_INFOBAR_COLLAPSE;
var _593=this.m_id+"_collapse";
return "<button class=\"dijitStretch infoBarHeaderCloseButton\" id=\"infoBarHeaderCloseButton"+this.m_id+"\" aria-labelledby=\""+_593+"\" type=\"button\" role=\"button\" tabindex=\"0\" value=\"\" title=\""+_592+"\">"+"<span class=\"dijitInline infoBarIconClose BUXNoPrint\" title=\""+_592+"\"></span>"+"<span class=\"dijitInline dijitDisplayNone infoBarCloseButtonText\">x</span>"+"</button>";
},isFilterApplied:function(){
if(this.m_editableFilters||this.m_editableSliders||typeof this.m_containerInfo.lockedFilters!=="undefined"||this.hasPrompts()){
return true;
}
return false;
},isSortApplied:function(){
if(this.m_editableSorts){
return true;
}
return false;
},renderDetails:function(){
var _594=document.getElementById("infoBarFlyout"+this.m_id);
var _595=document.getElementById(this.m_id+"instructions");
if(_594===null){
this.getLayoutElement();
_594=document.createElement("div");
_594.setAttribute("id","infoBarFlyout"+this.m_id);
_594.setAttribute("cvid",this.m_cognosViewer.getId());
_594.setAttribute("layoutid",this.m_id);
_594.setAttribute("containerid",this.m_layoutIndex);
_594.className="infoBarFlyout";
_594.style.display="none";
_594.innerHTML="<div class=\"infoBarFlyoutContent\" id=\"infoBarFlyoutContent"+this.m_id+"\" role=\"list\">"+this.addLockedInfoBarDetails()+this.addEditableInfoBarDetails()+this.addRAPTimingDetails()+"</div>"+this.createHiddenSpan(this.m_id+"_filterString",RV_RES.IDS_JS_FILTER)+this.createHiddenSpan(this.m_id+"_sortString",RV_RES.IDS_JS_SORT)+this.createHiddenSpan(this.m_id+"_promptString",RV_RES.IDS_JS_INFOBAR_PROMPT)+this.createHiddenSpan(this.m_id+"_sliderString",RV_RES.IDS_JS_INFOBAR_SLIDER)+this.createHiddenSpan(this.m_id+"_lockedString",RV_RES.IDS_JS_INFOBAR_LOCKED)+this.createHiddenSpan(this.m_id+"_collapse",RV_RES.IDS_JS_INFOBAR_COLLAPSE)+this.createHiddenSpan(this.m_id+"_delete",RV_RES.IDS_JS_DELETE);
this.connections.push(dojo.connect(_594,"onkeydown",this,this.onKeyDown));
this.connections.push(dojo.query(".infoBarDetailRow",_594).forEach(function(item,_597,_598){
dojo.attr(item,{"aria-setsize":_598.length,"aria-posinset":_597+1});
}).connect("onfocus",function(e){
dojo.query(e.currentTarget).addClass("infoBarDetailRowHover");
}).connect("onblur",function(e){
var el=typeof e.explicitOriginalTarget!=="undefined"?e.explicitOriginalTarget:document.activeElement;
if(dojo.hasClass(el,"infoBarDeleteButton")){
return true;
}
dojo.query(e.currentTarget).removeClass("infoBarDetailRowHover");
}).connect("onmouseover",this,function(e){
this.focusDetailRow(e.currentTarget);
}));
}
if(_595===null){
_595=document.createElement("span");
_595.id=this.m_id+"instructions";
_595.setAttribute("role","presentation");
_595.style.visibility="hidden";
_595.style.display="none";
document.body.appendChild(_595);
_595.innerHTML=RV_RES.IDS_JS_INFOBAR_EXPLANATION;
}
return _594;
},addRAPTimingDetails:function(){
if(this.m_timingDetails){
var _59d=this.m_timingDetails.length-1;
var _59e=this.m_timingDetails[_59d].time-this.m_timingDetails[0].time;
return "<div><table role=\"presentation\" class=\"infoBarLockedItems\">"+"<tr>"+this.addTimingIcon(_59e,250,500)+"<td colspan=\"2\" class=\"bibi inforBarDetailsText\" role=\"presentation\" id=\""+this.m_id+"_timingDetail\" style=\"background-color:LightGray\"><b>RAP Total Time: ("+_59e+")</b></td>"+"</tr>"+this.addRAPTimingItemDetails()+"</table></div>";
}
return "";
},addRAPTimingItemDetails:function(){
var _59f="";
if(this.m_timingDetails){
for(var _5a0=0;_5a0<=this.m_timingDetails.length-1;++_5a0){
var _5a1=this.m_timingDetails[_5a0];
var _5a2=this.getTimeDiff(_5a0);
_59f+="<tr class=\"infoBarDetailRow\" type=\"filter\" tabindex=\"-1\">";
if(_5a1.level){
_59f+="<td colspan=3><font size=\"1\">"+_5a2+":"+html_encode(_5a1.event)+"</font></td></tr>";
}else{
_59f+=this.addTimingIcon(_5a2,100,500);
_59f+="<td class=\"bibi infoBarDetailsText\" role=\"presentation\" id=\""+this.m_id+_5a0+"_timingDetail\">";
_59f+=html_encode(_5a1.event);
_59f+="</td><td align=\"right\">"+_5a2+"</td>";
}
_59f+="</tr>";
}
}
return _59f;
},getTimeDiff:function(_5a3){
var _5a4=_5a3+1;
if(_5a4>=this.m_timingDetails.length){
return 0;
}
var _5a5=this.m_timingDetails[_5a3].level;
if(!(_5a5==this.m_timingDetails[_5a4].level)){
while(_5a4<this.m_timingDetails.length&&this.m_timingDetails[_5a4].level!=_5a5&&typeof this.m_timingDetails[_5a4].level!="undefined"){
_5a4++;
}
}
return (this.m_timingDetails[_5a4].time-this.m_timingDetails[_5a3].time);
},addTimingIcon:function(_5a6,_5a7,red){
var _5a9="icon_excellent_traffic.gif";
if(_5a6>red){
_5a9="icon_poor_traffic.gif";
}else{
if(_5a6>_5a7){
_5a9="icon_average_traffic.gif";
}
}
return this.addInfoBarIcon(_5a9,true);
},addLockedInfoBarDetails:function(){
if(this.hasPrompts()||typeof this.m_containerInfo.lockedFilters!=="undefined"){
return "<div role=\"presentation\" class=\"infoBarLockedItems\">"+this.addPromptDetails()+this.addLockedFilterDetails()+"</div>";
}
return "";
},addEditableInfoBarDetails:function(){
if(this.m_editableFilters||this.m_editableSorts||this.m_editableSliders){
return "<div role=\"presentation\" class=\"infoBarEditableItems\">"+this.addFilteredItemsDetails()+this.addSliderDetails()+this.addSortDetails()+"</div>";
}
return "";
},onKeyDown:function(evt){
var _5ab=evt.target;
var cvId=this.m_cognosViewer.getId();
var _5ad=document.getElementById("infoBarHeaderButton"+this.m_id);
var _5ae=document.getElementById(this.m_id+"instructions");
var node;
if(evt.keyCode=="13"){
_5ae.innerHTML=RV_RES.IDS_JS_INFOBAR_EXPLANATION;
if(_5ab===_5ad){
this.toggle();
return stopEventBubble(evt);
}
}else{
if(evt.keyCode=="27"){
var _5b0=this.m_cognosViewer.getA11YHelper();
if(this.m_cognosViewer.getCurrentNodeFocus()){
node=this.m_cognosViewer.getCurrentNodeFocus();
if(node.nodeName.toLowerCase()!="span"){
var _5b1=node.getElementsByTagName("span");
for(var _5b2=0;_5b2<_5b1.length;_5b2++){
if(_5b1[_5b2].style.display!="hidden"){
node=_5b1[_5b2];
break;
}
}
}
this.hide(false);
_5b0.setFocusToNode(node);
}else{
this.hide();
}
return stopEventBubble(evt);
}else{
if(evt.keyCode=="46"){
if(dojo.hasClass(_5ab,"infoBarDetailRow")){
node=dojo.query("td.infoBarRightIcon",_5ab)[0];
if(typeof node!=="undefined"){
if(_5ab.getAttribute("type")=="filter"){
InfoBarHelper.infoBarRemoveFilter(cvId,this.m_layoutIndex,node.getAttribute("filterItem"),node.getAttribute("details"));
}else{
if(_5ab.getAttribute("type")=="sort"){
InfoBarHelper.infoBarRemoveSort(cvId,this.m_layoutIndex,node.getAttribute("sortItem"),node.getAttribute("byLabel"));
}else{
if(_5ab.getAttribute("type")=="slider"){
InfoBarHelper.infoBarRemoveSlider(cvId,node.getAttribute("slider"));
}
}
}
}
}
}else{
if(evt.keyCode=="38"){
if(dojo.hasClass(_5ab,"infoBarDetailRow")){
this.focusDetailRow(_5ab,"prev");
}else{
this.focusDetailRow();
}
_5ae.innerHTML="";
return stopEventBubble(evt);
}else{
if(evt.keyCode=="40"){
if(dojo.hasClass(_5ab,"infoBarDetailRow")){
this.focusDetailRow(_5ab,"next");
}else{
this.focusDetailRow();
}
_5ae.innerHTML="";
return stopEventBubble(evt);
}else{
if(evt.keyCode=="9"){
var _5b3=document.getElementById("infoBar"+this.m_id);
if(dojo.hasClass(_5b3,"infoBarExpanded")){
if(dojo.hasClass(_5ab,"infoBarDetailRow")){
dojo.byId("infoBarHeaderCloseButton"+this.m_id).focus();
}else{
this.focusDetailRow();
}
return stopEventBubble(evt);
}
}
}
}
}
}
}
},focusDetailRow:function(_5b4,dir){
var _5b6=document.getElementById("infoBarFlyout"+this.m_id);
var _5b7=document.getElementById("infoBar"+this.m_id);
if(!dojo.hasClass(_5b7,"infoBarExpanded")){
return;
}
if(typeof _5b4=="undefined"||_5b4===null){
var _5b8=dojo.query(".infoBarLockedItems .infoBarDetailRow, .infoBarEditableItems .infoBarDetailRow",_5b6);
_5b4=_5b8[0];
}
if(_5b4&&dojo.hasClass(_5b4,"infoBarDetailRow")){
var _5b9,rows,len,i;
if(dir==="prev"){
if(_5b4.parentNode.previousSibling){
_5b9=_5b4.parentNode.previousSibling.childNodes[1];
}else{
rows=dojo.query(".infoBarDetailRow",_5b6);
len=rows.length;
if(_5b4===rows[0]){
_5b9=rows[len-1];
}else{
for(i=1;i<len;i++){
if(_5b4===rows[i]){
_5b9=rows[i-1];
break;
}
}
}
}
}else{
if(dir==="next"){
if(_5b4.parentNode.nextSibling){
_5b9=_5b4.parentNode.nextSibling.childNodes[1];
}else{
rows=dojo.query(".infoBarDetailRow",_5b6);
len=rows.length;
if(_5b4===rows[len-1]){
_5b9=rows[0];
}else{
for(i=0;i<len-1;i++){
if(_5b4===rows[i]){
_5b9=rows[i+1];
break;
}
}
}
}
}else{
_5b9=_5b4;
}
}
_5b9.focus();
}
},toggle:function(evt){
var _5be=document.getElementById("infoBar"+this.m_id);
if(dojo.hasClass(_5be,"infoBarExpanded")){
this.hide();
}else{
this.show();
}
stopEventBubble(evt);
},ignoreEvent:function(evt){
stopEventBubble(evt);
},show:function(){
var _5c0=document.getElementById("infoBar"+this.m_id);
if(!dojo.hasClass(_5c0,"infoBarExpanded")){
var _5c1=document.getElementById("infoBarHeader"+this.m_id);
var _5c2=document.getElementById("infoBarFlyout"+this.m_id);
var _5c3=document.getElementById("infoBarHeaderButton"+this.m_id);
var _5c4,_5c5,_5c6;
var _5c7=dojo.fx.wipeIn({node:_5c2,duration:300,onEnd:dojo.hitch(this,function(){
this.focusDetailRow();
_5c3.setAttribute("title",RV_RES.IDS_JS_INFOBAR_COLLAPSE);
_5c3.childNodes[0].setAttribute("title",RV_RES.IDS_JS_INFOBAR_COLLAPSE);
})});
this.updateInfoBarRenderedState(this.m_id,"true");
dojo.addClass(_5c0,"infoBarExpanded");
if(this.m_containerInfo&&this.m_containerInfo.displayTypeId==="singleton"){
dojo.style(_5c0,{opacity:"1"});
}
dojo.style(_5c0,"width","auto");
_5c7.play();
var _5c8=document.getElementById("infoBarHeaderText"+this.m_id).innerHTML;
var _5c9=this._getTextWidth(_5c8)+40;
if(_5c9<500){
_5c9=500;
}
var _5ca=this.m_cognosViewer.getViewerWidget();
var _5cb=_5ca.findContainerDiv().clientWidth;
if(_5c9>_5cb){
_5c9=_5cb-5;
}
_5c0.style.width=_5c9+"px";
dojo.removeClass(_5c1,"BUXNoPrint");
}
},_getTextWidth:function(text){
var div=document.createElement("div");
div.className="infoBar infoBarHeader";
div.style.fontWeight="bold";
div.style.position="absolute";
div.style.visibility="hidden";
div.style.height="auto";
div.style.width="auto";
document.body.appendChild(div);
div.innerHTML=text;
var _5ce=div.clientWidth;
document.body.removeChild(div);
return _5ce;
},hide:function(_5cf){
var _5d0=document.getElementById("infoBar"+this.m_id);
if(dojo.hasClass(_5d0,"infoBarExpanded")){
this.updateInfoBarRenderedState(this.m_id,"false");
var _5d1=document.getElementById("infoBarHeader"+this.m_id);
var _5d2=document.getElementById("infoBarFlyout"+this.m_id);
var _5d3=document.getElementById("infoBarHeaderButton"+this.m_id);
dojo.addClass(_5d1,"BUXNoPrint");
dojo.fx.wipeOut({node:_5d2,duration:300,onEnd:dojo.hitch(this,function(){
dojo.removeClass(_5d0,"infoBarExpanded");
dojo.style(_5d0,"width","auto");
if(this.m_containerInfo&&this.m_containerInfo.displayTypeId==="singleton"){
dojo.style(_5d0,{opacity:"0.6"});
}
_5d3.setAttribute("title",RV_RES.IDS_JS_INFOBAR_EXPAND);
_5d3.childNodes[0].setAttribute("title",RV_RES.IDS_JS_INFOBAR_EXPAND);
if(!_5cf){
_5d3.focus();
}
})}).play();
}
},updateInfoBarRenderedState:function(_5d4,_5d5){
var _5d6=this.m_cognosViewer.getViewerWidget();
if(_5d6){
var _5d7=_5d6.getInfoBarRenderedState();
_5d7[_5d4]=_5d5;
}
},wasInfoBarExpanded:function(_5d8){
var _5d9=this.m_cognosViewer.getViewerWidget();
if(_5d9){
var _5da=_5d9.getInfoBarRenderedState();
if(_5da){
if(_5da[_5d8]){
if("true"===_5da[_5d8]){
return true;
}
}
}
}
return false;
},destroy:function(){
for(var i=0;i<this.connections.length;i++){
var _5dc=this.connections[i];
if(_5dc&&_5dc.remove){
dojo.disconnect(_5dc);
}
}
var _5dd=document.getElementById("infoBar"+this.m_id);
if(_5dd){
var _5de=_5dd.parentNode;
if(_5de){
_5de.removeChild(_5dd);
}
}
_5dd=document.getElementById(this.m_id+"instructions");
if(_5dd){
_5dd.parentNode.removeChild(_5dd);
}
delete this.m_layoutElement;
delete this.m_containerInfo;
}});
dojo.declare("AnnotationFilterContext",null,{m_parameterValuesString:null,m_parameterValuesSpec:null,m_slidersJSON:null,m_filterJSON:null,constructor:function(_5df,_5e0,_5e1,_5e2){
this.m_parameterValuesString=_5df;
this.m_parameterValuesSpec=_5e0;
this.m_slidersJSON=_5e1;
this.m_filterJSON=_5e2;
},setParameterValuesString:function(_5e3){
this.m_parameterValuesString=_5e3;
},setParameterValuesSpec:function(_5e4){
this.m_parameterValuesSpec=_5e4;
},setSlidersJSON:function(_5e5){
this.m_slidersJSON=_5e5;
},setFilterJSON:function(_5e6){
this.m_filterJSON=_5e6;
},getParameterValuesString:function(){
return this.m_parameterValuesString||null;
},getParameterValuesSpec:function(){
return this.m_parameterValuesSpec||null;
},getPromptsJSON:function(){
var _5e7=null;
if(this.m_parameterValuesString){
_5e7={};
_5e7.parameterValuesString=this.m_parameterValuesString;
}
if(this.m_parameterValuesString){
_5e7=_5e7||{};
_5e7.parameterValuesSpec=this.m_parameterValuesSpec;
}
return _5e7;
},getSlidersJSON:function(){
return this.m_slidersJSON||null;
},getFilterJSON:function(){
return this.m_filterJSON||null;
},isEmpty:function(){
if(this.m_parameterValuesString||this.m_parameterValuesSpec||this.m_slidersJSON||this.m_filterJSON){
return false;
}
return true;
}});
dojo.declare("AnnotationInfoBar",InfoBarBase,{constructor:function(_5e8,lid){
this.m_id="annoInfoBar_"+lid;
this.m_layoutElementId=lid;
},createFilterContext:function(){
var _5ea=null;
var _5eb=null;
var _5ec=null;
var _5ed=null;
if(this.m_cognosViewer.getRAPReportInfo()){
var _5ee=this.m_cognosViewer.getRAPReportInfo();
if(_5ee.getContainers()){
var _5ef=_5ee.getContainers();
if(_5ef[this.m_layoutElementId]){
var _5f0=_5ef[this.m_layoutElementId];
if(typeof _5f0.filter!=="undefined"){
_5ea=_5f0.filter;
}
if(typeof _5f0.sliders!=="undefined"){
_5eb=_5f0.sliders;
}
}
}
}
if(this.hasPrompts()){
_5ec=CViewerCommon.buildParameterValuesSpec(this.m_cognosViewer);
_5ed=this.m_cognosViewer.getExecutionParameters();
}
if(_5ea||_5eb||_5ec||_5ed){
return new AnnotationFilterContext(_5ed,_5ec,_5eb,_5ea);
}
return null;
}});
dojo.declare("AnnotationInfoBarRenderer",null,{m_AnnotationInfoBar:null,m_id:null,m_labelledByHideButton:"",miniCognosViewer:null,m_editableSliders:null,constructor:function(_5f1,lid,_5f3,_5f4){
this.m_AnnotationInfoBar=null;
this.miniCognosViewer={};
this.miniCognosViewer.m_sId=_5f1.id;
this.miniCognosViewer.getId=_5f1.getId;
this.miniCognosViewer.m_sParameters=(_5f3===null||_5f3.getParameterValuesString()===null)?"":_5f3.getParameterValuesString();
this.miniCognosViewer.getExecutionParameters=_5f1.getExecutionParameters;
this.miniCognosViewer.getWebContentRoot=_5f1.getWebContentRoot;
this.m_AnnotationInfoBar=new AnnotationInfoBar(this.miniCognosViewer,lid);
this.m_AnnotationInfoBar.setId("annoInfoBar_"+_5f4+lid);
this.m_id="annoInfoBar_"+_5f4+lid+"_renderer";
if(_5f3){
if(_5f3.getSlidersJSON()){
this.m_AnnotationInfoBar.setContainerInfo({"sliders":_5f3.getSlidersJSON()});
this.m_AnnotationInfoBar.m_editableSliders=_5f3.getSlidersJSON();
}
if(_5f3.getFilterJSON()){
this.m_AnnotationInfoBar.setEditableFilters(_5f3.getFilterJSON());
}
}
},render:function(){
var _5f5="<div class=\"infoBar infoBarCollapsed\" id=\"infoBarHeaderCollapsed"+this.m_id+"\" >"+this.renderHeader(false)+"</div>";
var _5f6="<div class=\"infoBar infoBarExpanded\" id=\"infoBarHeaderExpanded"+this.m_id+"\" style=\"display:none;\" >"+this.renderHeader(true)+this.renderDetails()+"</div>";
_5f6=this.updateHideButtonLabelledBy(_5f6);
var _5f7=document.getElementById("annotationInfoBarInstructions");
if(_5f7===null){
_5f7=document.createElement("span");
_5f7.id="annotationInfoBarInstructions";
_5f7.setAttribute("role","presentation");
_5f7.style.visibility="hidden";
_5f7.style.display="none";
var _5f8=this.m_AnnotationInfoBar.createHiddenSpan("annoInfoBarButtonInstruction",RV_RES.IDS_JS_ANNO_INFOBAR_BUTTON_EXPLANATION)+this.m_AnnotationInfoBar.createHiddenSpan("annoInfoBar_filterString",RV_RES.IDS_JS_FILTER)+this.m_AnnotationInfoBar.createHiddenSpan("annoInfoBar_promptString",RV_RES.IDS_JS_INFOBAR_PROMPT)+this.m_AnnotationInfoBar.createHiddenSpan("annoInfoBar_sliderString",RV_RES.IDS_JS_INFOBAR_SLIDER);
document.body.appendChild(_5f7);
_5f7.innerHTML=_5f8;
}
return _5f5+_5f6;
},renderInJSON:function(){
var _5f9=[];
return _5f9.concat(this.m_AnnotationInfoBar.getPromptDetailsInJSON(),this.m_AnnotationInfoBar.getFilteredItemsDetailsInJSON(),this.m_AnnotationInfoBar.getSliderDetailsInJSON());
},renderHeader:function(_5fa){
var mode=(_5fa)?"Hide":"Show";
var _5fc=(_5fa)?RV_RES.IDS_JS_ANNO_INFOBAR_HIDE:RV_RES.IDS_JS_ANNO_INFOBAR_SHOW;
var _5fd=(_5fa)?("XXREPLACEXX"):" annoInfoBarHeaderControlButtonText"+mode+this.m_id;
var _5fe="<table class=\"annoInfoBarHeader\" id=\"annoInfoBarHeader"+mode+this.m_id+"\" role=\"presentation\">"+"<tr>"+"<td class=\"annoInfoBarHeaderText\" id=\"infoBarHeaderText"+this.m_id+"\" >"+RV_RES.IDS_JS_FILTER_APPLIED+"</td>"+"<td class=\"annoInfoBarHeaderControl\" id=\"infoBarHeader"+mode+this.m_id+"\" >"+"<button id=\"annoInfoBarHeaderControl"+mode+this.m_id+"\" aria-labelledby=\""+_5fd+"\" type=\"button\" role=\"button\" tabindex=\"0\" value=\"\" title=\""+_5fc+"\""+" onmousedown=\"annotationInfoBarToggle('"+this.m_id+"', '"+mode+"');\">"+"<span id=\"annoInfoBarHeaderControlButtonText"+mode+this.m_id+"\"class=\"dijitInline annoInfoBarHeaderControlText\" title=\""+_5fc+"\" >"+_5fc+"</span>"+"</button>"+"</td>"+"</tr>"+"</table>";
return _5fe;
},renderDetails:function(){
var _5ff=this.m_AnnotationInfoBar.addPromptDetails(true);
var _600=this.m_AnnotationInfoBar.addFilteredItemsDetails(true);
var _601=this.m_AnnotationInfoBar.addSliderDetails(true);
var _602="<div class=\"annoInfoBarDetails\" id=\"annoInfoBarDetails"+this.m_id+"\" role=\"presentation\">"+_5ff+_600+_601+"</div>";
this.m_labelledByHideButton=(_5ff.length===0)?"":(" annoInfoBar_promptString "+this.m_AnnotationInfoBar.getId()+"0_promptDetail ");
this.m_labelledByHideButton+=(_600.length===0)?"":(" annoInfoBar_filterString "+this.m_AnnotationInfoBar.getId()+"0_filterDetail ");
this.m_labelledByHideButton+=(_601.length===0)?"":(" annoInfoBar_sliderString "+this.m_AnnotationInfoBar.getId()+"0_sliderDetail  annoInfoBar_sliderString "+this.m_AnnotationInfoBar.getId()+"1_sliderDetail ");
this.m_labelledByHideButton+=" annoInfoBarHeaderControlButtonTextHide"+this.m_id;
return _602;
},updateHideButtonLabelledBy:function(_603){
return _603.replace("XXREPLACEXX",this.m_labelledByHideButton);
}});
function annotationInfoBarToggle(mId,_605){
var _606=document.getElementById("infoBarHeaderExpanded"+mId);
var _607=document.getElementById("infoBarHeaderCollapsed"+mId);
var _608=null;
if("Show"===_605){
dojo.style(_606,{display:""});
dojo.style(_607,{display:"none"});
_608=document.getElementById("annoInfoBarHeaderControlHide"+mId);
}else{
dojo.style(_607,{display:""});
dojo.style(_606,{display:"none"});
_608=document.getElementById("annoInfoBarHeaderControlShow"+mId);
}
if(_608){
_608.focus();
}
};
var CV_BACKGROUND_LAYER_ID="CV_BACK";
if(typeof window.gaRV_INSTANCES=="undefined"){
window.gaRV_INSTANCES=[];
}
if(!window.gViewerLogger){
window.gViewerLogger={log:function(hint,_60a,type){
},addContextInfo:function(_60c){
}};
}
function CognosViewerSession(oCV){
this.m_sConversation=oCV.getConversation();
this.m_sParameters=oCV.getExecutionParameters();
this.m_envParams={};
applyJSONProperties(this.m_envParams,oCV.envParams);
this.m_bRefreshPage=false;
};
function CCognosViewer(sId,_60f){
if(typeof window.gCognosViewer=="undefined"){
window.gCognosViewer=this;
}
if(typeof ViewerConfig=="function"){
this.m_viewerConfig=new ViewerConfig();
try{
if(typeof window.getViewerConfiguration=="function"){
this.m_viewerConfig.configure(window.getViewerConfiguration());
}else{
if(window.parent&&typeof window.parent.getViewerConfiguration=="function"){
this.m_viewerConfig.configure(window.parent.getViewerConfiguration());
}
}
}
catch(e){
}
this.m_viewerUIConfig=this.m_viewerConfig.getUIConfig();
}
this.m_sActionState="";
this.m_bKeepSessionAlive=false;
this.m_undoStack=[];
this.m_aSecRequests=[];
this.m_bDebug=false;
this.m_sCAFContext="";
this.m_sContextInfoXML="";
this.m_sConversation="";
this.m_sStatus="";
this.m_sGateway=_60f;
this.m_sId=sId;
this.m_sMetadataInfoXML="";
this.m_sParameters="";
this.m_sReportState="";
this.envParams={};
this.m_sTracking="";
this.m_sSoapFault="";
this.m_sWaitHTML="";
this.m_oDrillMgr=null;
this.goDrillManager=null;
this.m_oWorkingDialog=null;
this.m_oRequestExecutedIndicator=null;
this.m_bUseWorkingDialog=true;
this.m_oSubscriptionManager=null;
this.m_oCVMgr=null;
this.m_bUseSafeMode=true;
if(typeof CViewerManager=="function"){
this.m_oCVMgr=new CViewerManager(this);
}
if(window.gaRV_INSTANCES){
var _610=false;
for(var _611=0;_611<window.gaRV_INSTANCES.length;_611++){
if(window.gaRV_INSTANCES[_611].m_sId==sId){
window.gaRV_INSTANCES[_611]=this;
_610=true;
break;
}
}
if(!_610){
window.gaRV_INSTANCES=window.gaRV_INSTANCES.concat(this);
}
}
this.m_bReportHasPrompts=false;
this.m_viewerWidget=null;
this.m_flashChartsObjectIds=[];
this.m_raiseSharePromptEvent=true;
this.m_actionFactory=null;
this.m_calculationCache={};
this.m_drillTargets=[];
this.m_reportRenderingDone=false;
if(typeof PinFreezeManager!=="undefined"){
this.m_pinFreezeManager=new PinFreezeManager(this);
}
if(typeof ViewerDispatcher!=="undefined"){
this.m_viewerDispatcher=new ViewerDispatcher();
}
this.m_retryDispatcherEntry=null;
this.m_RAPReportInfo=null;
if(typeof ViewerState=="function"){
this.m_viewerState=new ViewerState();
}
this.m_aInfoBar=null;
};
CCognosViewer.prototype.setScheduledMobileOutput=function(_612){
this.m_mobileScheduledOutput=_612;
if(_612){
this.m_sStatus="complete";
}
};
CCognosViewer.prototype.setTabInfo=function(_613){
this.m_tabsPayload=_613;
if(this.m_tabsPayload&&this.m_tabsPayload.tabs&&this._keepTabSelected){
var _614=false;
for(var i=0;i<this.m_tabsPayload.tabs.length;i++){
var tab=this.m_tabsPayload.tabs[i];
if(tab.id==this._keepTabSelected){
this.m_tabsPayload.currentTabId=this._keepTabSelected;
break;
}
}
this._keepTabSelected=null;
}
};
CCognosViewer.prototype.setKeepTabSelected=function(_617){
this._keepTabSelected=_617;
};
CCognosViewer.prototype.getTabController=function(){
return this.m_tabControl;
};
CCognosViewer.prototype.getCurrentlySelectedTab=function(){
return this.m_currentlySelectedTab?this.m_currentlySelectedTab:null;
};
CCognosViewer.prototype.deleteTabs=function(){
if(this.m_tabControl){
this.m_tabControl.destroy();
delete this.m_tabControl;
this.m_tabControl=null;
}
this.m_tabsPayload=null;
};
CCognosViewer.prototype.renderTabs=function(){
if(!this.m_tabsPayload){
return;
}
var _618=this.isSavedOutput()&&!this.m_mobileScheduledOutput;
var _619=document.getElementById("CVNavLinks"+this.getId());
if(_619||!this.shouldWriteNavLinks()||_618){
var _61a=this.getReportDiv();
this.m_bHasTabs=true;
if(this.m_tabControl&&this.m_tabControl.isSavedOutput()!=_618){
this.deleteTabs();
}
if(!this.m_tabControl){
if(this.getStatus()!="complete"&&!_618){
return;
}
var tr=document.createElement("tr");
var _61c=document.createElement("td");
tr.appendChild(_61c);
var _61d=document.getElementById("mainViewerTR"+this.getId());
if(!_61d){
return;
}
if(this.m_tabsPayload.position=="topLeft"){
_61d.parentNode.insertBefore(tr,_61d);
}else{
_61d.parentNode.appendChild(tr);
}
var _61e=null;
if(this.m_viewerWidget){
_61e=this.m_viewerWidget.findContainerDiv().firstChild;
}else{
_61e=_61c;
}
var oCV=this;
if(_618){
this.m_tabControl=new CognosTabControl(_61e,function(_620){
oCV.switchSavedOutputTab(_620,true);
});
this.switchSavedOutputTab(this.m_tabsPayload.currentTabId,false);
}else{
this.m_tabControl=new CognosTabControl(_61e,function(_621){
oCV.switchTabs(_621);
});
}
if(this.m_viewerWidget){
this.m_tabControl.setSpaceSaverContainer(_61c);
this.m_tabControl.setScrollAttachNode(this.m_viewerWidget.findContainerDiv());
this.m_tabControl.useAbsolutePosition(true);
}
this.m_tabControl.setIsSavedOutput(_618);
if(!window.gScriptLoader.m_bScriptLoaderCalled){
var _622=document.getElementById("RVContent"+this.getId());
var _623=this._getNodesWithViewerId(_622,"link",null);
for(var i=0;i<_623.length;i++){
window.gScriptLoader.moveLinks(_623[i]);
if(_623[i].getAttribute("href").indexOf("promptCommon.css")>0){
this.setHasPrompts(true);
}
}
window.gScriptLoader.loadStyles(_622,this.getId());
this.repaintDiv(_622);
}
}
if(this.getStatus()=="prompting"){
this.previouslySelectedTab=null;
this.m_tabControl.hide();
}else{
if(this.isHighContrast()){
this.m_tabControl.setHighContrast(true);
}
this.m_tabControl.render(this.m_tabsPayload);
this.m_currentlySelectedTab=this.m_tabControl.getSelectedTabId();
if(this.m_switchingToTabId&&this.m_currentlySelectedTab!=this.m_switchingToTabId){
this._removeTabContent(_61a.parentNode,this.m_switchingToTabId);
this._removeTabContent(_61a.parentNode,this.m_currentlySelectedTab);
if(_619){
this._removeTabContent(_619.parentNode,this.m_switchingToTabId);
this._removeTabContent(_619.parentNode,this.m_currentlySelectedTab);
}
this.m_tabInfo={};
}
this.m_switchingToTabId=null;
_61a.setAttribute("tabId",this.m_currentlySelectedTab);
if(_619){
_619.setAttribute("tabId",this.m_currentlySelectedTab);
}
if(isIE()&&_618&&window.resizeIFrame&&!this.m_viewerFragment&&!this.m_viewerWidget){
window.resizeIFrame();
}
}
this.setMaxContentSize();
}else{
var obj=this;
setTimeout(function(){
obj.renderTabs();
},100);
}
};
CCognosViewer.prototype.cancelTabSwitch=function(){
var _626=this.getReportDiv();
var _627=this.m_switchingToTabId;
this.m_currentlySelectedTab=_627;
this.m_tabControl.selectTab(this.previouslySelectedTab,false);
this.switchTabs(this.previouslySelectedTab);
if(_626){
_626.parentNode.removeChild(_626);
}
if(this.m_tabInfo[this.m_currentlySelectedTab]&&this.m_tabInfo[this.m_currentlySelectedTab].styles){
this._addTabStylesToHead(this.m_tabInfo[this.m_currentlySelectedTab].styles);
}
this.previouslySelectedTab=null;
this.m_tabInfo[_627]=null;
};
CCognosViewer.prototype.switchSavedOutputTab=function(_628,_629){
var _62a=this.getSelectionController();
if(_62a){
_62a.clearSelectedObjects();
}
this.m_currentlySelectedTab=this.m_tabControl.getSelectedTabId();
if(_629){
this.notifyTabChange(_628);
}
if(this.m_viewerWidget){
this.m_viewerWidget.getSavedOutput().switchSavedOutputTab(_628,_629);
this.getTabController().resetPosition();
}else{
if(!this.savedOutputTabNodes){
var _62b=document.getElementById("CVIFrame"+this.getId());
this.savedOutputTabNodes=getElementsByAttribute(_62b.contentWindow.document.body,"*","tabid");
}
if(!this.savedOutputTabNodes){
return;
}
for(var i=0;i<this.savedOutputTabNodes.length;i++){
var _62d=this.savedOutputTabNodes[i];
_62d.style.display=_62d.getAttribute("tabid")==_628?"":"none";
}
this.setMaxContentSize();
}
};
CCognosViewer.prototype.notifyTabChange=function(_62e){
};
CCognosViewer.prototype._getNodesWithViewerId=function(_62f,_630,id){
var _632=[];
var _633=_62f.getElementsByTagName(_630);
for(var i=0;i<_633.length;i++){
var node=_633[i];
if(!id||(node.getAttribute&&node.getAttribute("namespaceId")==id)){
node.parentNode.removeChild(node);
_632.push(node);
i--;
}
}
return _632;
};
CCognosViewer.prototype._removeTabStylesFromHead=function(){
var id=this.getId();
return this._getNodesWithViewerId(document.getElementsByTagName("head").item(0),"style",id);
};
CCognosViewer.prototype._addTabStylesToHead=function(_637){
if(!_637){
return;
}
for(var i=0;i<_637.length;i++){
document.getElementsByTagName("head").item(0).appendChild(_637[i]);
}
};
CCognosViewer.prototype.switchTabs=function(_639){
if(this.m_currentlySelectedTab==_639){
return;
}
var _63a=this.getSelectionController();
if(_63a){
_63a.clearSelectedObjects();
}
var _63b=this.getReportDiv();
this.m_nReportDiv=null;
var _63c=_63b.clientHeight;
_63b.removeAttribute("id");
_63b.style.display="none";
if(!this.m_tabInfo){
this.m_tabInfo={};
}
var _63d=this._removeTabStylesFromHead();
var _63e=this.getSelectionController().getCCDManager();
this.m_tabInfo[this.m_currentlySelectedTab]={"conversation":this.getConversation(),"metadata":_63e.getClonedMetadataArray(),"contextdata":_63e.getClonedContextdataArray(),"secondaryRequests":this.getSecondaryRequests(),"styles":_63d,"hasPromptControl":this.getHasPrompts()};
var _63f=this._findChildWithTabId(_63b.parentNode,_639);
this.previouslySelectedTab=this.m_currentlySelectedTab;
if(_63f&&this.m_tabInfo[_639]&&this.m_tabInfo[_639].hasPromptControl){
if(_63f){
_63f.parentNode.removeChild(_63f);
_63f=null;
}
delete this.m_tabInfo[_639];
this.m_tabInfo[_639]=null;
}
if(_63f){
this.m_currentlySelectedTab=_639;
_63f.style.display="block";
_63f.setAttribute("id","CVReport"+this.getId());
if(this.m_tabInfo&&this.m_tabInfo[_639]){
var _640=this.m_tabInfo[_639];
if(_640.conversation){
this.setConversation(_640.conversation);
}
if(_640.metadata){
_63e.SetMetadata(_640.metadata);
}
if(_640.contextdata){
_63e.SetContextData(_640.contextdata);
}
if(_640.secondaryRequests){
this.setSecondaryRequests(_640.secondaryRequests);
}
if(_640.styles){
this._addTabStylesToHead(_640.styles);
}
this.setHasPrompts(_640.hasPromptControl);
}
if(this.shouldWriteNavLinks()){
this.writeNavLinks(this.getSecondaryRequests().join(" "));
}
if(this.getPinFreezeManager()&&this.getPinFreezeManager().hasFrozenContainers()){
this.getPinFreezeManager().rePaint();
if(isIE()){
var _641=document.getElementById("RVContent"+this.getId());
this.repaintDiv(_641);
}
}
if(this.m_viewerWidget){
this.m_viewerWidget.placeTabControlInView();
}
this._keepFocus=null;
this.doneLoadingUpdateA11Y("complete");
this.getTabController().resetPosition();
this.setMaxContentSize();
}else{
this.m_switchingToTabId=_639;
var _642=_63b.cloneNode(false);
_642.style.display="block";
_642.setAttribute("id","CVReport"+this.getId());
_642.removeAttribute("tabId");
_63b.parentNode.appendChild(_642);
_642.innerHTML="<table height='"+_63c+"px'><tr><td height='100%'></td></tr></table>";
var _643=new ViewerDispatcherEntry(this);
_643.addFormField("ui.action","reportAction");
_643.addFormField("generic.anyURI.http://developer.cognos.com/ceba/constants/runOptionEnum#pageGroup",_639);
if(this.m_viewerWidget){
this.m_viewerWidget.placeTabControlInView();
}
this.dispatchRequest(_643);
}
};
CCognosViewer.prototype._removeTabContent=function(_644,_645){
var _646=this._findChildWithTabId(_644,_645);
while(_646){
_646.parentNode.removeChild(_646);
_646=this._findChildWithTabId(_644,_645);
}
};
CCognosViewer.prototype._findChildWithTabId=function(_647,_648){
var _649=null;
for(var i=0;i<_647.childNodes.length;i++){
var _64b=_647.childNodes[i];
if(_64b.getAttribute("tabId")==_648){
_649=_64b;
break;
}
}
return _649;
};
CCognosViewer.prototype.clearTabs=function(){
if(!this.m_bHasTabs){
return;
}
this.m_tabInfo={};
var _64c=this.getReportDiv();
var _64d=_64c.parentNode;
for(var i=0;i<_64d.childNodes.length;i++){
var node=_64d.childNodes[i];
if(node.getAttribute("id")!="CVReport"+this.m_sId){
_64d.removeChild(node);
i--;
}
}
};
CCognosViewer.prototype.isSavedOutput=function(){
var _650=this.envParams["ui.action"];
return _650==="view"||_650==="buxView";
};
CCognosViewer.prototype.renderSavedOutputIFrame=function(url,_652,_653){
var _654=document.getElementById("CVReport"+this.getId());
var _655=document.createElement("iframe");
_655.style.width="100%";
_655.style.height=_654.clientHeight?_654.clientHeight+"px":"99%";
_655.id="CVIFrame"+this.getId();
_655.title=_652;
_655.setAttribute("frameBorder","0");
_654.appendChild(_655);
var obj=this;
var func=function(){
obj.renderTabs();
};
setTimeout(function(){
if(_653){
if(_655.attachEvent){
_655.attachEvent("onload",func);
}else{
_655.addEventListener("load",func,true);
}
}
_655.src=url;
},1);
};
CCognosViewer.prototype.updatePageState=function(_658){
if(_658&&this.getState()){
this.getState().setPageState(_658);
}
};
CCognosViewer.prototype.getPageInfo=function(){
if(this.m_viewerState&&this.m_viewerState.getPageState()){
var _659=this.m_viewerState.getPageState();
return {"currentPage":_659.getCurrentPage(),"pageCount":_659.getPageCount()};
}
return {};
};
CCognosViewer.prototype.isIWidgetMobile=function(){
return this.m_viewerWidget&&this.m_viewerWidget.isMobile();
};
CCognosViewer.prototype.isInteractiveViewer=function(){
return false;
};
CCognosViewer.prototype.launchGotoPageForIWidgetMobile=function(form){
if(this.isIWidgetMobile()){
this.m_viewerWidget.launchGotoPageForIWidgetMobile(form);
return true;
}
return false;
};
CCognosViewer.prototype.executeDrillThroughForIWidgetMobile=function(form){
if(this.isIWidgetMobile()){
this.m_viewerWidget.executeDrillThroughForIWidgetMobile(form);
return true;
}
return false;
};
CCognosViewer.prototype.getState=function(){
return this.m_viewerState;
};
CCognosViewer.prototype.getConfig=function(){
return this.m_viewerConfig;
};
CCognosViewer.prototype.getUIConfig=function(){
return this.m_viewerUIConfig;
};
CCognosViewer.prototype.setCurrentNodeFocus=function(node){
this.m_currentNodeFocus=node;
};
CCognosViewer.prototype.getCurrentNodeFocus=function(node){
return this.m_currentNodeFocus;
};
CCognosViewer.prototype.loadExtra=function(){
};
CCognosViewer.prototype.setRetryDispatcherEntry=function(_65e){
this.m_retryDispatcherEntry=_65e;
};
CCognosViewer.prototype.getRetryDispatcherEntry=function(){
return this.m_retryDispatcherEntry;
};
CCognosViewer.prototype.resetViewerDispatcher=function(){
if(this.m_viewerDispatcher!==null){
delete this.m_viewerDispatcher;
this.m_viewerDispatcher=new ViewerDispatcher();
}
};
CCognosViewer.prototype.getViewerDispatcher=function(){
return this.m_viewerDispatcher;
};
CCognosViewer.prototype.setFaultDispatcherEntry=function(_65f){
this.m_faultDispatcherEntry=_65f;
};
CCognosViewer.prototype.getFaultDispatcherEntry=function(){
return this.m_faultDispatcherEntry;
};
CCognosViewer.prototype.dispatchRequest=function(_660){
this.setFaultDispatcherEntry(null);
this.getViewerDispatcher().dispatchRequest(_660);
};
CCognosViewer.prototype.getActiveRequest=function(){
return this.getViewerDispatcher().getActiveRequest();
};
CCognosViewer.prototype.getProductLocale=function(){
if(this.sProductLocale){
return this.sProductLocale;
}
return "en";
};
CCognosViewer.prototype.getDirection=function(){
if(this.sDirection){
return this.sDirection;
}
return "ltr";
};
CCognosViewer.prototype.isBidiEnabled=function(){
if(this.bIsBidiEnabled){
return true;
}
return false;
};
CCognosViewer.prototype.getBaseTextDirection=function(){
if(this.isBidiEnabled()){
if(this.sBaseTextDirection){
return this.sBaseTextDirection;
}
}
return "";
};
CCognosViewer.prototype.getActionFactory=function(){
if(!this.m_actionFactory){
this.m_actionFactory=new ActionFactory(this);
}
return this.m_actionFactory;
};
CCognosViewer.prototype.getAction=function(_661){
var _661=this.getActionFactory().load(_661);
_661.setCognosViewer(this);
return _661;
};
CCognosViewer.prototype.getCalculationCache=function(){
return this.m_calculationCache;
};
CCognosViewer.prototype.updateOutputForA11ySupport=function(){
this.updateBorderCollapse();
if(this.getA11YHelper()){
this.getA11YHelper().addLabelledByForItemsOutsideOfContainers();
}
var _662=navigator.userAgent.toLowerCase();
var _663=_662.indexOf("iphone")!=-1;
var _664=_662.indexOf("ipod")!=-1;
var _665=_662.indexOf("ipad")!=-1;
var _666=_663||_664||_665;
var _667=_662.indexOf("android")!=-1;
if(_666||_667){
document.body.classList.add("clsViewerMobile");
}
};
CCognosViewer.prototype.checkForHighContrast=function(){
if(this.isBux){
this.m_bHighContrast=dojo.hasClass(document.body,"dijit_a11y")?true:false;
}else{
var _668=document.createElement("div");
_668.id=this.m_sId+"hc";
_668.style.border="1px solid";
_668.style.borderColor="red green";
_668.style.height="10px";
_668.style.top="-999px";
_668.style.position="absolute";
document.body.appendChild(_668);
var _669=null;
if(isIE()){
_669=_668.currentStyle;
}else{
_669=_668.ownerDocument.defaultView.getComputedStyle(_668,null);
}
if(!_669){
return;
}
this.m_bHighContrast=_669.borderTopColor==_669.borderRightColor;
document.body.removeChild(_668);
}
};
CCognosViewer.prototype.isHighContrast=function(){
if(typeof this.m_bHighContrast==="undefined"){
this.checkForHighContrast();
}
return this.m_bHighContrast;
};
CCognosViewer.prototype.isLimitedInteractiveMode=function(){
return this.envParams&&this.envParams.limitedInteractiveMode&&this.envParams.limitedInteractiveMode==="true";
};
CCognosViewer.prototype.updateBorderCollapse=function(){
if(this.isHighContrast()==true){
var _66a=null;
if(this.envParams["ui.action"]=="view"&&!this.isBux){
var _66b=document.getElementById("CVIFrame"+this.getId());
_66a=_66b.contentWindow.document;
}else{
_66a=document.getElementById("CVReport"+this.getId());
}
var _66c=_66a.getElementsByTagName("table");
for(var i=0;i<_66c.length;i++){
if(_66c[i].style.borderCollapse=="collapse"){
_66c[i].style.borderCollapse="separate";
}
}
}
};
CCognosViewer.prototype.isAccessibleMode=function(){
if(this.m_bAccessibleMode==true){
return true;
}
return false;
};
CCognosViewer.prototype.isSinglePageReport=function(){
for(var _66e in this.m_aSecRequests){
if(this.m_aSecRequests[_66e]=="nextPage"||this.m_aSecRequests[_66e]=="previousPage"){
return false;
}
}
return true;
};
CCognosViewer.prototype.hasNextPage=function(){
for(var _66f in this.m_aSecRequests){
if(this.m_aSecRequests[_66f]=="nextPage"){
return true;
}
}
return false;
};
CCognosViewer.prototype.hasPrevPage=function(){
for(var _670 in this.m_aSecRequests){
if(this.m_aSecRequests[_670]=="previousPage"){
return true;
}
}
return false;
};
CCognosViewer.prototype.captureHotkeyPageNavigation=function(evt){
evt=(evt)?evt:((event)?event:null);
if(evt){
var node=getNodeFromEvent(evt);
var _673=(node&&node.nodeName)?node.nodeName.toLowerCase():null;
if((evt.keyCode==8&&_673!="input"&&_673!="textarea")||(evt.altKey==true&&(evt.keyCode==37||evt.keyCode==39))){
evt.returnValue=false;
evt.cancelBubble=true;
if(typeof evt.stopPropagation!="undefined"){
evt.stopPropagation();
}
if(typeof evt.preventDefault!="undefined"){
evt.preventDefault();
}
return false;
}
}
return true;
};
CCognosViewer.prototype.setUseWorkingDialog=function(_674){
this.m_bUseWorkingDialog=_674;
};
CCognosViewer.prototype.getWorkingDialog=function(){
if(!this.m_oWorkingDialog&&this.m_bUseWorkingDialog&&typeof WorkingDialog!=="undefined"){
if(this.getConfig()&&this.getConfig().getHttpRequestConfig()&&this.getConfig().getHttpRequestConfig().getWorkingDialog()){
this.m_oWorkingDialog=this.getConfig().getHttpRequestConfig().getWorkingDialog();
}else{
this.m_oWorkingDialog=new WorkingDialog(this);
}
}
return this.m_oWorkingDialog;
};
CCognosViewer.prototype.getRequestIndicator=function(){
if(this.m_bUseWorkingDialog&&!this.m_oRequestExecutedIndicator&&typeof RequestExecutedIndicator!=="undefined"){
if(this.getConfig()&&this.getConfig().getHttpRequestConfig()&&this.getConfig().getHttpRequestConfig().getRequestIndicator()){
this.m_oRequestExecutedIndicator=this.getConfig().getHttpRequestConfig().getRequestIndicator();
}else{
this.m_oRequestExecutedIndicator=new RequestExecutedIndicator(this);
}
}
return this.m_oRequestExecutedIndicator;
};
CCognosViewer.prototype.disableBrowserHotkeyPageNavigation=function(){
if(document.attachEvent){
document.attachEvent("onkeydown",this.captureHotkeyPageNavigation);
}else{
if(document.addEventListener){
document.addEventListener("keydown",this.captureHotkeyPageNavigation,false);
}
}
};
CCognosViewer.prototype.setHasPrompts=function(_675){
if(!_675){
this.preProcessControlArray=[];
}
this.m_bReportHasPrompts=_675;
};
CCognosViewer.prototype.getHasPrompts=function(){
return this.m_bReportHasPrompts;
};
CCognosViewer.prototype.setUsePageRequest=function(_676){
this.m_viewerDispatcher.setUsePageRequest(_676);
};
CCognosViewer.prototype.getUsePageRequest=function(){
return this.m_viewerDispatcher.getUsePageRequest();
};
CCognosViewer.prototype.setKeepSessionAlive=function(_677){
this.m_bKeepSessionAlive=_677;
};
CCognosViewer.prototype.getKeepSessionAlive=function(){
return this.m_bKeepSessionAlive;
};
CCognosViewer.prototype.getWebContentRoot=function(){
if(typeof this.sWebContentRoot!="undefined"){
return this.sWebContentRoot;
}else{
return "..";
}
};
CCognosViewer.prototype.getSkin=function(){
if(typeof this.sSkin!="undefined"){
return this.sSkin;
}else{
return this.getWebContentRoot()+"/skins/corporate";
}
};
CCognosViewer.prototype.getSelectionController=function(){
var _678;
try{
_678=getCognosViewerSCObjectRef(this.m_sId);
}
catch(e){
_678=null;
}
return _678;
};
CCognosViewer.prototype.addCallback=function(_679,oFct,_67b){
if(!this.m_aCallback){
this.m_aCallback=[];
}
this.m_aCallback=this.m_aCallback.concat({m_sEvent:_679,m_oCallback:oFct,m_bCaptureEvent:(_67b===true)});
};
CCognosViewer.prototype.canDrillDown=function(sId){
var sCtx=this.findCtx(sId).split("::")[0];
if(sCtx){
var _67e=this.getSelectionController();
if(_67e){
return (_67e.canDrillDown(sCtx));
}
}
return false;
};
CCognosViewer.prototype.canDrillUp=function(sId){
var sCtx=this.findCtx(sId).split("::")[0];
if(sCtx){
var _681=this.getSelectionController();
if(_681){
return (_681.canDrillUp(sCtx));
}
}
return false;
};
CCognosViewer.prototype.canSubmitPrompt=function(){
var _682=null;
if(this.preProcessControlArray&&this.preProcessControlArray instanceof Array){
var _683=this.preProcessControlArray.length;
for(var k=0;k<_683;k++){
_682=eval(this.preProcessControlArray[k]);
if(_682.isValid()===false){
if(!this.m_reportRenderingDone||!_682.getCascadeOnParameter||!_682.getCascadeOnParameter()){
return false;
}
}
}
}
return true;
};
CCognosViewer.prototype.closeContextMenuAndToolbarMenus=function(){
if(this.rvMainWnd){
this.rvMainWnd.closeContextMenuAndToolbarMenus();
}
};
CCognosViewer.prototype.dcm=function(_685,_686){
if(this.canDisplayContextMenu()){
if(this.preSelectNode==true){
_686=false;
this.preSelectNode=false;
}
if(this.rvMainWnd.displayContextMenu(_685,_686)!=false){
return stopEventBubble(_685);
}
}
};
CCognosViewer.prototype.canDisplayContextMenu=function(){
if(!this.getUIConfig()||this.getUIConfig().getShowContextMenu()){
return (!this.isWorkingOrPrompting()&&this.rvMainWnd!=null&&typeof this.bCanUseCognosViewerContextMenu!="undefined"&&this.bCanUseCognosViewerContextMenu);
}
return false;
};
CCognosViewer.prototype.de=function(_687){
var _688=this.getDrillMgr();
if(_688){
_688.singleClickDrillEvent(_687,"RV");
}
};
CCognosViewer.prototype.debug=function(sMsg){
if(this.m_bDebug){
var _68a="";
var _68b=this.debug.caller;
if(typeof _68b=="object"&&_68b!==null){
_68a=_68b.toString().match(/function (\w*)/)[1];
}
if(!_68a){
_68a="?";
}
alert(_68a+": "+sMsg);
}
};
CCognosViewer.prototype.callbackExists=function(_68c){
var _68d=false;
if(this.m_aCallback&&this.m_aCallback.length){
for(var _68e=0;_68e<this.m_aCallback.length;++_68e){
var oCB=this.m_aCallback[_68e];
if(oCB.m_sEvent==_68c){
return true;
}
}
}
return false;
};
CCognosViewer.prototype.executeCallback=function(_690){
var _691=false;
if(this.m_aCallback&&this.m_aCallback.length){
for(var _692=0;_692<this.m_aCallback.length;++_692){
var oCB=this.m_aCallback[_692];
if(oCB.m_sEvent==_690){
if(typeof oCB.m_oCallback=="function"){
oCB.m_oCallback();
}
if(oCB.m_bCaptureEvent){
_691=true;
}
}
}
}
return _691;
};
CCognosViewer.prototype.getCAFContext=function(){
return this.m_sCAFContext;
};
CCognosViewer.prototype.getSoapFault=function(){
return this.m_sSoapFault;
};
CCognosViewer.prototype.getColumnContextIds=function(sId){
return this.getContextIds(sId,2);
};
CCognosViewer.prototype.getConversation=function(){
return this.m_sConversation;
};
CCognosViewer.prototype.getStatus=function(){
return (this.m_sStatus?this.m_sStatus:"");
};
CCognosViewer.prototype.isWorking=function(_695){
if(typeof _695!="string"){
_695=this.getStatus();
}
return ((""+_695).match(/^(working|stillWorking)$/)?true:false);
};
CCognosViewer.prototype.isWorkingOrPrompting=function(){
return (this.getStatus().match(/^(working|stillWorking|prompting)$/)?true:false);
};
CCognosViewer.prototype.getActionState=function(){
return this.m_sActionState;
};
CCognosViewer.prototype.getDataItemName=function(sId){
var _697=null;
var sCtx=this.findCtx(sId).split("::")[0];
if(sCtx){
var _699=this.getSelectionController();
if(_699){
var _69a=_699.getRefDataItem(sCtx);
if(_69a){
_697=_69a;
}
}
}
return _697;
};
CCognosViewer.prototype.getDataType=function(sId){
var _69c=null;
var sCtx=this.findCtx(sId).split("::")[0];
if(sCtx){
var _69e=this.getSelectionController();
if(_69e){
var _69f=_69e.getDataType(sCtx);
if(_69f){
_69c=_69f;
}
}
}
return _69c;
};
CCognosViewer.prototype.getDepth=function(sId){
var _6a1=null;
var sCtx=this.findCtx(sId).split("::")[0];
if(sCtx){
var _6a3=this.getSelectionController();
if(_6a3){
var _6a4=_6a3.getDepth(sCtx);
if(_6a4){
_6a1=_6a4;
}
}
}
return _6a1;
};
CCognosViewer.prototype.getDrillMgr=function(){
if(!this.m_oDrillMgr){
this.loadExtra();
if(typeof CDrillManager=="function"){
this.m_oDrillMgr=new CDrillManager(this);
this.goDrillManager=this.m_oDrillMgr;
}
}
return this.m_oDrillMgr;
};
CCognosViewer.prototype.getSubscriptionManager=function(){
if(!this.m_oSubscriptionManager){
this.loadExtra();
if(typeof CSubscriptionManager=="function"){
this.m_oSubscriptionManager=new CSubscriptionManager(this);
}
}
return this.m_oSubscriptionManager;
};
CCognosViewer.prototype.getExecutionParameters=function(){
return this.m_sParameters;
};
CCognosViewer.prototype.getGateway=function(){
return this.m_sGateway;
};
CCognosViewer.prototype.getSpecification=function(){
return this.envParams["ui.spec"];
};
CCognosViewer.prototype.getHierarchyUniqueName=function(sId){
var sHun=null;
var sCtx=this.findCtx(sId).split("::")[0];
if(sCtx){
var _6a8=this.getSelectionController();
if(_6a8){
var aHUN=_6a8.getHun(sCtx);
if(aHUN){
sHun=aHUN;
}
}
}
return sHun;
};
CCognosViewer.prototype.getDimensionUniqueName=function(sId){
var sCtx=this.findCtx(sId).split("::")[0];
if(sCtx){
var _6ac=this.getSelectionController();
if(_6ac){
var aDUN=_6ac.getDun(sCtx);
if(aDUN){
return aDUN;
}
}
}
return null;
};
CCognosViewer.prototype.getId=function(){
return this.m_sId;
};
CCognosViewer.prototype.getLevelId=function(sId){
var _6af=null;
var sCtx=this.findCtx(sId).split("::")[0];
if(sCtx){
var _6b1=this.getSelectionController();
if(_6b1){
var aLUN=_6b1.getLun(sCtx);
if(aLUN){
_6af=aLUN;
}
}
}
return _6af;
};
CCognosViewer.prototype.getMemberUniqueName=function(sId){
var sMUN=null;
var sCtx=this.findCtx(sId).split("::")[0];
if(sCtx){
var _6b6=this.getSelectionController();
if(_6b6){
var aMUN=_6b6.getMun(sCtx);
if(aMUN){
sMUN=aMUN;
}
}
}
return sMUN;
};
CCognosViewer.prototype.getObjectId=function(){
var _6b8="window";
if(typeof this.getId()=="string"){
_6b8=getCognosViewerObjectRefAsString(this.getId());
}
return _6b8;
};
CCognosViewer.prototype.getQueryModelId=function(sId){
var _6ba=null;
var sCtx=this.findCtx(sId).split("::")[0];
if(sCtx){
var _6bc=this.getSelectionController();
if(_6bc){
var _6bd=_6bc.getQueryModelId(sCtx);
if(_6bd){
_6ba=_6bd;
}
}
}
return _6ba;
};
CCognosViewer.prototype.getQueryName=function(sId){
var _6bf=null;
var sCtx=this.findCtx(sId).split("::")[0];
if(sCtx){
var _6c1=this.getSelectionController();
if(_6c1){
var _6c2=_6c1.getRefQuery(sCtx);
if(_6c2){
_6bf=_6c2;
}
}
}
return _6bf;
};
CCognosViewer.prototype.getContextIds=function(sId,_6c4){
var aIds=[];
var sCtx=this.findCtx(sId);
if(sCtx){
var _6c7=sCtx.split("::");
if(_6c7&&_6c7.length>1&&_6c4<_6c7.length){
aIds=_6c7[_6c4].split(":");
}
}
return aIds;
};
CCognosViewer.prototype.getRowContextIds=function(sId){
return this.getContextIds(sId,1);
};
CCognosViewer.prototype.getPageContextIds=function(sId){
return this.getContextIds(sId,3);
};
CCognosViewer.prototype.getString=function(sKey){
if(RV_RES&&RV_RES[sKey]){
return RV_RES[sKey];
}
return sKey;
};
CCognosViewer.prototype.getRV=function(){
if(typeof this.m_oCVMgr=="object"){
return this.m_oCVMgr;
}
return window;
};
CCognosViewer.prototype.getSecondaryRequests=function(){
return this.m_aSecRequests;
};
CCognosViewer.prototype.getTracking=function(){
return this.m_sTracking;
};
CCognosViewer.prototype.findCtx=function(sId){
var sCtx="";
if(typeof sId=="string"){
var aCtx=this.getReportContextHelper().processCtx(sId);
var _6ce=aCtx[0][0];
var _6cf=this.getSelectionController();
if(_6cf){
if(_6cf.isContextId(_6ce)){
sCtx=sId;
}
}
}
if(!sCtx){
var _6d0=this.findElementWithCtx(sId);
if(_6d0){
sCtx=_6d0.getAttribute("ctx");
}
}
return sCtx;
};
CCognosViewer.prototype.findElementWithCtx=function(sId){
var _6d2=sId;
if(typeof sId=="string"){
_6d2=this.findElementWithCtx(document.getElementById(sId));
}
if(_6d2){
if(_6d2.getAttribute&&_6d2.getAttribute("ctx")){
return _6d2;
}
for(var _6d3=0;_6d3<_6d2.childNodes.length;_6d3++){
var _6d4=this.findElementWithCtx(_6d2.childNodes[_6d3]);
if(_6d4){
return _6d4;
}
}
}
return null;
};
CCognosViewer.prototype.getUseValue=function(sId){
var sVal=null;
var sCtx=this.findCtx(sId).split("::")[0];
if(sCtx){
var _6d8=this.getSelectionController();
if(_6d8){
sVal=_6d8.getUseValue(sCtx);
}
}
return sVal;
};
CCognosViewer.prototype.init=function(_6d9){
if(_6d9&&typeof _6d9=="object"){
for(var _6da in _6d9){
this[_6da]=_6d9[_6da];
}
}
};
CCognosViewer.prototype.initViewer=function(_6db){
var _6dc=new RequestHandler(this);
var _6dd=document.getElementById("formBackJax"+this.getId());
if(_6dd&&typeof _6dd.state!="undefined"&&_6dd.state.value.length>0){
_6dc.loadReportHTML(_6dd.result.value);
var _6de=eval("("+_6dd.state.value+")");
_6dc.updateViewerState(_6de);
_6dc.postComplete();
}else{
if(this.getUsePageRequest()){
var _6df=_6db?_6db.m_sStatus:null;
if(isIE()){
if(window.location.hash=="#working"){
window.history.go(-2);
return;
}else{
if(_6df==="working"||_6df==="stillWorking"){
window.location.hash="#working";
}
}
}else{
if(_6dd&&_6dd.working){
if(_6dd.working.value=="true"){
window.history.go(-1);
return;
}else{
if(_6df==="working"||_6df==="stillWorking"){
_6dd.working.value="true";
}
}
}
}
}
_6dc.processInitialResponse(_6db);
}
};
CCognosViewer.prototype.saveBackJaxInformation=function(_6e0){
var _6e1=document.getElementById("formBackJax"+this.getId());
if(_6e1){
if(typeof _6e1.state!="undefined"){
_6e1.state.value=_6e0.getResponseStateText();
}
if(typeof _6e1.result!="undefined"){
_6e1.result.value=_6e0.getResult();
}
}
};
CCognosViewer.prototype.pcc=function(evt){
if(evt&&typeof evt.button!="undefined"&&evt.button!="1"){
this.preSelectNode=true;
var _6e3=this.getSelectionController();
if(_6e3){
_6e3.pageContextClicked(evt);
}
}
};
CCognosViewer.prototype.isValidAjaxResponse=function(_6e4){
return (_6e4&&_6e4.childNodes&&_6e4.childNodes.length>0&&_6e4.childNodes[0].nodeName!="parsererror"?true:false);
};
CCognosViewer.prototype.resubmitInSafeMode=function(_6e5){
if(this.m_bUseSafeMode){
this.resetViewerDispatcher();
this.setUsePageRequest(true);
this.envParams["cv.useAjax"]="false";
if(_6e5){
_6e5.retryRequest();
}
}
};
CCognosViewer.prototype.showLoadedContent=function(_6e6){
if(_6e6!==null&&typeof _6e6!="undefined"){
_6e6.style.display="block";
}
this.m_resizeReady=true;
this.doneLoading();
var obj=this;
setTimeout(function(){
obj.renderTabs();
},1);
};
CCognosViewer.prototype.doneLoading=function(){
var _6e8=this.getViewerWidget();
if(_6e8){
if(window.IBM&&window.IBM.perf){
window.IBM.perf.log("viewer_doneLoading",this);
}
var _6e9=this.getStatus();
if(!this.m_reportRenderingDone&&this.m_resizeReady&&this.m_stateSet){
var _6ea=_6e9=="working"||_6e9=="stillWorking"||_6e9=="fault";
_6e8.fireEvent("com.ibm.bux.widget.render.done",null,{noAutoResize:_6ea});
if(_6e9=="complete"){
if(window.IBM&&window.IBM.perf){
window.IBM.perf.log("viewer_doneLoading",this);
}
if(typeof _6e8.postLoadContent=="function"){
_6e8.postLoadContent();
}
this.m_reportRenderingDone=true;
if(!_6ea){
var _6eb=this;
setTimeout(function(){
_6eb.m_readyToRespondToResizeEvent=true;
},20);
}
}
}
if(_6e9!="fault"){
_6e8.clearErrorDlg();
}
this.doneLoadingUpdateA11Y(_6e9);
}else{
var _6e9=this.getStatus();
if(_6e9=="complete"){
this.m_reportRenderingDone=true;
this.JAWSTalk(RV_RES.IDS_JS_READY);
}else{
if(_6e9=="working"){
this.JAWSTalk(RV_RES.IDS_JS_WAIT_PAGE_LOADING);
}
}
}
};
CCognosViewer.prototype.doneLoadingUpdateA11Y=function(_6ec){
if(this.getKeepFocus()!==false&&this.getKeepFocus()!=null){
var _6ed=this.getKeepFocus();
if(_6ec=="complete"){
this.setKeepFocus(false);
}
var _6ee=null;
if(this.getVisibleDialog()!==null){
_6ee=this.getVisibleDialog().getDialogDiv();
}else{
if(_6ed===true){
_6ee=document.getElementById("CVReport"+this.getId());
}else{
if(typeof _6ed=="string"){
_6ee=document.getElementById(_6ed);
}else{
if(_6ed!==null){
_6ee=_6ed;
if(this.isBux){
dojo.window.scrollIntoView(_6ee);
}
}
}
}
}
if(_6ee){
setFocusToFirstTabItem(_6ee);
}
if(_6ec=="complete"){
this.JAWSTalk(RV_RES.IDS_JS_READY);
}else{
if(_6ec=="working"||_6ec=="stillWorking"){
this.JAWSTalk(RV_RES.IDS_JS_WAIT_PAGE_LOADING);
}
}
}
};
CCognosViewer.prototype.JAWSTalk=function(_6ef){
if(this.isMobile()||this.isIWidgetMobile()){
return;
}
var id=this.getId();
var div=document.getElementById("JAWS_Alert_"+id);
if(div){
div.parentNode.removeChild(div);
}
div=document.createElement("div");
div.id="JAWS_Alert_"+id;
div.style.position="absolute";
div.style.top="-9000px";
div.style.display="none";
div.setAttribute("role","alert");
div.appendChild(document.createTextNode(_6ef));
var _6f2=document.getElementById("RVContent"+id);
if(_6f2){
_6f2.appendChild(div);
}else{
if(typeof console!="undefined"&&console&&console.log){
console.log("CCognosViewer: Could not find the Viewer div to append the JAWS alert.");
}
}
};
CCognosViewer.prototype.canInsertExpandIconsForAllCrosstabs=function(){
if(this.isLimitedInteractiveMode()||this.isBlacklisted("ExpandMember")||this.isIWidgetMobile()){
return false;
}
var _6f3=this.getAdvancedServerProperty("VIEWER_JS_EXPAND_COLLAPSE_CONTROLS_DEFAULT");
if(_6f3===null){
return false;
}
var _6f4=this.getViewerWidget().getProperties().getShowExpandCollapseIconFlag();
return (_6f3.toLowerCase()==="on"&&_6f4!==false)||(_6f3.toLowerCase()==="off"&&_6f4===true);
};
CCognosViewer.prototype.setMaxContentSize=function(){
if("10"!=window.getIEVersion()){
return;
}
if(document.body.className==="viewer"){
var _6f5=document.body.offsetHeight;
var _6f6=this.getNonReportHeight(document.getElementById("CVReport"+this.getId()));
var _6f7=document.getElementById("mainViewerTable"+this.getId());
_6f7.style.maxHeight=_6f5-_6f6-2+"px";
var _6f8=GUtil.generateCallback(this.setMaxContentSize,[true],this);
if(!this.attachedOnResize){
this.attachedOnResize=true;
if(window.attachEvent){
window.attachEvent("onresize",_6f8);
}else{
if(window.addEventListener){
window.addEventListener("resize",_6f8,false);
}
}
}
}
};
CCognosViewer.prototype.getNonReportHeight=function(node){
var _6fa=0;
var _6fb=node.parentNode;
if(!_6fb){
return _6fa;
}
if(_6fb.childNodes.length>1){
for(var i=0;i<_6fb.childNodes.length;i++){
var _6fd=_6fb.childNodes[i];
if(_6fd!=node&&!isNaN(_6fd.clientHeight)&&_6fd.style.display!="none"){
_6fa+=_6fd.clientHeight;
}
}
}
if(node.getAttribute("id")!=("mainViewerTable"+this.m_viewerId)){
_6fa+=this.getNonReportHeight(_6fb);
}
return _6fa;
};
CCognosViewer.prototype.addPageAdornments=function(){
this.m_layoutElements=null;
this.m_lidToElement=null;
this.initFlashCharts();
this.insertSortIconsForAllLists();
var _6fe=this.getViewerWidget().getProperties();
if(this.canInsertExpandIconsForAllCrosstabs()){
this.insertExpandIconsForAllCrosstabs();
}
var _6ff=document.getElementById("CVReport"+this.getId());
if(_6ff){
var oCV=this;
setTimeout(function(){
if(oCV.getPinFreezeManager()&&oCV.getPinFreezeManager().hasFrozenContainers()){
oCV.getPinFreezeManager().renderReportWithFrozenContainers(_6ff);
}
oCV.addInfoBar();
},1);
}
this.getViewerWidget().reselectSelectionFilterObjects();
this.getViewerWidget().addChromeWhitespaceHandler(this.getId());
};
CCognosViewer.prototype.addFlashChart=function(_701){
this.m_flashChartsObjectIds.push(_701);
};
CCognosViewer.prototype.flashChartError=function(_702){
var _703=this.getViewerWidget();
var _704=_703.getProperties();
_704.setProperty("flashCharts",false);
var _705=this.getAction("Redraw");
_705.isUndoable=function(){
return false;
};
_705.execute();
};
CCognosViewer.prototype.initFlashCharts=function(){
var _706=this.getViewerWidget();
if(this.m_flashChartsObjectIds.length>0){
var _707=document.getElementById("rt"+this.getId());
if(window.addEventListener){
_707.addEventListener("mousedown",onFlashChartRightClick,true);
}else{
var _708={};
var _709=function(){
this.releaseCapture();
};
var _70a=function(){
onFlashChartRightClick(event);
this.setCapture();
};
for(var i=0;i<this.m_flashChartsObjectIds.length;++i){
var _70c=this.m_flashChartsObjectIds[i];
var _70d=document.getElementById(_70c);
_708[_70c]=1;
_70d.parentNode.onmouseup=_709;
_70d.parentNode.onmousedown=_70a;
}
if(this.m_flashChartsObjectIds.length>0){
_707.attachEvent("oncontextmenu",function(){
if(_708[window.event.srcElement.id]){
return false;
}
});
}
}
if(_706){
_706.fireEvent("com.ibm.bux.widget.setShowBordersWhenInnactive",null,true);
}
}else{
if(_706){
_706.fireEvent("com.ibm.bux.widget.setShowBordersWhenInnactive",null,false);
}
}
};
CCognosViewer.prototype.initializeLayoutElements=function(){
var _70e=document.getElementById("rt"+this.getId());
var _70f=getElementsByAttribute(_70e,"*","lid");
this.m_lidToElement={};
this.m_layoutElements=[];
var _710=0;
var _711=this.getPinFreezeManager();
for(var i=0;i<_70f.length;i++){
var e=_70f[i];
if(!_711||!_711.getContainerElement(e)||_711.isElementInMainOutput(e)){
this.m_layoutElements[_710]=e;
this.m_lidToElement[e.getAttribute("lid")]=e;
_710++;
}
}
};
CCognosViewer.prototype.getLayoutElement=function(_714){
if(!this.m_layoutElements){
this.initializeLayoutElements();
}
if(this.m_layoutElements){
return this.m_layoutElements[_714];
}
return null;
};
CCognosViewer.prototype.getLayoutElementFromLid=function(lid){
if(!this.m_lidToElement){
this.initializeLayoutElements();
}
return this.m_lidToElement[lid];
};
CCognosViewer.prototype.getInfoBars=function(){
return this.m_aInfoBar?this.m_aInfoBar:null;
};
CCognosViewer.prototype.addInfoBar=function(){
if(this.getAdvancedServerProperty("VIEWER_JS_HIDE_INFO_BAR")==="true"){
return;
}
var _716=this.getRAPReportInfo();
if(_716){
var _717=document.getElementById("rt"+this.getId());
this.initializeLayoutElements();
var _718=[];
this.m_aInfoBar=[];
for(var _719=0;_719<this.m_layoutElements.length;++_719){
var _71a=this.m_layoutElements[_719];
var lid=_71a.getAttribute("lid");
if(lid){
if(lid.indexOf("RAP_NDH_")>-1){
lid=lid.substring(8);
}
lid=lid.substring(0,lid.indexOf(this.getId()));
}
var _71c=_716.getContainer(lid);
if(_71c&&typeof _71c.parentContainer=="undefined"){
var _71d=this.collectChildContainers(_71c.container);
if(this.getPinFreezeManager()){
oPinFreezeContainerElement=this.getPinFreezeManager().getContainerElement(_71a);
_71a=(oPinFreezeContainerElement)?oPinFreezeContainerElement:_71a;
}
var _71e=new InfoBar(this,_71a,_71c,_71d,_719);
_71e.setTimingDetails(_716._getEventTimings());
_71e.render();
if(_71e.hasSomethingRendered()){
_718.push(_71e.getId());
}
this.m_aInfoBar.push(_71e);
}
}
var _71f=this.getViewerWidget();
if(_71f){
_71f.refreshInfoBarRenderedState(_718);
}
}
};
CCognosViewer.prototype.collectChildContainers=function(_720){
var _721=[];
var _722=this.getRAPReportInfo();
if(_722){
var _723=_722.getContainerCount();
for(var cidx=0;cidx<_723;++cidx){
var _725=_722.getContainerFromPos(cidx);
if(typeof _725.parentContainer!="undefined"&&_725.parentContainer==_720){
_721.push(_725);
}
}
}
return _721;
};
CCognosViewer.prototype.addReportInfo=function(){
var _726=this.getViewerWidget();
if(typeof _726==="undefined"||_726===null){
return;
}
if(!_726.getAttributeValue("originalReport")||this.isIWidgetMobile()){
return;
}
var _727=this.envParams["baseReportModificationTime"];
var _728=_726.getAttributeValue("baseReportModificationTime");
if(typeof _727!=="undefined"&&typeof _728!=="undefined"&&_728&&_728!="<empty>"&&_727!==_728){
var cvid=this.getId();
var _72a=document.getElementById("CVReport"+cvid);
var _72b=_72a.parentNode;
var id="ReportInfo"+cvid;
var _72d=document.createElement("div");
_72d.setAttribute("id",id+"_container");
_72d.setAttribute("cvid",cvid);
_72d.className="new-info-indicator BUXNoPrint";
var _72e=document.createElement("img");
var img=null;
if(this.getDirection()==="rtl"){
img="/rv/images/action_show_info_rtl.png";
}else{
img="/rv/images/action_show_info.png";
}
_72e.src=this.getWebContentRoot()+img;
_72e.className="reportInfoIcon";
_72e.setAttribute("tabIndex","0");
_72e.setAttribute("alt","");
_72e.setAttribute("title","");
_72e.setAttribute("role","presentation");
var _730=RV_RES.IDS_JS_REPORT_INFO_TITLE;
var _731=RV_RES.IDS_JS_REPORT_INFO_TEXT;
var _732=RV_RES.IDS_JS_REPORT_INFO_LINK_TEXT;
_72d.appendChild(_72e);
_72b.insertBefore(_72d,_72a);
this.m_reportInfoTooltip=new bux.reportViewer.ReportInfo({connectId:[id+"_container"],focusElement:_72e,position:["above","below"],title:_730,text:_731,linkText:_732,linkScript:getCognosViewerObjectRefAsString(cvid)+".reportInfoResetReport();",allowMouseOverToolTip:true});
}
};
CCognosViewer.prototype.reportInfoResetReport=function(){
this.executeAction("ResetToOriginal");
};
CCognosViewer.prototype.hideReportInfo=function(){
var _733=document.getElementById("ReportInfo"+this.getId()+"_container");
if(typeof _733!=="undefined"&&_733!==null){
_733.style.visibility="hidden";
}
};
CCognosViewer.prototype.insertSortIcons=function(){
var _734=this.envParams?this.envParams.limitedInteractiveMode:true;
if(typeof _734==="undefined"||_734===true){
return;
}
if(this.envParams["ui.action"]==="run"||this.envParams["ui.primaryAction"]==="run"){
this.insertSortIconsForAllLists();
}
};
CCognosViewer.prototype._getContainers=function(_735){
var _736=[];
var _737="",_738="";
if(_735==="list"){
_737="list";
_738="ls";
}else{
if(_735==="crosstab"){
_737="crosstab";
_738="xt";
}
}
var _739=document.getElementById("CVReport"+this.getId());
if(this.getRAPReportInfo()){
var _73a=this.getRAPReportInfo().getContainerIds(_737);
for(var i=0;i<_73a.length;++i){
var _73c=getElementsByAttribute(_739,"table","lid",_73a[i]+this.getId(),1);
if(_73c&&_73c.length>0){
_736.push(_73c[0]);
}
}
}else{
_736=getElementsByClassName(_739,"table",_738);
}
return _736;
};
CCognosViewer.prototype.insertSortIconsForAllLists=function(){
var _73d=this._getContainers("list");
for(var i=0;i<_73d.length;++i){
this.insertSortIconsToList(_73d[i]);
}
};
CCognosViewer.prototype.insertSortIconsToList=function(_73f){
var _740=getElementsByAttribute(_73f,"*","type","columnTitle");
for(var i=0;i<_740.length;++i){
var _742=_740[i];
this.getSelectionController().getSelectionObjectFactory().getSelectionObject(_742);
if(_742.getAttribute("canSort")!="false"&&_742.getAttribute("CTNM")===null&&_742.getAttribute("CC")===null){
var _743=false;
for(var _744=0;_744<_742.childNodes.length;_744++){
var _745=_742.childNodes[_744];
if(_745.nodeName.toLowerCase()=="img"){
if(_745.id&&_745.id.indexOf("sortimg")===0){
_743=true;
break;
}
var sLid=_745.getAttribute("lid");
if(sLid&&sLid.indexOf("SortIcon")!==-1){
_742.removeChild(_745);
break;
}
}
}
if(!_743&&this.canInsertSortIcon(_742)){
this.insertSortIconToColumnHeader(_742);
}
}
}
};
CCognosViewer.prototype.isDrillBlackListed=function(){
if(typeof this.m_bDrillBlacklisted=="undefined"){
this.m_bDrillBlacklisted=this.isBlacklisted("DrillDown")||this.isBlacklisted("DrillUp");
}
return this.m_bDrillBlacklisted;
};
CCognosViewer.prototype.isBlacklisted=function(item){
return this.UIBlacklist&&this.UIBlacklist.indexOf(" "+item+" ")>0;
};
CCognosViewer.prototype.canInsertSortIcon=function(_748){
var _749=_748.getAttribute("rp_sort");
return ((!this.isLimitedInteractiveMode()&&!this.isBlacklisted("Sort"))||(_749!==undefined&&_749!==null&&_749.length>0));
};
CCognosViewer.prototype.insertSortIconToColumnHeader=function(_74a){
if(!_74a.style.whiteSpace){
_74a.style.whiteSpace="nowrap";
}
var _74b=document.createElement("img");
_74b.setAttribute("id","sortimg"+Math.random());
if((!this.isLimitedInteractiveMode()&&!this.isBlacklisted("Sort"))){
_74b.onmouseover=function(){
this.setAttribute("oldClassName",this.className);
this.className+=" sortIconOver";
};
_74b.onmouseout=function(){
this.className=this.getAttribute("oldClassName");
this.removeAttribute("oldClassName");
};
}
_74b.src=this.getImgSrc(_74a);
var _74c=this.getSortInfo(_74a);
var _74d=this.getSortOrder(_74c);
_74b.setAttribute("alt",this.getSortAltText(_74d));
_74b.setAttribute("title",this.getSortAltText(_74d));
_74b.className=this.getSortClass(_74c);
_74b.setAttribute("sortOrder",_74d);
_74a.appendChild(_74b);
};
CCognosViewer.prototype.canInsertShowExpandCollapseIconForNode=function(_74e,_74f){
var _750=this.getSelectionController();
var _751=_750.hasCalculationMetadata(_74f,[_74f],"crosstab");
return ((_750.canDrillDown(_74f)||_74e.alwaysCanExpandCollapse)&&!_750.isCalculationOrMeasure(_74f,_751));
};
CCognosViewer.prototype.insertExpandIconsForAllCrosstabs=function(){
var _752=this._getContainers("crosstab");
var _753=this;
var _754=this.getRAPReportInfo();
var _755=this.getReportContextHelper();
for(var i=0;i<_752.length;i++){
var _757=_752[i];
var _758=_757.getAttribute("lid");
_758=_758.substring(0,_758.length-this.getId().length);
var _759=getElementsByAttribute(_757,["td","th"],"ctnm","true");
for(var j=0;j<_759.length;j++){
var _75b=_759[j];
var sCtx=this.findCtx(_75b);
var _75d=_755.getDataItemName(sCtx);
if(_75d){
var _75e=_754.getItemInfo(_758,_75d);
var _75f=_755.processCtx(sCtx);
if(this.canInsertShowExpandCollapseIconForNode(_75e,_75f[0][0])){
var sMun=_755.getMun(sCtx);
var _761=sMun&&_75e.expandedMembers&&_75e.expandedMembers[sMun]===true;
var _762=document.createElement("div");
_762.setAttribute("skipSelection","true");
_762.className="expandButton "+(_761?"collapse":"expand");
_75b.insertBefore(_762,_75b.firstChild);
var _763=document.createElement("span");
_763.className="expandButtonCaption";
_763.innerHTML=(_761?"[-]":"[+]");
_762.appendChild(_763);
}
}
}
}
};
CCognosViewer.prototype.removeExpandIconsForAllCrosstabs=function(){
var _764=this._getContainers("crosstab");
for(var i=0;i<_764.length;i++){
var _766=_764[i];
var _767=_766.getAttribute("lid");
_767=_767.substring(0,_767.length-this.getId().length);
var _768=getElementsByAttribute(_766,"td","ctnm","true");
for(var j=0;j<_768.length;j++){
var _76a=_768[j];
if(_76a.firstChild.className==="expandButton collapse"||_76a.firstChild.className==="expandButton expand"){
_76a.removeChild(_76a.firstChild);
}
}
}
};
CCognosViewer.prototype.fillInContextData=function(){
if(!this.isLimitedInteractiveMode()){
var _76b=document.getElementById("CVReport"+this.getId());
var _76c=getElementsByClassName(_76b,"table","ls");
for(var i=0;i<_76c.length;++i){
var _76e=getElementsByAttribute(_76c[i],"*","type","columnTitle");
for(var j=0;j<_76e.length;++j){
this.getSelectionController().getSelectionObjectFactory().getSelectionObject(_76e[j]);
}
}
}
};
CCognosViewer.prototype.getSortAltText=function(_770){
if(_770==="ascending"){
return RV_RES.IDS_JS_SORT_ASCENDING;
}else{
if(_770==="descending"){
return RV_RES.IDS_JS_SORT_DESCENDING;
}else{
if(_770==="nosort"){
return RV_RES.IDS_JS_NOT_SORTED;
}
}
}
};
CCognosViewer.prototype.getSortInfo=function(_771){
var _772=_771.getAttribute("rp_sort");
if(_772){
_772=_772.split(".");
}
return _772;
};
CCognosViewer.prototype.getSortClass=function(_773){
var _774="sortIconHidden";
if(_773){
if(_773[0]==="d"||_773[0]==="a"){
_774="sortIconVisible";
}
}
return _774;
};
CCognosViewer.prototype.getSortOrder=function(_775){
var _776="nosort";
if(_775){
if(_775[0]==="d"){
_776="descending";
}else{
if(_775[0]==="a"){
_776="ascending";
}
}
}
return _776;
};
CCognosViewer.prototype.getImgSrc=function(_777){
var _778=_777.getAttribute("rp_sort");
var src=this.getWebContentRoot()+"/rv/images/"+this.getSortIconName(_778);
return src;
};
CCognosViewer.prototype.getSortIconName=function(_77a){
var _77b="sort_no.gif";
if(_77a){
_77a=_77a.split(".");
if(_77a[0]==="d"){
_77b="sort_descending.gif";
}else{
if(_77a[0]==="a"){
_77b="sort_ascending.gif";
}
}
}
return _77b;
};
CCognosViewer.prototype.shouldWriteNavLinks=function(){
if(this.envParams["cv.navlinks"]=="false"){
return false;
}else{
if(!this.getUIConfig()||this.getUIConfig().getShowPageNavigation()){
if(this.rvMainWnd||(this.isBux&&!this.isActiveReport())){
return true;
}
}
}
return false;
};
CCognosViewer.prototype.isActiveReport=function(){
if(this.envParams["cv.responseFormat"]==="activeReport"){
return true;
}
return false;
};
CCognosViewer.prototype.resetRaiseSharePromptEventFlag=function(){
this.m_raiseSharePromptEvent=true;
};
CCognosViewer.prototype.resetbHasPromptFlag=function(){
this.m_bHasPrompt=null;
};
CCognosViewer.prototype.disableRaiseSharePromptEvent=function(){
this.m_raiseSharePromptEvent=false;
};
CCognosViewer.prototype.widgetHasPromptParameters=function(){
var _77c=this.getViewerWidget();
return (_77c&&_77c.promptParametersRetrieved==true&&this.envParams&&typeof this.envParams["reportPrompts"]!="undefined"&&this.envParams["reportPrompts"]!=null&&this.envParams["reportPrompts"].length>0);
};
CCognosViewer.prototype.getPromptParametersInfo=function(){
var _77d=null;
if(this.widgetHasPromptParameters()){
_77d="<widget><parameterValues>"+sXmlEncode(this.getExecutionParameters())+"</parameterValues>"+this.envParams["reportPrompts"]+"</widget>";
}
return _77d;
};
CCognosViewer.prototype.raisePromptEvent=function(_77e,_77f,_780){
try{
var _781=this.getViewerWidget();
_781.getWidgetContextManager().raisePromptEvent(_77e,_77f,_77f.get("ui.action"),this.getModelPath(),_780);
}
catch(e){
}
};
CCognosViewer.prototype.getModelPath=function(){
var _782=this.getSelectionController().getModelPathForCurrentSelection();
if(_782){
return _782;
}else{
if(this.envParams.modelPath){
return this.envParams.modelPath;
}else{
if(typeof document.forms["formWarpRequest"+this.getId()].modelPath!=="undefined"){
return document.forms["formWarpRequest"+this.getId()].modelPath.value;
}
}
}
return "";
};
CCognosViewer.prototype.setKeepFocus=function(_783){
this._keepFocus=_783;
};
CCognosViewer.prototype.getKeepFocus=function(){
if(typeof this._keepFocus!="undefined"){
return this._keepFocus;
}
return false;
};
CCognosViewer.prototype.onFocus=function(evt){
var _785=this.getA11YHelper();
if(_785){
_785.onFocus(evt);
}
};
CCognosViewer.prototype.getA11YHelper=function(){
if(!this.a11yHelper){
this.loadExtra();
if(typeof ViewerA11YHelper=="function"){
this.a11yHelper=new ViewerA11YHelper(this);
}else{
if(typeof console!=="undefined"&&console.log){
console.log("CCognosViewer: Could not create ViewerA11YHelper object.");
}
return null;
}
}
return this.a11yHelper;
};
CCognosViewer.prototype.onKeyDown=function(evt){
if(this.getA11YHelper()){
this.getA11YHelper().onKeyDown(evt);
}
};
CCognosViewer.prototype.updateSkipToReportLink=function(){
var _787=this.getStatus();
var _788=document.getElementById("cvSkipToReport"+this.getId());
if(_788){
_788.style.display=_787=="prompting"?"none":"";
}
};
CCognosViewer.prototype.updateSkipToNavigationLink=function(_789){
var _78a=document.getElementById("cvSkipToNavigation"+this.getId());
if(_78a){
_78a.style.display=_789?"none":"";
}
};
CCognosViewer.prototype.pageAction=function(_78b){
this.setKeepFocus("CVNavLinks"+this.getId());
var _78c=new ViewerDispatcherEntry(this);
_78c.addFormField("ui.action",_78b);
if(this.getCurrentlySelectedTab()){
_78c.addFormField("generic.anyURI.http://developer.cognos.com/ceba/constants/runOptionEnum#pageGroup",this.getCurrentlySelectedTab());
}
this.dispatchRequest(_78c);
};
CCognosViewer.prototype.writeNavLink=function(_78d,_78e,_78f,_790){
var _791="";
if(_78f){
_791="<td nowrap=\"nowrap\">"+"<img src=\"LINK_IMG\" width=\"15\" height=\"15\" alt=\"\" style=\"vertical-align:middle;\">"+"</td>"+"<td nowrap=\"nowrap\">";
if(_790){
_791+="<a href=\"#\" tabindex=\"0\" onclick=\""+getCognosViewerObjectRefAsString(this.getId())+".getViewerWidget().getSavedOutput().pageAction('LINK_REQUEST');return false;\"";
}else{
_791+="<a href=\"#\" tabindex=\"0\" onclick=\""+getCognosViewerObjectRefAsString(this.getId())+".pageAction('LINK_REQUEST');return false;\"";
}
_791+=">LINK_TEXT</a>&#160;"+"</td>";
}else{
_791="<td nowrap=\"nowrap\">"+"<img src=\"LINK_IMG\" width=\"15\" height=\"15\" alt=\"\" style=\"vertical-align:middle;\">"+"</td>"+"<td nowrap=\"nowrap\">LINK_TEXT&#160;</td>";
}
var sImg=this.sSkin+(!_78f&&_78d.sImgDisabled?_78d.sImgDisabled:_78d.sImg);
return _791.replace(/LINK_REQUEST/g,_78e).replace(/LINK_TEXT/g,_78d.sText).replace(/LINK_IMG/g,sImg);
};
CCognosViewer.prototype.loadNavLinks=function(){
var _793=window.gScriptLoader.loadFile(this.getGateway(),"b_action=xts.run&m=portal/report-viewer-navlinks.xts");
if(_793){
this.init(eval("("+_793+")"));
}
};
CCognosViewer.prototype.writeNavLinks=function(sSR,_795){
var _796=document.getElementById("CVNavLinks"+this.getId());
if(_796){
var _797=document.getElementById("CVNavLinks_Container"+this.getId());
if(typeof this.oNavLinks!="object"||typeof sSR!="string"||!sSR.match(/\bfirstPage\b|\bpreviousPage\b|\bnextPage\b|\blastPage\b|\bplayback\b/i)){
_796.style.display="none";
if(_797){
_797.style.display="none";
}
this.updateSkipToNavigationLink(true);
return;
}
this.updateSkipToNavigationLink(false);
if(_797){
_797.style.display="";
}
_796.style.display=(isIE()?"block":"table-cell");
var _798="";
_798+="<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" class=\"pageControls BUXNoPrint\" role=\"presentation\"><tbody><tr>";
_798+=this.writeNavLink(this.oNavLinks.oFirst,"firstPage",sSR.match(/\bfirstPage\b/gi),_795);
_798+=this.writeNavLink(this.oNavLinks.oPrevious,"previousPage",sSR.match(/\bpreviousPage\b/gi),_795);
_798+=this.writeNavLink(this.oNavLinks.oNext,"nextPage",sSR.match(/\bnextPage\b/gi),_795);
_798+=this.writeNavLink(this.oNavLinks.oLast,"lastPage",sSR.match(/\blastPage\b/gi),_795);
_798+="</tr></tbody></table>";
var _799=document.getElementById("CVNavLinks_label"+this.getId());
var _79a="";
if(_799){
_79a+="<span id=\"CVNavLinks_label"+this.getId()+"\" style=\"visibilty:hidden; display:none;\">"+_799.innerHTML+"</span>";
}
_796.innerHTML=_79a+_798;
}else{
if(this.shouldWriteNavLinks()){
setTimeout(getCognosViewerObjectRefAsString(this.getId())+".writeNavLinks(\""+sSR+"\",\""+_795+"\");",100);
}
}
};
function CVBackgroundLayer_ignoreMouseClick(e){
if(e.returnValue){
e.returnValue=false;
}else{
if(e.preventDefault){
e.preventDefault();
}else{
return false;
}
}
};
CCognosViewer.prototype.createTransparentBackgroundLayer=function(){
this.removeTransparentBackgroundLayer();
var oBL=document.createElement("div");
oBL.id=CV_BACKGROUND_LAYER_ID;
oBL.style.display="none";
oBL.style.position="absolute";
oBL.setAttribute("role","region");
oBL.setAttribute("aria-label",RV_RES.IDS_JS_A11Y_BACKGROUND_TINT);
oBL.style.top="0px";
oBL.style.left="0px";
oBL.style.zIndex=98;
oBL.style.width="100%";
oBL.style.height="100%";
oBL.style.backgroundColor="rgb(238, 238, 238)";
oBL.style.opacity="0";
oBL.style.filter="alpha(opacity:0)";
oBL.innerHTML="<table tabindex=\"1\" width=\"100%\" height=\"100%\"><tr><td role=\"presentation\" onclick=\"CVBackgroundLayer_ignoreMouseClick(event)\"></td></tr></table>";
oBL.style.display="inline";
document.body.appendChild(oBL);
};
CCognosViewer.prototype.removeTransparentBackgroundLayer=function(){
var oBL=document.getElementById(CV_BACKGROUND_LAYER_ID);
if(oBL){
oBL.parentNode.removeChild(oBL);
}
};
CCognosViewer.prototype.closeActiveHTTPConnection=function(){
var _79e=this.getActiveRequest();
if(_79e){
_79e.abortHttpRequest();
}
};
CCognosViewer.prototype.canCancel=function(){
var _79f=this.getTracking();
var _7a0=this.getStatus();
return _79f!=""&&_7a0!="complete";
};
CCognosViewer.prototype.cancel=function(_7a1){
if(this.getWorkingDialog()&&this.getWorkingDialog().disableCancelButton){
this.getWorkingDialog().disableCancelButton(_7a1);
}
this.removeTransparentBackgroundLayer();
this.clearPrompts();
if(this.m_viewerFragment&&this.envParams["fragment.fireEventWhenComplete"]){
this.envParams["fragment.fireEventWhenComplete"]="";
}
var _7a2=null;
if(this.m_undoStack.length>0){
_7a2=this.m_undoStack.pop();
}
var _7a3=this.getActiveRequest();
if(this.canCancel()===true||_7a3){
if(_7a3){
_7a3.cancelRequest(true);
}else{
var _7a4=null;
var _7a5=_7a2!=null&&_7a2.m_bRefreshPage;
if(typeof this.getCancelDispatcherEntry=="function"){
_7a4=this.getCancelDispatcherEntry();
}else{
if(_7a5||this.m_viewerFragment){
_7a4=new ViewerDispatcherEntry(this);
}else{
if(this.getId()=="RS"){
_7a4=new ViewerDispatcherEntry(this);
_7a4.addFormField("cv.responseFormat","rs");
}else{
_7a4=new DispatcherEntry(this);
_7a4.addFormField("cv.responseFormat","successfulRequest");
}
}
}
_7a4.forceSynchronous();
_7a4.addFormField("ui.action","cancel");
_7a4.addFormField("m_tracking",this.getTracking());
this.setTracking("");
if(_7a5){
var _7a6="<CognosViewerUndo><conversation>";
_7a6+=_7a2.m_sConversation;
_7a6+="</conversation></CognosViewerUndo>";
_7a4.addFormField("cv.previousSession",_7a6);
}
this.dispatchRequest(_7a4);
if(!this.isBux&&!this.m_viewerFragment&&(this.getUsePageRequest()||!this.isReportRenderingDone())){
this.executeCallback("cancel");
}
}
this.setStatus("complete");
var _7a7=this.envParams["ui.action"];
var _7a8=this.getUsePageRequest();
var _7a9=this.m_undoStack.length;
if(_7a2!=null){
this.m_sConversation=_7a2.m_sConversation;
this.m_sParameters=_7a2.m_sParameters;
this.envParams={};
applyJSONProperties(this.envParams,_7a2.m_envParams);
this.m_undoStack.push(_7a2);
}
this.setTracking("");
if(this.previouslySelectedTab){
this.cancelTabSwitch();
}else{
if(_7a7!="view"&&_7a9<=0&&this.rvMainWnd){
this.rvMainWnd.executePreviousReport(-1);
}
}
return true;
}else{
if(this.rvMainWnd&&typeof this.envParams!="undefined"&&(this.envParams["ui.primaryAction"]=="authoredDrillThrough"||this.envParams["ui.primaryAction"]=="authoredDrillThrough2")){
this.rvMainWnd.executePreviousReport(-1);
return true;
}else{
if(!this.isBux){
executeBackURL(this.getId());
}
return true;
}
}
return false;
};
CCognosViewer.prototype.clearPrompts=function(){
if(this.preProcessControlArray){
var _7aa=this.preProcessControlArray.length;
var k=0;
for(k=0;k<_7aa;k++){
var _7ac=eval(this.preProcessControlArray[k]);
if(_7ac){
if(_7ac.clearSubmit){
_7ac.clearSubmit();
}
}
}
}
};
CCognosViewer.prototype.wait=function(){
if(this.isWorking()){
this.JAWSTalk(RV_RES.IDS_JS_WAIT_PAGE_LOADING);
var _7ad=new ViewerDispatcherEntry(this);
_7ad.addFormField("ui.action","wait");
_7ad.addFormField("ui.primaryAction",this.envParams["ui.primaryAction"]);
_7ad.addFormField("cv.actionState",this.envParams["cv.actionState"]);
_7ad.addNonEmptyStringFormField("bux",this.envParams["bux"]);
_7ad.addNonEmptyStringFormField("ui.preserveRapTags",this.envParams["ui.preserveRapTags"]);
this.dispatchRequest(_7ad);
return true;
}
return false;
};
CCognosViewer.prototype.setCAFContext=function(_7ae){
this.m_sCAFContext=_7ae;
};
CCognosViewer.prototype.setContextInfo=function(sXML){
this.m_sContextInfoXML=sXML;
};
CCognosViewer.prototype.setConversation=function(_7b0){
this.m_sConversation=_7b0;
};
CCognosViewer.prototype.setActionState=function(_7b1){
this.m_sActionState=_7b1;
};
CCognosViewer.prototype.setStatus=function(_7b2){
this.m_sStatus=_7b2;
};
CCognosViewer.prototype.setDebug=function(_7b3){
this.m_bDebug=_7b3;
};
CCognosViewer.prototype.setExecutionParameters=function(_7b4){
this.m_sParameters=_7b4;
};
CCognosViewer.prototype.setMetadataInfo=function(sXML){
this.m_sMetadataInfoXML=sXML;
};
CCognosViewer.prototype.setSecondaryRequests=function(_7b6){
if(_7b6){
this.m_aSecRequests=_7b6;
}else{
this.m_aSecRequests=[];
}
};
CCognosViewer.prototype.setTracking=function(_7b7){
this.m_sTracking=_7b7;
};
CCognosViewer.prototype.setSoapFault=function(_7b8){
this.m_sSoapFault=_7b8;
};
CCognosViewer.prototype.showOutputInNewWindow=function(sURL){
var _7ba=document.getElementById("formWarpRequest"+this.getId());
var _7bb=_7ba.elements["ui.postBack"];
var _7bc=_7ba.elements["ui.backURL"];
if(window.opener||_7bb||(_7bc&&_7bc.value!=="javascript:window.close();")){
window.open(sURL,"","");
this.updateNewBrowserWindow();
}else{
if(this.isAccessibleMode()&&this.envParams["run.outputFormat"]=="PDF"&&window.detachLeavingRV){
window.detachLeavingRV();
}
window.location=sURL;
}
};
CCognosViewer.prototype.hideToolbar=function(_7bd){
this.m_bHideToolbar=_7bd;
};
CCognosViewer.prototype.showExcel=function(sURL){
var _7bf=true;
var _7c0=document.getElementById("formWarpRequest"+this.getId());
var _7c1=_7c0.elements["ui.backURL"];
if(_7c1&&_7c1.value.indexOf("javascript:window.close()")!==0&&_7c1.value.indexOf("close.html")===-1){
_7bf=false;
}
var _7c2=window;
if(window.opener&&(isIE()||isFF())&&_7bf){
_7c2=window.opener?window.opener:window;
}else{
if(!window.opener&&_7bf){
var _7c3=this.envParams["run.outputFormat"].toLowerCase();
if((_7c3=="spreadsheetml"||_7c3=="csv"||_7c3=="singlexls"||_7c3=="xlsxdata"||_7c3=="xlwa")&&window.detachLeavingRV&&window.attachLeavingRV){
window.detachLeavingRV();
window.location=sURL;
window.attachLeavingRV();
return;
}else{
window.location=sURL;
return;
}
}
}
var _7c4=null;
var _7c5="";
try{
if(this.envParams["cv.excelWindowOpenProperties"]){
_7c5=this.envParams["cv.excelWindowOpenProperties"];
}
_7c4=_7c2.open(sURL,"",_7c5);
}
catch(e){
_7c2=window;
_7c4=_7c2.open(sURL,"",_7c5);
}
if(!_7c4||_7c4.closed||typeof _7c4.closed=="undefined"){
alert(RV_RES.RV_BROWSER_POPUP_IS_ENABLED);
}
this.updateNewBrowserWindow();
};
CCognosViewer.prototype.updateNewBrowserWindow=function(){
var id=this.getId();
var _7c7=document.forms["formWarpRequest"+id].elements["ui.postBack"];
var _7c8=document.forms["formWarpRequest"+id].elements["ui.backURL"];
if(_7c7&&_7c7.value){
setTimeout(getCognosViewerObjectRefAsString(id)+".getRV().doPostBack();",100);
}else{
if(_7c8&&_7c8.value){
if(_7c8.value.length<2048){
setTimeout("location.replace(\""+_7c8.value+"\");",100);
}else{
_7c8=decodeURIComponent(_7c8.value);
var _7c9=_7c8.split("?");
var _7ca=document.createElement("form");
_7ca.style.display="none";
_7ca.setAttribute("target","_self");
_7ca.setAttribute("method","post");
_7ca.setAttribute("action",_7c9[0]);
var _7cb=_7c9[1].split("&");
for(var _7cc=0;_7cc<_7cb.length;_7cc++){
var _7cd=_7cb[_7cc].indexOf("=");
var _7ce=_7cb[_7cc].substr(0,_7cd);
var _7cf=_7cb[_7cc].substr(_7cd+1);
var _7d0=document.createElement("img");
_7d0.setAttribute("type","hidden");
_7d0.setAttribute("name",decodeURIComponent(_7ce));
_7d0.setAttribute("value",decodeURIComponent(_7cf));
_7ca.appendChild(_7d0);
}
document.body.appendChild(_7ca);
_7ca.submit();
}
}else{
window.close();
}
}
};
CCognosViewer.prototype.showWaitPage=function(){
};
CCognosViewer.prototype.sendRequest=function(_7d1){
var _7d2=new ViewerDispatcherEntry(this);
_7d2.addFormField("ui.action",_7d1.getAction());
if(_7d1.getCallback()!=null){
_7d2.setCallbacks({"complete":{"object":null,"method":_7d1.getCallback()}});
}
var _7d3=_7d1.getFormFields().keys();
for(var _7d4=0;_7d4<_7d3.length;_7d4++){
_7d2.addFormField(_7d3[_7d4],_7d1.getFormFields().get(_7d3[_7d4]));
}
var _7d5=_7d1.m_oOptions.keys();
for(var _7d6=0;_7d6<_7d5.length;_7d6++){
_7d2.addFormField(_7d5[_7d6],_7d1.getOption(_7d5[_7d6]));
}
var _7d7=_7d1.m_oParams.keys();
for(var _7d8=0;_7d8<_7d7.length;_7d8++){
_7d2.addFormField(_7d7[_7d8],_7d1.getParameter(_7d7[_7d8]));
}
this.dispatchRequest(_7d2);
};
CCognosViewer.prototype.promptAction=function(_7d9,sUrl){
this.setKeepFocus(true);
if(typeof datePickerObserverNotify=="function"){
datePickerObserverNotify();
}
var _7db=this.getViewerWidget();
if(_7d9=="cancel"){
this.cancelPrompt(sUrl);
if(_7db){
if(!this.isReportRenderingDone()){
var _7dc={action:"deleteWidget"};
_7db.fireEvent("com.ibm.bux.widget.action",null,_7dc);
}
}
}else{
var oReq=new ViewerDispatcherEntry(this);
oReq.addFormField("ui.action",_7d9=="back"?"back":"forward");
if(_7d9=="finish"){
oReq.addFormField("run.prompt",false);
}else{
if(_7d9=="back"||_7d9=="next"){
oReq.addFormField("run.prompt",true);
}
}
if(_7d9=="reprompt"){
if(typeof repromptObserverNotify=="function"){
repromptObserverNotify(this);
}
oReq.addFormField("_promptControl",_7d9);
}else{
oReq.addFormField("_promptControl","prompt");
}
if(_7db){
_7db.fireEvent("com.ibm.bux.widget.modified",null,{"modified":true});
if(_7db.isSelectionFilterEnabled){
_7db.clearSelectionFilter();
}
}
this.submitPromptValues(oReq);
}
};
CCognosViewer.prototype.cancelPrompt=function(sUrl){
this.cancel();
};
CCognosViewer.prototype.notify=function(_7df,_7e0){
var _7e1=0,k=0;
var _7e3=null;
if(this.rangeObserverArray&&this.rangeObserverArray instanceof Array){
_7e1=this.rangeObserverArray.length;
for(k=0;k<_7e1;k++){
_7e3=eval(this.rangeObserverArray[k]);
if(_7e3&&typeof _7e3=="object"&&typeof _7e3.update=="function"){
_7e3.update();
}
}
}
var _7e4=true;
if(this.preProcessControlArray&&this.preProcessControlArray instanceof Array){
_7e1=this.preProcessControlArray.length;
for(k=0;k<_7e1;k++){
_7e3=eval(this.preProcessControlArray[k]);
if((typeof _7e3.getValid=="function")&&!_7e3.getValid()){
_7e4=false;
break;
}
}
}
this.notifyPageNavEnabled(_7e4);
if(this.multipleObserverArray&&this.multipleObserverArray instanceof Array){
_7e1=this.multipleObserverArray.length;
for(k=0;k<_7e1;k++){
_7e3=eval(this.multipleObserverArray[k]);
if(_7e3&&typeof _7e3=="object"&&typeof _7e3.checkInsertRemove=="function"){
_7e3.checkInsertRemove();
}
}
}
for(var _7e5=0;_7e5<gaNotifyTargets.length;_7e5++){
var _7e6=gaNotifyTargets[_7e5];
if(typeof _7e6!="undefined"&&typeof _7e6.notify=="function"){
_7e6.notify(_7df,_7e0);
}
}
};
CCognosViewer.prototype.notifyPageNavEnabled=function(_7e7){
if(this.pageNavigationObserverArray&&this.pageNavigationObserverArray instanceof Array){
var _7e8=this.pageNavigationObserverArray.length;
var _7e9=false;
var _7ea=null;
var _7eb=null;
var k=0;
for(k=0;k<_7e8;k++){
try{
_7ea=eval(this.pageNavigationObserverArray[k]);
_7eb=_7ea.getType();
if(_7eb==PROMPTBUTTON_FINISH){
_7e9=true;
break;
}
}
catch(e){
}
}
for(k=0;k<_7e8;k++){
try{
_7ea=eval(this.pageNavigationObserverArray[k]);
_7eb=_7ea.getType();
if(!_7e7){
if((_7eb==PROMPTBUTTON_NEXT)||(_7eb==PROMPTBUTTON_OK)||(_7eb==PROMPTBUTTON_FINISH)){
_7ea.setEnabled(false);
}
}else{
if(_7eb==PROMPTBUTTON_FINISH){
_7ea.setEnabled(this.bCanFinish);
}else{
if(_7eb==PROMPTBUTTON_NEXT){
_7ea.setEnabled(this.bNextPage||!_7e9);
}else{
if(_7eb==PROMPTBUTTON_OK){
_7ea.setEnabled(true);
}
}
}
}
}
catch(e2){
}
}
}
};
CCognosViewer.prototype.getDrillResetHUNs=function(_7ed){
var _7ee=null;
if(this.getRAPReportInfo()){
_7ee=this.getRAPReportInfo().getDrilledOnHUNs();
}
if(!_7ee){
return null;
}
var _7ef=this.getExecutionParameters();
if(!_7ef){
return null;
}
var _7f0=this._getListOfChangedPromptParameters(_7ed);
if(!_7f0||_7f0.length===0){
return null;
}
var _7f1=[];
for(var i=0;i<_7ee.length;i++){
for(var j=0;j<_7f0.length;j++){
if(_7f0[j].indexOf(_7ee[i])!==-1){
_7f1.push(_7ee[i]);
}
}
}
return _7f1;
};
CCognosViewer.prototype.getOldParameters=function(){
var _7f4=new CParameterValues();
var _7f5=XMLBuilderLoadXMLFromString(this.getExecutionParameters());
if(_7f5.childNodes.length==1){
_7f4.loadWithOptions(_7f5.childNodes[0],false);
}
if(!_7f4||!_7f4.m_parameterValues||!_7f4.m_parameterValues.m_aValues){
return null;
}
return _7f4.m_parameterValues.m_aValues;
};
CCognosViewer.prototype._createDummyRequest=function(){
var _7f6=new ViewerDispatcherEntry(this);
return this.preparePromptValues(_7f6);
};
CCognosViewer.prototype._getChangedPromptParametersValues=function(_7f7,_7f8,_7f9){
var _7fa=XMLBuilderLoadXMLFromString(_7f8);
if(!_7fa){
for(var j=0;j<_7f7.length;j++){
var _7fc=_7f7[j].m_useValue;
if(_7f8.indexOf(sXmlEncode(_7fc))<0){
_7f9.push(_7fc);
}
}
return;
}
var _7fd=_7fa.getElementsByTagName("selectOption");
if(!_7fd){
return;
}
var _7fe=_7f7.length;
var _7ff=_7fd.length;
for(var i=0;i<_7ff;i++){
var _7f8=_7fd[i].attributes.getNamedItem("useValue").nodeValue;
bMatchOldParam=false;
for(var j=0;j<_7fe;j++){
var _7fc=_7f7[j].m_useValue;
if(_7f8.indexOf(_7fc)===0){
bMatchOldParam=true;
break;
}
}
if(!bMatchOldParam){
_7f9.push(_7f8);
}
}
};
CCognosViewer.prototype._getListOfChangedPromptParameters=function(_801){
var _802=this.getOldParameters();
if(!_802){
return null;
}
var _803=[];
if(!_801){
var _804=this._createDummyRequest();
for(var _805 in _802){
var _806=_802[_805].m_parmValueItems;
var _807=_804.getRequest().getFormFields().get("p_"+_805);
if(!_807){
continue;
}
this._getChangedPromptParametersValues(_806,_807,_803);
}
}else{
if(!_801.parameters){
return null;
}
var _808=_801.parameters;
for(var i=0;i<_808.length;i++){
var _80a=_808[i].parmName;
if(!_80a||!_802[_80a]){
continue;
}
var _806=_802[_80a].m_parmValueItems;
if(!_806||_806.length==0){
continue;
}
this._getChangedPromptParametersValues(_806,_808[i].parmValue,_803);
}
}
return _803;
};
CCognosViewer.prototype.submitPromptValues=function(oReq){
if(this.gbPromptRequestSubmitted===true){
return false;
}
if(this.isReportRenderingDone()){
this.m_currentlySelectedTab=null;
}
this.gbPromptRequestSubmitted=true;
if(this.isBux){
var _80c=this.getDrillResetHUNs(null);
if(_80c&&_80c.length!==0){
var _80d={"drilledResetHUNs":_80c};
this.executeAction("DrillReset",_80d);
return;
}
}
oReq=this.preparePromptValues(oReq);
if(window.portletSharePrompt){
var _80e=this.portletPromptParams(oReq);
if(_80e.length>0){
portletSharePrompt(_80e);
}
}
this.dispatchRequest(oReq);
};
CCognosViewer.prototype.portletPromptParams=function(oReq){
var _810=[];
var _811=null;
var _812=true;
var _813=oReq.getFormFields().keys();
for(var _814=0;_814<_813.length;_814++){
_811=_813[_814];
if(_811=="_promptControl"&&oReq.getFormField(_811)=="search"){
_812=false;
break;
}else{
if(_811.indexOf("p_")===0){
if(_811.indexOf("p_credential")===0){
_812=false;
break;
}else{
_810.push([_811,oReq.getFormField(_811)]);
}
}
}
}
if(_810&&!_812){
_810=[];
}
return _810;
};
CCognosViewer.prototype.preparePromptValues=function(oReq){
var _816=[];
if(this.preProcessControlArray){
var _817=this.preProcessControlArray.length;
var k=0;
for(k=0;k<_817;k++){
var _819=eval(this.preProcessControlArray[k]);
var _81a=(typeof _819.isEnabled=="function"?_819.isEnabled():true);
if(_819&&typeof _819.preProcess=="function"&&_81a){
_819.preProcess();
if(_819.m_oSubmit){
if(oReq.addParameter){
oReq.addParameter(_819.m_oSubmit.name,_819.m_oSubmit.value);
}else{
oReq.addFormField(_819.m_oSubmit.name,_819.m_oSubmit.value);
}
_816.push(_819.m_oSubmit);
if(_819.m_sPromptId&&_819.m_oForm&&_819.m_oForm.elements&&typeof _819.m_oForm.elements["p_"+_819.m_sRef]=="object"){
if(oReq.addParameter){
oReq.addParameter("p_"+_819.m_sPromptId,_819.m_oForm.elements["p_"+_819.m_sRef].value);
}else{
oReq.addFormField("p_"+_819.m_sPromptId,_819.m_oForm.elements["p_"+_819.m_sRef].value);
}
}
}
}
}
}
var _81b=document.getElementById("formWarpRequest"+this.getId());
if(_81b){
var _81c=_81b.elements;
for(var _81d=0;_81d<_81c.length;_81d++){
var _81e=_81c[_81d];
if(!_81e.name||!_81e.name.match(/^p_/)){
continue;
}
var _81f=true;
for(var _820=0;_820<_816.length;_820++){
if(_816[_820]==_81e){
_81f=false;
break;
}
}
if(_81f){
oReq.addFormField(_81e.name,_81e.value);
_816.push(_81e);
}
}
}
var oRM=this["CognosReport"];
if(oRM){
var _822=oRM.prompt.getParameters();
for(var i=0;i<_822.length;i++){
var _824="p_"+_822[i].getName();
if(!oReq.getFormField(_824)){
oReq.addFormField(_824,_822[i].getXML());
}
}
}
return oReq;
};
CCognosViewer.prototype.setViewerWidget=function(_825){
this.m_viewerWidget=_825;
};
CCognosViewer.prototype.getViewerWidget=function(){
return this.m_viewerWidget;
};
CCognosViewer.prototype.getFlashChartOption=function(){
var _826=this.getViewerWidget();
var _827=null;
if(_826){
var _828=_826.getProperties();
if(_828){
_827=_828.getFlashCharts();
}
}
return _827;
};
CCognosViewer.prototype.fireWidgetEvent=function(evt,_82a){
var _82b=this.getViewerWidget();
if(_82b!=null){
_82b.fireEvent(evt,null,_82a);
}
};
CCognosViewer.prototype.isMobile=function(){
return false;
};
CCognosViewer.prototype.setVisibleDialog=function(_82c){
this.m_visibleDialog=_82c;
};
CCognosViewer.prototype.getVisibleDialog=function(){
if(typeof this.m_visibleDialog!="undefined"){
return this.m_visibleDialog;
}
return null;
};
CCognosViewer.prototype.getContentLocale=function(){
var _82d=document.getElementById("formWarpRequest"+this.getId());
if(_82d&&_82d["ui.contentLocale"]&&_82d["reRunObj"]&&_82d["reRunObj"].value.length>0){
return _82d["ui.contentLocale"].value;
}
return null;
};
CCognosViewer.prototype.updateLayout=function(_82e){
var cvid=this.getId();
var _830=document.getElementById("CVHeader"+cvid);
var _831=document.getElementById("CVToolbar"+cvid);
if(!_830&&!_831){
setTimeout(getCognosViewerObjectRefAsString(cvid)+".updateLayout(\""+_82e+"\");",100);
return;
}
if(_830){
var _832=this.getUIConfig()&&!this.getUIConfig().getShowBanner();
if((_82e=="prompting"&&!this.bShowHeaderWithPrompts)||_832){
_830.parentNode.style.display="none";
}else{
_830.parentNode.style.display="";
}
}
if(_831){
if(_82e=="prompting"||this.m_bHideToolbar==true){
_831.parentNode.style.display="none";
}else{
_831.parentNode.style.display="";
}
}
};
CCognosViewer.prototype.updateResponseSpecification=function(_833){
this.sResponseSpecification=_833;
};
CCognosViewer.prototype.getResponseSpecification=function(){
return this.sResponseSpecification;
};
CCognosViewer.prototype.release=function(_834){
if(this.getStatus()!="fault"){
this._release(_834);
}
};
CCognosViewer.prototype._release=function(_835){
var form=document.getElementById("formWarpRequest"+this.getId());
var _837=this.getTracking();
if(!_837&&form&&form["m_tracking"]&&form["m_tracking"].value){
_837=form["m_tracking"].value;
form["m_tracking"].value="";
}
this.setTracking("");
if(_837){
var _838=new DispatcherEntry(this);
if(this.isWorkingOrPrompting()){
_838.addFormField("ui.action","cancel");
}else{
_838.addFormField("ui.action","release");
}
_838.addFormField("cv.responseFormat","successfulRequest");
_838.addNonEmptyStringFormField("ui.primaryAction",this.envParams["ui.primaryAction"]);
_838.addNonEmptyStringFormField("ui.objectClass",this.envParams["ui.objectClass"]);
_838.addFormField("m_tracking",_837);
if(_835!=true){
_838.forceSynchronous();
}
var _839=this.getActiveRequest()?this.getActiveRequest():this.getFaultDispatcherEntry();
if(_839&&_839.getFormField("cv.outputKey")){
_838.addFormField("b_action","cvx.high");
_838.addFormField("cv.outputKey",_839.getFormField("cv.outputKey"));
_838.addFormField("cv.waitForResponse","false");
_838.setHeaders(_839.getHeaders());
}
_838.sendRequest();
return true;
}
return false;
};
CCognosViewer.prototype.cleanupStyles=function(){
if(this.getViewerWidget()){
this.getViewerWidget().cleanupStyles();
}
};
CCognosViewer.prototype.destroy=function(_83a){
this.release(_83a);
if(!this.m_destroyed){
if(typeof window.gaRV_INSTANCES!="undefined"){
for(var _83b=0;_83b<window.gaRV_INSTANCES.length;_83b++){
if(window.gaRV_INSTANCES[_83b].m_sId==this.getId()){
window.gaRV_INSTANCES.splice(_83b,1);
this.m_destroyed=true;
break;
}
}
}
if(this.m_layoutElements){
for(var i=0;i<this.m_layoutElements.length;i++){
var e=this.m_layoutElements[i];
var j=e.getAttribute("lid");
this.m_layoutElements.splice(i,1);
delete this.m_lidToElement[j];
var _83f=e.parentNode;
if(_83f){
_83f.removeChild(e);
}
}
delete this.m_layoutElements;
delete this.m_lidToElement;
}
if(this.m_oDrillMgr){
this.m_oDrillMgr.setCV(null);
}
var _840=this.getSelectionController();
if(_840){
GUtil.destroyProperties(_840);
}
var cvId=this.getId();
this.m_viewerDispatcher=null;
GUtil.destroyProperties(this,true);
cleanupGlobalObjects(cvId);
}
};
CCognosViewer.prototype.exit=function(){
this.release();
};
CCognosViewer.prototype.executeAction=function(_842,_843){
var _844=this.getAction(_842);
_844.setRequestParms(_843);
return _844.execute();
};
CCognosViewer.prototype.getCalculation=function(_845){
var calc=null;
var _847=this.getCalculationCache();
if(_847[_845]){
calc=_847[_845];
}else{
calc=eval("new "+_845+"();");
calc.setCognosViewer(this);
_847[_845]=calc;
}
return calc;
};
CCognosViewer.prototype.findBlueDotMenu=function(_848){
var root=null;
var _84a=(_848)?_848:this.getToolbar();
for(var idx=0;idx<_84a.length;++idx){
if(typeof _84a[idx]._root!="undefined"){
root=_84a[idx]._root;
break;
}
}
return root;
};
CCognosViewer.prototype.findToolbarItem=function(_84c,_84d){
var spec=typeof _84d=="undefined"||_84d==null?this.getToolbar():_84d;
var _84f=null;
for(var _850=0;_850<spec.length;++_850){
var name=spec[_850]["name"];
if(typeof name!="undefined"&&name==_84c){
_84f=spec[_850];
break;
}
}
return _84f;
};
CCognosViewer.prototype.findToolbarItemIndex=function(_852,_853){
var spec=typeof _853=="undefined"||_853==null?this.getToolbar():_853;
var _855=null;
for(var _856=0;_856<spec.length;++_856){
var name=spec[_856]["name"];
if(typeof name!="undefined"&&name==_852){
_855=_856;
break;
}
}
return _855;
};
CCognosViewer.prototype.addedButtonToToolbar=function(_858,_859,_85a,_85b){
if(typeof _859!="undefined"&&_859!=null){
if(this.findToolbarItem(_859.name,_858)==null){
_85a=this.findToolbarItemIndex(_85a,_858);
if(typeof _85a!="undefined"&&_85a!=null){
_858.splice(++_85a,0,_859);
return true;
}else{
if(typeof _85b!="undefined"&&_85b!=null){
_858.splice(_85b,0,_859);
return true;
}
}
}
}
return false;
};
CCognosViewer.prototype.addDrillTargets=function(_85c){
this.m_drillTargets=_85c;
};
CCognosViewer.prototype.getDrillTargets=function(){
return this.m_drillTargets;
};
CCognosViewer.prototype.getDrillTarget=function(idx){
if(idx>=this.m_drillTargets.length){
return null;
}
return this.m_drillTargets[idx];
};
CCognosViewer.prototype.getNumberOfDrillTargets=function(){
return this.m_drillTargets.length;
};
CCognosViewer.prototype.isReportRenderingDone=function(){
return this.m_reportRenderingDone;
};
CCognosViewer.prototype.setReportRenderingDone=function(flag){
this.m_reportRenderingDone=flag;
};
CCognosViewer.prototype.hasAVSChart=function(){
var _85f=this.getRAPReportInfo();
if(_85f){
var _860=_85f.getDisplayTypes();
return _860.match("_v2")!=null||_860.match("v2_")!=null;
}
return false;
};
CCognosViewer.prototype.getPinFreezeManager=function(){
return this.m_pinFreezeManager;
};
CCognosViewer.prototype.getReportContextHelper=function(){
if(!this.m_reportContextHelper){
this.m_reportContextHelper=new ReportContextHelper(this.getSelectionController().getCCDManager());
}
return this.m_reportContextHelper;
};
CCognosViewer.prototype.getRAPReportInfo=function(){
return this.m_RAPReportInfo;
};
CCognosViewer.prototype.setRAPReportInfo=function(_861){
this.m_RAPReportInfo=_861;
};
CCognosViewer.prototype.isNodeVisible=function(node){
if(this.m_pinFreezeManager){
return this.m_pinFreezeManager.isNodeVisible(node);
}
return true;
};
CCognosViewer.prototype.getWarpRequestForm=function(){
return document.getElementById("formWarpRequest"+this.getId());
};
CCognosViewer.prototype.getBrowser=function(){
return this.sBrowser;
};
CCognosViewer.prototype.repaintDiv=function(oDiv){
var _864=oDiv.style.display;
oDiv.style.display="none";
oDiv.style.display=_864;
};
CCognosViewer.prototype.isMetadataEmpty=function(){
var oSC=this.getSelectionController();
if(oSC){
var _866=oSC.getCCDManager();
if(_866){
return _866.isMetadataEmpty();
}
}
return true;
};
CCognosViewer.prototype.setContextMenu=function(_867){
this.m_contextMenu=_867;
};
CCognosViewer.prototype.getContextMenu=function(){
return this.m_contextMenu;
};
CCognosViewer.prototype.setToolbar=function(_868){
this.m_toolbar=_868;
};
CCognosViewer.prototype.getToolbar=function(){
return this.m_toolbar;
};
CCognosViewer.prototype.getAdvancedServerProperty=function(_869){
if(this.m_advancedProperties&&this.m_advancedProperties[_869]!==undefined&&this.m_advancedProperties[_869]!==null){
return this.m_advancedProperties[_869];
}else{
return null;
}
};
CCognosViewer.prototype.hasPrompt=function(){
if(typeof this.m_bHasPrompt==="undefined"||this.m_bHasPrompt===null){
var _86a=false;
if(this.getAdvancedServerProperty("VIEWER_JS_PROMPT_AGAIN_SHOW_ALWAYS")==="true"||(this.envParams.reportPrompts&&this.envParams.reportPrompts.length>0)){
_86a=true;
}else{
var _86b=new CParameterValues();
var _86c=XMLBuilderLoadXMLFromString(this.getExecutionParameters());
if(_86c.childNodes.length==1){
_86b.loadWithOptions(_86c.childNodes[0],true);
var _86d=_86b.length();
for(var _86e=0;_86e<_86d;++_86e){
var _86f=_86b.getAt(_86e);
if(_86f!==null&&_86f.length()>0&&_86f.name().indexOf("credential:")!=-1){
_86a=true;
break;
}
}
}
}
this.m_bHasPrompt=_86a;
}
return this.m_bHasPrompt;
};
CCognosViewer.prototype.getDrillState=function(){
return this.m_sStateData?this.m_sStateData:"";
};
CCognosViewer.prototype.isSelectionFilterEnabled=function(){
if(typeof this.m_bSelectionFilterSwitch=="undefined"){
this.m_bSelectionFilterSwitch=false;
}
return this.m_bSelectionFilterSwitch;
};
CCognosViewer.prototype.broadcastContextChange=function(evt,_871){
if(this.getViewerWidget()){
this.getViewerWidget().broadcastContextChange(_871);
}
stopEventBubble(evt);
};
CCognosViewer.prototype.broadcastParameterChange=function(evt,_873){
if(this.getViewerWidget()){
this.getViewerWidget().broadcastParameterChange(_873);
}
stopEventBubble(evt);
};
CCognosViewer.prototype.getReportDiv=function(){
if(!this.m_nReportDiv){
this.m_nReportDiv=document.getElementById("CVReport"+this.m_sId);
}
return this.m_nReportDiv;
};
function CDocumentWriter(sId,_875){
this.m_sId=sId;
this.m_sText="";
this.m_sScript=_875;
};
CDocumentWriter.prototype.isValid=function(){
if(typeof this.m_sScript!="undefined"&&this.m_sScript&&window.gScriptLoader){
return true;
}
return false;
};
CDocumentWriter.prototype.execute=function(){
if(this.isValid()&&window.gScriptLoader){
var _876=/document\.write(ln)?\s*\(/gi;
var _877=this.m_sScript.replace(_876,"this.write(").replace(window.gScriptLoader.m_reScriptTagOpen,"").replace(window.gScriptLoader.m_reScriptTagClose,"");
try{
eval(_877);
var _878=document.getElementById(this.m_sId);
if(_878){
_878.innerHTML=this.m_sText;
return true;
}
}
catch(e){
}
}
return false;
};
CDocumentWriter.prototype.write=function(_879){
var _87a="";
if(typeof _879=="function"){
_87a=eval(_879);
}else{
if(typeof _879=="string"){
_87a=_879;
}
}
this.m_sText+=_87a;
};
function setFocusToFirstTabItem(_87b){
if(!window.dojo){
return;
}
var _87c=dojo.query("*",_87b);
var _87d=_87c.length;
for(var i=0;i<_87d;i++){
var node=_87c[i];
if(!node.style||(node.style.display!="none"&&node.style.visibility!="hidden")){
if(node.getAttribute("tabIndex")==0){
try{
node.focus();
}
catch(e){
}
break;
}
}
}
};
function ReportContextHelper(_880){
this.m_oCDManager=_880;
};
ReportContextHelper.prototype.destroy=function(){
if(this.m_oCDManager&&this.m_oCDManager.destroy){
this.m_oCDManager.destroy();
}
delete this.m_oCDManager;
};
ReportContextHelper.prototype.processCtx=function(sCtx){
var _882=sCtx.split("::");
var _883=[];
for(var i=0;i<_882.length;++i){
_883[i]=_882[i].split(":");
}
if(_883&&_883.length&&_883[0].length){
return _883;
}else{
return null;
}
};
ReportContextHelper.prototype.getDataItemName=function(sCtx){
var _886=this.processCtx(sCtx);
if(_886){
return this.getRefDataItem(_886[0][0]);
}
return null;
};
ReportContextHelper.prototype.getRefDataItem=function(_887){
var _888=this.m_oCDManager.GetRDIValue(_887);
return (_888==null)?"":_888;
};
ReportContextHelper.prototype.getMun=function(_889){
var aCtx=null;
if(typeof _889==="string"){
aCtx=this.processCtx(_889);
}else{
if(typeof _889==="number"){
aCtx=this.processCtx(_889.toString());
}else{
aCtx=_889;
}
}
if(aCtx){
var sMun=this.m_oCDManager.GetMUN(aCtx[0][0]);
return (sMun==null)?"":sMun;
}
return "";
};
function ViewerConfig(){
this.uiConfig=new ViewerUIConfig();
this.findConfig=typeof ViewerFindActionConfig=="function"?new ViewerFindActionConfig():null;
this.httpRequestConfig=typeof ViewerHttpRequestConfig=="function"?new ViewerHttpRequestConfig():null;
this.eventsConfig=typeof ViewerEventsConfig=="function"?new ViewerEventsConfig():null;
};
ViewerConfig.prototype.configure=function(_88c){
if(!_88c){
return;
}
if(_88c.findAction&&this.findConfig){
this.findConfig.configure(_88c.findAction);
}
if(_88c.UI){
this.uiConfig.configure(_88c.UI);
}
if(_88c.httpRequestCallbacks&&this.httpRequestConfig){
this.httpRequestConfig.configure(_88c.httpRequestCallbacks);
}
if(_88c.events&&this.eventsConfig){
this.eventsConfig.configure(_88c.events);
}
};
ViewerConfig.prototype.getUIConfig=function(){
return this.uiConfig;
};
ViewerConfig.prototype.getFindActionConfig=function(){
return this.findConfig;
};
ViewerConfig.prototype.getHttpRequestConfig=function(){
return this.httpRequestConfig;
};
ViewerConfig.prototype.getEventsConfig=function(){
return this.eventsConfig;
};
function ViewerUIConfig(){
this.showBanner=true;
this.showToolbar=true;
this.showContextMenu=true;
this.showPageNavigation=true;
this.primarySelectionColor=null;
this.secondarySelectionColor=null;
this.showSecondarySelection=true;
};
ViewerUIConfig.prototype.configure=function(_88d){
applyJSONProperties(this,_88d);
};
ViewerUIConfig.prototype.getShowBanner=function(){
return this.showBanner;
};
ViewerUIConfig.prototype.getShowToolbar=function(){
return this.showToolbar;
};
ViewerUIConfig.prototype.getShowContextMenu=function(){
return this.showContextMenu;
};
ViewerUIConfig.prototype.getShowPageNavigation=function(){
return this.showPageNavigation;
};
ViewerUIConfig.prototype.getPrimarySelectionColor=function(){
return this.primarySelectionColor;
};
ViewerUIConfig.prototype.getSeondarySelectionColor=function(){
return this.secondarySelectionColor;
};
ViewerUIConfig.prototype.getShowSecondarySelection=function(){
return this.showSecondarySelection;
};
function ViewerHttpRequestConfig(){
this.reportStatus={};
this.UI={};
};
ViewerHttpRequestConfig.prototype.configure=function(_88e){
applyJSONProperties(this,_88e);
};
ViewerHttpRequestConfig.prototype.getRequestIndicator=function(){
if(this.UI){
return this.UI.requestIndicator?this.UI.requestIndicator:null;
}
};
ViewerHttpRequestConfig.prototype.getWorkingDialog=function(){
if(this.UI){
return this.UI.workingDialog?this.UI.workingDialog:null;
}
};
ViewerHttpRequestConfig.prototype.getReportStatusCallback=function(_88f){
if(this.reportStatus){
var _890=this.reportStatus[_88f];
if(_890){
return _890;
}
if(_88f=="complete"&&this.reportStatus["initialComplete"]){
var _891=this.reportStatus["initialComplete"];
this.reportStatus["initialComplete"]=null;
return _891;
}
}
return null;
};
function ViewerState(){
this.findState=null;
this.pageState=null;
};
ViewerState.prototype.setFindState=function(_892){
if(typeof ViewerFindState!="function"){
return;
}
if(!this.findState){
this.findState=new ViewerFindState();
}
this.findState.setState(_892);
};
ViewerState.prototype.clearFindState=function(){
this.findState=null;
};
ViewerState.prototype.getFindState=function(){
return this.findState;
};
ViewerState.prototype.setPageState=function(_893){
if(typeof ViewerPageState!="function"){
return;
}
if(!this.pageState){
this.pageState=new ViewerPageState();
}
this.pageState.setState(_893);
};
ViewerState.prototype.clearPageState=function(){
this.pageState=null;
};
ViewerState.prototype.getPageState=function(){
return this.pageState;
};
function ViewerEventsConfig(){
this.showContextMenuOnClick=false;
};
ViewerEventsConfig.prototype.configure=function(_894){
applyJSONProperties(this,_894);
};
ViewerEventsConfig.prototype.getShowContextMenuOnClick=function(){
return this.showContextMenuOnClick;
};
CCognosViewer.prototype.loadExtra=function(){
var _895=this.getViewerWidget();
if(_895){
_895.loadExtraJavascriptFiles(this.getWebContentRoot());
}
};
function CCognosViewerToolbarHelper(){
};
CCognosViewerToolbarHelper.updateToolbarForCurrentSelection=function(oCV,_897){
if(_897){
var _898=oCV.getActionFactory();
for(var _899=0;_899<_897.length;++_899){
var name=_897[_899]["name"];
if(typeof name!="undefined"&&name!=null){
var _89b=_898.load(name);
if(_89b!=null&&typeof _89b!="undefined"){
var _89c=_89b.updateMenu(_897[_899]);
if(_89c.visible==false){
if(_89c.save){
oCV.getViewerWidget().addButtonToSavedToolbarButtons(name,_897[_899],_899);
}
_897.splice(_899,1);
--_899;
}else{
_897[_899]=_89c;
}
}
}else{
if(typeof _897[_899]._root!="undefined"){
CCognosViewerToolbarHelper.updateToolbarForCurrentSelection(oCV,_897[_899]._root);
}else{
if(_897[_899].separator){
if(_899==0||(_899>0&&_897[_899-1].separator)||_899==_897.length){
_897.splice(_899,1);
--_899;
}
}
}
}
}
}
};
CCognosViewerToolbarHelper.updateContextMenuForCurrentSelection=function(oCV,_89e){
var _89f=[];
if(_89e){
var _8a0=oCV.getActionFactory();
for(var _8a1=0;_8a1<_89e.length;++_8a1){
var _8a2=_89e[_8a1];
var name=_89e[_8a1]["name"];
var _8a4=true;
if(typeof name!="undefined"){
var _8a5=_8a0.load(name);
if(_8a5!=null&&typeof _8a5!="undefined"){
if(typeof _8a5.buildMenu=="function"){
_8a2=_8a5.buildMenu(_89e[_8a1]);
}else{
_8a2=_8a5.updateMenu(_89e[_8a1]);
}
_8a4=_8a5.isValidMenuItem();
}else{
if(typeof _8a2.items!="undefined"){
_8a2.items=CCognosViewerToolbarHelper.updateContextMenuForCurrentSelection(oCV,_8a2.items);
_8a4=(_8a2.items&&_8a2.items.length>0)?true:false;
if(_8a4&&_8a2.items.length==1){
_8a2=_8a2.items[0];
}
}
}
}
if(_8a2&&_8a2.visible!==false&&_8a4){
if(_8a2.separator===true){
if(_89f.length>0&&typeof _89f[_89f.length-1].separator=="undefined"){
_89f[_89f.length]=_8a2;
}
}else{
if(_8a2.useChildrenItems==true&&_8a2.items&&_8a2.items.length>0){
if(!_8a2.disabled){
for(var _8a6=0;_8a6<_8a2.items.length;_8a6++){
_89f[_89f.length]=_8a2.items[_8a6];
}
}
}else{
if(typeof _8a2._root!="undefined"){
_89f[_89f.length]={"_root":CCognosViewerToolbarHelper.updateContextMenuForCurrentSelection(oCV,_8a2._root)};
}else{
_89f[_89f.length]=_8a2;
}
}
}
}
}
if(_89f.length>1){
if(_89f[_89f.length-1].separator){
_89f=_89f.splice(0,_89f.length-1);
}
}
}
return _89f;
};
function CCDManager(cv){
this.m_cd=null;
this.m_md=null;
this.m_oCV=null;
this.m_dataItemInfo=null;
};
CCDManager.prototype.SetContextData=function(CD){
if(this.m_cd){
this.m_cd=null;
}
this.m_cd=CD;
};
CCDManager.prototype.SetMetadata=function(MD){
if(this.m_md){
this.m_md=null;
}
this.m_md=MD;
};
CCDManager.prototype.AddContextData=function(CD){
if(!this.m_cd){
this.m_cd=CD;
}else{
for(var i in CD){
this.m_cd[i]=CD[i];
}
}
};
CCDManager.prototype.AddMetadata=function(MD){
if(!this.m_md){
this.m_md=MD;
}else{
for(var j in MD){
this.m_md[j]=MD[j];
}
}
};
CCDManager.prototype.getClonedMetadataArray=function(){
var _8ae={};
applyJSONProperties(_8ae,this.m_md);
return _8ae;
};
CCDManager.prototype.getClonedContextdataArray=function(){
var _8af={};
applyJSONProperties(_8af,this.m_cd);
return _8af;
};
CCDManager.prototype.SetCognosViewer=function(_8b0){
if(_8b0){
this.m_oCV=_8b0;
}
};
CCDManager.prototype.onComplete_GetCDRequest=function(_8b1,_8b2){
if(_8b1){
var _8b3=_8b1.getResult();
var _8b4=XMLBuilderLoadXMLFromString(_8b3);
if(_8b4){
var _8b5=_8b4.getElementsByTagName("Block");
for(var i=0;i<_8b5.length;i++){
var _8b7="";
var _8b8=_8b5[i].firstChild;
while(_8b8){
_8b7+=_8b8.nodeValue;
_8b8=_8b8.nextSibling;
}
var cd=eval("("+_8b7+")");
this.AddContextData(cd);
}
}
}
if(_8b2&&typeof _8b2=="function"){
_8b2();
}
};
CCDManager.prototype.FetchContextData=function(_8ba,_8bb){
var _8bc=[];
var c=null,_8be=_8ba.length;
for(var i=0;i<_8be;++i){
c=_8ba[i];
if(c!=""&&!this.ContextIdExists(c)){
_8bc.push(c);
}
}
if(_8bc.length){
if(this.m_oCV){
this.getContextData(_8bc,_8bb);
}
}
return _8bc.length;
};
CCDManager.prototype.getContextData=function(_8c0,_8c1){
var oCV=this.m_oCV;
var _8c3=new AsynchDataDispatcherEntry(oCV);
_8c3.setCanBeQueued(false);
if(!oCV.isBux){
_8c3.forceSynchronous();
}
var form=document["formWarpRequest"+oCV.getId()];
var _8c5=oCV.getConversation();
var _8c6=oCV.getTracking();
if(!_8c6&&form&&form["m_tracking"]&&form["m_tracking"].value){
_8c6=form["m_tracking"].value;
}
if(oCV.m_viewerFragment){
var _8c7=oCV.getActiveRequest();
if(_8c7&&_8c7.getFormField("m_tracking")==_8c6){
return;
}
}
var _8c8={customArguments:[_8c1],"complete":{"object":this,"method":this.onComplete_GetCDRequest}};
if(oCV.getStatus()=="prompting"){
_8c8["prompting"]={"object":this,"method":this.onComplete_GetCDRequest};
}
_8c3.setCallbacks(_8c8);
if(_8c5&&oCV.envParams["ui.action"]!="view"){
_8c3.addFormField("ui.action","getContext");
_8c3.addFormField("ui.conversation",_8c5);
}else{
var _8c9=form["ui.object"];
if(typeof _8c9.length!="undefined"&&_8c9.length>1){
_8c3.addFormField("ui.object",form["ui.object"][0].value);
}else{
_8c3.addFormField("ui.object",form["ui.object"].value);
}
_8c3.addFormField("ui.action","getObjectContext");
}
_8c3.addFormField("cv.responseFormat","asynchDetailContext");
_8c3.addFormField("context.format","initializer");
_8c3.addFormField("context.type","reportService");
_8c3.addFormField("context.selection",_8c0.join(","));
_8c3.addNonEmptyStringFormField("m_tracking",_8c6);
oCV.dispatchRequest(_8c3);
};
CCDManager.prototype.ContextIdExists=function(_8ca){
return (this.m_cd&&this.m_cd[_8ca]?true:false);
};
CCDManager.prototype.HasContextData=function(){
return (this.m_cd?true:false);
};
CCDManager.prototype.HasMetadata=function(){
return (this.m_md?true:false);
};
CCDManager.prototype._getMDPropertyFromCD=function(_8cb,_8cc,_8cd){
var p=null;
this.FetchContextData([_8cb]);
var cd=this.m_cd&&this.m_cd[_8cb];
if(cd){
var md=this.m_md[cd[_8cc]];
if(md){
p=md[_8cd];
}
}
return p;
};
CCDManager.prototype.GetDrillFlag=function(_8d1){
return this._getMDPropertyFromCD(_8d1,"r","drill");
};
CCDManager.prototype.getModelPathFromBookletItem=function(_8d2){
var mp=null;
var md=this.m_md[_8d2];
if(md){
mp=md.mp;
if(mp&&this.m_md[mp]){
mp=this.m_md[mp].mp;
}
}
return mp?mp:null;
};
CCDManager.prototype.GetBookletModelBasedDrillThru=function(_8d5){
var p=null;
var md=this.m_md[_8d5];
if(md){
p=md.modelBasedDrillThru;
}
return p?p:0;
};
CCDManager.prototype.GetDrillFlagForMember=function(_8d8){
var _8d9=null;
var d=this._getMDPropertyFromCD(_8d8,"r","drill");
if(d!==null&&this.m_cd[_8d8].m){
_8d9=d;
}
return _8d9;
};
CCDManager.prototype.GetDataType=function(_8db){
return this._getMDPropertyFromCD(_8db,"r","dtype");
};
CCDManager.prototype.GetUsage=function(_8dc){
return this._getMDPropertyFromCD(_8dc,"r","usage");
};
CCDManager.prototype.GetHUN=function(_8dd){
var hun=this._getMDPropertyFromCD(_8dd,"h","h");
if(!hun){
var h=this._getMDPropertyFromCD(_8dd,"r","h");
if(h){
hun=this.m_md[h].h;
}
}
if(hun!=null&&hun.indexOf("[__ns_")==0){
hun=null;
}
return hun;
};
CCDManager.prototype.GetQuery=function(_8e0){
var qry=null;
var q=this._getMDPropertyFromCD(_8e0,"r","q");
if(q){
qry=this.m_md[q].q;
}
return qry;
};
CCDManager.prototype.GetDepth=function(_8e3){
return this._getMDPropertyFromCD(_8e3,"r","level");
};
CCDManager.prototype.GetDisplayValue=function(_8e4){
var _8e5=null;
this.FetchContextData([_8e4]);
if(this.ContextIdExists(_8e4)&&this.m_cd[_8e4]){
_8e5=this.m_cd[_8e4].u;
}
return _8e5;
};
CCDManager.prototype.GetPUN=function(_8e6){
return this._getMDPropertyFromCD(_8e6,"p","p");
};
CCDManager.prototype.GetLUN=function(_8e7){
return this._getMDPropertyFromCD(_8e7,"l","l");
};
CCDManager.prototype.GetMUN=function(_8e8){
return this._getMDPropertyFromCD(_8e8,"m","m");
};
CCDManager.prototype.GetDUN=function(_8e9){
return this._getMDPropertyFromCD(_8e9,"d","d");
};
CCDManager.prototype.GetQMID=function(_8ea){
return this._getMDPropertyFromCD(_8ea,"i","i");
};
CCDManager.prototype.GetRDIValue=function(_8eb){
return this._getMDPropertyFromCD(_8eb,"r","r");
};
CCDManager.prototype.GetBIValue=function(_8ec){
return this._getMDPropertyFromCD(_8ec,"r","bi");
};
CCDManager.prototype.getContextIdForMetaData=function(lun,hun,_8ef){
var _8f0=[{"expression":lun,"type":"l"},{"expression":hun,"type":"h"}];
for(var _8f1=0;_8f1<_8f0.length;++_8f1){
var _8f2=_8f0[_8f1].expression;
var _8f3=_8f0[_8f1].type;
if(_8f2==""){
continue;
}
for(var _8f4 in this.m_md){
if(this.m_md[_8f4][_8f3]==_8f2){
for(var _8f5 in this.m_md){
if(this.m_md[_8f5].r&&this.m_md[_8f5][_8f3]==_8f4){
if(this.m_md[_8f5].drill!=0||_8ef==true){
for(var ctx in this.m_cd){
if(this.m_cd[ctx].r==_8f5&&this.m_cd[ctx].m){
return ctx;
}
}
}
}
}
}
}
}
return "";
};
CCDManager.prototype.GetContextIdForMUN=function(mun){
var _8f8=null;
var _8f9=null;
for(var i in this.m_md){
if(this.m_md[i].m==mun){
_8f8=i;
break;
}
}
if(_8f8!=null){
for(var j in this.m_cd){
if(this.m_cd[j].m==_8f8){
_8f9=j;
break;
}
}
}
return _8f9;
};
CCDManager.prototype.GetContextIdsForRDI=function(rdi){
var _8fd=[];
for(var i in this.m_md){
if(this.m_md[i].r==rdi){
_8fd.push(i);
}
}
return _8fd;
};
CCDManager.prototype.getMUNForRDIAndUseValue=function(rdi,_900){
var _901=this.GetContextIdsForRDI(rdi);
for(var i in this.m_cd){
for(var j in _901){
if(this.m_cd[i].r==_901[j]&&this.m_cd[i].u==_900){
var _904=this.m_cd[i].m;
if(_904){
return this.m_md[_904].m;
}
}
}
}
return null;
};
CCDManager.prototype.GetPageMinMaxForRDI=function(rdi){
var _906=null;
var _907=null;
var _908=this.GetContextIdsForRDI(rdi);
this.FetchContextData([0]);
for(var i in this.m_cd){
for(var j in _908){
if(this.m_cd[i].r==_908[j]){
var _90b=parseFloat(this.m_cd[i].u);
if(_90b==this.m_cd[i].u){
if(_906==null||_90b<_906){
_906=_90b;
}
if(_907==null||_90b>_907){
_907=_90b;
}
}
}
}
}
if(_906!=null&&_907!=null){
return eval("({ pageMin: "+_906+", pageMax: "+_907+"})");
}
};
CCDManager.prototype.GetContextIdForDisplayValue=function(_90c){
var _90d=null;
for(var i in this.m_cd){
if(this.m_cd[i].u==_90c){
_90d=i;
break;
}
}
return _90d;
};
CCDManager.prototype.GetContextIdForUseValue=function(_90f){
var _910=null;
var _911=null;
var _912=null;
for(var i in this.m_md){
var md=this.m_md[i];
for(var j in md){
if(md[j]==_90f){
_910=i;
_911=j;
break;
}
}
}
if(_910!=null){
for(var k in this.m_cd){
if(this.m_cd[k][_911]==_910){
_912=k;
break;
}
}
}
return _912;
};
CCDManager.prototype.getDataItemInfo=function(){
if(this.m_cd){
var _917={};
this.m_dataItemInfo={};
for(var i in this.m_cd){
var _919=this.m_cd[i].r;
if(typeof _919!="undefined"){
var _91a=this.m_md[_919].r;
if(this.m_dataItemInfo[_91a]==null){
this.m_dataItemInfo[_91a]=1;
}else{
this.m_dataItemInfo[_91a]++;
}
}
}
return CViewerCommon.toJSON(this.m_dataItemInfo);
}
return "";
};
CCDManager.prototype.DataItemInfoToJSON=function(){
return this.getDataItemInfo();
};
CCDManager.prototype.MetadataToJSON=function(){
if(this.m_md){
return CViewerCommon.toJSON(this.m_md);
}
return "";
};
CCDManager.prototype.ContextDataToJSON=function(){
if(this.m_cd){
return CViewerCommon.toJSON(this.m_cd);
}
return "";
};
CCDManager.prototype.ContextDataSubsetToJSON=function(_91b){
if(_91b<=0){
return this.ContextDataToJSON();
}
if(this.m_cd){
var _91c={};
var _91d={};
for(var i in this.m_cd){
var _91f=this.m_cd[i].r;
if(typeof _91f!="undefined"){
if(_91c[_91f]==null){
_91c[_91f]=0;
}else{
_91c[_91f]++;
}
if(_91c[_91f]<_91b){
_91d[i]=this.m_cd[i];
}
}
}
return CViewerCommon.toJSON(_91d);
}
return "";
};
CCDManager.prototype.GetHUNForRDI=function(rdi,_921){
for(var i in this.m_md){
if(this.m_md[i].r==rdi&&this.m_md[i].q==_921){
var _923=this.m_md[i].h;
if(_923){
return this.m_md[_923].h;
}
}
}
return null;
};
CCDManager.prototype.GetMetadataIdForQueryName=function(_924){
for(var i in this.m_md){
if(this.m_md[i].q===_924){
return i;
}
}
return null;
};
CCDManager.prototype._isEmptyObject=function(obj){
for(var _927 in obj){
return false;
}
return true;
};
CCDManager.prototype.isMetadataEmpty=function(){
if(this.m_md){
return this._isEmptyObject(this.m_md);
}
return true;
};
CCDManager.prototype.GetBestPossibleItemName=function(_928){
var item=this.m_cd[_928];
if(!item){
return null;
}
if(item.l&&this.m_md[item.l].l){
return this._getStringInLastBracket(this.m_md[item.l].l);
}
if(item.r&&this.m_md[item.r].r){
return this._getStringInLastBracket(this.m_md[item.r].r);
}
if(item.h&&this.m_md[item.h].h){
return this._getStringInLastBracket(this.m_md[item.h].h);
}
if(item.i&&this.m_md[item.i].i){
return this._getStringInLastBracket(this.m_md[item.i].i);
}
return null;
};
CCDManager.prototype.GetBestPossibleDimensionMeasureName=function(_92a){
var item=this.m_cd[_92a];
if(item&&item.m&&this.m_md[item.m]&&this.m_md[item.m].m){
return this._getStringInLastBracket(this.m_md[item.m].m);
}
return null;
};
CCDManager.prototype._getStringInLastBracket=function(str){
if(str&&str.indexOf("].[")>0){
var _92d=str.split("].[");
var _92e=_92d[_92d.length-1];
return _92e.substring(0,_92e.length-1);
}
return str;
};
CCDManager.prototype._replaceNamespaceForSharedTM1DimensionOnly=function(_92f){
var _930=this._getNamespaceAndDimensionFromUniqueName(_92f);
if(_930&&this.m_md){
for(var _931 in this.m_md){
var sMun=this.m_md[_931].m;
if(sMun&&sMun.length>0){
if(sMun.indexOf("->:[TM].")>0){
var oObj=this._getNamespaceAndDimensionFromUniqueName(sMun);
if(oObj.dimension&&oObj.dimension===_930.dimension&&oObj.namespace!==_930.namespace){
var _934=_92f.indexOf(".");
return oObj.namespace+_92f.substr(_934,_92f.length);
}
}else{
var _935=sMun.indexOf("->:[");
if(_935>0){
if(sMun.substr(_935+4,4)!=="TM]."){
return _92f;
}
}
}
}
}
}
return _92f;
};
CCDManager.prototype._getNamespaceAndDimensionFromUniqueName=function(_936){
if(_936&&_936.length>0&&_936.indexOf("].[")>0){
var _937=_936.split("].[");
if(_937.length>1){
return {"namespace":_937[0]+"]","dimension":"["+_937[1]+"]"};
}
}
return null;
};
CCDManager.prototype.destroy=function(){
delete this.m_cd;
delete this.m_md;
delete this.m_oCV;
delete this.m_dataItemInfo;
};
var GUtil={};
GUtil.createHiddenForm=function(name,_939,_93a,_93b){
var form=document.getElementById(name);
if(form){
document.body.removeChild(form);
}
form=document.createElement("form");
form.id=name;
form.name=name;
form.method=_939;
form.style.display="none";
form.action=document.forms["formWarpRequest"+_93a].action;
form.target=_93b+(new Date()).getTime();
document.body.appendChild(form);
return form;
};
GUtil.createFormField=function(el,name,_93f){
var _940=document.createElement("input");
_940.type="hidden";
_940.name=name;
_940.value=_93f;
el.appendChild(_940);
};
GUtil.generateCallback=function(func,_942,_943){
if(func){
var _944=_943||this;
_942=(_942 instanceof Array)?_942:[];
return (function(_945){
if(typeof _945!="undefined"&&_942.length==0){
_942.push(_945);
}
return func.apply(_944,_942);
});
}else{
return (function(){
});
}
};
GUtil.destroyProperties=function(_946,_947){
var _948;
if(_946 instanceof Array){
for(var i=0;i<_946.length;i++){
_948=_946[i];
if(_948 instanceof String){
_948=null;
}else{
if(_948&&_948.destroy&&!_948._beingDestroyed){
_948.destroy();
}
GUtil.destroyProperties(_948);
}
}
}else{
if(_946 instanceof Object){
if(_946._beingDestroyed){
return;
}
var obj=_946;
obj._beingDestroyed=true;
for(var _94b in obj){
_948=obj[_94b];
if(_94b==="_beingDestroyed"||_94b==="m_destroyed"||_94b==="_destroyed"||typeof _948=="function"){
continue;
}
if(_948 instanceof Array){
GUtil.destroyProperties(_948);
}else{
if(_948 instanceof Object){
if(typeof _948.destroy=="function"&&!_948._destroyed&&(_948!==CCognosViewer||_947)){
_948.destroy();
}
}
}
delete obj[_94b];
}
}
}
};
cvLoadDialog=function(_94c,_94d,_94e,_94f,_950){
var _951=document.getElementById("formWarpRequest"+_94c.getId());
if(_951&&_94c){
_94c.getWorkingDialog().hide();
var _952="";
var _953="";
var _954=null;
if(_94c.isAccessibleMode()){
_952="winNAT_"+(new Date()).getTime();
_953=_94c.getWebContentRoot()+"/"+"rv/blankNewWin.html?cv.id="+this.getCVId();
}else{
var _955=document.body;
_954=new CModal("","",_955,null,null,_94f,_94e,true,true,false,true,_94c.getWebContentRoot());
if(typeof _950=="string"){
document.getElementById(CMODAL_CONTENT_ID).setAttribute("title",_950);
}
document.getElementById(CMODAL_BACK_IFRAME_ID).setAttribute("title",RV_RES.IDS_JS_MODAL_BACK_IFRAME);
_952=CMODAL_CONTENT_ID;
}
var _956=document.createElement("FORM");
_956.method="POST";
_956.action=_94c.getGateway();
_956.target=_952;
_956.style.margin="0px";
document.body.appendChild(_956);
for(var _957 in _94d){
_956.appendChild(createHiddenFormField(_957,_94d[_957]));
}
_956.appendChild(createHiddenFormField("cv.id",_94c.getId()));
_956.appendChild(createHiddenFormField("b_action","xts.run"));
_956.appendChild(createHiddenFormField("ui.action",_951["ui.action"].value));
_956.appendChild(createHiddenFormField("ui.object",_951["ui.object"].value));
if(typeof _94c.rvMainWnd!="undefined"){
_956.appendChild(createHiddenFormField("run.outputFormat",_94c.rvMainWnd.getCurrentFormat()));
}
if(typeof _951["run.outputLocale"]!="undefined"){
_956.appendChild(createHiddenFormField("run.outputLocale",_951["run.outputLocale"].value));
}
if(typeof _956["backURL"]=="undefined"&&typeof _956["ui.backURL"]=="undefined"&&typeof _951["ui.backURL"]!="undefined"){
_956.appendChild(createHiddenFormField("ui.backURL",_951["ui.backURL"].value));
}
if(typeof _94c!="undefined"&&typeof _94c.getConversation!="undefined"&&typeof _94c.getTracking!="undefined"){
_956.appendChild(createHiddenFormField("ui.conversation",_94c.getConversation()));
_956.appendChild(createHiddenFormField("m_tracking",_94c.getTracking()));
if(_94c.envParams["ui.name"]!="undefined"){
_956.appendChild(createHiddenFormField("ui.name",_94c.envParams["ui.name"]));
}
}
var _958=window.onbeforeunload;
window.onbeforeunload=null;
if(_94c.isAccessibleMode()){
window.open(_953,_952,"rv");
_956.submit();
}else{
_956.submit();
_954.show();
}
window.onbeforeunload=_958;
document.body.removeChild(_956);
_94c.modalShown=true;
}
};
function createHiddenFormField(name,_95a){
var _95b=document.createElement("input");
_95b.setAttribute("type","hidden");
_95b.setAttribute("name",name);
_95b.setAttribute("id",name);
_95b.setAttribute("value",_95a);
return (_95b);
};
function isAuthenticationFault(_95c){
if(_95c!=null){
var _95d=XMLHelper_FindChildByTagName(_95c,"CAM",true);
return (_95d!=null&&XMLHelper_FindChildByTagName(_95d,"promptInfo",true)!=null);
}
};
function processAuthenticationFault(_95e,_95f){
if(isAuthenticationFault(_95e)){
launchLogOnDialog(_95f,_95e);
return true;
}
return false;
};
function isObjectEmpty(_960){
for(var _961 in _960){
if(_960.hasOwnProperty(_961)){
return false;
}
}
return true;
};
function launchLogOnDialog(cvID,_963){
try{
var oCV=getCognosViewerObjectRef(cvID);
var _965={"b_action":"xts.run","m":"portal/close.xts","h_CAM_action":"logonAs"};
if(_963!=null){
var _966=XMLHelper_FindChildrenByTagName(_963,"namespace",true);
if(_966!=null){
for(var _967=0;_967<_966.length;++_967){
var _968=_966[_967];
if(_968!=null){
var _969=XMLHelper_FindChildByTagName(_968,"name",false);
var _96a=XMLHelper_FindChildByTagName(_968,"value",false);
if(_969!=null&&_96a!=null){
var _96b=XMLHelper_GetText(_969);
var _96c=XMLHelper_GetText(_96a);
if(_96b!=null&&_96b.length>0){
_965[_96b]=_96c;
}
}
}
}
}
}
cvLoadDialog(oCV,_965,540,460);
}
catch(exception){
}
};
function getCVWaitingOnFault(){
var oCV=null;
for(var _96e=0;_96e<window.gaRV_INSTANCES.length;_96e++){
if(window.gaRV_INSTANCES[_96e].getRetryDispatcherEntry()!=null){
oCV=window.gaRV_INSTANCES[_96e];
break;
}
}
return oCV;
};
function ccModalCallBack(_96f,data){
var oCV=getCVWaitingOnFault();
destroyCModal();
if(typeof HiddenIframeDispatcherEntry=="function"&&HiddenIframeDispatcherEntry.hideIframe){
var oCV=window.gaRV_INSTANCES[0];
if(oCV){
HiddenIframeDispatcherEntry.hideIframe(oCV.getId());
}
}
if(oCV!=null){
if(typeof _96f!="undefined"&&_96f=="ok"){
var _972=oCV.getRetryDispatcherEntry();
if(_972){
_972.retryRequest();
}
if(oCV.getRV()!=null){
oCV.getRV().updateUserName();
}
}else{
oCV.rvMainWnd.hideOpenMenus();
}
}
};
function closeErrorPage(){
var oCV=getCVWaitingOnFault();
destroyCModal();
if(oCV!=null){
oCV.setRetryDispatcherEntry(null);
oCV.rvMainWnd.hideOpenMenus();
}
};
function getCrossBrowserNode(evt,_975){
var node=null;
if(_975&&evt.explicitOriginalTarget){
node=evt.explicitOriginalTarget;
}else{
if(evt.originalTarget){
node=evt.originalTarget;
}else{
if(evt.target){
node=evt.target;
}else{
if(evt.srcElement){
node=evt.srcElement;
}
}
}
}
try{
if(node&&node.nodeType==3){
node=node.parentNode;
}
}
catch(ex){
}
return node;
};
function getNodeFromEvent(evt,_978){
var node=getCrossBrowserNode(evt,true);
if(node&&node.getAttribute&&node.getAttribute("name")=="primarySelectionDiv"){
node=node.parentNode.firstChild;
}
if(node&&node.getAttribute&&node.getAttribute("flashChartContainer")=="true"){
node=node.firstChild;
}
if(node&&node.getAttribute&&node.getAttribute("chartContainer")=="true"&&node.childNodes){
for(var i=0;i<node.childNodes.length;i++){
if(node.childNodes[i].nodeName.toLowerCase()=="img"){
node=node.childNodes[i];
break;
}
}
}else{
if(!_978&&node&&node.nodeName&&node.nodeName.toLowerCase()=="img"&&node.getAttribute("rsvpChart")!="true"){
node=node.parentNode;
}
}
return node;
};
function getCtxNodeFromEvent(evt){
try{
var node=getCrossBrowserNode(evt);
var _97d=node.nodeName.toUpperCase();
if((_97d=="SPAN"||_97d=="AREA"||_97d=="IMG")&&node.getAttribute("ctx")!=null){
return node;
}else{
if(_97d=="SPAN"&&(node.parentNode.getAttribute("ctx")!=null)){
return node.parentNode;
}
}
}
catch(exception){
}
return null;
};
function getDocumentFromEvent(evt){
var node=getCrossBrowserNode(evt,true);
var _980=node.document?node.document:node.ownerDocument;
return _980;
};
function stopEventBubble(evt){
evt.returnValue=false;
evt.cancelBubble=true;
if(typeof evt.stopPropagation!="undefined"){
evt.stopPropagation();
}
if(typeof evt.preventDefault!="undefined"){
evt.preventDefault();
}
return false;
};
function setNodeFocus(evt){
evt=(evt)?evt:((event)?event:null);
var _983=getNodeFromEvent(evt);
if(_983&&_983.nodeName){
var _984=_983.nodeName.toLowerCase();
if((_984=="td"||_984=="span")&&_983.childNodes&&_983.childNodes.length>0&&_983.childNodes[0].className=="textItem"){
try{
_983.childNodes[0].focus();
}
catch(e){
if(typeof console!=="undefined"&&console.log){
console.log("CCognosViewer: Could not set focus to node. setNodeFocus method common.js");
}
}
}
}
};
function html_encode(str){
return str.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");
};
function replaceNewLine(_986){
var regX=/\r\n|\r|\n/g;
var _988="<br/>";
return _986.replace(regX,_988);
};
function xml_encode(_989){
var _98a=""+_989;
if((_98a=="0")||((_989!=null)&&(_989!=false))){
_98a=_98a.replace(/&/g,"&amp;");
_98a=_98a.replace(/</g,"&lt;");
_98a=_98a.replace(/>/g,"&gt;");
_98a=_98a.replace(/"/g,"&quot;");
_98a=_98a.replace(/'/g,"&apos;");
}else{
if(_989==null){
_98a="";
}
}
return _98a;
};
function xml_decodeParser(sAll,_98c){
var _98d=sAll;
switch(_98c){
case "amp":
_98d="&";
break;
case "lt":
_98d="<";
break;
case "gt":
_98d=">";
break;
case "quot":
_98d="\"";
break;
case "apos":
_98d="'";
break;
}
return _98d;
};
function xml_decode(_98e){
var _98f=""+_98e;
if((_98f=="0")||((_98e!=null)&&(_98e!=false))){
_98f=_98f.replace(/&(amp|lt|gt|quot|apos);/g,xml_decodeParser);
}else{
if(_98e==null){
_98f="";
}
}
return _98f;
};
function xpath_attr_encode(_990){
var _991=null;
if(_990.indexOf("'")>=0&&_990.indexOf("\"")>=0){
var _992=_990.split("\"");
_991="concat(";
for(var i=0;i<_992.length;++i){
if(i>0){
_991+=",";
}
if(_992[i].length>0){
_991+=("\""+_992[i]+"\"");
}else{
_991+="'\"'";
}
}
_991+=")";
}else{
if(_990.indexOf("'")>=0){
_991="\""+_990+"\"";
}else{
_991="'"+_990+"'";
}
}
return _991;
};
function getCognosViewerObjectString(sId){
return "oCV"+sId;
};
function getCognosViewerObjectRefAsString(sId){
return "window."+getCognosViewerObjectString(sId);
};
function getCognosViewerObjectRef(sId){
return window[getCognosViewerObjectString(sId)];
};
function getCognosViewerSCObjectString(sId){
return "oCVSC"+sId;
};
function getCognosViewerSCObjectRefAsString(sId){
return "window."+getCognosViewerSCObjectString(sId);
};
function getCognosViewerSCObjectRef(sId){
return window[getCognosViewerSCObjectString(sId)];
};
function cleanupGlobalObjects(sId){
cleanupVariable(getCognosViewerObjectString(sId));
cleanupVariable(getCognosViewerSCObjectString(sId));
};
function cleanupVariable(_99b){
if(typeof window[_99b]!="undefined"&&window[_99b]){
if(isIE()){
eval("delete "+_99b);
}else{
delete window[_99b];
}
}
};
function loadClass(_99c){
try{
var _99d=eval("new "+_99c+"();");
return _99d;
}
catch(e){
return null;
}
};
function getElementsByClassName(oElm,_99f,_9a0){
var _9a1=(_99f=="*"&&oElm.all)?oElm.all:oElm.getElementsByTagName(_99f);
var _9a2=[];
var _9a3=new RegExp("(^|\\s)"+_9a0+"(\\s|$)");
var _9a4=_9a1.length;
for(var i=0;i<_9a4;i++){
var _9a6=_9a1[i];
if(_9a3.test(_9a6.className)){
_9a2.push(_9a6);
}
}
return _9a2;
};
function getImmediateLayoutContainerId(node){
var _9a8=node;
while(_9a8!=null){
if(_9a8.getAttribute&&_9a8.getAttribute("lid")!=null){
return _9a8.getAttribute("lid");
}
_9a8=_9a8.parentNode;
}
return null;
};
function getChildElementsByAttribute(oElm,_9aa,_9ab,_9ac){
return getDescendantElementsByAttribute(oElm,_9aa,_9ab,_9ac,true);
};
function getElementsByAttribute(oElm,_9ae,_9af,_9b0,_9b1,_9b2){
return getDescendantElementsByAttribute(oElm,_9ae,_9af,_9b0,false,_9b1,_9b2);
};
function getDescendantElementsByAttribute(oElm,_9b4,_9b5,_9b6,_9b7,_9b8,_9b9){
var _9ba=[];
var _9bb=null;
if(typeof _9b9==="undefined"){
_9bb=(typeof _9b6!="undefined")?new RegExp("(^|\\s)"+_9b6+"(\\s|$)","i"):null;
}else{
_9bb=_9b9;
}
if(typeof _9b4=="string"){
_9b4=[_9b4];
}
var _9bc=(oElm?_9b4.length:0);
for(var _9bd=0;_9bd<_9bc;_9bd++){
var _9be=null;
if(_9b7){
if(_9b4[_9bd]=="*"&&oElm.all){
_9be=oElm.childNodes;
}else{
_9be=[];
var _9bf=oElm.childNodes;
for(var i=0;i<_9bf.length;++i){
if(_9bf[i].nodeName.toLowerCase()==_9b4[_9bd].toLowerCase()){
_9be.push(_9bf[i]);
}
}
}
}else{
_9be=(_9b4[_9bd]=="*"&&oElm.all)?oElm.all:oElm.getElementsByTagName(_9b4[_9bd]);
}
var _9c1=_9be.length;
for(var idx=0;idx<_9c1;idx++){
var _9c3=_9be[idx];
var _9c4=_9c3.getAttribute&&_9c3.getAttribute(_9b5);
if(_9c4!==null){
var _9c5=null;
if(typeof _9c4==="number"){
_9c5=String(_9c4);
}else{
if(typeof _9c4==="string"&&_9c4.length>0){
_9c5=_9c4;
}
}
if(_9c5!==null){
if(typeof _9b6=="undefined"||(_9bb&&_9bb.test(_9c5))){
_9ba.push(_9c3);
if(_9b8!=-1&&_9ba.length>_9b8){
return [];
}else{
if(_9b8==1&&_9ba.length==1){
return _9ba;
}
}
}
}
}
}
}
return _9ba;
};
function savedOutputDoneLoading(cvId,_9c7){
var oCV=window["oCV"+cvId];
var _9c9=(oCV&&oCV.getViewerWidget?oCV.getViewerWidget():null);
var _9ca=(_9c9?_9c9.getSavedOutput():null);
if(_9ca){
_9ca.outputDoneLoading();
}else{
if(_9c7<5){
_9c7++;
var _9cb=function(){
savedOutputDoneLoading(cvId,_9c7);
};
setTimeout(_9cb,100);
}
}
};
function getNavVer(){
var temp;
if(isIE()){
return getIEVersion();
}else{
temp=navigator.userAgent.split("/");
return parseFloat(temp[temp.length-1]);
}
};
function isSafari(){
return (navigator.userAgent.toLowerCase().indexOf("safari")!=-1);
};
function isIE(){
return (navigator.userAgent.indexOf("MSIE")!=-1||navigator.userAgent.indexOf("Trident")!=-1);
};
function getIEVersion(){
var _9cd=navigator.userAgent.match(/(?:MSIE |Trident\/.*; rv:)(\d+)/);
return _9cd?parseFloat(_9cd[1]):null;
};
function isFF(){
return (navigator.userAgent.indexOf("Firefox")!=-1);
};
function isIOS(){
return navigator.userAgent.indexOf("iPad")!=-1||navigator.userAgent.indexOf("iPhone")!=-1;
};
function displayChart(_9ce,_9cf,_9d0,_9d1){
if(_9cf.length>1){
document.images[_9ce].src=_9cf;
}
};
function isFlashChartNode(evt){
var node=getNodeFromEvent(evt);
if(node!=null&&typeof node.getAttribute=="function"){
return node.getAttribute("flashChart")!=null;
}
return false;
};
function onFlashChartRightClick(evt){
if(evt&&evt.button&&evt.button!=0&&isFlashChartNode(evt)){
return onViewerChartFocus(evt);
}
};
function onViewerChartFocus(evt){
if(evt.stopPropagation){
evt.stopPropagation();
}
if(evt.preventDefault){
evt.preventDefault();
}
if(evt.preventCapture){
evt.preventCapture();
}
if(evt.preventBubble){
evt.preventBubble();
}
var node=getNodeFromEvent(evt);
var _9d7=node.getAttribute("viewerId");
if(!_9d7){
_9d7=node.parentNode.getAttribute("viewerId");
}
if(!_9d7){
return;
}
var oCV=window["oCV"+_9d7];
var _9d9=oCV.getAction("Selection");
_9d9.pageClicked(evt);
return stopEventBubble(evt);
};
function clientToScreenCoords(_9da,_9db){
var _9dc=_9da;
var _9dd={topCoord:0,leftCoord:0};
while(_9dc!=null&&_9dc!=_9db){
_9dd.topCoord+=_9dc.offsetTop;
_9dd.leftCoord+=_9dc.offsetLeft;
_9dc=_9dc.offsetParent;
}
return _9dd;
};
function getCurrentPosistionString(oCV,_9df,_9e0){
var _9e1=RV_RES.IDS_JS_INFOBAR_ITEM_COUNT;
var _9e2=/\{0\}/;
var _9e3=/\{1\}/;
_9e1=_9e1.replace(_9e2,_9df);
_9e1=" "+_9e1.replace(_9e3,_9e0)+" ";
return _9e1;
};
function applyJSONProperties(obj,_9e5){
for(property in _9e5){
if(typeof _9e5[property]=="object"&&!(_9e5[property] instanceof Array)){
if(typeof obj[property]=="undefined"){
obj[property]={};
}
applyJSONProperties(obj[property],_9e5[property]);
}else{
obj[property]=_9e5[property];
}
}
};
function CViewerCommon(){
};
CViewerCommon.openNewWindowOrTab=function(sURL,_9e7){
return window.open(sURL,_9e7);
};
CViewerCommon.toJSON=function(obj){
var type=typeof (obj);
if(type!="object"||type===null){
if(type==="string"){
obj="\""+obj+"\"";
}
return String(obj);
}else{
var _9ea;
var prop;
var json=[];
var _9ed=(obj&&obj.constructor==Array);
for(_9ea in obj){
prop=obj[_9ea];
type=typeof (prop);
if(type==="string"){
prop="\""+prop+"\"";
}else{
if(type=="object"&&prop!==null){
prop=CViewerCommon.toJSON(prop);
}
}
json.push((_9ed?"":"\""+_9ea+"\":")+String(prop));
}
return (_9ed?"[":"{")+String(json)+(_9ed?"]":"}");
}
};
function resizePinnedContainers(){
var oCV=window.gaRV_INSTANCES[0];
if(oCV&&!oCV.m_viewerFragment){
var _9ef=oCV.getPinFreezeManager();
if(_9ef&&_9ef.hasFrozenContainers()){
var _9f0=document.getElementById("RVContent"+oCV.getId());
var _9f1=document.getElementById("mainViewerTable"+oCV.getId());
var _9f2=_9f0.clientWidth;
var _9f3=_9f1.clientHeight;
_9ef.resize(_9f2,_9f3);
if(isIE()){
oCV.repaintDiv(_9f0);
}
}
}
};
function setWindowHref(url){
var _9f5=window.onbeforeunload;
window.onbeforeunload=null;
window.location.href=url;
window.onbeforeunload=_9f5;
};
CViewerCommon.getMessage=function(msg,args){
if(typeof args=="undefined"){
return msg;
}else{
if(typeof args=="string"){
msg=msg.replace("{0}",args);
}else{
if(args.length){
for(var i=0;i<args.length;++i){
msg=msg.replace("{"+i+"}",args[i]);
}
}else{
msg=msg.replace("{0}",args);
}
}
}
return msg;
};
function getViewerDirection(){
if(window.gaRV_INSTANCES&&window.gaRV_INSTANCES.length){
return gaRV_INSTANCES[0].getDirection();
}
return "ltr";
};
function isViewerBidiEnabled(){
if(window.gaRV_INSTANCES&&window.gaRV_INSTANCES.length){
var _9f9=gaRV_INSTANCES[0].isBidiEnabled();
if(_9f9){
return true;
}
}
return false;
};
function getViewerBaseTextDirection(){
if(window.gaRV_INSTANCES&&window.gaRV_INSTANCES.length){
return gaRV_INSTANCES[0].getBaseTextDirection();
}
return "";
};
function enforceTextDir(_9fa){
if(isViewerBidiEnabled()&&_9fa){
var sDir=getViewerBaseTextDirection();
var _9fc=BidiUtils.getInstance();
if(sDir=="auto"){
sDir=_9fc.resolveStrBtd(_9fa);
}
var _9fd=(!dojo._isBodyLtr())?_9fc.RLM:_9fc.LRM;
return _9fd+((sDir==="rtl")?_9fc.RLE:_9fc.LRE)+_9fa+_9fc.PDF+_9fd;
}
return _9fa;
};
function getElementDirection(_9fe){
var dir=null;
if(_9fe.currentStyle){
dir=_9fe.currentStyle.direction;
}else{
if(window.getComputedStyle){
var _a00=window.getComputedStyle(_9fe,null);
if(_a00){
dir=_a00.getPropertyValue("direction");
}
}
}
if(dir){
dir=dir.toLowerCase();
}
return dir;
};
function getScrollLeft(_a01){
if(getElementDirection(_a01)==="rtl"&&isFF()){
return _a01.scrollWidth-_a01.offsetWidth+_a01.scrollLeft;
}
return _a01.scrollLeft;
};
function setScrollLeft(_a02,_a03){
if(getElementDirection(_a02)==="rtl"&&isFF()){
_a02.scrollLeft=_a02.offsetWidth+_a03-_a02.scrollWidth;
}else{
_a02.scrollLeft=_a03;
}
};
function setScrollRight(_a04,_a05){
if(getElementDirection(_a04)==="rtl"&&isFF()){
_a04.scrollLeft=-_a05;
}else{
_a04.scrollLeft=_a04.scrollWidth-_a04.offsetWidth-_a05;
}
};
function getBoxInfo(el,_a07){
if(!getBoxInfo.aStyles){
getBoxInfo.aStyles=[{name:"marginLeft",ie:"marginLeft",ff:"margin-left"},{name:"marginRight",ie:"marginRight",ff:"margin-right"},{name:"marginTop",ie:"marginTop",ff:"margin-top"},{name:"marginBottom",ie:"marginBottom",ff:"margin-bottom"},{name:"borderLeftWidth",ie:"borderLeftWidth",ff:"border-left-width"},{name:"borderRightWidth",ie:"borderRightWidth",ff:"border-right-width"},{name:"borderTopWidth",ie:"borderTopWidth",ff:"border-top-width"},{name:"borderBottomWidth",ie:"borderBottomWidth",ff:"border-bottom-width"},{name:"paddingLeft",ie:"paddingLeft",ff:"padding-left"},{name:"paddingRight",ie:"paddingRight",ff:"padding-right"},{name:"paddingTop",ie:"paddingTop",ff:"padding-top"},{name:"paddingBottom",ie:"paddingBottom",ff:"padding-bottom"}];
}
var _a08={};
var _a09=null;
if(el.currentStyle){
_a09=el.currentStyle;
}else{
if(window.getComputedStyle){
_a09=window.getComputedStyle(el,null);
}
}
if(!_a09){
return null;
}
for(i in getBoxInfo.aStyles){
var _a0a=getBoxInfo.aStyles[i];
var size=null;
if(_a09.getPropertyValue){
size=_a09.getPropertyValue(_a0a.ff);
}else{
size=_a09[_a0a.ie];
}
if(size&&_a07){
size=Number(size.replace("px",""));
}
_a08[_a0a.name]=size;
}
return _a08;
};
if(!CViewerCommon){
var CViewerCommon={};
}
CViewerCommon.buildParameterValuesSpec=function(oCV){
var _a0d=XMLBuilderLoadXMLFromString(oCV.getExecutionParameters());
var _a0e=new CParameterValues();
if(_a0d.childNodes.length==1){
_a0e.loadWithOptions(_a0d.childNodes[0],false);
}
var _a0f=_a0e.length();
var _a10="<pvs>";
if(_a0f>0){
var _a11=new CParameterValueStringOperators(RV_RES.IDS_JS_FILTER_BETWEEN,RV_RES.IDS_JS_FILTER_NOT_BETWEEN,RV_RES.IDS_JS_FILTER_LESS_THAN,RV_RES.IDS_JS_FILTER_GREATER_THAN);
for(var _a12=0;_a12<_a0f;++_a12){
var _a13=_a0e.getAt(_a12);
if(_a13!=null){
_a10+="<pv>";
_a10+="<name>";
_a10+=xml_encode(_a13.name());
_a10+="</name>";
_a10+="<value>";
_a10+=xml_encode(_a13.toString(_a11));
_a10+="</value>";
_a10+="</pv>";
}
}
}
_a10+="</pvs>";
return _a10;
};
function PinFreezeContainer(_a14,lid,_a16,_a17,_a18,_a19,_a1a){
this.m_pinFreezeManager=_a14;
this.m_lid=lid;
this.m_lidNS=lid+_a16+_a1a;
this.m_viewerId=_a16;
this.m_freezeTop=_a17;
this.m_freezeSide=_a18;
this.m_cachedReportDiv=null;
this.m_cachedPFContainer=null;
this.m_cachedBaseContainer=_a19;
this.m_containerMargin={"top":0,"left":0};
if(this.m_cachedBaseContainer&&this.m_cachedBaseContainer.style){
if(this.m_cachedBaseContainer.style.marginTop){
this.m_containerMargin.top=Number(this.m_cachedBaseContainer.style.marginTop.replace("px",""));
}
if(this.m_cachedBaseContainer.style.marginLeft){
this.m_containerMargin.left=Number(this.m_cachedBaseContainer.style.marginLeft.replace("px",""));
}
}
this.m_cachedContainerIndex=_a1a;
this.m_sectionCache=null;
this.m_homeCellNodes={};
this.m_fixedWidth=null;
this.m_clientWidth=700;
this.m_scrollableClientWidth=700;
this.m_fixedHeight=null;
this.m_clientHeight=300;
this.m_scrollableClientHeight=300;
this.m_wrapFlag=false;
this.c_pageMargin=(this.m_freezeTop&&this.m_freezeSide)?50:20;
this.touchScrollSections=false;
this.touchPreviousX=-1;
this.touchPreviousY=-1;
};
PinFreezeContainer.prototype.toJSONString=function(){
var _a1b="{";
_a1b+="\"m_clientWidth\":"+this.m_clientWidth+"";
_a1b+=",\"m_scrollableClientWidth\":"+this.m_scrollableClientWidth+"";
_a1b+=",\"m_clientHeight\":"+this.m_clientHeight+"";
_a1b+=",\"m_scrollableClientHeight\":"+this.m_scrollableClientHeight+"";
_a1b+="}";
return _a1b;
};
PinFreezeContainer.prototype.copyProperties=function(_a1c){
this.m_clientWidth=_a1c.m_clientWidth;
this.m_scrollableClientWidth=_a1c.m_scrollableClientWidth;
this.m_clientHeight=_a1c.m_clientHeight;
this.m_scrollableClientHeight=_a1c.m_scrollableClientHeight;
};
PinFreezeContainer.prototype.setViewerId=function(id){
this.m_viewerId=id;
};
PinFreezeContainer.prototype.getLid=function(){
return this.m_lid;
};
PinFreezeContainer.prototype.createPFContainer=function(_a1e,_a1f){
var _a20=document.createElement("temp");
if(this.m_cachedBaseContainer){
this.applyAuthoredFixedSizes(this.m_cachedBaseContainer);
this.m_cachedReportDiv=_a1e;
var _a21=this.m_cachedBaseContainer.parentNode;
var _a22=this.loadTemplateHTML();
if(_a22){
_a20.innerHTML=_a22;
var _a23=this.getContainerByLID(_a20);
var _a24=this.getSectionByLID(_a20.firstChild,"pfMainOutput");
if(_a24){
var i=this.getChildPosition(_a21,this.m_cachedBaseContainer);
if(i!=-1){
var _a26=this.m_pinFreezeManager.m_oCV;
if(_a26&&_a26.envParams["freezeDefaultWrap"]){
if(this.m_cachedBaseContainer.style.whiteSpace===""&&_a26.envParams["freezeDefaultWrap"].toLowerCase()==="true"){
var _a27=this.m_cachedBaseContainer.getElementsByTagName("span");
if(_a27){
for(var k=0;k<_a27.length;k++){
_a27[k].style.whiteSpace="nowrap";
}
}
this.m_wrapFlag=true;
}
}
if(!_a1f){
if(!this._getFixedWidth()){
this.m_cachedBaseContainer.setAttribute("authoredFixedWidth","false");
this.m_addedFixedWidth=this.m_cachedBaseContainer.clientWidth+1;
this.m_cachedBaseContainer.style.width=this.m_addedFixedWidth+"px";
}
if(!this._getFixedHeight()){
this.m_cachedBaseContainer.setAttribute("authoredFixedHeight","false");
this.m_addedFixedHeight=this.m_cachedBaseContainer.clientHeight;
this.m_cachedBaseContainer.style.height=this.m_addedFixedHeight+"px";
}
_a24.style.width=this.m_cachedBaseContainer.clientWidth+2+"px";
_a24.style.height=this.m_cachedBaseContainer.clientHeight+2+"px";
}
_a24.appendChild(this.m_cachedBaseContainer);
this.insertAt(_a21,_a23,i);
}
if(this.m_cachedBaseContainer.style.border!==""){
_a23.style.border=this.m_cachedBaseContainer.style.border;
this.m_cachedBaseContainer.style.border="";
}
}
}
}
};
PinFreezeContainer.prototype._getFixedWidth=function(_a29){
if(_a29&&_a29.style.width&&!_a29.getAttribute("authoredFixedWidth")){
var _a2a=Number(_a29.style.width.split("px")[0]);
return isNaN(_a2a)?null:_a2a;
}
return null;
};
PinFreezeContainer.prototype._getFixedHeight=function(_a2b){
if(_a2b&&_a2b.style.height&&!_a2b.getAttribute("authoredFixedHeight")){
var _a2c=Number(_a2b.style.height.split("px")[0]);
return isNaN(_a2c)?null:_a2c;
}
return null;
};
PinFreezeContainer.prototype.applyAuthoredFixedSizes=function(_a2d){
var _a2e=this._getFixedWidth(_a2d);
if(_a2e){
this.m_fixedWidth=_a2e;
this.m_clientWidth=this.m_fixedWidth;
this.m_scrollableClientWidth=this.m_fixedWidth;
}
var _a2f=this._getFixedHeight(_a2d);
if(_a2f){
this.m_fixedHeight=_a2f;
this.m_clientHeight=this.m_fixedHeight;
this.m_scrollableClientHeight=this.m_fixedHeight;
}
};
PinFreezeContainer.prototype.loadFreezeBothTemplateHTML=function(){
var _a30="<table pflid=\""+this.m_lidNS+"\" pfclid=\"pfContainer_"+this.m_lidNS+"\" cellpadding=\"0\" style=\"white-space:nowrap; width:0px; height:0px;\" cellspacing=\"0\">"+"<tr class=\"BUXNoPrint\" templatePart=\"freezeTop\"><td align=\"center\" templatePart=\"freezeSide\"><div pflid=\""+this.m_lidNS+"\" pfslid=\"pfHomeCell_"+this.m_lidNS+"\" style=\"overflow-x:hidden; overflow-y:hidden; width:100%; height:100%\"/></td>"+"<td valign=top><div pflid=\""+this.m_lidNS+"\" pfslid=\"pfTopHeadings_"+this.m_lidNS+"\" style=\"width:0px; height:0px; overflow-x:hidden; overflow-y:hidden; position:relative;\"/></td><td templatePart=\"freezeTop\"></td></tr>"+"<tr><td class=\"BUXNoPrint\" valign=top templatePart=\"freezeSide\"><div pflid=\""+this.m_lidNS+"\" pfslid=\"pfSideHeadings_"+this.m_lidNS+"\" style=\"width:0px; height:0px; overflow-x:hidden; overflow-y:hidden; position:relative;\"/></td>"+"<td valign=top><div pflid=\""+this.m_lidNS+"\" pfslid=\"pfMainOutput_"+this.m_lidNS+"\" style=\"width:0px; height:0px; overflow-x:hidden; overflow-y:hidden; position:relative;\">"+"</div></td>"+"<td class=\"BUXNoPrint\" templatePart=\"freezeTop\">"+"<div style=\"padding-right:1px;overflow-x:hidden; overflow-y:scroll;\" pflid=\""+this.m_lidNS+"\" pfslid=\"pfVerticalScrollBar_"+this.m_lidNS+"\" tabIndex=\"-1\" onmouseup=\"stopEventBubble(event);\" onmousedown=\"stopEventBubble(event);\" onscroll=\""+getCognosViewerObjectRefAsString(this.m_viewerId)+".m_pinFreezeManager.getContainer('"+this.m_lid+"', "+this.m_cachedContainerIndex+").synchVScroll()\">"+"<div style=\"padding-right:1px;\"/>"+"</div>"+"</td>"+"</tr>"+"<tr class=\"BUXNoPrint\" templatePart=\"freezeSide\"><td></td><td>"+"<div style=\"overflow-x:scroll; overflow-y:hidden;\" pflid=\""+this.m_lidNS+"\" pfslid=\"pfHorizontalScrollBar_"+this.m_lidNS+"\" tabIndex=\"-1\" onmouseup=\"stopEventBubble(event);\" onmousedown=\"stopEventBubble(event);\" onscroll=\""+getCognosViewerObjectRefAsString(this.m_viewerId)+".m_pinFreezeManager.getContainer('"+this.m_lid+"', "+this.m_cachedContainerIndex+").synchScroll()\">"+"<div style=\"height:2px;\">&nbsp;</div>"+"</div>"+"</td><td></td></tr></table>";
return _a30;
};
PinFreezeContainer.prototype.loadFreezeSideTemplateHTML=function(){
var _a31="<table pflid=\""+this.m_lidNS+"\" pfclid=\"pfContainer_"+this.m_lidNS+"\" cellpadding=\"0\" style=\"white-space:nowrap; width:0px; height:0px;\" cellspacing=\"0\"><tr>"+"<td class=\"BUXNoPrint\" valign=top><div pflid=\""+this.m_lidNS+"\" pfslid=\"pfSideHeadings_"+this.m_lidNS+"\" style=\"width:0px; height:0px; overflow-x:hidden; overflow-y:hidden; position:relative;\"/></td>"+"<td valign=top><div pflid=\""+this.m_lidNS+"\" pfslid=\"pfMainOutput_"+this.m_lidNS+"\" style=\"width:0px; height:0px; overflow-x:hidden; overflow-y:hidden; position:relative;\">"+"</div></td>"+"</tr>"+"<tr class=\"BUXNoPrint\"><td></td><td>"+"<div style=\"overflow-x:scroll; overflow-y:hidden;\" pflid=\""+this.m_lidNS+"\" pfslid=\"pfHorizontalScrollBar_"+this.m_lidNS+"\" tabIndex=\"-1\" onmouseup=\"stopEventBubble(event);\" onmousedown=\"stopEventBubble(event);\" onscroll=\""+getCognosViewerObjectRefAsString(this.m_viewerId)+".m_pinFreezeManager.getContainer('"+this.m_lid+"', "+this.m_cachedContainerIndex+").synchScroll()\">"+"<div style=\"height:2px;\">&nbsp;</div>"+"</div>"+"</td></tr></table>";
return _a31;
};
PinFreezeContainer.prototype.loadFreezeTopTemplateHTML=function(){
var _a32="<table pflid=\""+this.m_lidNS+"\" pfclid=\"pfContainer_"+this.m_lidNS+"\" cellpadding=\"0\" style=\"white-space:nowrap; width:0px; height:0px;\" cellspacing=\"0\">"+"<tr class=\"BUXNoPrint\"><td valign=top><div pflid=\""+this.m_lidNS+"\" pfslid=\"pfTopHeadings_"+this.m_lidNS+"\" style=\"width:0px; height:0px; overflow-x:hidden; overflow-y:hidden; position:relative;\"/></td><td></td></tr>"+"<tr><td valign=top><div pflid=\""+this.m_lidNS+"\" pfslid=\"pfMainOutput_"+this.m_lidNS+"\" style=\"width:0px; height:0px; overflow-x:hidden; overflow-y:hidden; position:relative;\"></div></td>"+"<td class=\"BUXNoPrint\">"+"<div style=\"padding-right:1px;overflow-x:hidden; overflow-y:scroll;\" pflid=\""+this.m_lidNS+"\" pfslid=\"pfVerticalScrollBar_"+this.m_lidNS+"\" tabIndex=\"-1\" onmouseup=\"stopEventBubble(event);\" onmousedown=\"stopEventBubble(event);\" onscroll=\""+getCognosViewerObjectRefAsString(this.m_viewerId)+".m_pinFreezeManager.getContainer('"+this.m_lid+"', "+this.m_cachedContainerIndex+").synchVScroll()\">"+"<div style=\"padding-right:1px;\"/>"+"</div>"+"</td>"+"</tr></table>";
return _a32;
};
PinFreezeContainer.prototype.loadTemplateHTML=function(){
if(this.m_freezeSide&&this.m_freezeTop){
return this.loadFreezeBothTemplateHTML();
}else{
if(this.m_freezeSide){
return this.loadFreezeSideTemplateHTML();
}else{
if(this.m_freezeTop){
return this.loadFreezeTopTemplateHTML();
}
}
}
return null;
};
PinFreezeContainer.prototype.createSideHeadings=function(_a33){
var _a34=this.getSection("pfMainOutput");
var _a35=_a34.getAttribute("pfslid");
var _a36=this.getSection("pfSideHeadings");
var _a37=_a36.getAttribute("pfslid");
var _a38=this.getMainOutputHomeCell();
if(!_a38){
return;
}
var _a39=_a33;
var _a3a=_a36;
var _a3b=this.isA11yEnabled(_a39);
var _a3c=this.m_pinFreezeManager.deepCloneNode(_a39);
_a3a.appendChild(_a3c);
var _a3d=this.getSectionHomeCell(_a36);
if(!_a3d){
return;
}
var _a3e=_a39.getElementsByTagName("tbody");
var _a3f=_a3c.getElementsByTagName("tbody");
if(_a3e.length>0&&_a3f.length>0){
var _a40=_a3e[0];
var _a41=_a3f[0];
var _a42=_a40.firstChild;
var _a43=_a41.firstChild;
var _a44=_a38.rowSpan;
this.markAsCopy(_a38,_a3d,_a35,_a37);
for(var r=0;r<_a44;++r){
var _a46=_a41.rows[r];
this.removeCTX(_a46);
}
for(var r=_a44;r<_a41.rows.length;++r){
var _a47=_a40.rows[r];
var _a46=_a41.rows[r];
_a46.style.visibility="hidden";
for(var c=0;c<_a46.cells.length;++c){
var _a49=_a46.cells[c];
if(_a3b){
_a49=this.m_pinFreezeManager.removeIdAttribute(_a49);
}
if(_a49.getAttribute("type")=="datavalue"){
_a49.removeAttribute("ctx");
_a49.removeAttribute("uid");
_a49.removeAttribute("name");
}else{
var _a4a=_a47.cells[c];
this.markAsCopy(_a4a,_a49,_a35,_a37);
}
}
_a46.style.visibility="visible";
}
}
};
PinFreezeContainer.prototype.applyNeighbouringBorderStylesToHomeCell=function(_a4b,_a4c){
if(isFF()||isIE()){
if(_a4b&&_a4b.length&&_a4b[0].cells&&_a4b[0].cells.length>1){
if(this.m_freezeSide){
var _a4d=this.getBorderInfo(_a4b[0].cells[1],"right");
if(_a4d){
_a4c.style.borderRightWidth=_a4d.borderRightWidth;
_a4c.style.borderRightStyle=_a4d.borderRightStyle;
_a4c.style.borderRightColor=_a4d.borderRightColor;
}
}
if(this.m_freezeTop){
var _a4d=this.getBorderInfo(_a4b[0].cells[1],"bottom");
if(_a4d){
_a4c.style.borderBottomWidth=_a4d.borderBottomWidth;
_a4c.style.borderBottomStyle=_a4d.borderBottomStyle;
_a4c.style.borderBottomColor=_a4d.borderBottomColor;
}
}
}
}
};
PinFreezeContainer.prototype.createTopHeadings=function(_a4e){
var _a4f=this.getSection("pfMainOutput");
var _a50=_a4f.getAttribute("pfslid");
var _a51=this.getSection("pfTopHeadings");
var _a52=_a51.getAttribute("pfslid");
var _a53=this.getMainOutputHomeCell();
if(!_a53){
return;
}
var _a54=_a4e;
var _a55=_a51;
var _a56=this.isA11yEnabled(_a54);
var _a57=this.m_pinFreezeManager.deepCloneNode(_a54);
_a57.setAttribute("clonednode","true");
_a55.appendChild(_a57);
var _a58=_a54.getElementsByTagName("tbody");
var _a59=_a57.getElementsByTagName("tbody");
if(_a58.length>0&&_a59.length>0){
var _a5a=_a58[0];
var _a5b=_a59[0];
var _a5c=_a53.rowSpan;
for(var r=0;r<_a5b.rows.length;++r){
var _a5e=_a5a.rows[r];
var _a5f=_a5b.rows[r];
if(_a56){
_a5f=this.m_pinFreezeManager.removeIdAttribute(_a5f);
}
_a5f.style.visibility="hidden";
for(var c=0;c<_a5f.cells.length;++c){
var _a61=_a5f.cells[c];
if(r>_a5c||_a61.getAttribute("type")=="datavalue"){
_a61.removeAttribute("ctx");
_a61.removeAttribute("uid");
_a61.removeAttribute("name");
}else{
var _a62=_a5e.cells[c];
this.markAsCopy(_a62,_a61,_a50,_a52);
if(_a62===_a53){
this.initializeHomeCellTabIndex(_a61);
this.applyNeighbouringBorderStylesToHomeCell(_a5a.rows,_a61);
}
}
}
_a5f.style.visibility="visible";
}
}
};
PinFreezeContainer.prototype.createHomeCellHeading=function(){
var _a63=this.getSection("pfMainOutput");
var _a64=_a63.getAttribute("pfslid");
var _a65=this.getSection("pfHomeCell");
var _a66=_a65.parentNode;
var _a67=_a65.getAttribute("pfslid");
var _a68=this.getMainOutputHomeCell();
if(!_a68){
return;
}
_a66.style.height="100%";
var _a69=this.getTopHeadingSectionHeight(_a68);
_a65.style.height=_a69-this.m_containerMargin.top+"px";
_a65.style.width=this.getSideHeadingSectionWidth(_a68)-this.m_containerMargin.left+"px";
_a65.style.marginTop=this.m_containerMargin.top+"px";
_a65.style.marginLeft=this.m_containerMargin.left+"px";
var _a6a=_a68.parentNode;
var _a6b=_a6a.cloneNode(false);
var _a6c=this._findBestGuessHomeCell(_a68);
var _a6d=document.createElement("div");
_a6d.style.width="100%";
_a6d.style.height="100%";
while(_a68.offsetLeft<=_a6c.offsetLeft){
oTargetHomeCell=this.m_pinFreezeManager.deepCloneNode(_a68);
if(isFF()||isIE()){
_a68.appendChild(_a6d);
oTargetHomeCell.style.width=_a6d.clientWidth+"px";
_a68.removeChild(_a6d);
}else{
oTargetHomeCell.style.width=_a68.clientWidth+1+"px";
}
oTargetHomeCell.style.borderBottomWidth="0px";
_a6b.appendChild(oTargetHomeCell);
this.markAsCopy(_a68,oTargetHomeCell,_a64,_a67);
if(_a68.nextSibling){
_a68=_a68.nextSibling;
}else{
break;
}
}
if(oTargetHomeCell){
oTargetHomeCell.style.borderRightWidth="0px";
}
var _a6e=_a6a.parentNode;
var _a6f=_a6e.cloneNode(false);
_a6f.appendChild(_a6b);
var _a70=_a6e.parentNode;
var _a71=_a70.cloneNode(false);
_a71.appendChild(_a6f);
_a71.style.width="100%";
_a71.style.height="100%";
_a71.style.marginLeft="";
_a71.style.marginTop="";
_a65.appendChild(_a71);
this.initializeHomeCellTabIndex(oTargetHomeCell);
this.applyNeighbouringBorderStylesToHomeCell(_a63.firstChild.rows,_a65);
};
PinFreezeContainer.prototype.markAsCopy=function(main,copy,_a74,_a75){
if(!main.pfCopy){
main.setAttribute("pfslid",_a74);
main.pfCopy=[];
}
main.pfCopy.push(copy);
copy.pfMain=main;
copy.setAttribute("pfslid",_a75);
};
PinFreezeContainer.prototype.getCopy=function(_a76){
if(_a76.pfCopy){
var _a77={};
for(var i in _a76.pfCopy){
var copy=_a76.pfCopy[i];
if(copy.getAttribute){
var _a7a=copy.getAttribute("pfslid");
if(_a7a){
var _a7b=PinFreezeContainer.getSectionNameFromSlid(_a7a);
var _a7c=this.getSection(_a7b);
if(_a7c&&PinFreezeContainer.isSectionVisible(_a7c)){
_a77[_a7b]=copy;
}
}
}
}
if(_a77["pfHomeCell"]){
return _a77["pfHomeCell"];
}
for(i in _a77){
return _a77[i];
}
}
return null;
};
PinFreezeContainer.prototype.getMain=function(_a7d){
if(_a7d.pfMain){
return _a7d.pfMain;
}
return null;
};
PinFreezeContainer.isSectionVisible=function(_a7e){
var node=_a7e;
if(!node){
return false;
}
while(node.parentNode&&!node.getAttribute("pfclid")){
if(node.style&&node.style.display==="none"){
return false;
}
node=node.parentNode;
}
return (!node.style||node.style.display!=="none");
};
PinFreezeContainer.prototype.getSectionStructure=function(){
var _a80={isSideFrozen:false,isTopFrozen:false};
if(this.m_freezeSide){
var side=this.getSection("pfSideHeadings");
if(side){
_a80.isSideFrozen=PinFreezeContainer.isSectionVisible(side);
}
}
if(this.m_freezeTop){
var top=this.getSection("pfTopHeadings");
if(top){
_a80.isTopFrozen=PinFreezeContainer.isSectionVisible(top);
}
}
return _a80;
};
PinFreezeContainer.prototype.checkSectionStructureChange=function(_a83,_a84){
if(_a83.isSideFrozen!==_a84.isSideFrozen||_a83.isTopFrozen!==_a84.isTopFrozen){
this.m_pinFreezeManager.sectionStructureChange();
}
};
PinFreezeContainer.prototype.freezeContainerInReport=function(_a85){
this.cacheContainerAndSections(this.getContainerByLID(_a85));
this.m_homeCellNodes={};
this.updateContainer();
};
PinFreezeContainer.prototype.frozenSectionsRequired=function(){
return (this.frozenSideHeadingsRequired()||this.frozenTopHeadingsRequired());
};
PinFreezeContainer.prototype.frozenSideHeadingsRequired=function(){
var _a86=this.getSection("pfMainOutput");
if(_a86){
if(this.m_freezeSide){
var _a87=_a86.scrollWidth;
return ((this.m_clientWidth<_a87)||_a87==0);
}
}
return false;
};
PinFreezeContainer.prototype.frozenTopHeadingsRequired=function(){
var _a88=this.getSection("pfMainOutput");
if(_a88){
if(this.m_freezeTop){
var _a89=_a88.scrollHeight;
return ((this.m_clientHeight<_a89)||_a89==0);
}
}
return false;
};
PinFreezeContainer.prototype.showTemplatePart=function(_a8a,_a8b){
var _a8c=this.getContainer().rows;
for(var r=0;r<_a8c.length;++r){
if(_a8c[r].getAttribute("templatePart")===_a8a){
_a8c[r].style.display=((_a8b)?"":"none");
}else{
var _a8e=_a8c[r].cells;
for(var c=0;c<_a8e.length;++c){
if(_a8e[c].getAttribute("templatePart")===_a8a){
_a8e[c].style.display=((_a8b)?"":"none");
}
}
}
}
};
PinFreezeContainer.prototype.showFreezeTopOnly=function(_a90){
if(!(this.m_freezeTop&&this.m_freezeSide)){
return;
}
var _a91=(_a90.scrollWidth==0)?_a90.clientWidth:_a90.scrollWidth;
this.updateMainOutputWidth(_a91);
this.setScrollX(_a90,0);
if(this.getSection("pfTopHeadings")){
this.getSection("pfTopHeadings").style.width=_a91+"px";
this.setScrollX(this.getSection("pfTopHeadings"),0);
}
this.showTemplatePart("freezeSide",false);
};
PinFreezeContainer.prototype.showFreezeSideOnly=function(_a92){
if(!(this.m_freezeTop&&this.m_freezeSide)){
return;
}
var _a93=(_a92.scrollHeight==0)?_a92.clientHeight:_a92.scrollHeight;
this.updateMainOutputHeight(_a93);
this.setScrollY(_a92,0);
if(this.getSection("pfSideHeadings")){
this.getSection("pfSideHeadings").style.height=_a93+"px";
this.setScrollY(this.getSection("pfSideHeadings"),0);
}
this.showTemplatePart("freezeTop",false);
};
PinFreezeContainer.prototype.showAll=function(){
if(!(this.m_freezeTop&&this.m_freezeSide)){
return;
}
this.showTemplatePart("freezeTop",true);
this.showTemplatePart("freezeSide",true);
};
PinFreezeContainer.prototype.showMainOutputOnly=function(_a94){
this.updateMainOutputWidth((_a94.scrollWidth==0)?_a94.clientWidth:_a94.scrollWidth);
this.updateMainOutputHeight((_a94.scrollHeight==0)?_a94.clientHeight:_a94.scrollHeight);
this.setInitialScrollPosition(_a94,0,0);
if(this.m_freezeSide&&this.m_freezeTop){
this.getSection("pfHomeCell").style.display="none";
}
if(this.m_freezeSide){
this.getSection("pfSideHeadings").style.display="none";
this.getSection("pfHorizontalScrollBar").style.display="none";
}
if(this.m_freezeTop){
this.getSection("pfTopHeadings").style.display="none";
this.getSection("pfVerticalScrollBar").style.display="none";
}
};
PinFreezeContainer.prototype.getWrap=function(el){
if(el.currentStyle){
return el.currentStyle.whiteSpace;
}else{
if(window.getComputedStyle){
return window.getComputedStyle(el,null).getPropertyValue("white-space");
}else{
return el.style.whiteSpace;
}
}
};
PinFreezeContainer.prototype.headingsCreated=function(_a96){
return _a96.firstChild?true:false;
};
PinFreezeContainer.prototype.updateContainer=function(){
var _a97=this.getSection("pfMainOutput");
var _a98=this.getMainOutputHomeCell();
if(_a98){
if(this.m_scrollableClientHeight===this.m_clientHeight||!this.m_scrollableClientHeight){
this.m_scrollableClientHeight-=_a98.offsetHeight;
var _a99=this.calculateMinCrossTabScrollableClientHeight();
if(_a99>this.m_scrollableClientHeight){
this.m_scrollableClientHeight=_a99;
}
}
if(this.m_scrollableClientWidth===this.m_clientWidth||!this.m_scrollableClientWidth){
this.m_scrollableClientWidth-=this.getHomeCellOffsetWidth(_a98);
}
}
if(_a97&&_a98){
this.showAll();
if(this.frozenSectionsRequired()){
this.updateMainOutputSize();
this.initializeHomeCellTabIndex(_a98);
if(this.m_freezeSide){
var _a9a=this.getSection("pfSideHeadings");
if(!this.headingsCreated(_a9a)){
this.createSideHeadings(this.m_cachedBaseContainer);
if(this.m_freezeTop){
this.initializeTouchScrolling(_a9a);
}
}
var _a9b=this.getSection("pfHorizontalScrollBar");
_a9b.scrollLeft="0px";
}
if(this.m_freezeTop){
var _a9c=this.getSection("pfTopHeadings");
if(!this.headingsCreated(_a9c)){
this.createTopHeadings(this.m_cachedBaseContainer);
if(this.m_freezeSide){
this.initializeTouchScrolling(_a9c);
}
}
var _a9d=this.getSection("pfVerticalScrollBar");
_a9d.scrollTop="0px";
}
if(this.m_freezeSide&&this.m_freezeTop){
var _a9e=this.getSection("pfHomeCell");
if(!this.headingsCreated(_a9e)){
this.createHomeCellHeading();
}
_a9e.style.display="";
}
var _a9f=this.updateSideHeadingSize(_a98);
var _aa0=this.updateTopHeadingSize(_a98);
if(!this.frozenSectionsRequired()){
this.showMainOutputOnly(_a97);
}
this.setInitialScrollPosition(_a97,_a9f,_aa0);
if(this.m_freezeTop&&this.m_freezeSide){
this.setInitialScrollPosition(this.getSection("pfSideHeadings"),0,_aa0);
this.setInitialScrollPosition(this.getSection("pfTopHeadings"),_a9f,0);
}
this.initializeTouchScrolling(_a97);
}else{
this.showMainOutputOnly(_a97);
this.removeTouchScrolling();
}
this.updateTabIndexValues();
}
};
PinFreezeContainer.prototype.calculateMinCrossTabScrollableClientHeight=function(){
var _aa1=0;
if(this.m_cachedPFContainer){
var _aa2=this.getElementByLID(this.m_cachedPFContainer,"table",this.m_lid+this.m_viewerId);
if(_aa2){
var _aa3=0;
for(var r=0;r<_aa2.rows.length;r++){
var row=_aa2.rows[r];
for(var c=0;c<row.cells.length;c++){
var cell=row.cells[c];
if(cell.getAttribute("type")=="datavalue"){
_aa3++;
if(cell.childNodes.length===1&&cell.childNodes[0].getAttribute&&cell.childNodes[0].getAttribute("class")==="textItem"){
_aa1=_aa1+cell.offsetHeight;
}else{
_aa3++;
var _aa8=this.getSection("pfVerticalScrollBar");
if(_aa8){
_aa1=_aa8.offsetWidth*2;
}
}
break;
}
}
if(_aa3>=2){
break;
}
}
}
}
return _aa1;
};
PinFreezeContainer.prototype.updateSideHeadingSize=function(_aa9){
var _aaa=0;
if(this.m_freezeSide){
var _aab=this.getSection("pfMainOutput");
if(!_aab){
return 0;
}
if(!this.frozenSideHeadingsRequired()){
this.showFreezeTopOnly(_aab);
return 0;
}
var _aac=this.getSection("pfSideHeadings");
_aaa=this.getSideHeadingSectionWidth(_aa9);
var _aad=this.getSection("pfHorizontalScrollBar");
var _aae=this.getSectionHomeCell(_aac);
if(_aac.style.display=="none"){
_aac.style.display="";
_aad.style.display="";
}
_aac.style.width=_aaa+"px";
_aac.style.height=_aab.clientHeight+"px";
}
return _aaa;
};
PinFreezeContainer.prototype.updateTopHeadingSize=function(_aaf){
var _ab0=0;
if(this.m_freezeTop){
var _ab1=this.getSection("pfMainOutput");
if(!_ab1){
return 0;
}
if(!this.frozenTopHeadingsRequired()){
this.showFreezeSideOnly(_ab1);
return 0;
}
var _ab2=this.getSection("pfTopHeadings");
_ab0=this.getTopHeadingSectionHeight(_aaf);
var _ab3=this.getSection("pfVerticalScrollBar");
var _ab4=this.getSectionHomeCell(_ab2);
if(_ab2.style.display=="none"){
_ab2.style.display="";
_ab3.style.display="";
}
_ab2.style.height=_ab0+"px";
_ab2.style.width=_ab1.clientWidth+"px";
}
return _ab0;
};
PinFreezeContainer.prototype.setScrollX=function(_ab5,_ab6){
if(getElementDirection(_ab5)==="rtl"){
setScrollRight(_ab5,_ab6);
}else{
setScrollLeft(_ab5,_ab6);
}
};
PinFreezeContainer.prototype.setScrollY=function(_ab7,_ab8){
_ab7.scrollTop=_ab8;
};
PinFreezeContainer.prototype.setInitialScrollPosition=function(_ab9,_aba,_abb){
if(getElementDirection(_ab9)==="rtl"){
setScrollRight(_ab9,_aba);
}else{
setScrollLeft(_ab9,_aba);
}
_ab9.scrollTop=_abb;
};
PinFreezeContainer.prototype.getScrollableClientWidth=function(){
return this.m_scrollableClientWidth;
};
PinFreezeContainer.prototype.setScrollableClientWidth=function(_abc){
this.m_scrollableClientWidth=_abc;
};
PinFreezeContainer.prototype.getContainerWidth=function(){
return this.m_addedFixedWidth?this.m_addedFixedWidth:this.m_clientWidth;
};
PinFreezeContainer.prototype.getClientWidth=function(){
return this.m_clientWidth;
};
PinFreezeContainer.prototype.getScrollableClientHeight=function(){
return this.m_scrollableClientHeight;
};
PinFreezeContainer.prototype.setScrollableClientHeight=function(_abd){
this.m_scrollableClientHeight=_abd;
};
PinFreezeContainer.prototype.getClientHeight=function(){
return this.m_clientHeight;
};
PinFreezeContainer.prototype.clientHeight=function(_abe){
return _abe.clientHeight;
};
PinFreezeContainer.prototype.findBestContainerHeight=function(_abf){
if(this.m_freezeTop&&this.m_cachedReportDiv){
var _ac0=this.m_cachedReportDiv.parentNode;
if(_ac0){
var _ac1=this._findRestOfPageHeight(this.getContainer());
return _abf-_ac1-(this.c_pageMargin/2)-this.m_containerMargin.top;
}
}
return _abf-this.c_pageMargin;
};
PinFreezeContainer.prototype.findBestContainerWidth=function(_ac2){
var node=this.getContainer();
while(node&&node.nodeName.toLowerCase()!="td"&&node.getAttribute("id")!=("mainViewerTable"+this.m_viewerId)){
node=node.parentNode;
}
if(!node){
return -1;
}
if(node.nodeName.toLowerCase()=="td"){
var _ac4=0;
var _ac5=node.parentNode.childNodes;
for(var i=0;i<_ac5.length;i++){
if(_ac5[i]!==node){
_ac4+=_ac5[i].clientWidth;
}
}
return _ac2-_ac4-(this.c_pageMargin/2);
}
return _ac2;
};
PinFreezeContainer.prototype._findRestOfPageHeight=function(node){
var _ac8=0;
var _ac9=node.parentNode;
if(!_ac9){
return _ac8;
}
if(_ac9.childNodes.length>1){
for(var i=0;i<_ac9.childNodes.length;i++){
var _acb=_ac9.childNodes[i];
if(_acb!=node&&!isNaN(_acb.clientHeight)&&_acb.style.display!="none"){
_ac8+=this.clientHeight(_acb);
}
}
}
if(node.getAttribute("id")!=("mainViewerTable"+this.m_viewerId)){
_ac8+=this._findRestOfPageHeight(_ac9);
}
return _ac8;
};
PinFreezeContainer.prototype.resize=function(_acc,_acd,_ace,_acf){
if(this.m_fixedWidth&&this.m_fixedHeight){
return;
}
_acc=(this.m_fixedWidth)?this.m_fixedWidth:_acc;
_acd=(this.m_fixedHeight)?this.m_fixedHeight:_acd;
var _ad0=this.getSectionStructure();
if(this.m_sectionCache&&this.m_cachedPFContainer){
var _ad1=0;
if(_acd!==0){
_ad1=this.findBestContainerHeight(_acd);
if(_ace&&_ad1<300){
_ad1=300;
}else{
if(_ad1<100){
_ad1=100;
}
}
}
this.m_clientHeight=_ad1>0?_ad1:this.m_clientHeight;
var _ad2=0;
if(_acc!==0){
_ad2=this.findBestContainerWidth(_acc);
}
this.m_clientWidth=(_ad2>0)?_ad2-5-(this.c_pageMargin/2):this.m_clientWidth;
var _ad3=this.getSection("pfMainOutput");
var _ad4=this.getSectionHomeCell(_ad3);
if(_ad4){
this.m_scrollableClientWidth=this.m_clientWidth-this.getSideHeadingSectionWidth(_ad4);
this.m_scrollableClientHeight=this.m_clientHeight-_ad4.offsetHeight;
}
if(_acf){
var _ad5=getElementsByAttribute(this.m_cachedPFContainer,"div","pflid",_acf.lid);
if(_ad5){
var node=_ad5[0];
while(node.nodeName.toLowerCase()!="table"){
node=node.parentNode;
}
node.style.width=_acf.width+"px";
}
}
this.updateContainer();
}else{
this.m_clientWidth=_acc-this.c_pageMargin;
this.m_clientHeight=_acd-this.c_pageMargin;
}
var _ad7=this.getSectionStructure();
this.checkSectionStructureChange(_ad0,_ad7);
};
PinFreezeContainer.prototype.updateMainOutputSize=function(){
if(this.m_freezeSide&&this.m_freezeTop){
if(this.frozenSideHeadingsRequired()){
this.updateMainOutputWidth(this.getScrollableClientWidth());
}
if(this.frozenTopHeadingsRequired()){
this.updateMainOutputHeight(this.getScrollableClientHeight());
}
}else{
if(this.m_freezeSide){
this.updateMainOutputWidth(this.getScrollableClientWidth());
}else{
if(this.m_freezeTop){
this.updateMainOutputHeight(this.getScrollableClientHeight());
}
}
}
};
PinFreezeContainer.prototype.updateMainOutputWidth=function(_ad8){
var _ad9=this.getSection("pfMainOutput");
if(!_ad9){
return;
}
if(this.m_freezeSide==true){
_ad9.style.width=(_ad8+"px");
if(this.m_freezeTop==false||!this.frozenTopHeadingsRequired()){
_ad9.style.height=_ad9.firstChild.clientHeight+"px";
}
var _ada=this.getSection("pfHorizontalScrollBar");
if(_ada){
_ada.style.width=(_ad8+"px");
var _adb=_ada.firstChild;
if(_adb){
var _adc=this.getSectionHomeCell(_ad9);
var _add=_ad9.scrollWidth-this.getHomeCellOffsetWidth(_adc);
_adb.style.width=_add+"px";
}
}
}
};
PinFreezeContainer.prototype.updateMainOutputHeight=function(_ade){
var _adf=this.getSection("pfMainOutput");
if(!_adf){
return;
}
_adf.style.height=(_ade+"px");
if(!this.m_freezeSide||!this.frozenSideHeadingsRequired()){
_adf.style.width=_adf.firstChild.clientWidth+2+"px";
}
var _ae0=this.getSection("pfVerticalScrollBar");
if(_ae0){
_ae0.style.height=(_ade+"px");
var _ae1=_ae0.firstChild;
if(_ae1){
var _ae2=this.getSectionHomeCell(_adf);
var _ae3=_adf.scrollHeight-_ae2.offsetHeight;
_ae1.style.height=_ae3+"px";
}
}
};
PinFreezeContainer.prototype.getElementByLID=function(_ae4,tag,lid){
var _ae7=getElementsByAttribute(_ae4,tag,"lid",lid);
if(_ae7.length>0){
return _ae7[0];
}
return null;
};
PinFreezeContainer.prototype.getContainerByLID=function(_ae8){
var _ae9=getElementsByAttribute(_ae8,"table","pfclid","pfContainer_"+this.m_lidNS);
if(_ae9.length>0){
return _ae9[0];
}
return null;
};
PinFreezeContainer.prototype.getSectionByLID=function(_aea,_aeb){
var _aec=getElementsByAttribute(_aea,"div","pfslid",_aeb+"_"+this.m_lidNS);
if(_aec.length>0){
return _aec[0];
}
return null;
};
PinFreezeContainer.getSectionNameFromSlid=function(slid){
return slid?slid.split("_")[0]:null;
};
PinFreezeContainer.getLidFromSlid=function(slid){
return slid.split("_")[1];
};
PinFreezeContainer.nodeToSlid=function(_aef){
while(_aef.parentNode&&!_aef.getAttribute("pfslid")){
_aef=_aef.parentNode;
}
if(_aef.getAttribute){
return _aef.getAttribute("pfslid");
}
return null;
};
PinFreezeContainer.prototype.cacheContainerAndSections=function(_af0){
if(!_af0){
return _af0;
}
this.m_cachedPFContainer=_af0;
var _af1=getElementsByAttribute(this.m_cachedPFContainer,"div","pflid",this.m_lidNS);
this.m_sectionCache={};
for(var i=0;i<_af1.length;++i){
var key=_af1[i].getAttribute("pfslid");
key=key.split("_",1);
this.m_sectionCache[key]=_af1[i];
}
return _af0;
};
PinFreezeContainer.prototype.getContainer=function(){
return this.m_cachedPFContainer;
};
PinFreezeContainer.prototype.getSection=function(key){
if(!this.m_sectionCache){
return null;
}
if(!this.m_sectionCache[key]){
this.m_sectionCache[key]=this.getSectionByLID(this.m_cachedPFContainer,key);
}
return this.m_sectionCache[key];
};
PinFreezeContainer.prototype.initializeHomeCellTabIndex=function(_af5){
var slid=PinFreezeContainer.nodeToSlid(_af5);
if(!this.m_homeCellNodes[slid]){
var _af7=getElementsByAttribute(_af5,"*","tabIndex","*");
for(var i in _af7){
if(!_af7[i].getAttribute("widgetid")){
this.m_homeCellNodes[slid]=_af7[i];
break;
}
}
}
};
PinFreezeContainer.prototype.updateTabIndexValues=function(){
if(this.isContainerFrozen()){
for(var slid in this.m_homeCellNodes){
var _afa=this.m_pinFreezeManager.isNodeVisible(this.m_homeCellNodes[slid])?"0":"-1";
this.m_homeCellNodes[slid].setAttribute("tabIndex",_afa);
}
}else{
for(var slid in this.m_homeCellNodes){
var _afa=(PinFreezeContainer.getSectionNameFromSlid(slid)==="pfMainOutput")?"0":"-1";
this.m_homeCellNodes[slid].setAttribute("tabIndex",_afa);
}
}
};
PinFreezeContainer.prototype.getSectionHomeCell=function(_afb){
if(_afb){
var _afc=this.getElementByLID(_afb,"table",this.m_lid+this.m_viewerId);
if(_afc&&_afc.rows.length&&_afc.rows[0].cells.length){
return _afc.rows[0].cells[0];
}
}
return null;
};
PinFreezeContainer.prototype.getMainOutputHomeCell=function(){
var _afd=this.getSection("pfMainOutput");
if(!_afd){
_afd=this.getSectionByLID(this.m_cachedPFContainer,"pfMainOutput");
}
return this.getSectionHomeCell(_afd);
};
PinFreezeContainer.prototype.getChildPosition=function(_afe,_aff){
for(var i=0;i<_afe.childNodes.length;++i){
if(_afe.childNodes[i]==_aff){
return i;
}
}
return -1;
};
PinFreezeContainer.prototype.insertAt=function(_b01,_b02,_b03){
if(_b03==_b01.childNodes.length){
_b01.appendChild(_b02);
}else{
_b01.insertBefore(_b02,_b01.childNodes[_b03]);
}
};
PinFreezeContainer.prototype.synchScroll=function(){
if(!this.m_cachedPFContainer){
return;
}
var _b04=this.getMainOutputHomeCell();
var _b05=this.getSection("pfMainOutput");
var _b06=this.getSection("pfSideHeadings");
if(_b06!=null){
var _b07=this.getSection("pfHorizontalScrollBar");
if(_b07){
var _b08=this.getSideHeadingSectionWidth(_b04);
if(getElementDirection(_b05)==="rtl"){
_b08=0;
}
setScrollLeft(_b05,getScrollLeft(_b07)+_b08);
if(this.m_freezeTop){
setScrollLeft(this.getSection("pfTopHeadings"),getScrollLeft(_b07)+_b08);
}
}
}
};
PinFreezeContainer.prototype.updateScroll=function(_b09){
var slid=PinFreezeContainer.nodeToSlid(_b09);
if(!slid){
return;
}
var _b0b=PinFreezeContainer.getSectionNameFromSlid(slid);
if(!_b0b){
return;
}
var _b0c=document.getElementById("CVReport"+this.m_viewerId);
if(!_b0c){
return;
}
if(!this.m_cachedPFContainer){
return;
}
var _b0d=_b09.parentNode;
if(_b0d){
var _b0e=_b0d.tagName.toLowerCase();
if(_b0e==="td"||_b0e==="th"){
var _b0f=this.getMainOutputHomeCell();
var _b10=this.getSection("pfMainOutput");
if(_b0b==="pfMainOutput"||_b0b==="pfTopHeadings"){
var _b11=this.getSection("pfHorizontalScrollBar");
if(_b11){
var _b12=PinFreezeContainer.calculateNewPosition(_b0d.offsetLeft,_b0d.offsetWidth,getScrollLeft(_b10),_b10.offsetWidth);
var _b13=this.getHomeCellOffsetWidth(_b0f);
if(getElementDirection(_b10)==="rtl"){
_b13=0;
}
setScrollLeft(_b11,_b12-_b13);
setScrollLeft(_b10,_b12);
}
}
if(_b0b==="pfMainOutput"||_b0b==="pfSideHeadings"){
var _b14=this.getSection("pfVerticalScrollBar");
if(_b14){
var _b15=PinFreezeContainer.calculateNewPosition(_b0d.offsetTop,_b0d.offsetHeight,_b10.scrollTop,_b10.offsetHeight);
_b14.scrollTop=_b15-_b0f.offsetHeight;
_b10.scrollTop=_b15;
}
}
}
}
};
PinFreezeContainer.calculateNewPosition=function(_b16,_b17,_b18,_b19){
var _b1a=_b16+_b17;
var _b1b=_b18+_b19;
if(_b18>_b16){
return _b16;
}else{
if(_b1b<_b1a){
if(_b17>_b19){
return _b16;
}
return _b1a-_b19;
}
}
return _b18;
};
PinFreezeContainer.prototype.synchVScroll=function(){
if(!this.m_cachedPFContainer){
return;
}
var _b1c=this.getMainOutputHomeCell();
var _b1d=this.getSection("pfMainOutput");
var _b1e=this.getSection("pfTopHeadings");
if(_b1e!=null){
var _b1f=this.getSection("pfVerticalScrollBar");
if(_b1f){
_b1d.scrollTop=_b1f.scrollTop+this.getTopHeadingSectionHeight(_b1c);
if(this.m_freezeSide){
this.getSection("pfSideHeadings").scrollTop=_b1f.scrollTop+this.getTopHeadingSectionHeight(_b1c);
}
}
}
};
PinFreezeContainer.prototype.getTopHeadingSectionHeight=function(_b20){
return _b20.offsetHeight+_b20.offsetTop+this.m_containerMargin.top;
};
PinFreezeContainer.prototype._findBestGuessHomeCell=function(_b21){
if(this.m_bestGuessHomeCell){
return this.m_bestGuessHomeCell;
}
if(_b21){
var _b22=_b21.parentNode.parentNode;
var _b23=_b21.rowSpan?(_b21.rowSpan):1;
var tr=_b22.childNodes[_b23];
if(tr){
var _b25=tr.childNodes.length;
var _b26=null;
var td=null;
for(var i=0;i<_b25;i++){
td=tr.childNodes[i];
if(td.getAttribute("type")=="datavalue"){
break;
}
_b26=td;
}
if(_b26){
this.m_bestGuessHomeCell=_b26;
return this.m_bestGuessHomeCell;
}
}else{
return _b21;
}
}
return null;
};
PinFreezeContainer.prototype.getHomeCellOffsetWidth=function(_b29){
var _b2a=this._findBestGuessHomeCell(_b29);
return _b2a?_b2a.offsetWidth:0;
};
PinFreezeContainer.prototype.getSideHeadingSectionWidth=function(_b2b){
var _b2c=this._findBestGuessHomeCell(_b2b);
if(_b2c){
return _b2c.offsetWidth+_b2c.offsetLeft+this.m_containerMargin.left;
}else{
return _b2b.offsetWidth+_b2b.offsetLeft;
}
};
PinFreezeContainer.prototype.isContainerFrozen=function(){
return (this.m_freezeTop||this.m_freezeSide);
};
PinFreezeContainer.prototype.unfreeze=function(_b2d){
var _b2e=this.getContainerByLID(_b2d);
this.m_freezeTop=false;
this.m_freezeSide=false;
if(_b2e){
var _b2f=_b2e.parentNode;
pfMainOutput=this.getSectionByLID(_b2e,"pfMainOutput");
if(pfMainOutput&&_b2f){
if(_b2e.style.border!==""){
pfMainOutput.firstChild.style.border=_b2e.style.border;
_b2e.style.border="";
}
if(this.m_wrapFlag){
var _b30=pfMainOutput.firstChild.getElementsByTagName("span");
if(_b30){
for(var k=0;k<_b30.length;k++){
_b30[k].style.whiteSpace="";
}
}
this.m_wrapFlag=false;
}
this.updateTabIndexValues();
if(this.m_cachedBaseContainer.getAttribute("authoredFixedWidth")){
this.m_cachedBaseContainer.removeAttribute("authoredFixedWidth");
this.m_cachedBaseContainer.style.width="auto";
this.m_addedFixedWidth=null;
}
if(this.m_cachedBaseContainer.getAttribute("authoredFixedHeight")){
this.m_cachedBaseContainer.removeAttribute("authoredFixedHeight");
this.m_cachedBaseContainer.style.height="auto";
this.m_addedFixedHeight=null;
}
_b2f.replaceChild(this.m_pinFreezeManager.deepCloneNode(pfMainOutput.firstChild),_b2e);
}
}
};
PinFreezeContainer.prototype.getBorderInfo=function(el,_b33){
var _b34={};
var _b35="border-"+_b33+"-";
var _b36="border"+_b33.charAt(0).toUpperCase()+_b33.substring(1);
if(el.currentStyle){
_b34[_b36+"Width"]=el.currentStyle[_b36+"Width"];
_b34[_b36+"Style"]=el.currentStyle[_b36+"Style"];
_b34[_b36+"Color"]=el.currentStyle[_b36+"Color"];
}else{
if(window.getComputedStyle){
_b34[_b36+"Width"]=window.getComputedStyle(el,null).getPropertyValue(_b35+"width");
_b34[_b36+"Style"]=window.getComputedStyle(el,null).getPropertyValue(_b35+"style");
_b34[_b36+"Color"]=window.getComputedStyle(el,null).getPropertyValue(_b35+"color");
}else{
return null;
}
}
return _b34;
};
PinFreezeContainer.prototype.isA11yEnabled=function(_b37){
return (_b37.getAttribute("role")==="grid");
};
PinFreezeContainer.isElementInMainOutput=function(_b38){
var _b39=PinFreezeContainer.nodeToSlid(_b38);
if(_b39){
return (_b39.indexOf("pfMainOutput_")===0);
}
return false;
};
PinFreezeContainer.prototype.removeCTX=function(_b3a){
_b3a.removeAttribute("ctx");
var _b3b=getElementsByAttribute(_b3a,"*","ctx","*");
if(_b3b&&_b3b.length){
for(var i=0;i<_b3b.length;i++){
_b3b[i].removeAttribute("ctx");
}
}
};
PinFreezeContainer.prototype.initializeTouchScrolling=function(_b3d){
if(!this.m_pinFreezeManager.isIWidgetMobile()){
return;
}
if(_b3d){
_b3d.m_pinFreezeContainer=this;
if(document.attachEvent){
_b3d.attachEvent("touchstart",this.touchStart);
_b3d.attachEvent("touchmove",this.touchMove);
_b3d.attachEvent("touchend",this.touchEnd);
}else{
_b3d.addEventListener("touchstart",this.touchStart,false);
_b3d.addEventListener("touchmove",this.touchMove,false);
_b3d.addEventListener("touchend",this.touchEnd,false);
}
}
};
PinFreezeContainer.prototype.removeTouchScrolling=function(){
if(!this.m_pinFreezeManager.isIWidgetMobile()){
return;
}
this.removeTouchScrollingEvents(this.getSection("pfMainOutput"));
this.removeTouchScrollingEvents(this.getSection("pfSideHeadings"));
this.removeTouchScrollingEvents(this.getSection("pfTopHeadings"));
};
PinFreezeContainer.prototype.removeTouchScrollingEvents=function(_b3e){
if(!this.m_pinFreezeManager.isIWidgetMobile()){
return;
}
if(_b3e){
if(document.detachEvent){
_b3e.detachEvent("touchstart",this.touchStart);
_b3e.detachEvent("touchmove",this.touchMove);
_b3e.detachEvent("touchend",this.touchEnd);
}else{
_b3e.removeEventListener("touchstart",this.touchStart,false);
_b3e.removeEventListener("touchmove",this.touchMove,false);
_b3e.removeEventListener("touchend",this.touchEnd,false);
}
}
};
PinFreezeContainer.prototype.touchMove=function(e){
if(this.m_pinFreezeContainer&&e&&e.changedTouches&&e.touches&&e.touches.length==1){
var _b40=e.changedTouches[0];
if(_b40&&_b40.clientX&&_b40.clientY){
var _b41=parseInt(_b40.clientX);
var _b42=parseInt(_b40.clientY);
if(this.m_pinFreezeContainer.touchMoveHandler(_b41,_b42)){
return stopEventBubble(e);
}
}
}
};
PinFreezeContainer.prototype.touchStart=function(e){
if(this.m_pinFreezeContainer&&e&&e.changedTouches&&e.touches&&e.touches.length==1){
var _b44=e.changedTouches[0];
if(_b44&&_b44.clientX&&_b44.clientY){
var _b45=parseInt(_b44.clientX);
var _b46=parseInt(_b44.clientY);
this.m_pinFreezeContainer.touchStartHandler(_b45,_b46);
}
}
};
PinFreezeContainer.prototype.touchStartHandler=function(_b47,_b48){
this.touchScrollSections=false;
this.touchPreviousX=_b47;
this.touchPreviousY=_b48;
};
PinFreezeContainer.prototype.touchEnd=function(e){
if(this.m_pinFreezeContainer&&this.m_pinFreezeContainer.touchEndHandler()){
stopEventBubble(e);
}
};
PinFreezeContainer.prototype.touchEndHandler=function(){
var _b4a=this.touchScrollSections;
this.touchScrollSections=false;
this.touchPreviousX=-1;
this.touchPreviousY=-1;
return _b4a;
};
PinFreezeContainer.prototype.touchMoveHandler=function(_b4b,_b4c){
var _b4d=this.getSection("pfMainOutput");
if(!_b4d){
return;
}
var _b4e=this.getSectionHomeCell(_b4d);
var _b4f=this.getTopHeadingSectionHeight(_b4e);
var _b50=this.getSideHeadingSectionWidth(_b4e);
var _b51=_b4c-this.touchPreviousY;
var _b52=_b4b-this.touchPreviousX;
if(this.touchScrollSections){
if(_b51!=0){
var _b53=_b4d.scrollTop-_b51;
_b53=(_b53>_b4f)?_b53:_b4f;
_b4d.scrollTop=_b53;
var _b54=this.getSection("pfSideHeadings");
if(_b54){
_b54.scrollTop=_b53;
}
}
if(_b52!=0){
var _b55=_b4d.scrollLeft-_b52;
_b55=(_b55>_b50)?_b55:_b50;
_b4d.scrollLeft=_b55;
var _b56=this.getSection("pfTopHeadings");
if(_b56){
_b56.scrollLeft=_b55;
}
}
}else{
this.firstTouchMove(_b4d,_b52,_b51,_b50,_b4f);
}
this.touchPreviousX=_b4b;
this.touchPreviousY=_b4c;
return this.touchScrollSections;
};
PinFreezeContainer.prototype.firstTouchMove=function(_b57,_b58,_b59,_b5a,_b5b){
var _b5c=this.mostlyVerticalTouchMove(_b58,_b59);
var _b5d=PinFreezeContainer.isSectionVisible(this.getSection("pfTopHeadings"));
var _b5e=PinFreezeContainer.isSectionVisible(this.getSection("pfSideHeadings"));
if(_b5c&&(!_b5d||(_b59>0&&_b57.scrollTop<=_b5b)||(_b59<0&&_b57.scrollTop+_b57.clientHeight>=_b57.scrollHeight))){
this.touchScrollSections=false;
}else{
if(!_b5c&&(!_b5e||(_b58>0&&_b57.scrollLeft<=_b5a)||(_b58<0&&_b57.scrollLeft+_b57.clientWidth>=_b57.scrollWidth))){
this.touchScrollSections=false;
}else{
this.touchScrollSections=true;
}
}
};
PinFreezeContainer.prototype.mostlyVerticalTouchMove=function(_b5f,_b60){
var _b61=(_b5f>0)?_b5f:0-_b5f;
var _b62=(_b60>0)?_b60:0-_b60;
return (_b62>_b61);
};
PinFreezeContainer.prototype.destroy=function(){
this.removeTouchScrolling();
GUtil.destroyProperties(this);
};
function PinFreezeManager(oCV){
this.m_oCV=oCV;
this.m_viewerId=oCV.getId();
this.m_frozenInfo=null;
this.m_lastWidthProcessed=0;
this.m_lastHeightProcessed=0;
this.c_resizeTweekLimit=5;
this.m_repaintOnVisible=false;
};
PinFreezeManager.prototype.addContainerObject=function(lid,_b65,_b66,_b67,_b68){
if(_b65||_b66){
if(!this.m_frozenInfo){
this.m_frozenInfo={};
}
if(!this.m_frozenInfo[lid]){
this._createDefaultFrozenInfo(lid);
}
this.m_frozenInfo[lid].freezeTop=_b65;
this.m_frozenInfo[lid].freezeSide=_b66;
var _b69=this.newContainer(lid,_b65,_b66,_b67,_b68);
this.m_frozenInfo[lid].pinFreezeContainers.push(_b69);
return _b69;
}
return null;
};
PinFreezeManager.prototype.newContainer=function(lid,_b6b,_b6c,_b6d,_b6e){
return new PinFreezeContainer(this,lid,this.m_viewerId,_b6b,_b6c,_b6d,_b6e);
};
PinFreezeManager.prototype.clearPinInfo=function(lid){
if(!this.m_frozenInfo){
return;
}
if(lid){
if(this.m_frozenInfo[lid]){
delete this.m_frozenInfo[lid];
}
}else{
delete this.m_frozenInfo;
this.m_frozenInfo=null;
}
};
PinFreezeManager.prototype._createDefaultFrozenInfo=function(lid){
this.m_frozenInfo[lid]={"lid":lid,"freezeTop":false,"freezeSide":false,"pinFreezeContainers":[],"childContainers":{}};
};
PinFreezeManager.prototype._resetFrozenInfo=function(lid){
var _b72=this.m_frozenInfo[lid];
if(_b72){
delete _b72.pinFreezeContainers;
_b72.pinFreezeContainers=[];
_b72.freezeTop=false;
_b72.freezeSide=false;
}
};
PinFreezeManager.prototype.prepopulateFrozenInfo=function(_b73){
var _b74=getDescendantElementsByAttribute(_b73,"table","lid","",false,-1,new RegExp("[\\s\\S]*"));
if(_b74){
if(!this.m_frozenInfo){
this.m_frozenInfo={};
}
for(var i=0;i<_b74.length;i++){
var _b76=_b74[i];
if(_b76.getAttribute("id")=="rt"+this.m_viewerId){
continue;
}
var lid=this.removeNamespace(_b76.getAttribute("lid"));
if(this.m_frozenInfo[lid]&&this.m_frozenInfo[lid].childContainers){
continue;
}
if(!this.m_frozenInfo[lid]){
this._createDefaultFrozenInfo(lid);
}
if(!this.m_frozenInfo[lid].childContainers){
this.m_frozenInfo[lid].childContainers={};
}
var _b78=getDescendantElementsByAttribute(_b76,"table","lid","",false,-1,new RegExp("[\\s\\S]*"));
if(_b78){
for(var _b79=0;_b79<_b78.length;_b79++){
var _b7a=_b78[_b79];
var _b7b=this.removeNamespace(_b7a.getAttribute("lid"));
if(!this.m_frozenInfo[lid].childContainers[_b7b]){
var _b7c=_b7a.parentNode;
while(_b7c&&!_b7c.getAttribute("lid")){
_b7c=_b7c.parentNode;
}
if(_b7c&&this.removeNamespace(_b7c.getAttribute("lid"))==lid){
this.m_frozenInfo[lid].childContainers[_b7b]=true;
}
}
}
}
}
this._updateParentContainerInfo();
}
};
PinFreezeManager.prototype._updateParentContainerInfo=function(){
for(var _b7d in this.m_frozenInfo){
var _b7e=this.m_frozenInfo[_b7d].childContainers;
if(_b7e){
for(var _b7f in _b7e){
if(this.m_frozenInfo[_b7f]){
this.m_frozenInfo[_b7f].parentContainer=_b7d;
break;
}
}
}
}
};
PinFreezeManager.prototype.getTopLevelContainerLID=function(lid){
if(this.m_frozenInfo[lid]){
while(this.m_frozenInfo[lid].parentContainer){
lid=this.m_frozenInfo[lid].parentContainer;
}
}
return lid;
};
PinFreezeManager.prototype.freezeContainer=function(lid,_b82,_b83){
var _b84=document.getElementById("CVReport"+this.m_viewerId);
this.prepopulateFrozenInfo(_b84);
var _b85=this.getTopLevelContainerLID(lid);
this.unfreezeAllNestedContainers(_b85,_b84);
this.m_frozenInfo[lid].freezeTop=_b82;
this.m_frozenInfo[lid].freezeSide=_b83;
var _b86=this._createPinAndFreezeObject(_b84,_b85);
this.m_lastWidthProcessed=0;
this.m_lastHeightProcessed=0;
this._resizePinFreezeObjects(_b86);
this.sectionStructureChange();
if(isIE()){
var obj=this;
setTimeout(function(){
obj.refresh();
},1);
var _b88=document.getElementById("RVContent"+this.m_viewerId);
this.m_oCV.repaintDiv(_b88);
}
return _b86;
};
PinFreezeManager.prototype.getInitialWidthThreshold=function(){
return document.body.clientWidth*3/4;
};
PinFreezeManager.prototype.getInitialHeightThreshold=function(){
return document.body.clientWidth*9/10;
};
PinFreezeManager.prototype.hasFrozenContainers=function(){
return ((this.m_frozenInfo)?true:false);
};
PinFreezeManager.prototype.hasFrozenRowHeadings=function(lid){
if(this.m_frozenInfo&&this.m_frozenInfo[lid]){
return this.m_frozenInfo[lid].freezeSide?this.m_frozenInfo[lid].freezeSide:false;
}
return false;
};
PinFreezeManager.prototype.hasFrozenColumnHeadings=function(lid){
if(this.m_frozenInfo&&this.m_frozenInfo[lid]){
return this.m_frozenInfo[lid].freezeTop?this.m_frozenInfo[lid].freezeTop:false;
}
return false;
};
PinFreezeManager.prototype.removeNamespace=function(idNS){
if(idNS.length>this.m_viewerId.length){
if(idNS.indexOf(this.m_viewerId)>0){
return idNS.substring(0,idNS.indexOf(this.m_viewerId));
}
}
return idNS;
};
PinFreezeManager.prototype.getContainer=function(lid,_b8d){
if(this.m_frozenInfo&&this.m_frozenInfo[lid]&&this.m_frozenInfo[lid].pinFreezeContainers[0]){
_b8d=_b8d?_b8d:0;
return this.m_frozenInfo[lid].pinFreezeContainers[_b8d];
}
return null;
};
PinFreezeManager.prototype.nodeToContainer=function(node){
var slid=PinFreezeContainer.nodeToSlid(node);
var _b90=null;
if(slid){
var lid=this.removeNamespace(PinFreezeContainer.getLidFromSlid(slid));
_b90=this.getContainer(lid);
}
return _b90;
};
PinFreezeManager.prototype.getContainerElement=function(_b92){
var lid=this.removeNamespace(_b92.getAttribute("lid"));
if(lid){
var _b94=this.getContainer(lid);
if(_b94){
return _b94.getContainer();
}
}
return null;
};
PinFreezeManager.prototype._createPinAndFreezeObject=function(_b95,lid){
var _b97=null;
if(this.m_frozenInfo){
var _b98=this.m_frozenInfo[lid];
var _b99=_b98.initialLoad;
if(_b99){
delete _b98.initialLoad;
}
var _b9a=_b98.freezeTop;
var _b9b=_b98.freezeSide;
var _b9c=null;
if(_b99&&_b98.pinFreezeContainers&&(_b9a||_b9b)){
_b9c=_b98.pinFreezeContainers.slice(0);
}
var _b9d=_b95;
if(_b98&&_b98.parentContainer){
var _b9e=getElementsByAttribute(_b95,"table","lid",_b98.parentContainer+this.m_viewerId);
if(_b9e){
for(parentIndex=0;parentIndex<_b9e.length;parentIndex++){
if(!_b9e[parentIndex].getAttribute("clonednode")){
_b9d=_b9e[parentIndex];
break;
}
}
}
}
if(_b98.childContainers){
for(var _b9f in _b98.childContainers){
var _ba0=this._createPinAndFreezeObject(_b9d,_b9f);
_b97=_b97?_b97:_ba0;
}
}
var _ba1=getElementsByAttribute(_b9d,"table","lid",lid+this.m_viewerId);
if(_ba1&&_ba1.length>0){
delete _b98.pinFreezeContainers;
_b98.pinFreezeContainers=[];
}else{
return null;
}
if(_ba1&&(_b9a||_b9b)){
var _ba2=(_b97!==null);
for(var i=0;i<_ba1.length;i++){
var _ba4=_ba1[i];
if(_ba4.getAttribute("clonednode")=="true"){
continue;
}
_b97=this.addContainerObject(lid,_b9a,_b9b,_ba4,i);
if(_b97){
_b97.createPFContainer(_b9d,_ba2);
if(_b99){
_b97.copyProperties(_b9c[0]);
}
_b97.freezeContainerInReport(_b95);
}
}
}
}
return _b97;
};
PinFreezeManager.prototype.renderReportWithFrozenContainers=function(_ba5){
if(this.m_frozenInfo){
var _ba6=false;
var _ba7=null;
for(var _ba8 in this.m_frozenInfo){
var _ba9=this.m_frozenInfo[_ba8];
if(!_ba6){
_ba6=_ba9.initialLoad;
}
if(!_ba9.parentContainer){
var temp=this._createPinAndFreezeObject(_ba5,_ba9.lid);
_ba7=_ba7?_ba7:temp;
}
}
if(!_ba6&&_ba7){
this._resizePinFreezeObjects(_ba7);
}
this.refresh();
}
};
PinFreezeManager.prototype._resizePinFreezeObjects=function(_bab){
var _bac,_bad;
var _bae=this.m_oCV.getViewerWidget();
if(_bae){
var size=_bae.getWidgetSize();
_bad=(size&&size.w&&(size.w<this.getInitialWidthThreshold()))?size.w:_bab.getClientWidth();
_bac=(size&&size.h&&(size.h<this.getInitialHeightThreshold()))?size.h:_bab.getClientHeight();
}else{
var _bb0=document.getElementById("RVContent"+this.m_viewerId);
var _bb1=document.getElementById("mainViewerTable"+this.m_viewerId);
_bad=_bb0.clientWidth;
_bac=_bb1.clientHeight;
}
this.m_lastWidthProcessed=0;
this.m_lastHeightProcessed=0;
this.resize(_bad,_bac);
};
PinFreezeManager.prototype.resize=function(_bb2,_bb3){
var _bb4=(Math.abs(_bb2-this.m_lastWidthProcessed)<this.c_resizeTweekLimit);
var _bb5=(Math.abs(_bb3-this.m_lastHeightProcessed)<this.c_resizeTweekLimit);
if(_bb4&&_bb5){
return;
}
var _bb6=(Math.abs(_bb2-this.m_lastWidthProcessed)>2)?_bb2:0;
var _bb7=(Math.abs(_bb3-this.m_lastHeightProcessed)>2)?_bb3:0;
for(var lid in this.m_frozenInfo){
if(!this.m_frozenInfo[lid].parentContainer){
this.resizeContainer(lid,_bb6,_bb7);
}
}
this.m_lastWidthProcessed=_bb2;
this.m_lastHeightProcessed=_bb3;
};
PinFreezeManager.prototype.resizeContainer=function(lid,_bba,_bbb){
var _bbc=this.m_frozenInfo[lid];
if(_bbc){
var _bbd=null;
if(_bbc.childContainers){
var _bbe=_bba>10?_bba-10:_bba;
var _bbf=_bbb>10?_bbb-10:_bbb;
for(var _bc0 in _bbc.childContainers){
_bbd=this.resizeContainer(_bc0,_bbe,_bbf);
}
}
var _bc1=_bbc.pinFreezeContainers;
var _bc2=null;
var _bc3=null;
if(_bc1){
for(var i=0;i<_bc1.length;i++){
_bc2=_bc1[i];
_bc2.resize(_bba,_bbb,_bbc.parentContainer,_bbd);
var _bc5=_bc2.getContainer();
if(_bc5&&(!_bc3||(_bc3.width<_bc5.clientWidth))){
_bc3={"width":_bc5.clientWidth,"lid":_bc2.m_lidNS};
}
}
}
return _bc3;
}
};
PinFreezeManager.prototype.processAutoResize=function(_bc6,_bc7){
this.m_lastWidthProcessed=_bc6;
this.m_lastHeightProcessed=_bc7;
};
PinFreezeManager.prototype.onSetVisible=function(){
this.refresh();
if(this.m_repaintOnVisible){
this.rePaint();
this.m_repaintOnVisible=false;
}
};
PinFreezeManager.prototype.onResizeCanvas=function(_bc8){
if(_bc8){
this.rePaint();
}else{
this.m_repaintOnVisible=true;
}
};
PinFreezeManager.prototype.rePaint=function(){
for(var lid in this.m_frozenInfo){
if(!this.m_frozenInfo[lid].parentContainer){
this.resizeContainer(lid,this.m_lastWidthProcessed,this.m_lastHeightProcessed);
}
}
};
PinFreezeManager.prototype.refresh=function(){
for(var _bca in this.m_frozenInfo){
var _bcb=this.m_frozenInfo[_bca].pinFreezeContainers;
if(_bcb){
for(var i=0;i<_bcb.length;i++){
var _bcd=_bcb[i];
_bcd.synchScroll();
_bcd.synchVScroll();
}
}
}
};
PinFreezeManager.prototype.freezeContainerRowHeadings=function(lid){
return this.freezeContainer(lid,this.hasFrozenColumnHeadings(lid),true);
};
PinFreezeManager.prototype.freezeSelectedRowHeadings=function(){
var lid=this.getValidSelectedContainerId(false);
if(lid){
this.m_oCV.getSelectionController().resetSelections();
return this.freezeContainerRowHeadings(lid);
}
return null;
};
PinFreezeManager.prototype.canFreezeSelectedRowHeadings=function(){
var lid=this.getValidSelectedContainerId(false);
if(lid){
return (!this.hasFrozenRowHeadings(lid));
}
return false;
};
PinFreezeManager.prototype.unfreezeContainerRowHeadings=function(lid){
this.freezeContainer(lid,this.hasFrozenColumnHeadings(lid),false);
};
PinFreezeManager.prototype.unfreezeSelectedRowHeadings=function(){
var lid=this.getValidSelectedContainerId(false);
if(lid){
this.m_oCV.getSelectionController().resetSelections();
this.unfreezeContainerRowHeadings(lid);
}
};
PinFreezeManager.prototype.canUnfreezeSelectedRowHeadings=function(){
var lid=this.getValidSelectedContainerId(false);
if(lid){
return (this.hasFrozenRowHeadings(lid));
}
return false;
};
PinFreezeManager.prototype.freezeContainerColumnHeadings=function(lid){
return this.freezeContainer(lid,true,this.hasFrozenRowHeadings(lid));
};
PinFreezeManager.prototype.freezeSelectedColumnHeadings=function(){
var lid=this.getValidSelectedContainerId(true);
if(lid){
this.m_oCV.getSelectionController().resetSelections();
return this.freezeContainerColumnHeadings(lid);
}
return null;
};
PinFreezeManager.prototype.canFreezeSelectedColumnHeadings=function(){
var lid=this.getValidSelectedContainerId(true);
if(lid){
return (!this.hasFrozenColumnHeadings(lid));
}
return false;
};
PinFreezeManager.prototype.unfreezeContainerColumnHeadings=function(lid){
this.freezeContainer(lid,false,this.hasFrozenRowHeadings(lid));
};
PinFreezeManager.prototype.unfreezeSelectedColumnHeadings=function(){
var lid=this.getValidSelectedContainerId(true);
if(lid){
this.m_oCV.getSelectionController().resetSelections();
this.unfreezeContainerColumnHeadings(lid);
}
};
PinFreezeManager.prototype.canUnfreezeSelectedColumnHeadings=function(){
var lid=this.getValidSelectedContainerId(true);
if(lid){
return (this.hasFrozenColumnHeadings(lid));
}
return false;
};
PinFreezeManager.prototype.getValidSelectedContainerId=function(_bda){
var _bdb=this.m_oCV.getSelectionController().getAllSelectedObjects();
if(_bdb&&_bdb.length&&(_bdb[0].getDataContainerType()==="crosstab"||(_bda&&_bdb[0].getDataContainerType()==="list"))){
var lid=(_bdb[0].getLayoutElementId());
if(lid){
if(!this.hasPromptControlsInFreezableCells(lid)){
return this.removeNamespace(lid);
}
}
}
return null;
};
PinFreezeManager.prototype.hasPromptControlsInFreezableCells=function(lid){
var _bde=this.m_oCV.getLayoutElementFromLid(lid);
var _bdf=getElementsByAttribute(_bde,["td","th"],"type","columnTitle");
var _be0=new RegExp("(^|[W])clsPromptComponent($|[W])");
var _be1=isIE()?"className":"class";
for(var j in _bdf){
if(_bdf.hasOwnProperty(j)){
var _be3=getElementsByAttribute(_bdf[j],"*",_be1,null,1,_be0);
if(_be3.length>0){
return true;
}
}
}
return false;
};
PinFreezeManager.prototype.unfreeze=function(lid,_be5,_be6){
if(this.m_frozenInfo&&this.m_frozenInfo[lid]){
var _be7=this.m_frozenInfo[lid].pinFreezeContainers;
if(_be7){
for(var i=0;i<_be7.length;i++){
var _be9=_be7[i];
_be9.unfreeze(_be5);
}
if(_be6){
this._resetFrozenInfo(lid);
}
}
}
};
PinFreezeManager.prototype.unfreezeAllNestedContainers=function(lid,_beb){
var _bec=this.m_frozenInfo[lid];
if(_bec){
if(_bec.freezeTop||_bec.freezeSide){
this.unfreeze(lid,_beb,false);
}
if(_bec.childContainers){
for(var _bed in _bec.childContainers){
this.unfreezeAllNestedContainers(_bed,_beb);
}
}
}
};
PinFreezeManager.prototype.isNodeVisible=function(node){
var slid=PinFreezeContainer.nodeToSlid(node);
if(!slid){
return true;
}
var lid=this.removeNamespace(PinFreezeContainer.getLidFromSlid(slid));
var _bf1=this.getContainer(lid);
if(!_bf1){
return true;
}
var _bf2=PinFreezeContainer.getSectionNameFromSlid(slid);
var _bf3=_bf1.getSection(_bf2);
var _bf4=null,_bf5=null;
var _bf6=node;
var _bf7=null;
while(_bf6&&_bf6!==_bf3&&!_bf4&&!_bf5){
_bf4=_bf1.getMain(_bf6);
_bf5=_bf1.getCopy(_bf6);
_bf7=_bf6;
_bf6=_bf6.parentNode;
}
var _bf8=_bf4?true:false;
var _bf9=_bf5?true:false;
if(_bf8){
return _bf1.getCopy(_bf4)===_bf7;
}else{
if(_bf9){
return _bf1.getCopy(_bf7)?false:true;
}else{
return true;
}
}
};
PinFreezeManager.prototype.sectionStructureChange=function(){
var _bfa=this.m_oCV.getViewerWidget();
if(_bfa&&_bfa.getAnnotationHelper()){
_bfa.getAnnotationHelper().repositionCommentIndicators();
}
};
PinFreezeManager.prototype.deepCloneNode=function(_bfb){
var copy=_bfb.cloneNode(true);
var _bfd=this.m_oCV.getViewerWidget();
if(_bfd){
if(_bfd.reportContainsDijits()){
var _bfe=getElementsByAttribute(copy,"*","widgetid","*");
if(_bfe&&_bfe.length){
for(var i=0;i<_bfe.length;i++){
_bfe[i].parentNode.removeChild(_bfe[i]);
}
}
}
}
return copy;
};
PinFreezeManager.prototype.toJSONString=function(){
var _c00="";
var _c01="";
for(var _c02 in this.m_frozenInfo){
if(_c00.length>0){
_c00+=",";
}
var _c03=this.m_frozenInfo[_c02];
_c00+="{";
_c00+="\"lid\":\""+_c03.lid.replace("\"","\\\"")+"\",";
_c00+="\"freezeTop\":"+_c03.freezeTop+",";
_c00+="\"freezeSide\":"+_c03.freezeSide+",";
if(_c03.parentContainer){
_c00+="\"parentContainer\":\""+_c03.parentContainer+"\",";
}
if(_c03.pinFreezeContainers&&_c03.pinFreezeContainers.length>0){
_c00+="\"properties\":"+_c03.pinFreezeContainers[0].toJSONString()+",";
}
_c00+="\"childContainers\": {";
if(_c03.childContainers){
var _c04=true;
for(var _c05 in _c03.childContainers){
if(!_c04){
_c00+=",";
}
_c00+="\""+_c05+"\":true";
_c04=false;
}
}
_c00+="}}";
}
if(_c00.length>0){
_c01="{\"version\":1, \"containers\":["+_c00+"]}";
}
return _c01;
};
PinFreezeManager.prototype.fromJSONString=function(_c06){
if(!_c06||_c06.length===0){
return;
}
var _c07=null;
try{
_c07=eval("("+_c06+")");
}
catch(e){
if(typeof console!="undefined"){
console.log("PinFreezeManager.prototype.fromJSON could not parse JSON - "+_c06);
console.log(e);
}
}
if(!_c07){
return;
}
var _c08=_c07.containers;
var _c09=_c07.version;
if(_c08.length>0){
this.m_frozenInfo={};
}
for(var _c0a=0;_c0a<_c08.length;_c0a++){
var _c0b=_c08[_c0a];
var lid=_c0b.lid;
var _c0d=_c0b.freezeTop;
var _c0e=_c0b.freezeSide;
var _c0f=document.getElementById("CVReport"+this.m_viewerId);
var _c10=getElementsByAttribute(_c0f,"table","lid",lid+this.m_viewerId);
var _c11=[];
if(_c10&&(_c0d||_c0e)){
for(var i=0;i<_c10.length;i++){
var _c13=_c10[i];
var _c14=new PinFreezeContainer(this,lid,this.m_viewerId,_c0b.freezeTop,_c0b.freezeSide,_c13,i);
if(_c0b.properties){
applyJSONProperties(_c14,_c0b.properties);
}
_c11.push(_c14);
}
}
this.m_frozenInfo[lid]={"lid":lid,"freezeTop":_c0d,"freezeSide":_c0e,"pinFreezeContainers":_c11,"initialLoad":true};
if(_c09>=1){
if(_c0b.childContainers){
this.m_frozenInfo[lid].childContainers=_c0b.childContainers;
}
if(_c0b.parentContainer){
this.m_frozenInfo[lid].parentContainer=_c0b.parentContainer;
}
}
}
};
PinFreezeManager.prototype.removeIdAttribute=function(_c15){
var _c16=_c15.getAttribute("id");
if(_c16!==null&&_c16!==""){
_c15.removeAttribute("id");
}
var _c17=getElementsByAttribute(_c15,"*","id","*");
if(_c17&&_c17.length){
for(var i=0;i<_c17.length;i++){
_c17[i].removeAttribute("id");
}
}
return _c15;
};
PinFreezeManager.prototype.isElementInMainOutput=function(_c19){
return PinFreezeContainer.isElementInMainOutput(_c19);
};
PinFreezeManager.prototype.isIWidgetMobile=function(){
return (this.m_oCV&&this.m_oCV.isIWidgetMobile());
};
PinFreezeManager.prototype.destroy=function(){
GUtil.destroyProperties(this);
};
dojo.provide("WidgetContextManager");
dojo.declare("WidgetContextManager",null,{PP_WIDGET_CONTEXT:"com.ibm.widget.context",PP_REPORT_PROMPT_CONTEXT:"com.ibm.widget.context.report.prompt",PP_REPORT_DRILL_CONTEXT:"com.ibm.widget.context.report.drill",PP_VALUES:"values",PP_RANGES:"ranges",PP_MULTIVALUED:"multivalued",PP_MODELITEM:"modelItem",PP_MODELINFO:"modelInfo",PP_PROMPT:"prompt",PP_DRILL:"drill",PP_SELECT_CHOICES:"selectChoices",PP_BUX_SELECTVALUECONTROL_CONTEXT:"com.ibm.widget.context.bux.selectValueControl",PP_BUX_SELECTION_CONTEXT:"com.ibm.widget.context.bux.selection",PP_CASCADEPROMPT_CLEAR:"clearCascadePromptParams",EVENT_NAME_PROMPT:"com.ibm.widget.contextChanged.prompt",EVENT_NAME_DRILL:"com.ibm.widget.contextChanged.drill",EVENT_NAME_SELECTVALUECONTROL:"com.ibm.widget.contextChanged.selectValueControl",DEFAULT_MODEL_PATH:".",m_widget:null,m_oWidgetContextContainer:null,m_oPromptContextContainer:null,m_oDrillContextContainer:null,m_oPromptGenericContext:null,m_oDrillGenericContext:null,m_oFilterGenericContext:null,m_oSelectionFilterContext:null,m_oContextCollection:null,m_oWidgetContextObject:null,m_oPromptContextObject:null,m_oDrillContextObject:null,m_aSelectionFilterObjects:null,constructor:function(_c1a){
this.m_widget=_c1a;
this.m_oWidgetContextContainer={};
this.m_oPromptContextContainer={};
this.m_oDrillContextContainer={};
this.m_oPromptGenericContext={};
this.m_oDrillGenericContext={};
this.m_oFilterGenericContext={};
this.m_oSelectionFilterContext={};
this.m_oContextCollection={};
this.m_oWidgetContextObject={};
this.m_oPromptContextObject={};
this.m_oDrillContextObject={};
this.m_aSelectionFilterObjects=null;
},getWidgetContextObject:function(){
var _c1b={};
if(this.m_oWidgetContextContainer){
_c1b[this.PP_WIDGET_CONTEXT]=this.m_oWidgetContextContainer;
if(this.m_widget){
_c1b.clientId=this.m_widget.getWidgetId();
}
}
return _c1b;
},getFilterFirstItemName:function(){
var _c1c=this.m_oFilterGenericContext;
if(_c1c){
var _c1d=(_c1c.values?_c1c.values:_c1c.ranges);
for(_c1e in _c1d){
return _c1e;
}
}
for(var _c1e in _c1c){
return _c1e;
}
return null;
},getItemNames:function(_c1f){
var _c20=[];
var _c21=_c1f[this.PP_WIDGET_CONTEXT];
if(_c21){
var _c22=(_c21.values?_c21.values:_c21.ranges);
for(var _c23 in _c22){
_c20.push(_c23);
}
return _c20;
}
for(var _c23 in _c21){
_c20.push(_c23);
}
return _c20;
},raisePromptEvent:function(_c24,_c25,_c26,_c27,_c28){
var _c29=this._buildGeneralizedPromptPayload(_c24,_c25,_c26,_c27,_c28);
if(_c29){
this.m_widget.fireEvent(this.EVENT_NAME_PROMPT,null,_c29);
this._updatePromptContext(_c29);
this._updateWidgetContextContainer();
}
},_updatePromptContext:function(_c2a){
this._updatePromptGenericContext(_c2a);
this._updatePromptContextContainer(_c2a);
},_resetWorkingMembers:function(){
this.m_oWidgetContextObject={};
this.m_oPromptContextObject={};
this.m_oDrillContextObject={};
},updateFilterContext:function(_c2b){
this.m_oFilterGenericContext=_c2b[this.PP_WIDGET_CONTEXT];
this._updateWidgetContextContainer();
},getSelectValueControlTypeFromPayload:function(_c2c){
var _c2d=_c2c[this.PP_BUX_SELECTVALUECONTROL_CONTEXT];
if(_c2d&&_c2d["selectValueControl"]){
return _c2d["selectValueControl"]["controlType"];
}
return null;
},getSelectValuePropertyFromPayload:function(_c2e,_c2f){
var _c30=_c2e[this.PP_BUX_SELECTVALUECONTROL_CONTEXT];
if(_c30&&_c30["selectValueControl"]){
return _c30["selectValueControl"][_c2f];
}
return null;
},_updateWidgetContextContainer:function(){
this.m_oWidgetContextContainer={};
var _c31=null;
if(this.m_oDrillGenericContext[this.PP_VALUES]){
_c31=dojo.mixin(_c31,this.m_oDrillGenericContext[this.PP_VALUES]);
}
if(this.m_oPromptGenericContext[this.PP_VALUES]){
_c31=dojo.mixin(_c31,this.m_oPromptGenericContext[this.PP_VALUES]);
}
if(this.m_oFilterGenericContext[this.PP_VALUES]){
_c31=dojo.mixin(_c31,this.m_oFilterGenericContext[this.PP_VALUES]);
}
if(this.m_oSelectionFilterContext[this.PP_VALUES]){
_c31=dojo.mixin(_c31,this.m_oSelectionFilterContext[this.PP_VALUES]);
}
if(_c31){
this.m_oWidgetContextContainer[this.PP_VALUES]=_c31;
}
var _c32=null;
if(this.m_oPromptGenericContext[this.PP_RANGES]){
_c32=dojo.mixin(_c32,this.m_oPromptGenericContext[this.PP_RANGES]);
}
if(this.m_oFilterGenericContext[this.PP_RANGES]){
_c32=dojo.mixin(_c32,this.m_oFilterGenericContext[this.PP_RANGES]);
}
if(_c32){
this.m_oWidgetContextContainer[this.PP_RANGES]=_c32;
}
},_updatePromptGenericContext:function(_c33){
if(_c33[this.PP_WIDGET_CONTEXT]){
this.m_oPromptGenericContext=_c33[this.PP_WIDGET_CONTEXT];
}
},_updatePromptContextContainer:function(_c34){
if(_c34[this.PP_REPORT_PROMPT_CONTEXT]&&_c34[this.PP_REPORT_PROMPT_CONTEXT][this.PP_PROMPT]){
this.m_oPromptContextContainer=_c34[this.PP_REPORT_PROMPT_CONTEXT][this.PP_PROMPT];
}
},_buildGeneralizedPromptPayload:function(_c35,_c36,_c37,_c38,_c39){
var _c3a=null;
this._resetWorkingMembers();
var _c3b=this._buildContextsFromPrompt(_c35,_c36);
if(_c3b){
_c3a={};
_c3a[this.PP_WIDGET_CONTEXT]=this.m_oWidgetContextObject;
var _c3c={};
_c3c[_c38]=this.m_oPromptContextObject;
_c3a[this.PP_REPORT_PROMPT_CONTEXT]={"prompt":{"id":this.m_widget.iContext.widgetId,"action":_c37,"itemSpecification":_c3c}};
_c3a[this.PP_CASCADEPROMPT_CLEAR]=_c39;
}
return _c3a;
},_getReportParameterNodes:function(_c3d){
var _c3e=XMLBuilderLoadXMLFromString(_c3d);
if(!_c3e){
return null;
}
var _c3f=_c3e.firstChild;
if(!_c3f){
return null;
}
var _c40=XMLHelper_FindChildByTagName(_c3f,"reportParameters",true);
if(!_c40){
return null;
}
var _c41=XMLHelper_FindChildrenByTagName(_c40,"reportParameter",false);
if(!_c41){
return null;
}
return _c41;
},_getSelectChoicesXMLString:function(_c42,_c43){
var _c44=null;
var _c45="p_"+_c42;
if(_c43.get(_c45)){
_c44=_c43.get(_c45);
}
return _c44;
},_getSelectChoicesNode:function(_c46){
var _c47=null;
if(_c46){
var _c48=XMLBuilderLoadXMLFromString(_c46,true);
if(_c48&&_c48.firstChild){
_c47=_c48.firstChild;
}
}
return _c47;
},_buildContextsFromPrompt:function(_c49,_c4a){
var _c4b=this._getReportParameterNodes(_c49);
if(_c4b===null){
return false;
}
for(var i in _c4b){
var _c4d=_c4b[i];
var _c4e=_c4d.getAttribute("parameterName");
var _c4f=this._getSelectChoicesXMLString(_c4e,_c4a);
var _c50=this._getSelectChoicesNode(_c4f);
if(_c50){
var _c51,_c52,_c53;
if(!this._isPromptRangeType(_c4f)){
var _c54=this._buildReportContextValuesFromPromptSelectOption(_c50);
_c51=this._createPromptDetailObject(_c4f,_c4d.getAttribute("modelItem"),_c4d.getAttribute("multivalued"),_c54);
_c52=this._buildValuesArrayFromReportContextValueArray(_c54);
_c53=this.PP_VALUES;
}else{
_c52=this._buildMinMaxArrayFromRangePrompt(_c50);
_c51=this._createPromptDetailObject(_c4f,_c4d.getAttribute("modelItem"),_c4d.getAttribute("multivalued"),_c52);
_c53=this.PP_RANGES;
}
this.m_oPromptContextObject[_c4e]=_c51;
if(!this.m_oWidgetContextObject[_c53]){
this.m_oWidgetContextObject[_c53]={};
}
this.m_oWidgetContextObject[_c53][_c4e]=_c52;
}
}
return true;
},_createPromptDetailObject:function(_c55,_c56,_c57,_c58){
var _c59={};
_c59[this.PP_SELECT_CHOICES]=_c55;
if(_c56!==null){
_c59[this.PP_MODELITEM]=_c56;
}
if(_c57!==null){
_c59[this.PP_MULTIVALUED]=true;
}
_c59[this.PP_VALUES]=_c58;
return _c59;
},_isPromptRangeType:function(_c5a){
var _c5b=new RegExp(/^<selectChoices><select[\s\S]*Range/);
return _c5b.test(_c5a);
},_buildReportContextValuesFromPromptSelectOption:function(_c5c){
var _c5d=[];
if(_c5c){
var _c5e=dojo.query("selectOption[displayValue]",_c5c);
if(_c5e.length>0){
for(var i=0;i<_c5e.length;i++){
var _c60=_c5e[i].getAttribute("displayValue");
var _c61=_c5e[i].getAttribute("useValue");
var _c62={"caption":_c60,"use":_c61};
_c5d.push(_c62);
}
}
}
return _c5d;
},_buildValuesArrayFromReportContextValueArray:function(_c63){
var _c64=[];
if(_c63&&_c63.length>0){
for(var i=0;i<_c63.length;i++){
var _c66=_c63[i].caption;
if(_c66){
_c64.push(_c66);
}
}
}
return _c64;
},_buildMinMaxArrayFromRangePrompt:function(_c67){
var _c68=[];
if(_c67&&_c67.childNodes&&_c67.childNodes.length>0){
var _c69=_c67.childNodes.length;
for(var i=0;i<_c69;i++){
var _c6b=this._buildMinMaxFromSelectAnyRange(_c67.childNodes[i]);
if(_c6b){
_c68.push(_c6b);
}
}
}
return _c68;
},_buildMinMaxFromSelectAnyRange:function(_c6c){
var _c6d=null;
if(_c6c){
var _c6e=dojo.query("[displayValue]",_c6c);
if(_c6e.length>0){
_c6d={};
for(var i=0;i<_c6e.length;i++){
var node=_c6e[i];
var _c71=(node.nodeName==="start")?"min":"max";
_c6d[_c71]=node.getAttribute("useValue");
_c6d[_c71+"Display"]=node.getAttribute("displayValue");
}
}
}
return _c6d;
},handleIncomingPromptEvent:function(evt){
if(!evt||!evt.payload){
return;
}
var _c73=this._convertToLegacyPromptPayload(evt.payload);
if(_c73){
var _c74={"payload":_c73};
this.m_widget.onPromptLegacyPayload(_c74);
}
},_convertToLegacyPromptPayload:function(_c75){
var _c76=null;
var _c77=_c75[this.PP_REPORT_PROMPT_CONTEXT];
if(_c77&&_c77.prompt){
_c77=_c77.prompt;
_c76={};
_c76.cv_id=_c77.id;
_c76.parameters=this._genLegacyPromptParameterArrayFromItemSpec(_c77.itemSpecification);
_c76.clearCascadePromptParams=_c75[this.PP_CASCADEPROMPT_CLEAR];
}else{
if(_c75[this.PP_WIDGET_CONTEXT]&&_c75[this.PP_WIDGET_CONTEXT].values){
_c76={};
_c76.parameters=[];
var _c78=_c75[this.PP_WIDGET_CONTEXT].values;
for(var _c79 in _c78){
var _c7a=_c78[_c79];
if(_c7a&&_c7a.length>0){
if(_c7a.length==1&&_c7a[0].indexOf("<selectChoices>")===0){
_c76.parameters.push({"parmName":_c79,"parmValue":_c7a[0]});
}else{
var _c7b="<selectChoices>";
for(var i=0;i<_c7a.length;i++){
_c7b+="<selectOption useValue=\""+_c7a[i]+"\" displayValue=\""+_c7a[i]+"\"/>";
}
_c7b+="</selectChoices>";
_c76.parameters.push({"parmName":_c79,"parmValue":_c7b});
}
}
}
_c76.clearCascadePromptParams=_c75[this.PP_CASCADEPROMPT_CLEAR];
}
}
return _c76;
},_genLegacyPromptParameterArrayFromItemSpec:function(_c7d){
if(!_c7d){
return null;
}
var _c7e=this._getFirstPropertyOfObject(_c7d);
var _c7f=[];
for(var _c80 in _c7e){
var _c81=_c7e[_c80];
var _c82={parmName:_c80,parmValue:_c81[this.PP_SELECT_CHOICES],modelItem:_c81[this.PP_MODELITEM]};
if(_c81[this.PP_MULTIVALUES]!==null){
_c82.multivalued=true;
}
_c7f.push(_c82);
}
return _c7f;
},_isRangeTypeValues:function(_c83){
if(_c83){
if(_c83.min||_c83.max){
return true;
}
}
return false;
},_getFirstPropertyOfObject:function(_c84){
var _c85=null;
for(var _c86 in _c84){
_c85=_c84[_c86];
break;
}
return _c85;
},_getFirstPropertyNameOfObject:function(_c87){
var _c88=null;
for(var _c89 in _c87){
_c88=_c89;
break;
}
return _c88;
},extractWidgetContextObject:function(_c8a){
if(_c8a){
var _c8b=_c8a[this.PP_WIDGET_CONTEXT];
if(_c8b){
var obj={};
obj[this.PP_WIDGET_CONTEXT]=_c8b;
return obj;
}
}
return null;
},genMergedWidgetContextObject:function(){
var _c8d=null;
var _c8e=null;
for(var key in this.m_oContextCollection){
var _c90=this.m_oContextCollection[key];
if(_c90){
var _c91=_c90[this.PP_WIDGET_CONTEXT];
if(_c91){
if(_c91[this.PP_VALUES]){
_c8d=dojo.mixin(_c8d,_c91[this.PP_VALUES]);
}
if(_c91[this.PP_RANGES]){
_c8e=dojo.mixin(_c8e,this._convertRangeArrayToObjectForActiveReport(_c91[this.PP_RANGES]));
}
}
}
}
if(_c8d||_c8e){
var obj={};
obj[this.PP_WIDGET_CONTEXT]={};
if(_c8d){
obj[this.PP_WIDGET_CONTEXT][this.PP_VALUES]=_c8d;
}
if(_c8e){
obj[this.PP_WIDGET_CONTEXT][this.PP_RANGES]=_c8e;
}
return obj;
}
return null;
},raiseDrillEvent:function(_c93,_c94,_c95){
var _c96=this._buildGeneralizedDrillPayload(_c93,_c94,_c95);
if(_c96){
this.m_widget.fireEvent(this.EVENT_NAME_DRILL,null,_c96);
this._updateDrillContext(_c96);
this._updateWidgetContextContainer();
}
},_updateDrillContext:function(_c97){
this._updateDrillGenericContext(_c97);
this._updateDrillContextContainer(_c97);
},_updateDrillGenericContext:function(_c98){
if(_c98[this.PP_WIDGET_CONTEXT]){
this.m_oDrillGenericContext=_c98[this.PP_WIDGET_CONTEXT];
}
},_updateDrillContextContainer:function(_c99){
if(_c99[this.PP_REPORT_DRILL_CONTEXT]&&_c99[this.PP_REPORT_DRILL_CONTEXT][this.PP_DRILL]){
this.m_oDrillContextContainer=_c99[this.PP_REPORT_DRILL_CONTEXT][this.PP_DRILL];
}
},_buildGeneralizedDrillPayload:function(_c9a,_c9b,_c9c){
if(!_c9a||!_c9b){
return null;
}
var _c9d={};
var _c9e={};
for(var i in _c9a){
var _ca0=_c9a[i];
var mun=(_ca0.mun)?_ca0.mun:"";
var lun=(_ca0.lun)?_ca0.lun:"";
var hun=(_ca0.hun)?_ca0.hun:"";
var _ca4={};
_ca4[this.PP_VALUES]=[{"caption":_ca0.displayValue,"mun":mun,"lun":lun,"hun":hun}];
if(_ca0.summary){
_ca4["summary"]=_ca0.summary;
}
_c9d[_ca0.dataItem]=_ca4;
_c9e[_ca0.dataItem]=[_ca0.displayValue];
}
var _ca5={};
_ca5[this.PP_VALUES]=_c9e;
var _ca6={};
_ca6[_c9c]=_c9d;
var _ca7={};
_ca7[_c9b]={"id":this.m_widget.iContext.widgetId,"action":_c9b,"itemSpecification":_ca6};
var _ca8={};
_ca8[this.PP_WIDGET_CONTEXT]=_ca5;
_ca8[this.PP_REPORT_DRILL_CONTEXT]=_ca7;
return _ca8;
},genDrillSpecObjects:function(_ca9){
if(!_ca9||!_ca9[this.PP_REPORT_DRILL_CONTEXT]){
return null;
}
var _caa=[];
var _cab=_ca9[this.PP_REPORT_DRILL_CONTEXT];
var _cac=this._getFirstPropertyOfObject(_cab);
var _cad=this._getFirstPropertyOfObject(_cac.itemSpecification);
for(var _cae in _cad){
var _caf=_cad[_cae];
var _cb0=_caf[this.PP_VALUES];
if(_cb0&&_cb0.length>0){
var _cb1=_cb0[0];
var _cb2={"dataItem":_cae,"displayValue":_cb1.caption,"mun":_cb1.mun,"lun":_cb1.lun,"hun":_cb1.hun};
if(_cb1.summary){
_cb2["summary"]=_cb1.summary;
}
_caa.push(_cb2);
}
}
return (_caa.length>0)?_caa:null;
},getDrillActionType:function(_cb3){
if(!_cb3||!_cb3[this.PP_REPORT_DRILL_CONTEXT]){
return null;
}
return this._getFirstPropertyNameOfObject(_cb3[this.PP_REPORT_DRILL_CONTEXT]);
},_convertRangeArrayToObjectForActiveReport:function(_cb4){
if(_cb4){
var _cb5={};
for(var name in _cb4){
var _cb7=_cb4[name];
if(_cb7&&_cb7.length>0){
_cb5[name]=_cb7[0];
}else{
_cb5[name]=_cb7;
}
}
return _cb5;
}
return _cb4;
},getItemsInItemSpecification:function(_cb8){
var _cb9=_cb8[this.PP_BUX_SELECTVALUECONTROL_CONTEXT];
if(_cb9&&_cb9["selectValueControl"]&&_cb9["selectValueControl"]["itemSpecification"]){
return this._getFirstPropertyOfObject(_cb9["selectValueControl"]["itemSpecification"]);
}
return null;
},genRemoveDiscreteFilterPayload:function(_cba){
var _cbb={"clientId":_cba,"com.ibm.widget.context":{},"com.ibm.widget.context.bux.selectValueControl":{"selectValueControl":{"id":_cba,"controlType":"selectValueFilter","type":"discrete","valueType":"string"}}};
return _cbb;
},genEmptySelectionPayload:function(oCV,_cbd){
var obj={"clientId":_cbd,"com.ibm.widget.context":{},"com.ibm.widget.context.bux.selection":{"selection":{"id":_cbd,"valueType":"string"}}};
this.m_oSelectionFilterContext={};
this._updateWidgetContextContainer();
this.setSelectionFilterObjects(null);
return obj;
},genSelectionPayload:function(oCV,_cc0,_cc1){
var _cc2={};
var _cc3={"id":_cc0,"valueType":"string"};
var obj={"clientId":_cc0,"com.ibm.widget.context":_cc2,"com.ibm.widget.context.bux.selection":{"selection":_cc3}};
var _cc5=false;
var _cc6=[];
var oSC=oCV.getSelectionController();
var _cc8=oSC.getAllSelectedObjects();
if(_cc8&&_cc8.length>0){
var _cc9={};
var _cca=null;
var _ccb={};
var _ccc={};
for(var i=0;i<_cc8.length;i++){
if(_cc8[i].populateSelectionPayload(_ccb,_ccc,_cc1)){
_cc5=true;
_cca=_cc8[i].getCtxAttributeString();
if(typeof _cc9[_cca]=="undefined"){
_cc9[_cca]=true;
_cc6.push(_cc8[i].marshal(oSC,oCV.getId()));
}
}
}
if(_cc5){
_cc2.values=_ccb;
var _cce={};
var _ccf=oCV.getModelPath();
var _cd0=(_ccf)?_ccf:".";
_cce[_cd0]=_ccc;
_cc3.itemSpecification=_cce;
}
}
this.m_oSelectionFilterContext=obj[this.PP_WIDGET_CONTEXT];
this._updateWidgetContextContainer();
this.setSelectionFilterObjects(_cc6.length>0?_cc6:null);
return obj;
},isSelectionPayloadForReset:function(obj){
if(obj&&obj[this.PP_WIDGET_CONTEXT]){
return this.isEmptyObject(obj[this.PP_WIDGET_CONTEXT]);
}
return true;
},setSelectionFilterObjects:function(_cd2){
this.m_aSelectionFilterObjects=_cd2;
},getSelectionFilterObjects:function(){
return this.m_aSelectionFilterObjects;
},toStringSelectionFilterObjects:function(){
var str="";
for(var idx in this.m_aSelectionFilterObjects){
if(str.length>0){
str+=",";
}
str+=JSON.stringify(this.m_aSelectionFilterObjects[idx]);
}
return "["+str+"]";
},convertSelectionToSelectValueControlPayload:function(_cd5){
if(_cd5["com.ibm.widget.context.bux.selection"]){
var _cd6=_cd5["com.ibm.widget.context.bux.selection"]["selection"];
_cd6.controlType="selectValueFilter";
_cd6.type="discrete";
_cd5["com.ibm.widget.context.bux.selectValueControl"]={"selectValueControl":_cd6};
delete _cd5["com.ibm.widget.context.bux.selection"];
}
return _cd5;
},convertGenericToSelectValueControlPayload:function(_cd7){
if(this._hasItemSpecification(_cd7)){
return;
}
if(_cd7[this.PP_WIDGET_CONTEXT][this.PP_VALUES]){
var _cd8=_cd7[this.PP_WIDGET_CONTEXT][this.PP_VALUES];
for(dataItem in _cd8){
if(_cd8[dataItem].length==0){
delete _cd8[dataItem];
}
}
var _cd9=true;
for(dataItem in _cd8){
_cd9=false;
break;
}
if(_cd9){
delete _cd7[this.PP_WIDGET_CONTEXT][this.PP_VALUES];
}
}
if(_cd7[this.PP_WIDGET_CONTEXT][this.PP_RANGES]){
var _cd8=_cd7[this.PP_WIDGET_CONTEXT][this.PP_RANGES];
var _cd9=true;
for(dataItem in _cd8){
_cd9=false;
break;
}
if(_cd9){
delete _cd7[this.PP_WIDGET_CONTEXT][this.PP_RANGES];
}
}
var _cd8=null;
if(_cd7[this.PP_WIDGET_CONTEXT][this.PP_VALUES]){
key=this.PP_VALUES;
_cd8=_cd7[this.PP_WIDGET_CONTEXT][this.PP_VALUES];
}else{
key=this.PP_RANGES;
_cd8=_cd7[this.PP_WIDGET_CONTEXT][this.PP_RANGES];
}
var cv=this.m_widget.getViewerObject();
var _cdb=null;
if(cv){
var sc=cv.getSelectionController();
_cdb=sc.getCCDManager();
}
for(dataItem in _cd8){
var _cdd=true;
var _cde={};
for(var _cdf in _cd8){
var _ce0=[];
for(var i=0;i<_cd8[_cdf].length;i++){
var _ce2=_cd8[_cdf][i];
var _ce3={"caption":_ce2};
if(_cdd){
var mun=_cdb?_cdb.getMUNForRDIAndUseValue(_cdf,_ce2):null;
if(mun!=null){
_ce3.mun=mun;
}else{
_cdd=false;
for(var i=0;i<_ce0.length;i++){
delete _ce0[i].mun;
}
}
}
_ce0.push(_ce3);
}
_cde[_cdf]={"values":_ce0};
}
var _ce5={};
var _ce6=cv?cv.getModelPath():null;
var _ce7=(_ce6)?_ce6:"unknown";
_ce5[_ce7]=_cde;
_cd7[this.PP_BUX_SELECTVALUECONTROL_CONTEXT]={"selectValueControl":{"valueType":"string","type":"discrete","controlType":"selectValueFilter","id":_cd7.clientId?_cd7.clientId:"","itemSpecification":_ce5}};
}
},getMUNOfItemValueInItemSpecification:function(_ce8,_ce9){
var _cea=this.getItemsInItemSpecification(_ce8);
if(_cea&&_cea[_ce9]){
var _ceb=_cea[_ce9];
if(_ceb.values&&_ceb.values.length>0){
return _ceb.values[0].mun;
}
}
return null;
},_hasItemSpecification:function(_cec){
if(_cec[this.PP_BUX_SELECTVALUECONTROL_CONTEXT]&&_cec[this.PP_BUX_SELECTVALUECONTROL_CONTEXT]["selectValueControl"]&&_cec[this.PP_BUX_SELECTVALUECONTROL_CONTEXT]["selectValueControl"]["itemSpecification"]){
return true;
}
if(_cec[this.PP_BUX_SELECTION_CONTEXT]&&_cec[this.PP_BUX_SELECTION_CONTEXT]["selection"]&&_cec[this.PP_BUX_SELECTION_CONTEXT]["selection"]["itemSpecification"]){
return true;
}
return false;
},getSourceUniqueId:function(_ced,_cee){
var id=null;
var _cf0=null;
if(_ced["clientId"]){
id=_ced["clientId"];
}
if(_ced[this.PP_BUX_SELECTVALUECONTROL_CONTEXT]){
_cf0="selectValueControl";
if(!id&&_ced[this.PP_BUX_SELECTVALUECONTROL_CONTEXT]["selectValueControl"]&&_ced[this.PP_BUX_SELECTVALUECONTROL_CONTEXT]["selectValueControl"]["id"]){
id=_ced[this.PP_BUX_SELECTVALUECONTROL_CONTEXT]["selectValueControl"]["id"];
}
}else{
if(_ced[this.PP_BUX_SELECTION_CONTEXT]){
_cf0="selection";
if(!id&&_ced[this.PP_BUX_SELECTION_CONTEXT]["selection"]&&_ced[this.PP_BUX_SELECTION_CONTEXT]["selection"]["id"]){
id=_ced[this.PP_BUX_SELECTION_CONTEXT]["selection"]["id"];
}
}else{
if(_ced[this.PP_REPORT_PROMPT_CONTEXT]){
_cf0="prompt";
if(!id&&_ced[this.PP_REPORT_PROMPT_CONTEXT]["prompt"]&&_ced[this.PP_REPORT_PROMPT_CONTEXT]["prompt"]["id"]){
id=_ced[this.PP_REPORT_PROMPT_CONTEXT]["prompt"]["id"];
}
}else{
if(_ced[this.PP_REPORT_DRILL_CONTEXT]){
_cf0="drill";
if(!id&&_ced[this.PP_REPORT_DRILL_CONTEXT]["DrillUp"]&&_ced[this.PP_REPORT_DRILL_CONTEXT]["DrillUp"]["id"]){
id=_ced[this.PP_REPORT_DRILL_CONTEXT]["DrillUp"]["id"];
}
}else{
if(_ced[this.PP_REPORT_DRILL_CONTEXT]){
_cf0="drill";
if(!id&&_ced[this.PP_REPORT_DRILL_CONTEXT]["DrillDown"]&&_ced[this.PP_REPORT_DRILL_CONTEXT]["DrillDown"]["id"]){
id=_ced[this.PP_REPORT_DRILL_CONTEXT]["DrillDown"]["id"];
}
}
}
}
}
}
if(!id){
id="unknown";
}
if(!_cf0){
_cf0="unknown";
}
if(typeof _cee=="string"){
_cf0=_cee;
}
return id+"_"+_cf0;
},isWidgetContextEmpty:function(_cf1){
return (this.isEmptyObject(_cf1[this.PP_WIDGET_CONTEXT])||(this.isEmptyObject(_cf1[this.PP_WIDGET_CONTEXT][this.PP_VALUES])&&this.isEmptyObject(_cf1[this.PP_WIDGET_CONTEXT][this.PP_RANGES])));
},isEmptyObject:function(obj){
var _cf3=true;
if(obj){
for(var _cf4 in obj){
_cf3=false;
break;
}
}
return _cf3;
},updateContextCollection:function(_cf5){
if(!this.isEmptyObject(_cf5)){
var _cf6=this.getSourceUniqueId(_cf5);
if(this.isWidgetContextEmpty(_cf5)){
if(this.m_oContextCollection[_cf6]){
this.setEmptyArrayToWidgetContextValues(this.m_oContextCollection[_cf6]);
}else{
var _cf7=this.getSourceUniqueId(_cf5,"unknown");
if(this.m_oContextCollection[_cf7]){
this.setEmptyArrayToWidgetContextValues(this.m_oContextCollection[_cf7]);
}
}
}else{
if(_cf5[this.PP_WIDGET_CONTEXT][this.PP_VALUES]){
for(var name in _cf5[this.PP_WIDGET_CONTEXT][this.PP_VALUES]){
for(var key in this.m_oContextCollection){
var _cfa=this.m_oContextCollection[key];
if(_cfa[this.PP_WIDGET_CONTEXT][this.PP_VALUES]&&_cfa[this.PP_WIDGET_CONTEXT][this.PP_VALUES][name]){
delete _cfa[this.PP_WIDGET_CONTEXT][this.PP_VALUES][name];
}
}
}
}
this.m_oContextCollection[_cf6]=dojo.clone(_cf5);
}
return this.m_oContextCollection;
}
},setEmptyArrayToWidgetContextValues:function(_cfb){
if(_cfb&&_cfb[this.PP_WIDGET_CONTEXT]&&_cfb[this.PP_WIDGET_CONTEXT][this.PP_VALUES]){
var _cfc=_cfb[this.PP_WIDGET_CONTEXT][this.PP_VALUES];
for(var name in _cfc){
_cfc[name]=[];
}
}
}});
dojo.provide("viewer.AnnotationHelper");
dojo.declare("viewer.AnnotationHelper",null,{m_loadAnnotationsDfd:null,m_bCallGetAnnotations:true,m_bAnnotationsEnabled:null,constructor:function(_cfe){
this.m_viewerIWidget=_cfe;
this.m_bCallGetAnnotations=true;
this.m_bAnnotationsEnabled=null;
},getAnnotationStore:function(){
return this.m_viewerIWidget.getAnnotationStore();
},setCallGetAnnotations:function(flag){
this.m_bCallGetAnnotations=flag;
},isEnabled:function(){
if(this.m_bAnnotationsEnabled===null){
this.m_bAnnotationsEnabled=this.m_viewerIWidget.getViewerObject().bBuxAnnotationsAvailable;
}
return this.m_bAnnotationsEnabled;
},refreshAnnotationData:function(){
if(this.m_loadAnnotationsDfd){
return null;
}
this.m_loadAnnotationsDfd=new dojo.Deferred();
this.fetchAnnotationData();
return this.m_loadAnnotationsDfd;
},fetchAnnotationData:function(){
var _d00=this.m_viewerIWidget;
if(!this.m_bCallGetAnnotations||!this.isEnabled()){
return;
}
dojo.when(_d00.getWidgetStoreID(),dojo.hitch(this,function(_d01){
if(!_d01){
return;
}
this.m_viewerIWidget.getLoadManager().runWhenHasViewer(dojo.hitch(this,this._fetchAnnotationData,_d01));
}));
},_fetchAnnotationData:function(_d02){
var _d03=this.m_viewerIWidget.getViewerObject();
var _d04=_d03.getSelectionController();
var _d05=_d04.getCCDManager().m_md;
if(!_d05){
_d05={};
}
_d05=dojo.toJson(_d05);
var _d06=_d04.getCCDManager().m_cd;
if(!_d06){
_d06={};
}
_d06=dojo.toJson(_d06);
var _d07={"complete":{},"fault":{}};
_d07.complete["object"]=this;
_d07.complete["method"]=this.fetchAnnotationDataResponse;
_d07.fault["object"]=this;
_d07.fault["method"]=this.fetchAnnotationDataResponseFault;
var _d08=new AsynchJSONDispatcherEntry(_d03);
_d08.setCallbacks(_d07);
_d08.addFormField("widgetStoreID",_d02);
_d08.addFormField("ui.action","getAnnotations");
_d08.addFormField("cv.metatdata",_d05);
_d08.addFormField("cv.context",_d06);
_d08.sendRequest();
},fetchAnnotationDataResponseFault:function(_d09){
this.m_bCallGetAnnotations=false;
var _d0a=new FaultDialog(this.m_viewerIWidget.getViewerObject());
var _d0b=_d09.getSoapFault();
var _d0c=null;
var _d0d=XMLHelper_FindChildByTagName(_d0b,"exception",true);
if(_d0d){
var _d0e=XMLHelper_FindChildByTagName(_d0d,"errorCode",false);
if(_d0e){
_d0c=XMLHelper_GetText(_d0e);
}
}
if(_d0c==="0"){
var _d0f=null;
var _d10=XMLHelper_FindChildByTagName(_d0d,"message",false);
if(_d10){
var _d11=XMLHelper_FindChildByTagName(_d10,"messageString",true);
if(_d11){
_d0f=XMLHelper_GetText(_d11,false);
}
}
if(_d0f){
var _d12=/ANS-GEN-(\d{2,4})/;
var _d13=_d12.exec(_d0f);
if(_d13&&_d13.length&&_d13.length>1){
var _d14=_d13[1];
if(_d14==="0075"){
_d0a.setErrorMessage(RV_RES.IDS_ANNOTATION_WIDGET_DELETED_ERROR);
}
}
}
}
this._cleanupPreviousAnnotations();
this.getAnnotationStore().clear();
_d0a.show(_d0b);
if(this.m_loadAnnotationsDfd){
this.m_loadAnnotationsDfd.errback();
this.m_loadAnnotationsDfd=null;
}
},fetchAnnotationDataResponse:function(_d15){
var _d16=window["CVEditContentActionInstance"];
var _d17=_d15.getResult();
this.m_bCallGetAnnotations=this.m_bCallGetAnnotations&&_d17!==null;
if(_d17===null){
_d17=[];
}
var _d18=this.m_viewerIWidget.getViewerObject();
_d18.envParams["cv.annotationData"]=_d17;
this._cleanupPreviousAnnotations();
if(_d17.length>0){
if(this.getAnnotationStore()){
var _d19=this._generateMatchedAnnotationsFromViewerObject();
this.getAnnotationStore().load(_d19);
this.displayCommentIndicators();
}
}
if(this.m_loadAnnotationsDfd){
this.m_loadAnnotationsDfd.callback();
this.m_loadAnnotationsDfd=null;
}
},_cleanupPreviousAnnotations:function(){
var _d1a=this.getAnnotationStore();
if(_d1a){
var _d1b=_d1a.getAll();
for(var _d1c in _d1b){
var _d1d=this.m_viewerIWidget.getWidgetId()+"_"+_d1c+"_comment";
var _d1e=dijit.byId(_d1d);
if(typeof _d1e!="undefined"&&_d1e!=null){
_d1e.destroy();
delete _d1e;
}
_d1a.clear(_d1c);
}
}
},_generateMatchedAnnotationsFromViewerObject:function(){
var _d1f=this.m_viewerIWidget.getViewerObject();
var _d20=[];
if(_d1f&&_d1f.envParams&&_d1f.envParams["cv.annotationData"]){
_d20=eval(_d1f.envParams["cv.annotationData"]);
}
var _d21=this._generateAnnotationListWithoutORoperator(_d20);
return this._updateAnnotationCtxWithMatchedCellCtx(_d21,_d1f);
},_generateAnnotationListWithoutORoperator:function(_d22){
var _d23=[];
for(var i=0,len=_d22.length;i<len;i++){
var anno=_d22[i];
if(anno.ctx){
var _d27=bux.AnnotationHelper.generateCTXList(anno.ctx);
for(var j=0,jLen=_d27.length;j<jLen;j++){
var _d2a={ann:anno.ann,lmt:anno.lmt,lmtf:anno.lmtf,ctx:anno.ctx,desc:anno.desc,fd:anno.fd,layoutElementId:anno.layoutElementId,owner:anno.owner,ownerSearchPath:anno.ownerSearchPath,pv:anno.pv,rdi:anno.rdi,sd:anno.sd,version:anno.version||1};
_d2a.ctx=_d27[j];
_d23.splice(0,0,_d2a);
}
}else{
_d23.splice(0,0,anno);
}
}
return _d23;
},_updateAnnotationCtxWithMatchedCellCtx:function(_d2b,_d2c){
var _d2d=[];
var _d2e=new AnnotationCTXLookup(this.m_viewerIWidget.getViewerObject().getSelectionController().getCCDManager());
_d2e.populateCtxDetailsForAllAnnotations(_d2b);
var _d2f=[];
for(var i=0,len=_d2b.length;i<len;i++){
var anno=_d2b[i];
if(anno.ctx){
if(_d2f.length===0){
_d2f=dojo.query("[ctx]",this.m_viewerIWidget.iContext.getRootElement());
}
for(var j=0,jLen=_d2f.length;j<jLen;j++){
var _d35=_d2f[j].getAttribute("ctx");
if(_d2e.isAnnotatedCell(anno,_d35)){
anno.ctx=_d35;
_d2d.splice(0,0,anno);
break;
}
}
}else{
_d2d.splice(0,0,anno);
}
}
return _d2d;
},displayCommentIndicators:function(){
var _d36=this.getAnnotationStore();
var _d37=_d36.getAll();
for(var cell in _d37){
var _d39=new bux.AnnotationIndicator({annotationStore:_d36,context:cell,iWidgetContainer:this.m_viewerIWidget,dir:this.m_viewerIWidget.getViewerObject().getDirection()});
_d39.addExistingCommentToCell();
}
},repositionCommentIndicators:function(){
var _d3a=this.getAnnotationStore();
var _d3b=_d3a.getAll();
for(var id in _d3b){
var _d3d=_d3b[id];
var ctx=_d3d[0].getContext();
var _d3f=_d3a.getIndicatorWidgetId(ctx);
if(_d3f!==null){
var _d40=dijit.byId(_d3f);
_d40.addToPage();
}
}
},promptForSave:function(_d41){
dojo["require"]("bux.dialogs.InformationDialog");
var _d42=new bux.dialogs.InformationDialog({title:RV_RES.IDS_JS_COMMENT_DLG_TITLE,sMainMessage:RV_RES.IDS_JS_COMMENT_DLG_MESSAGE,sDescription:RV_RES.IDS_JS_COMMENT_DLG_DETAILS,sInfoIconClass:"bux-informationDialog-warning-icon",buttons:["YES","NO"],yesOKHandler:_d41});
_d42.startup();
_d42.show();
},addComment:function(_d43,_d44){
if(this.m_viewerIWidget.isSaveNecessary()){
this.promptForSave(dojo.hitch(this,this.onCommentSaveAcknowledge,_d43,_d44));
}else{
this.addNewComment(_d43,_d44);
}
},editComment:function(_d45){
var _d46=bux.getComment(this.m_viewerIWidget.iContext,this.getAnnotationStore().getEffectiveIds(_d45));
if(_d46&&_d46.edit){
_d46.edit();
}
},deleteComment:function(_d47){
this.getAnnotationStore().deleteOneComment(_d47);
},addNewComment:function(_d48,_d49){
this.addAsNewComment(_d48,(_d49==null)?"":(_d49+" - "));
},addAsNewComment:function(_d4a,text){
var _d4c=null;
var _d4d=(_d4a===null)?this.getAnnotationStore().WIDGET_CONTEXT:_d4a;
var _d4e=this.getAnnotationStore().getIndicatorWidgetId(_d4d);
if(_d4e!=null){
_d4c=dijit.byId(_d4e);
}
if(_d4c==null){
dojo["require"]("bux.AnnotationIndicator");
_d4c=new bux.AnnotationIndicator({annotationStore:this.getAnnotationStore(),context:_d4d,iWidgetContainer:this.m_viewerIWidget,dir:this.m_viewerIWidget.getViewerObject().getDirection()});
window.setTimeout(function(){
_d4c.addNewCommentToCell(text);
},0);
}else{
window.setTimeout(function(){
_d4c.comment.editNewComment(_d4d,text);
},0);
}
},onCommentSaveAcknowledge:function(_d4f,_d50){
this.m_viewerIWidget._pendingContextId=_d4f;
this.m_viewerIWidget._pendingCellValue=_d50;
this.m_viewerIWidget.fireEvent("com.ibm.bux.widget.action",null,{action:"canvas.save"});
},addWidgetComment:function(){
if(this.m_viewerIWidget.isSaveNecessary()){
this.promptForSave(dojo.hitch(this,this.onCommentSaveAcknowledge,null,this.m_viewerIWidget.getDisplayName()));
}else{
this.addNewComment(null,this.m_viewerIWidget.getDisplayName());
}
},editWidgetComment:function(){
var _d51=bux.getComment(this.m_viewerIWidget.iContext,[this.getAnnotationStore().WIDGET_CONTEXT]);
if(_d51&&_d51.edit){
_d51.edit();
}
},deleteWidgetComment:function(){
this.deleteComment(this.getAnnotationStore().WIDGET_CONTEXT);
},commitComment:function(_d52){
if(_d52.getContext()!==this.getAnnotationStore().WIDGET_CONTEXT){
return this.commitCellComment(_d52);
}else{
return this.commitWidgetComment(_d52,this.getAnnotationStore());
}
},commitCellComment:function(_d53){
var _d54=new dojo.Deferred();
var _d55=this.m_viewerIWidget.getViewerObject();
var _d56={customArguments:[_d53,_d54],"complete":{"object":this,"method":this.handleCellCommentSaveResponse},"fault":{"object":this,"method":this.handleCellCommentSaveErrorResponse},"error":{"object":this,"method":this.handleCellCommentSaveServerErrorResponse}};
var _d57=new AsynchJSONDispatcherEntry(_d55);
_d57.setCallbacks(_d56);
this.preparePostForCommitCellComment(_d57,_d53).then(function(){
_d55.dispatchRequest(_d57);
});
return _d54;
},preparePostForCommitCellComment:function(_d58,_d59){
var dfd=new dojo.Deferred();
dojo.when(this.m_viewerIWidget.getWidgetStoreID(),dojo.hitch(this,function(_d5b){
var _d5c=this.m_viewerIWidget.getViewerObject();
var _d5d=_d5c.getSelectionController();
_d58.addFormField("widgetStoreID",_d5b);
_d58.addFormField("ui.action","commentSave");
_d58.addFormField("cv.metatdata",dojo.toJson(_d5d.getCCDManager().m_md));
_d58.addFormField("cv.context",dojo.toJson(_d5d.getCCDManager().m_cd));
_d58.addFormField("cv.commentId",_d59.getContext());
_d58.addFormField("cv.commentDesc",xml_encode(_d59.getDescription()));
var lid=_d5d.getAllSelectedObjects()[0].getLayoutElementId();
if(lid){
lid=lid.replace(this.m_viewerIWidget.getViewerId(),"");
_d59.setParentId(lid);
_d58.addFormField("cv.commentLayoutId",_d59.getParentId());
var _d5f=new AnnotationInfoBar(_d5c,lid);
var _d60=_d5f.createFilterContext();
if(_d60!=null){
_d59.setFilterContext(_d60);
if(_d60.getPromptsJSON()){
_d58.addFormField("cv.filterContext_prompts",dojo.toJson(_d60.getPromptsJSON()));
}
if(_d60.getFilterJSON()){
_d58.addFormField("cv.filterContext_filter",dojo.toJson(_d60.getFilterJSON()));
}
if(_d60.getSlidersJSON()){
_d58.addFormField("cv.filterContext_sliders",dojo.toJson(_d60.getSlidersJSON()));
}
}
}
dfd.callback();
}));
return dfd;
},commitWidgetComment:function(_d61){
dojo["require"]("bux.Services");
var _d62=bux.Services.getGateway()+"/annotationService/creation";
var _d63={};
_d63["annotationName"]=_d61.getName();
if(_d63["annotationName"]==null){
_d63["annotationName"]="";
}
_d63["annotationDescription"]=_d61.getDescription();
var dfd=new dojo.Deferred();
dojo.when(this.m_viewerIWidget.getWidgetStoreID(),dojo.hitch(this,function(_d65){
_d63["annotationParentID"]=_d65;
bux.xhrPost({url:_d62,sync:true,content:_d63}).then(dojo.hitch(this,function(_d66){
this.handleCommentSaveDone(_d66,_d61,this.getAnnotationStore(),this.m_viewerIWidget);
_d61.loadDetails();
dfd.callback();
}));
}));
return dfd;
},handleCellCommentSaveResponse:function(_d67,_d68,_d69){
var _d6a=_d67.getJSONResponseObject();
if(_d6a){
var _d6b=_d6a.json;
if(_d6b){
var _d6c=this.handleCommentSaveDone(_d6b,_d68,this.getAnnotationStore(),this.m_viewerIWidget);
if(typeof _d6c!="Error"){
_d68.loadDetails();
}
}
}
_d69.callback(_d67);
},handleCellCommentSaveErrorResponse:function(_d6d,_d6e,_d6f){
_d6f.errback(new Error(_d6d.getSoapFaultDetailMessageString()));
},handleCellCommentSaveServerErrorResponse:function(_d70,_d71,_d72){
var _d73=new Error(_d70.xmlHttp.statusText);
_d73.xhr=_d70.xmlHttp;
_d72.errback(_d73);
},handleCommentSaveDone:function(_d74,_d75,_d76,_d77){
var _d78=XMLBuilderLoadXMLFromString(_d74);
if(_d78){
var _d79=_d78.firstChild;
var _d7a=XMLHelper_FindChildByTagName(_d79,"annotation",false);
if(_d7a){
var _d7b=XMLHelper_FindChildByTagName(_d7a,"id",false);
if(_d7b){
var _d7c=XMLHelper_GetText(_d7b);
_d75.setServiceId(_d7c);
_d75.setIWidgetContainer(_d77);
_d76.setWidgetContainer(_d77);
this.setCallGetAnnotations(true);
return _d74;
}
}
}
return new Error(_d74.toString());
}});
dojo.provide("bux.reportViewer");
dojo.require("dojo.buxViewer");
dojo.require("bux.AnnotationHelper");
dojo.require("bux.AnnotationIndicator");
dojo.require("viewer.AnnotationHelper");
dojo.require("bux.data.AnnotationStore");
dojo.require("bux.iwidget.common.MultilingualWidgetBase");
dojo.require("InfoBarBase");
dojo.require("WidgetContextManager");
var globalViewerIdentifier=1;
dojo.declare("bux.reportViewer",bux.iwidget.common.MultilingualWidgetBase,{annotationStore:null,annotationHelper:null,savedOutput:null,undoRedoQueue:null,dojoConnections:null,properties:null,promptParametersRetrieved:false,viewerId:null,xNodeId:null,namespacePrefix:"x",timer:null,timerInterval:20,GODASHBOARD_REPORT_VERSION:"1.0.0.0",BUX_REPORT_VERSION:"4.0.0.0.0",BUX_REPORT_CASPIAN_RP1_VERSION:"3.0.0.0.0",RAP_REPORT_INFO_VERSION:"1.0.0.0",viewerWidgetLastAction:null,sliderState:null,sViewerIWidgetId:null,bToolbarInitialized:false,m_oWidgetContextManager:null,m_oInfoBarRenderedState:{},m_bRunReportOption:null,m_oLoadManager:null,m_visible:null,m_debugDelayedViewerLoadingMode:0,m_delayedLoadingContext:null,m_doGetParametersOnLoad:null,widgetSize:null,copyPasteResource:null,_pastedWidget:false,ciPublishedReportPath:null,touchStartX:-1,touchPaging:false,_BUXDBInfoArray:null,m_bSelectionFilterSwitch:false,savedToolbarButtons:null,constructor:function(){
this.onUnloadInProgress=false;
this.annotationHelper=new viewer.AnnotationHelper(this);
this.savedOutput=new CIWidgetSavedOutput(this);
this.undoRedoQueue=new UndoRedoQueue(this);
this.viewerIdentifier=(globalViewerIdentifier++).toString();
this.m_oCV=null;
this.m_oLoadManager=new ViewerLoadManager(this);
this.m_doGetParametersOnLoad=false;
this._isMobile=false;
this.m_bSelectionFilterSwitch=false;
this.m_oWidgetContextManager=new WidgetContextManager(this);
this.addWindowEventListeners();
this.m_bReportDropped=false;
this.sliderState={};
this.savedToolbarButtons={};
},getWidgetId:function(){
return this.sViewerIWidgetId;
},getAnnotationHelper:function(){
return this.annotationHelper;
},getUndoRedoQueue:function(){
return this.undoRedoQueue;
},getDisplayName:function(){
var _d7d=this.iContext.getItemSet("buxrtstate",false);
if(_d7d){
var _d7e=_d7d.getItemValue("displayTitle");
return _d7e?_d7e:"";
}
return "";
},getSavedOutput:function(){
return this.savedOutput;
},getAttributeValue:function(name){
return this.iContext.getiWidgetAttributes().getItemValue(name);
},setAttributeValue:function(name,_d81){
this.iContext.getiWidgetAttributes().setItemValue(name,_d81);
},removeAttributeValue:function(name){
this.iContext.getiWidgetAttributes().removeItem(name);
},getViewerObject:function(){
if(!this.m_oCV){
try{
this.m_oCV=window["oCV"+this.getViewerId()];
}
catch(ex){
return null;
}
if(!this.m_oCV){
var _d83=this.getWidgetId();
for(var _d84=0;_d84<window.gaRV_INSTANCES.length;_d84++){
if(window.gaRV_INSTANCES[_d84].widgetId==_d83){
this.m_oCV=window.gaRV_INSTANCES[_d84];
var _d85=this.getViewerId();
var _d86=this.m_oCV.getId();
this.setViewerId(_d86);
var _d87=document.getElementsByTagName("head").item(0).childNodes;
for(var i=0;i<_d87.length;i++){
var node=_d87[i];
if(node.getAttribute&&node.getAttribute("namespaceId")==_d85){
node.setAttribute("namespaceId",_d86);
}
}
break;
}
}
}
}
return this.m_oCV;
},setViewerId:function(id){
this.viewerId=id;
},getViewerId:function(){
if(!this.viewerId){
this.viewerId=this.namespacePrefix+this.viewerIdentifier;
}
return this.viewerId;
},getLoadManager:function(){
return this.m_oLoadManager;
},getReportBlocker:function(){
if(!this.m_reportBlocker){
this.m_reportBlocker=new Blocker(this.m_oCV.getId());
}
return this.m_reportBlocker;
},placeTabControlInView:function(){
var oCV=this.getViewerObject();
if(oCV&&oCV.getTabController()){
if(oCV.getTabController().getSelectedTab()&&oCV.getTabController().getSelectedTab().getFocusableDiv()){
oCV.setKeepFocus(oCV.getTabController().getSelectedTab().getFocusableDiv());
}
dojo.window.scrollIntoView(oCV.getTabController().getWrapperDiv());
}
},setReportBlocker:function(_d8c){
this.m_reportBlocker=_d8c;
},isSavedOutput:function(){
var _d8d=this.getViewerObject();
if(typeof _d8d!=="undefined"&&_d8d!==null){
var _d8e=(_d8d.envParams["ui.action"]);
return (_d8e==="view"||_d8e==="buxView");
}
return false;
},isMobile:function(){
return this._isMobile;
},getEmbeddedMobileItem:function(){
var _d8f=false;
var _d90=this.iContext.getItemSet("buxrtstate",false);
if(_d90){
_d8f=_d90.getItemValue("embeddedMobile")=="true"?true:false;
}
return _d8f;
},getBUXRTStateInfoMap:function(_d91){
if(!window.icdConfig||!window.icdConfig.ZIPIMode||window.icdConfig.ZIPIMode==="0"){
return "";
}
var _d92=["<RTStateInfo>"];
if(_d91&&_d91.length>0){
_d92.push(_d91);
}
var _d93=this.getDisplayName();
if(_d93&&_d93.length>0){
_d92.push("<widgetTitle>",xml_encode(_d93),"</widgetTitle>");
}
if(this._BUXDBInfoArray&&this._BUXDBInfoArray.length>0){
_d92=_d92.concat(this._BUXDBInfoArray);
}
_d92.push("</RTStateInfo>");
return _d92.length>2?_d92.join(""):"";
},getBUXDBInfoArray:function(_d94){
var _d95=null;
var _d96=null;
if(_d94){
_d95=_d94.dbTitle;
_d96=_d94.dbSearchPath;
}else{
var _d97=this.iContext.getItemSet("buxrtstate",false);
if(_d97){
_d95=_d97.getItemValue("dbTitle");
_d96=_d97.getItemValue("dbSearchPath");
}
}
var _d98=[];
if(_d95&&_d96&&_d96.length>0){
_d98.push("<dbTitle>",xml_encode(_d95),"</dbTitle><dbSearchPath>",xml_encode(_d96),"</dbSearchPath>");
}
return _d98;
},loadExtraJavascriptFiles:function(_d99){
if(typeof CSelectionContext=="undefined"){
this._loadFile("/drill/CSelectionContextBuilder.js",_d99);
}
this._loadFile("/mdsrv/lineage.js",_d99);
if(window.cognosViewerDebug){
this._loadFile("/rv/viewer.extra.debug.js",_d99);
}else{
this._loadFile("/rv/viewer.extra.js",_d99);
}
},_loadFile:function(_d9a,_d9b){
if(dojo.isIE||dojo.isTrident||_d9b.indexOf("..")==0){
var _d9c=window.gScriptLoader.loadFile(_d9b+_d9a,"","GET");
var _d9d=document.createElement("script");
_d9d.type="text/javascript";
_d9d.text=_d9c;
document.getElementsByTagName("head")[0].appendChild(_d9d);
}else{
dojo._loadPath(_d9b+_d9a,null);
}
},_getCWALaunchInformation:function(){
var args={url:this.buildPostUrl(),sync:false,handleAs:"json",preventCache:true,content:{"b_action":"cognosViewer","ui.action":"noOp","cv.responseFormat":"getCWALaunchParameters"},error:dojo.hitch(this,function(_d9f){
this.fireEvent("com.ibm.bux.widget.render.done",null,{noAutoResize:true});
this.fireEvent("com.ibm.bux.widget.notification",null,{type:"error",message:_d9f.message,description:_d9f.description});
}),load:dojo.hitch(this,function(_da0,_da1){
var _da2=_da1.xhr.getResponseHeader("Content-Type");
if(_da2&&_da2.indexOf("text/html")!=-1&&_da0&&_da0.match(/<ERROR_CODE>CAM_PASSPORT_ERROR<\/ERROR_CODE>/)){
this.handlePassportErrorFromDispatcher();
}else{
this._launchCWA(_da0);
}
})};
dojo.xhrPost(args);
},_launchCWA:function(_da3){
if(_da3){
if(typeof NewReportAction=="undefined"){
this.loadExtraJavascriptFiles(_da3.webContentRoot);
if(_da3.productLocale!="en"){
this._loadFile("rv/res/viewer_"+_da3.productLocale+".js",_da3.webContentRoot);
}
}
var _da4=new NewReportAction();
_da4.setRequestParms({"packageSearchPath":this.getAttributeValue("packageSearchPath"),"viewerIWidget":this,"webContentRoot":_da3.webContentRoot,"gateway":_da3.gateway,"capabilitiesXml":_da3.capabilitiesXML,"cafContextId":_da3.cafContextId});
this.removeAttributeValue("packageSearchPath");
_da4.execute();
}
},setNewReportInfo:function(info){
this._newReportInfo=info;
},_handleFileDialogCancel:function(){
this.fireEvent("com.ibm.bux.widget.action",null,{action:"deleteWidget"});
},_handleFileDialogOk:function(_da6){
this.removeAttributeValue("newReport");
this.setAttributeValue("packageSearchPath","storeID(\""+_da6+"\")");
this.onLoad();
},onLoad:function(){
this.sViewerIWidgetId=this.iContext.getRootElement().id;
if(this.getAttributeValue("packageSearchPath")){
this._getCWALaunchInformation();
return;
}else{
if(this.getAttributeValue("newReport")==="true"){
dojo["require"]("bux.dialogs.FileDialog");
var oDlg=new bux.dialogs.PackageDialog({onCancelHandler:dojo.hitch(this,this._handleFileDialogCancel),selectPackageHandler:dojo.hitch(this,this._handleFileDialogOk)});
oDlg.startup();
oDlg.show();
return;
}
}
var _da8=this.getAttributeValue("ViewerConcurrentRequestLimit");
if(_da8){
this.removeAttributeValue("ViewerConcurrentRequestLimit");
if(!window["gReportWidgetLoadQueue"]){
window["gReportWidgetLoadQueue"]=new ReportWidgetLoadQueue(_da8);
}
}
this._isMobile=this.getEmbeddedMobileItem();
this._BUXDBInfoArray=this.getBUXDBInfoArray();
var _da9=this.getAttributeValue("viewerProperties");
var _daa=this.getAttributeValue("promptParametersRetrieved");
if(_daa!==null&&_daa=="true"){
this.promptParametersRetrieved=true;
}
this.properties=this.createProperties(_da9);
this.savedOutput.setPagedOutput(!this.properties.getRetrieveAll());
this.setWidgetCopyPasteParameters();
this.m_bSelectionFilterSwitch=this.getAttributeValue("selectionFilterEnabled")=="true"?true:false;
if(this.isOpeningSavedDashboard()&&this.copyPasteResource==null){
this.disableListenToIfFullReportUpgraded();
this.enableFlashChartsToIfReportPartUpgraded();
this.disableListenToIfReportPartUpgraded();
if(this.isVisible()){
if(window["gReportWidgetLoadQueue"]){
window["gReportWidgetLoadQueue"].add(this);
}else{
this.postReport(null);
}
}
}else{
var _dab={action:"canvas.filters"};
this.fireEvent("com.ibm.bux.widget.action",null,_dab);
this.getLoadManager().viewerLoadInitiated();
this.m_visible=true;
}
this.addWidgetEventListeners();
this.iContext.iEvents.svc.addWire(this.iContext.widgetId,"com.ibm.widget.contextChanged","widgetBuxCanvasTabs","com.ibm.widget.contextChanged");
this.iContext.iEvents.svc.addWire(this.iContext.widgetId,"com.ibm.bux.data.filterCache.init","widgetBuxCanvasTabs","com.ibm.bux.data.filterCache.init");
this.fireEvent("com.ibm.bux.widget.updateStoreID",null,{});
},addWindowEventListeners:function(){
if(!this.dojoConnections){
this.dojoConnections=[];
}
this.dojoConnections.push(dojo.connect(window,"onresize",this,this.onBrowserResize));
this.dojoConnections.push(dojo.connect(window,"onbeforeunload",this,this.possibleUnloadEvent));
},addWidgetEventListeners:function(){
if(this.isMobile()){
this.dojoConnections.push(dojo.connect(this.iContext.getRootElement(),"touchstart",this,this.onTouchStart));
this.dojoConnections.push(dojo.connect(this.iContext.getRootElement(),"touchmove",this,this.onTouchMove));
}
},addChromeWhitespaceHandler:function(_dac){
if(isIE()){
var _dad=document.getElementById("mainViewerTR"+_dac);
if(_dad){
this.dojoConnections.push(dojo.connect(_dad,"onmousedown",this,this.onMouseDownOnChromeDiv));
}
}
},onMouseDownOnChromeDiv:function(evt){
var oCV=this.getViewerObject();
if(oCV){
var _db0=oCV.getReportDiv();
if(_db0){
var _db1=_db0.getBoundingClientRect();
var _db2=_db1.top+_db0.offsetHeight;
if(evt.clientY>_db2&&evt.button!==2){
if(oCV.getSelectionController()){
oCV.getSelectionController().clearSelectedObjects();
this.onSelectionChange();
stopEventBubble(evt);
}
}
}
}
},removeWindowEventListeners:function(){
if(this.dojoConnections){
for(var i=0;i<this.dojoConnections.length;++i){
dojo.disconnect(this.dojoConnections[i]);
}
delete this.dojoConnections;
}
},onBrowserResize:function(){
var oCV=this.getViewerObject();
if(oCV&&oCV.getPinFreezeManager()){
oCV.getPinFreezeManager().onResizeCanvas(this.isVisible());
}
},onTouchStart:function(e){
this.touchPaging=false;
if(this.m_oCV&&e&&e.changedTouches&&e.touches&&e.touches.length==1){
var _db6=e.changedTouches[0];
if(_db6&&_db6.clientX){
this.touchStartX=parseInt(_db6.clientX);
}
}
},onTouchMove:function(e){
if(!this.touchPaging&&this.touchStartX!=-1&&this.m_oCV&&e&&e.changedTouches&&e.touches&&e.touches.length==1){
var _db8=e.changedTouches[0];
if(_db8&&_db8.clientX){
var _db9=parseInt(_db8.clientX);
if(this.m_oCV.hasNextPage()&&this.touchStartX-_db9>10){
this.touchPaging=true;
this.m_oCV.pageAction("nextPage");
this.m_oCV.setKeepFocus(false);
}else{
if(this.m_oCV.hasPrevPage()&&_db9-this.touchStartX>10){
this.touchPaging=true;
this.m_oCV.pageAction("previousPage");
this.m_oCV.setKeepFocus(false);
}else{
this.touchPaging=false;
this.touchStartX=-1;
}
}
}
}
if(this.touchStartX>0){
stopEventBubble(e);
}
},isLiveReport:function(){
return this.isSavedOutput()===false&&!this.isLimitedInteractiveMode();
},createProperties:function(_dba){
return new bux.reportViewer.Properties(this,_dba);
},disableListenToIfFullReportUpgraded:function(){
if(this.isGoDashboardReportUpgrade()){
if(this.getAttributeValue("flexParam_properties")==null){
var _dbb={};
_dbb["*"]={blockedEvents:["com.ibm.bux.data.filter","com.ibm.bux.filter.values.get","com.ibm.bux.filter.items.get"]};
this.fireEvent("com.ibm.bux.widget.updateEventFilter",null,_dbb);
}
}
},enableFlashChartsToIfReportPartUpgraded:function(){
if(this.isGoDashboardReportUpgrade()){
var _dbc=this.getAttributeValue("originalReportPart");
if(typeof _dbc!=="undefined"&&_dbc!==null){
this.properties.setProperty("flashCharts","true");
}
}
},disableListenToIfReportPartUpgraded:function(){
if(this.isGoDashboardReportUpgrade()){
var _dbd=this.getAttributeValue("originalReportPart");
if(typeof _dbd!=="undefined"&&_dbd!==null){
var _dbe={};
_dbe["*"]={blockedEvents:["com.ibm.bux.viewer.drill","com.ibm.bux.viewer.prompt"]};
this.fireEvent("com.ibm.bux.widget.updateEventFilter",null,_dbe);
}
}
},possibleUnloadEvent:function(){
var oCV=this.getViewerObject();
if(oCV){
oCV.getViewerDispatcher().possibleUnloadEvent();
}
},onUnload:function(){
this.onUnloadInProgress=true;
this.destroy();
this.iContext=null;
},onGetFiltersDone:function(evt){
if(typeof this.filterRequiredAction!="undefined"&&this.filterRequiredAction!=null){
var _dc1=this.buildDataFiltersParam(evt.payload.filters);
var _dc2=new ActionFactory(this.getViewerObject());
var _dc3=_dc2.load(this.filterRequiredAction);
_dc3.dispatchRequest(_dc1,this.filterRequiredAction);
this.filterRequiredAction=null;
}else{
this.postReport(evt.payload.filters);
this.postSetWidgetCopyPasteParameters();
}
},getOriginalFormFields:function(){
return this.m_originalFormFields;
},setOriginalFormFields:function(_dc4){
this.m_originalFormFields=_dc4;
},getXNodeId:function(){
return this.xNodeId;
},setXNodeId:function(_dc5){
this.xNodeId=_dc5;
},postReport:function(_dc6){
this.getLoadManager().viewerLoadInitiated();
this.viewerWidgetLastAction={"functionName":"postReport","param":[_dc6]};
if(this.getRunReportOption()!==false){
this.m_oLoadManager.runningReport();
}
var _dc7=this.buildPostContent(_dc6);
if(_dc7["ui.reportDrop"]=="true"){
this.m_bReportDropped=true;
}
this.m_originalFormFields=new CDictionary();
for(var _dc8 in _dc7){
if(_dc8!="cv.outputKey"){
this.m_originalFormFields.add(_dc8,_dc7[_dc8]);
}
}
var _dc9={};
if(this.getAttributeValue("X-Node-ID")){
this.setXNodeId(this.getAttributeValue("X-Node-ID"));
_dc9["X-Node-ID"]=this.getAttributeValue("X-Node-ID");
this.removeAttributeValue("X-Node-ID");
}
var args={url:this.buildPostUrl(),sync:false,preventCache:true,content:_dc7,headers:_dc9,error:dojo.hitch(this,function(_dcb){
this.fireEvent("com.ibm.bux.widget.render.done",null,{noAutoResize:true});
this.fireEvent("com.ibm.bux.widget.notification",null,{type:"error",message:_dcb.message,description:_dcb.description});
})};
if(typeof xhrMultiPart!=="undefined"&&xhrMultiPart.active){
args.load=dojo.hitch(this,function(_dcc){
this.loadContent(_dcc.responseText);
});
xhrMultiPart.Post(args);
}else{
args.load=dojo.hitch(this,function(_dcd,_dce){
var _dcf=_dce.xhr.getResponseHeader("Content-Type");
if(_dcf&&_dcf.indexOf("text/html")!=-1&&_dcd&&_dcd.match(/<ERROR_CODE>CAM_PASSPORT_ERROR<\/ERROR_CODE>/)){
this.handlePassportErrorFromDispatcher();
}else{
this.loadContent(_dcd);
}
});
dojo.xhrPost(args);
}
},isDropped:function(){
return this.m_bReportDropped;
},cleanupStyles:function(){
this._cssLimitReached=true;
if(!this.isVisible()){
if(!this._styles){
this._styles=[];
}
var id=this.getViewerId();
var _dd1=document.getElementsByTagName("head").item(0).getElementsByTagName("style");
for(var i=0;i<_dd1.length;i++){
var _dd3=_dd1[i];
if(_dd3.getAttribute&&_dd3.getAttribute("namespaceId")==id){
_dd3.parentNode.removeChild(_dd3);
this._styles.push(_dd3);
i--;
}
}
}
},reloadStyles:function(){
if(this._styles){
while(this._styles.length>0){
var _dd4=this._styles.pop();
document.getElementsByTagName("head").item(0).appendChild(_dd4);
}
}
},loadStylesAndScripts:function(_dd5,_dd6,_dd7){
window.gScriptLoader.m_bIgnoreAjaxWarnings=true;
window.gScriptLoader.setHandlerStylesheetLimit(true);
var _dd8=this.iContext.getRootElement();
if(!_dd8){
return;
}
_dd5=window.gScriptLoader.loadCSS(_dd5,_dd6,true,this.getViewerId());
if(dojo.isIE||dojo.isTrident){
_dd5="<span style='display:none'>&nbsp;</span>"+_dd5;
}
_dd6.innerHTML=_dd5;
if(this.isSelectionFilterEnabled()){
this.updateDrillThroughLinks();
}
var _dd9=GUtil.generateCallback(this.fireResizeEvent,[],this);
this.m_sScriptLoaderNamespace=this.getViewerId();
window.gScriptLoader.loadAll(_dd6,_dd9,this.m_sScriptLoaderNamespace,_dd7);
},fireResizeEvent:function(){
var _dda=this.getViewerObject();
if(_dda==null){
this.fireEvent("com.ibm.bux.widget.render.done",null,{});
}else{
var _ddb=_dda.getViewerWidget();
if(_ddb){
_dda.m_resizeReady=true;
_dda.doneLoading();
}else{
var _ddc=this;
setTimeout(function(){
_ddc.fireResizeEvent();
},100);
}
}
},getSavedReportSearchPath:function(_ddd){
var _dde=this.getAttributeValue("savedReportPath");
if(_dde){
return _dde;
}
var _ddf=this.getAttributeValue("dashboardID");
_ddf=_ddf.substr("$$dbid$$".length);
var _de0="storeID(\""+_ddf+"\")/*[@name="+xpath_attr_encode(_ddd)+"]";
return _de0;
},isSavedReport:function(_de1,_de2){
return (typeof _de2!=="undefined"&&_de2!==null&&_de2.length>0&&_de1!==_de2);
},getGlobalPromptsInfo:function(){
var _de3=null;
var oCV=null;
var _de5=[];
var _de6=null;
if(window.gaRV_INSTANCES){
for(var _de7=0;_de7<window.gaRV_INSTANCES.length;_de7++){
oCV=window.gaRV_INSTANCES[_de7];
_de6=oCV.getPromptParametersInfo();
if(_de6!=null){
_de5.push(_de6);
}
}
}
if(_de5.length>0){
_de3="<globalPromptInfo>"+_de5.join("")+"</globalPromptInfo>";
}
return _de3;
},buildPostUrl:function(){
return this.getAttributeValue("gateway");
},getSavedItem:function(){
var _de8=this.getAttributeValue("savedReportPath");
if(!_de8){
_de8=this.getAttributeValue("savedReportName");
}
return _de8;
},setRunReportOption:function(_de9){
this.m_bRunReportOption=_de9;
},getRunReportOption:function(){
return this.m_bRunReportOption;
},resetRunReportOption:function(){
this.m_bRunReportOption=null;
},buildPostContent:function(_dea){
var _deb=this.getAttributeValue("originalReport");
var _dec=this.getSavedItem();
var _ded=this.getAttributeValue("originalReportPart");
var _dee=this.getAttributeValue("flexParam_properties");
var _def=this.getAttributeValue("flexParam_promptData");
var _df0=this.isSavedReport(_deb,_dec);
var _df1=this.getPromptRunOption(_def,_df0);
var _df2=this.getAttributeValue("cv.outputKey")?"cvx.high":"cognosViewer";
var _df3={"b_action":_df2,"run.outputFormat":"HTML","bux":"true","cv.responseFormat":"iWidget","cv.id":this.getViewerId()};
if(this.isMobile()){
_df3["container"]="mobile";
}
if(this.getAttributeValue("cv.outputKey")){
_df3["cv.outputKey"]=this.getAttributeValue("cv.outputKey");
this.removeAttributeValue("cv.outputKey");
_df3["widget.id"]=this.getWidgetId();
}
if(this.getAttributeValue("gateway")){
_df3["cv.gateway"]=this.getAttributeValue("gateway");
}
if(this.getAttributeValue("webcontent")){
_df3["cv.webcontent"]=this.getAttributeValue("webcontent");
}
this.sInitialSpec=this.getAttributeValue("specification");
if(_df0){
this.addUserParamsToContent(_df3);
}
if(!this.sInitialSpec||this.copyPasteResource){
if(_df0){
_df3["ui.object"]=this.getSavedReportSearchPath(_dec);
if(!this.getAttributeValue("savedReportPath")&&this.getAttributeValue("savedReportName")){
_df3["savedReportName"]=_dec;
}
_df3["widget.isSavedReport"]="true";
_df3["ui.reRunObj"]=this.getSavedReportSearchPath(_dec);
}else{
_df3["ui.object"]=_deb;
if(_dee&&_dee.length>0){
_df3["flexParamProperties"]=_dee;
}
if(_def&&_def.length>0){
_df3["gdPromptAnswers"]=_def;
}
}
_df3["originalReport"]=_deb;
}
if(this.getAttributeValue("savedOutputSearchPath")!=null){
this.setSavedOutputSearchPath(this.getAttributeValue("savedOutputSearchPath"));
_df3["ui.savedOutputSearchPath"]=this.getAttributeValue("savedOutputSearchPath");
_df3["ui.action"]="buxView";
}else{
if(this.getAttributeValue("mostRecentSavedOutput")=="true"){
_df3["ui.action"]="buxView";
}else{
if(_df0){
if(this.getAttributeValue("limitedInteractiveMode")==="true"){
_df3["limitedInteractiveMode"]="true";
_df3["ui.action"]="run";
_df3["run.xslURL"]="bux.xsl";
}else{
_df3["ui.action"]="bux";
}
if(this.getRunReportOption()!==null){
_df3["widget.runReport"]=(this.getRunReportOption())?"true":"false";
if(this.getDoGetParametersOnLoad()){
_df3["widget.globalPromptInfo"]="<globalPromptInfo></globalPromptInfo>";
}
this.resetRunReportOption();
}
}else{
if(_ded&&_ded.length>0&&this.copyPasteResource==null){
_df3["ui.reportDrop"]="true";
_df3["ui.action"]="bux";
_df3["reportpart_id"]=_ded;
}else{
if(this.copyPasteResource){
if(this.ciPublishedReportPath!=null){
_df3["ui.object"]=this.ciPublishedReportPath;
}
var _df4=dojo.fromJson(this.copyPasteResource);
if(_df4[0]&&_df4[0].body){
var _df5=this.getAttributeValue("copy.conversation");
if(_df5){
_df3["ui.conversation"]=_df5;
}
if(_df4[0].body.specification){
_df3["ui.spec"]=_df4[0].body.specification;
_df3["ui.action"]="buxCopyPaste";
if(this.getAttributeValue("reportCreatedInCW")==="true"){
_df3["cv.objectPermissions"]="read write execute setPolicy traverse";
}
}else{
_df3["ui.reportDrop"]="true";
_df3["ui.action"]="buxDropReportOnCanvas";
}
}
}else{
if(this.sInitialSpec){
_df3["ui.spec"]=this.sInitialSpec;
_df3["ui.action"]="buxRunSpecification";
_df3["cv.objectPermissions"]="read write execute setPolicy traverse";
}else{
if(this._newReportInfo){
for(prop in this._newReportInfo){
_df3[prop]=this._newReportInfo[prop];
}
_df3["ui.reportDrop"]="true";
_df3["ui.action"]="bux";
_df3["cv.objectPermissions"]="read write execute setPolicy traverse";
_df3["ui.objectClass"]="report";
_df3["openReportFromClipboard"]="true";
}else{
_df3["ui.reportDrop"]="true";
_df3["ui.action"]="buxDropReportOnCanvas";
}
}
}
}
}
}
}
if(_df1!==null){
_df3["run.prompt"]=(_df1?"true":"false");
}
if(this.getAttributeValue("lastLocaleSaved")!=null){
_df3["lastLocaleSaved"]=this.getAttributeValue("lastLocaleSaved");
}
var _df6="";
if(this.copyPasteResource){
_df6=this.updateCopyPasteFilters(_dea);
}else{
_df6=this.buildDataFiltersParam(_dea);
if(typeof _dea=="undefined"||_dea==null){
_df6=this.buildFiltersParamFromLoadedSliderState();
}
}
if(_df6!=""){
_df3["cv.updateDataFilters"]=_df6;
}
if(this.properties&&this.properties.getFlashCharts()!==null){
_df3["savedFlashChartOption"]=(this.properties.getFlashCharts()?"true":"false");
var _df7=this.getAttributeValue("hasAVSChart");
if(_df7=="true"){
_df3["hasAVSChart"]="true";
}else{
_df3["hasAVSChart"]="false";
}
}
if(this.properties.getRowsPerPage()!=null){
_df3["run.verticalElements"]=this.properties.getRowsPerPage();
}
var _df8=this.getAttributeValue("syncNewWidgets");
if(_df8===null||_df8==="true"){
_df8=true;
}else{
_df8=false;
}
if(!_df0&&_df8){
var _df9=this.getGlobalPromptsInfo();
if(_df9!==null){
_df3["widget.globalPromptInfo"]=_df9;
}
}
if(this.isOpeningSavedDashboard()){
_df3["ui.preserveRapTags"]="true";
}
if(_df0===true&&this.getAttributeValue("limitedInteractiveMode")!=="true"){
this.getUserId();
}
if(window.cognosViewerDebug){
_df3.debug=true;
}
_df3["cv.buxCurrentUserRole"]=this.getUserRole();
if(this.shouldUseSavedReportInfo()){
_df3["rap.getReportInfo"]="false";
}
if(window.icdConfig&&window.icdConfig.ZIPIMode!="0"){
this.addBUXRTStateInfoToContent(_df3);
}
this.addBUXWidgetTitleToContent(_df3);
return _df3;
},addBUXRTStateInfoToContent:function(_dfa){
if(_dfa!=null){
var _dfb=this.getBUXRTStateInfoMap();
if(_dfb&&_dfb.length>0){
_dfa["cv.buxRTStateInfo"]=_dfb;
}
}
},addBUXWidgetTitleToContent:function(_dfc){
if(_dfc!=null){
var _dfd=this.getAttributeValue("widgetTitle");
if(_dfd&&_dfd.length>0){
_dfc["widgetTitle"]=_dfd;
}
var _dfe=this.getDisplayName();
if(_dfe&&_dfe.length>0){
_dfc["displayTitle"]=_dfe;
}
}
},addUserParamsToContent:function(_dff){
var _e00=this.getAttributeValue("userParams");
if(!_e00){
return;
}
var doc=XMLBuilderLoadXMLFromString(_e00);
if(!doc){
return;
}
var _e02=XMLHelper_FindChildrenByTagName(doc.documentElement,"item",false);
var _e03=_e02.length;
for(var i=0;i<_e03;i++){
if(!_e02[i]){
continue;
}
var _e05=XMLHelper_FindChildByTagName(_e02[i],"name",false);
if(!_e05){
continue;
}
var _e06=XMLHelper_FindChildByTagName(_e02[i],"value",false);
_dff[XMLHelper_GetText(_e05)]=(!_e06?"":XMLHelper_GetText(_e06));
}
if(_e03>0){
_dff["widget.userParameters"]="true";
if(this.getAttributeValue("viewerReportPrompts")){
_dff["viewerReportPrompts"]=this.getAttributeValue("viewerReportPrompts");
}
}
this.removeAttributeValue("userParams");
},shouldUseSavedReportInfo:function(){
return this.getAttributeValue("rapReportInfoVersion")===this.RAP_REPORT_INFO_VERSION&&this.getAttributeValue("rapReportInfo")!=null;
},isConsumeUser:function(){
return this.getUserRole()==="consume";
},getUserRole:function(){
var _e07=null;
var _e08=this.iContext.getItemSet("buxuserprofile",false);
if(_e08){
_e07=_e08.getItemValue("currentUserRole");
}
return _e07==null?"assemble":_e07;
},getUserId:function(){
dojo["require"]("bux.UserAccount");
return bux.UserAccount.getUserAccount().then(dojo.hitch(this,function(_e09){
this.m_sUserId=_e09.cm$searchPath;
return this.m_sUserId;
}));
},_genMobileFormFieldPayload:function(form){
var _e0b={};
var _e0c=form.getElementsByTagName("input");
if(_e0c){
for(var i=0;i<_e0c.length;i++){
var name=_e0c[i].getAttribute("name");
var _e0f=_e0c[i].getAttribute("value");
if(name&&_e0f){
_e0b[name]=_e0f;
}
}
}
return _e0b;
},launchGotoPageForIWidgetMobile:function(form){
var _e11={"action":"goto","payload":this._genMobileFormFieldPayload(form)};
if(typeof console!="undefined"&&console&&console.log){
console.log(_e11);
}
this.fireEvent("com.ibm.bux.widget.openView",null,_e11);
},executeDrillThroughForIWidgetMobile:function(form){
var _e13=getChildElementsByAttribute(form,"input","name","ui.action");
if(_e13&&_e13.length>0){
_e13[0].setAttribute("value","authoredDrillThroughMobile");
}
var _e14={"action":"drillThrough","payload":this._genMobileFormFieldPayload(form)};
if(typeof console!="undefined"&&console&&console.log){
console.log(_e14);
}
this.fireEvent("com.ibm.bux.widget.openView",null,_e14);
},isBuxAvailable:function(){
return (this.bux&&this.bux._base?true:false);
},getDrillOptions:function(){
return this.properties.getDrillOptions();
},getPromptRunOption:function(_e15,_e16){
if(!_e16&&_e15&&_e15.length>0){
return false;
}else{
if(_e16){
return this.properties.getPromptUserOnLoad();
}else{
return null;
}
}
},buildDataFiltersParam:function(_e17){
var _e18="";
if(_e17&&_e17.length>0){
this.sliderState={};
_e18="<UpdateDataFilters>";
for(var _e19=0;_e19<_e17.length;++_e19){
var _e1a=_e17[_e19];
var _e1b=dojo.fromJson(_e1a);
if(_e1b.clientId==this.getWidgetId()){
continue;
}
if(!(_e1b["com.ibm.widget.context.bux.selectValueControl"])){
this.m_oWidgetContextManager.convertSelectionToSelectValueControlPayload(_e1b);
this.m_oWidgetContextManager.convertGenericToSelectValueControlPayload(_e1b);
_e1a=dojo.toJson(_e1b);
}
_e18+="<filter>"+xml_encode(_e1a)+"</filter>";
this.sliderState[_e1b.clientId]=_e1a;
}
_e18+="</UpdateDataFilters>";
}
return _e18;
},updateCopyPasteFilters:function(_e1c){
this.loadSliderState();
if(this.sliderState){
for(var _e1d in this.sliderState){
this.sliderState[_e1d]="{'clientId':'"+_e1d+"',\t'com.ibm.widget.context':{},'com.ibm.widget.context.bux.selectValueControl':"+"{'selectValueControl':{'id':'"+_e1d+"','controlType':'slider','type':'discrete','valueType':'string'}}}";
}
}
if(_e1c&&_e1c.length>0){
for(var _e1e=0;_e1e<_e1c.length;++_e1e){
var _e1f=_e1c[_e1e];
var _e20=dojo.fromJson(_e1f);
if(_e20["com.ibm.widget.context.bux.selection"]){
this.m_oWidgetContextManager.convertSelectionToSelectValueControlPayload(_e20);
this.m_oWidgetContextManager.convertGenericToSelectValueControlPayload(_e20);
_e1f=dojo.toJson(_e20);
}
this.sliderState[_e20.clientId]=_e1f;
}
}
return this.buildDataFiltersParam_fromState();
},buildFiltersParamFromLoadedSliderState:function(){
var _e21="";
this.loadSliderState();
_e21=this.buildDataFiltersParam_fromState();
return _e21;
},loadSliderState:function(){
this.sliderState={};
var _e22=dojo.fromJson(this.getAttributeValue("sliderIDs"));
if(_e22){
for(var i=0;i<_e22.length;++i){
var _e24=_e22[i];
var _e25=this.getItemValue("sliderState_"+_e24);
if(_e25!=null&&_e25!=""){
this.sliderState[_e24]=_e25;
}
}
}
},buildDataFiltersParam_fromState:function(){
var _e26="";
if(this.sliderState){
for(var _e27 in this.sliderState){
_e26+="<filter>"+xml_encode(this.sliderState[_e27])+"</filter>";
}
if(_e26!==""){
return ("<UpdateDataFilters>"+_e26+"</UpdateDataFilters>");
}
}
return _e26;
},loadContent:function(_e28){
var _e29=dojo.byId("_"+this.iContext.widgetId+"_cv");
this.loadStylesAndScripts(_e28,_e29,true);
if(!window.gScriptLoader.hasCompletedExecution()){
var obj=this;
this.timer=setInterval(function(){
window.gInitializeViewer(obj);
},this.timerInterval);
}else{
window.gInitializeViewer(this);
}
this.viewerWidgetLastAction=null;
},executeAction:function(evt,_e2c){
var _e2d=this.getViewerObject();
if(evt&&_e2d){
var _e2e=_e2c?_e2c:evt.payload.name;
var _e2f=evt.payload;
if(_e2e&&typeof _e2f!="undefined"&&_e2f!=null){
if(evt.payload.payload){
_e2f=evt.payload.payload;
}
_e2d.executeAction(_e2e,_e2f);
}
}
},onContextMenuAction:function(evt){
this.executeAction(evt);
},onToolbarAction:function(evt){
this.executeAction(evt);
},updateToolbar:function(){
var _e32=this.getViewerObject();
if(!_e32||(!this.bToolbarInitialized&&typeof CognosViewerAction!="function")){
return;
}
if(_e32.getStatus()==="prompting"){
return;
}
var _e33=_e32.getToolbar();
CCognosViewerToolbarHelper.updateToolbarForCurrentSelection(_e32,_e33);
this.fireEvent("com.ibm.bux.widgetchrome.toolbar.init",null,_e32.getToolbar());
},onSelect:function(){
if(!this.bToolbarInitialized){
this.bToolbarInitialized=true;
var _e34=this.getViewerObject();
if(_e34){
var _e35=_e34.getStatus();
if(_e35!=="prompting"&&_e35!=="working"&&_e35!="stillWorking"){
this.updateToolbar();
}
}
}
this.fireEvent("com.ibm.bux.widget.select.done",null,{});
},hideToolbarAndContextMenu:function(){
this.fireEvent("com.ibm.bux.widget.contextMenu.update");
this.fireEvent("com.ibm.bux.widgetchrome.toolbar.init");
},updateSavedAttributes:function(_e36){
this.setAttributeValue("version",this.BUX_REPORT_VERSION);
this.setAttributeValue("viewerProperties",this.properties.toString());
if(this.m_oWidgetContextManager.getSelectionFilterObjects()){
this.setAttributeValue("selectionObjects",this.m_oWidgetContextManager.toStringSelectionFilterObjects());
}
if(_e36==="live"){
var oCV=this.getViewerObject();
var _e38=this.getEnvParam("reportPrompts");
if(this.promptParametersRetrieved==true&&_e38&&_e38.length>0){
this.setAttributeValue("viewerReportPrompts",this.getEnvParam("reportPrompts"));
}
this.setAttributeValue("promptParametersRetrieved",(this.promptParametersRetrieved?"true":"false"));
this.setAttributeValue("selectionFilterEnabled",this.m_bSelectionFilterSwitch?"true":"false");
if(this.getEnvParam("reportpart_id")&&this.getEnvParam("reportpart_id").length>0){
this.setAttributeValue("fromReportPart","true");
}
if(this.isLimitedInteractiveMode()){
this.setAttributeValue("limitedInteractiveMode","true");
}else{
this.setAttributeValue("baseReportModificationTime",oCV.envParams["baseReportModificationTime"]);
}
var _e39=oCV.envParams["contentLocale"];
if(_e39!=null){
this.saveSliderState();
this.setAttributeValue("lastLocaleSaved",_e39);
}
this.setAttributeValue("originalReportLocation",oCV.envParams["originalReportLocation"]);
this.setAttributeValue("hasAVSChart",oCV.hasAVSChart()?"true":"false");
this.setAttributeValue("displayTypes",this.getDisplayTypes());
this.setSavedOutputsCMResponse(null);
if(oCV.getPinFreezeManager()){
var _e3a=oCV.getPinFreezeManager().toJSONString();
this.setAttributeValue("PinFreezeInfo",_e3a);
}
if(oCV.envParams["rapReportInfo"]){
this.setAttributeValue("rapReportInfoVersion",this.RAP_REPORT_INFO_VERSION);
this.setAttributeValue("rapReportInfo",oCV.envParams["rapReportInfo"]);
}
}
if(_e36==="savedOutput"){
if(this.getSavedOutputSearchPath()==null){
this.setAttributeValue("mostRecentSavedOutput","true");
}else{
this.setAttributeValue("savedOutputSearchPath",this.getSavedOutputSearchPath());
}
this.setAttributeValue("selectionFilterEnabled",this.m_bSelectionFilterSwitch?"true":"false");
}
},onItemSetChanged:function(_e3b){
if(this.getViewerObject()){
var _e3c=_e3b.payload.changes;
for(var i in _e3c){
if(_e3c[i].id==="savedReportPath"&&_e3c[i].newVal){
this.updateCVEnvParam();
}
}
}
},updateCVEnvParam:function(){
var oCV=this.getViewerObject();
oCV.envParams["ui.objectClass"]=this.isSavedOutput()?"reportView":"report";
oCV.envParams["widget.isSavedReport"]="true";
var _e3f=this.getAttributeValue("savedReportName");
if(_e3f){
oCV.envParams["ui.object"]=_e3f;
oCV.envParams["savedReportName"]=_e3f;
}else{
oCV.envParams["ui.object"]=this.getAttributeValue("savedReportPath");
}
},onWidgetSave:function(evt){
var _e41=this.getViewerObject();
var _e42={"status":false};
if(evt&&evt.payload&&evt.payload.isCopy===true){
this.setAttributeValue("copy.conversation",_e41.getConversation());
}else{
this.removeItem("copy.conversation");
this.removeItem("copy.ciPublishedReportPath");
}
var _e43=evt&&evt.payload&&evt.payload.operation=="saveAs"?true:false;
if(!_e41&&!_e43){
this.fireEvent("com.ibm.bux.widget.save.done",null,_e42);
return;
}
this.getLoadManager().runWhenHasViewer(dojo.hitch(this,function(){
var _e44=this.getViewerObject();
_e44.loadExtra();
if(this.isSavedOutput()){
this.cleanSavedAttributes();
this.updateSavedAttributes("savedOutput");
_e42.status=true;
this.fireEvent("com.ibm.bux.widget.save.done",null,_e42);
}else{
if(this.sInitialSpec){
_e42.status=true;
this.fireEvent("com.ibm.bux.widget.save.done",null,_e42);
}else{
var _e45=this.getEnvParam("cv.objectPermissions");
var _e46=new ViewerIWidgetSave(this,evt.payload);
if(!_e46.canSave(_e45)){
this.showErrorMessage(RV_RES.IDS_CANNOT_SAVE_CONTENT_ERROR);
this.fireEvent("com.ibm.bux.widget.save.done",null,_e42);
return;
}
if(this.isLimitedInteractiveMode()||(_e44.envParams["ui.spec"]&&_e44.envParams["ui.spec"].length>0)){
this.cleanSavedAttributes();
this.updateSavedAttributes("live");
if(_e46.doGetSavePropertiesFromServer()){
_e46.getSavePropertiesFromServer();
}else{
this.doWidgetSaveDone(_e46);
}
}else{
if(!_e44.envParams["ui.spec"]){
_e46.setDoCWCopy(true);
this.doWidgetSaveDone(_e46);
}else{
this.fireEvent("com.ibm.bux.widget.save.done",null,_e42);
}
}
}
}
}),evt);
},doWidgetSaveDone:function(_e47){
var _e48=_e47.getPayload();
_e48.status=true;
if(window.icdConfig&&window.icdConfig.ZIPIMode!="0"){
var _e49=_e47.m_payload.dashboard;
if(_e49){
this._BUXDBInfoArray=this.getBUXDBInfoArray({dbTitle:_e49.title._text,dbSearchPath:_e49.cm$searchPath});
}
}
this.fireEvent("com.ibm.bux.widget.save.done",null,_e48);
},handleGetSavePropertiesFromServerResponse:function(_e4a,_e4b){
var _e4c=new ViewerIWidgetSave(this,_e4b);
if(_e4a&&_e4a.getJSONResponseObject()){
applyJSONProperties(this.getViewerObject(),_e4a.getJSONResponseObject());
}
this.doWidgetSaveDone(_e4c);
},isPreCaspianRP1BUXReport:function(){
var _e4d=this.getAttributeValue("version");
if(!_e4d||_e4d<this.BUX_REPORT_CASPIAN_RP1_VERSION){
return true;
}
return false;
},isGoDashboardReportUpgrade:function(){
var _e4e=this.getAttributeValue("version");
if(_e4e==this.GODASHBOARD_REPORT_VERSION){
return true;
}
return false;
},isOpeningSavedDashboard:function(){
var _e4f=this.getAttributeValue("viewerProperties");
if((_e4f&&_e4f.indexOf("{")===0)||this.isGoDashboardReportUpgrade()){
return true;
}
return false;
},cleanSavedAttributes:function(){
this.removeAttributeValue("savedOutputSearchPath");
this.removeAttributeValue("mostRecentSavedOutput");
this.removeAttributeValue("savedReportName");
this.removeAttributeValue("dashboardID");
this.removeAttributeValue("savedReportId");
this.removeAttributeValue("baseReportModificationTime");
this.removeAttributeValue("viewerReportPrompts");
this.removeAttributeValue("promptParametersRetrieved");
this.removeAttributeValue("selectionFilterEnabled");
this.removeAttributeValue("PinFreezeInfo");
this.removeAttributeValue("rapReportInfoVersion");
this.removeAttributeValue("rapReportInfo");
this.removeAttributeValue("selectionObjects");
if(this.isSavedOutput()){
this.removeAttributeValue("savedReportPath");
}
},handleWidgetSaveDone:function(_e50){
var oCV=this.getViewerObject();
var _e52=_e50.getResult();
if(_e52===null){
_e52={};
}
this.cleanSavedAttributes();
this.updateSavedAttributes("live");
var _e53=_e52.reportName;
var _e54=_e52.dashboard_id;
this.setAttributeValue("savedReportName",_e53);
this.setAttributeValue("dashboardID","$$dbid$$"+_e54);
if(_e52.permissions){
oCV.envParams["cv.objectPermissions"]=_e52.permissions;
}
if(_e52.objectClass){
oCV.envParams["ui.objectClass"]=_e52.objectClass;
}
if(this.getEnvParam("reportpart_id")&&this.getEnvParam("reportpart_id").length>0){
this.setAttributeValue("fromReportPart","true");
}
if(this.isLimitedInteractiveMode()){
this.setAttributeValue("limitedInteractiveMode","true");
}else{
this.setAttributeValue("baseReportModificationTime",oCV.envParams["baseReportModificationTime"]);
}
var _e55=oCV.envParams["contentLocale"];
if(_e55!=null){
this.saveSliderState();
this.setAttributeValue("lastLocaleSaved",_e55);
}
this.setAttributeValue("originalReportLocation",oCV.envParams["originalReportLocation"]);
oCV.envParams["ui.object"]=this.getSavedReportSearchPath(_e53);
oCV.envParams["savedReportName"]=_e53;
this.setAttributeValue("hasAVSChart",oCV.hasAVSChart()?"true":"false");
this.setAttributeValue("displayTypes",this.getDisplayTypes());
this.setSavedOutputsCMResponse(null);
var _e56={"status":true};
this.fireEvent("com.ibm.bux.widget.save.done",null,_e56);
},getDisplayTypes:function(){
var oCV=this.getViewerObject();
if(oCV.getRAPReportInfo()){
return oCV.getRAPReportInfo().getDisplayTypes();
}
},saveSliderState:function(){
var _e58=this.getViewerObject();
var _e59=_e58.getRAPReportInfo();
var _e5a={};
if(_e59){
_e5a=_e59.collectSliderSetFromReportInfo();
}
var i=0;
var _e5c=[];
for(var _e5d in this.sliderState){
if(typeof _e5a[_e5d]!="undefined"){
this.setItemValue("sliderState_"+_e5d,this.sliderState[_e5d]);
_e5c[i++]=_e5d;
}else{
this.removeItem("sliderState_"+_e5d);
}
}
this.setAttributeValue("sliderIDs",dojo.toJson(_e5c));
},onWidgetRefresh:function(evt){
var _e5f={};
var _e60=this.getViewerObject();
if(evt&&_e60){
if(_e60.envParams["ui.action"]=="view"||_e60.envParams["ui.action"]=="buxView"){
_e60.executeAction("RefreshViewEvent");
}else{
if(evt.payload&&evt.payload.refreshType=="preferencesChanged"){
this.clearRAPCache();
_e60.executeAction("EditContent",{"preferencesChanged":true});
_e60.executeAction("Reprompt",{"preferencesChanged":true});
}else{
if(!this.isVisible()){
this.getDelayedLoadingContext().setForceRunReport(true);
}else{
_e60.executeAction("Refresh");
}
}
}
this.fireEvent("com.ibm.bux.widget.refresh.done",null,_e5f);
}
},invokeDisplayTypeDialog:function(_e61,_e62){
if(!this.m_chart){
this.m_chart=new bux.reportViewer.chart();
}
var _e63=this.m_chart.getDisplayTypeDialogDefinition(_e61);
var _e64={"supportedChartTypes":_e63,"suggestedDisplayTypes":_e62};
this.fireEvent("com.ibm.bux.widget.invokeDisplayTypeDialog",null,_e64);
},onChangeDisplayType:function(evt){
var _e66=this.getViewerObject();
if(evt&&_e66){
_e66.executeAction("ChangeDisplayType",evt.payload);
}
},onDisplayTypeDialogVariations:function(evt){
var _e68=this.getViewerObject();
if(evt&&_e68){
_e68.executeAction("ChangeDisplayVariations",evt.payload);
}
},updateDisplayTypeDialogVariations:function(_e69,_e6a){
if(!this.m_chart){
this.m_chart=new bux.reportViewer.chart();
}
var _e6b=this.m_chart.getDisplayTypeDialogDefinition(_e69);
var _e6c={"supportedChartTypes":_e6b,"variationGroups":_e6a};
this.fireEvent("com.ibm.bux.widget.updateDisplayTypeDialogVariations",null,_e6c);
},onGetDisplayTitleDone:function(evt){
if(evt&&evt.payload&&evt.payload.callback){
evt.payload.callback(evt.payload.title);
}
},getWidgetStoreID:function(){
if(typeof this.widgetStoreId==="undefined"){
if(!this.widgetStoreIdDfd){
this.widgetStoreIdDfd=new dojo.Deferred();
}
return this.widgetStoreIdDfd;
}
return this.widgetStoreId;
},setWidgetStoreID:function(_e6e){
this.widgetStoreId=_e6e;
if(this.widgetStoreIdDfd){
this.widgetStoreIdDfd.callback(this.widgetStoreId);
this.widgetStoreIdDfd=null;
}
},onUpdateWidgetStoreIDDone:function(evt){
var _e70=evt.payload.storeID;
var _e71="storeID(\"";
if(_e70&&(_e70.indexOf(_e71)>-1)){
_e70=_e70.substr(_e71.length,_e70.length-_e71.length-1);
}
dojo.when(this.getWidgetStoreID(),dojo.hitch(this,function(_e72){
if(_e72&&_e72!=_e70){
this._copyComments(_e72,_e70);
}
}));
this.setWidgetStoreID(_e70);
},_copyComments:function(_e73,_e74){
var _e75=this.buildPostUrl();
if(_e75){
var _e76=new XmlHttpObject();
_e76.addFormField("b_action","cognosViewer");
_e76.addFormField("widgetOldStoreID",_e73);
_e76.addFormField("widgetStoreID",_e74);
_e76.addFormField("ui.action","cloneAnnotations");
_e76.addFormField("cv.responseFormat","json");
_e76.sendHtmlRequest("POST",_e75,"",true);
}
},onRemoveDone:function(evt){
this.destroy();
},onGetProperties:function(evt){
this.initializeProperties();
this.fireEvent("com.ibm.bux.widget.properties.get.done",null,this.properties.onGet());
},onSetProperties:function(evt){
if(evt&&evt.payload&&evt.payload.properties){
this.properties.onSet(evt.payload);
}
this.fireEvent("com.ibm.bux.widget.properties.set.done");
var _e7a={"modified":true};
this.fireEvent("com.ibm.bux.widget.modified",null,_e7a);
},getProperties:function(){
return this.properties;
},clearPropertiesDialog:function(){
if(this.properties){
this.properties.clearDialogSpec();
}
},onGenericSelectValueControl:function(evt,_e7c){
if(evt){
this.getLoadManager().runWhenHasViewer(dojo.hitch(this,function(){
var _e7d=false;
var _e7e=this._getFilterPayload(evt);
var _e7f=(this.m_oWidgetContextManager)?this.m_oWidgetContextManager.getSelectValueControlTypeFromPayload(_e7e):null;
if(_e7f&&_e7f!=="facet"){
var _e80=dojo.clone(evt);
this.preProcessFilterValues(_e80);
this.m_oWidgetContextManager.updateFilterContext(_e80.payload);
_e7d=this.onFilter(_e80,_e7c);
}else{
this.m_oWidgetContextManager.updateFilterContext(_e7e);
_e7d=this.onFilter(evt,_e7c);
}
return _e7d;
}),evt.source);
}
},onFilter:function(evt,_e82){
if(evt){
this.getLoadManager().runWhenHasViewer(dojo.hitch(this,function(){
var _e83=false;
if(this.isLiveReport()===false){
return _e83;
}
var _e84=this._getFilterPayload(evt);
var _e85=(this.m_oWidgetContextManager)?this.m_oWidgetContextManager.getSelectValueControlTypeFromPayload(_e84):null;
var _e86=null;
var _e87=this.m_oWidgetContextManager.getItemNames(_e84);
var _e88=false;
for(var i=0;!_e88&&i<_e87.length;i++){
_e86=_e87[i];
_e88=this.canFilter(_e84,_e86,_e85,evt);
}
if(_e86==null&&!_e88){
_e88=this.canFilter(_e84,_e86,_e85,evt);
}
if(_e88){
var _e8a={};
var _e8b=this._getDrillResetHUNForFacet(_e86,_e85);
if(_e8b&&_e8b.length>0){
_e8a.drillResetHUN=_e8b;
}
var _e8c=(evt.type=="string")?evt.payload:dojo.toJson(evt.payload);
this.sliderState[evt.source]=_e8c;
_e8a.filterPayload=_e8c;
_e8a.isFacet=("facet"===_e85);
if(_e82){
_e8a.forceCleanup=this.m_oWidgetContextManager.genRemoveDiscreteFilterPayload(this.getWidgetId());
}
this.getViewerObject().executeAction("UpdateDataFilter",_e8a);
if(!this.shouldReportBeRunOnAction()){
this.getLoadManager().getDelayedLoadingContext().setForceRunReport(true);
}
_e83=true;
}
return _e83;
}),evt.source);
}
},clearSelectionFilter:function(){
if(this.m_oWidgetContextManager){
var _e8d=this.m_oWidgetContextManager.genEmptySelectionPayload(this.getViewerObject(),this.getWidgetId());
this._fireContextChangedEvent(_e8d,false);
}
},broadcastSelectionFilter:function(){
this.onSelectionChange();
},onSelectionChange:function(){
if(this.isSelectionFilterEnabled()){
var _e8e=(this.getContainerTypeForSelection()==="list");
var _e8f=this.m_oWidgetContextManager.genSelectionPayload(this.getViewerObject(),this.getWidgetId(),_e8e);
this._fireContextChangedEvent(_e8f,!this.m_oWidgetContextManager.isSelectionPayloadForReset(_e8f));
}
},_fireContextChangedEvent:function(_e90,_e91){
this.setSelectionFilterSent(_e91);
this.fireEvent("com.ibm.widget.contextChanged",null,_e90);
},somethingSelected:function(){
var oCV=this.getViewerObject();
return (oCV&&oCV.getSelectionController()&&oCV.getSelectionController().getAllSelectedObjects().length>0);
},selectionFilterSent:function(){
return this.m_bSelectionFilterSent;
},setSelectionFilterSent:function(flag){
this.m_bSelectionFilterSent=flag;
},reselectSelectionFilterObjects:function(){
if(this.isSelectionFilterEnabled()){
var oCV=this.getViewerObject();
var _e95=oCV.getSelectionController();
var _e96=this.m_oWidgetContextManager.getSelectionFilterObjects();
if(!_e96){
var str=this.getAttributeValue("selectionObjects");
if(str&&str.length>0){
_e96=eval(str);
this.m_oWidgetContextManager.setSelectionFilterObjects(_e96);
this.removeAttributeValue("selectionObjects");
}
}
if(_e96&&_e96.length>0){
var _e98=new ReselectAction(oCV,_e96);
_e98.executeAction();
}
}
},_getFilterPayload:function(evt){
return (evt.type=="string"?dojo.fromJson(evt.payload):evt.payload);
},_getFilterPayloadItemName:function(_e9a){
var _e9b=_e9a.name;
if(!_e9a.name){
_e9b=this.m_oWidgetContextManager.getFilterFirstItemName();
}
return _e9b;
},canFilter:function(_e9c,_e9d,_e9e,evt){
var _ea0;
var _ea1=this.getRAPCachedItem("filterableItems");
if(_e9e!=="facet"&&typeof _e9d!="undefined"&&_e9d!=null&&_ea1!=null){
for(var type in _ea1){
for(_ea0=0;_ea0<_ea1[type].length;++_ea0){
if(_ea1[type][_ea0].name==_e9d||_ea1[type][_ea0].label==_e9d){
return true;
}
}
}
}else{
var _ea3=this.getViewerObject();
var _ea4=_ea3.getRAPReportInfo();
if(_ea4){
var _ea5=(this.m_oWidgetContextManager)?this.m_oWidgetContextManager.getSelectValuePropertyFromPayload(_e9c,"dimension"):null;
var _ea6=_ea4.getContainers();
for(var lid in _ea6){
var _ea8=_ea6[lid];
var _ea9=_ea8.sliders;
if(_ea9&&_ea9.length){
for(var _eaa=0;_eaa<_ea9.length;++_eaa){
var _eab=_ea9[_eaa];
if(_eab.clientId==_e9c.clientId||(_eab.clientId==evt.source)||(_eab.clientId==_eab.name&&_eab.name==_e9d)){
return true;
}
}
}
var _eac=_ea8.itemInfo;
if(_eac&&_eac.length){
for(var _ead=0;_ead<_eac.length;++_ead){
if(_eac[_ead].item==_e9d){
return true;
}
if(_e9e==="facet"&&_eac[_ead].dimensionName==_e9d){
return true;
}
if(_e9e==="facet"&&_eac[_ead].dimensionName===_ea5){
return true;
}
}
}
if(_e9e==="facet"){
var _eae=(this.m_oWidgetContextManager)?this.m_oWidgetContextManager.getSelectValuePropertyFromPayload(_e9c,"filterType"):null;
if(_e9e==="facet"&&_eae==="attribute"){
return true;
}
var _eaf=_ea8.filter;
if(_eaf&&_eaf.length){
for(var _eb0=0;_eb0<_eaf.length;++_eb0){
if(_eaf[_eb0].hierarchyName===_e9d){
return true;
}
}
}
}else{
if(_ea4.getFilterObjectFromContainer(lid,_e9d,false)){
return true;
}
}
}
if(_ea4.isReportLevel_nonVisibleFilterItem(_e9d)){
return true;
}
}
}
return false;
},_getDrillResetHUNForFacet:function(_eb1,_eb2){
if(_eb2!=="facet"){
return null;
}
var _eb3=null;
var _eb4=this.getViewerObject();
if(_eb4.getRAPReportInfo()){
_eb3=_eb4.getRAPReportInfo().getDrilledOnHUNs();
}
if(!_eb3){
return null;
}
var _eb5=[];
for(var i=0;i<_eb3.length;i++){
if(_eb3[i].indexOf(_eb1)!==-1){
_eb5.push(_eb3[i]);
break;
}
}
return _eb5;
},preProcessFilterValues:function(evt){
var _eb8=evt.payload["com.ibm.widget.context"]["values"];
_eb8=(_eb8)?_eb8:evt.payload["com.ibm.widget.context"]["ranges"];
var _eb9=this.m_oWidgetContextManager.getItemsInItemSpecification(evt.payload);
var _eba=(_eb8)?false:true;
if(_eba){
_eb8=evt.payload["com.ibm.widget.context"];
}
var _ebb=this.getViewerObject();
if(_ebb){
var _ebc=_ebb.getRAPReportInfo();
for(var _ebd in _eb8){
if(!_ebc.isReferenced(_ebd)||_eba){
delete _eb8[_ebd];
if(_eb9&&_eb9[_ebd]){
delete _eb9[_ebd];
}
}
}
}
if(isObjectEmpty(_eb8)){
evt.payload["com.ibm.widget.context"]={};
}
},isLimitedInteractiveMode:function(){
var _ebe=this.getViewerObject();
if(_ebe){
return _ebe.isLimitedInteractiveMode();
}
return false;
},onMouseOver:function(evt){
if(DragDropAction_isDragging(evt)==false&&this.getViewerObject().getStatus()=="complete"){
var _ec0=ActionFactory_loadActionHandler(evt,this.getViewerObject());
if(_ec0){
return _ec0.onMouseOver(evt);
}
}
return true;
},onMouseOut:function(evt){
var _ec2=ActionFactory_loadActionHandler(evt,this.getViewerObject());
if(_ec2&&this.getViewerObject().getStatus()=="complete"){
return _ec2.onMouseOut(evt);
}
return true;
},onMouseOverRenamedItem:function(evt){
var node=getNodeFromEvent(evt);
if(node.getAttribute){
var _ec5=node.getAttribute("rp_name");
if(_ec5!=null){
var _ec6=this.getViewerObject().getSelectionController().getTextValue(node.childNodes);
if(_ec5!=_ec6){
var id=node.getAttribute("id");
node.m_tooltip=new bux.reportViewer.ReportInfo({connectId:[id],position:["above","below"],title:RV_RES.IDS_JS_RENAMED_ITEM,text:RV_RES.IDS_JS_RENAMED_ITEM_ORIGINAL_LABEL+" "+node.getAttribute("rp_name")});
node.m_tooltip.open();
}
}
}
},onMouseOutRenamedItem:function(evt){
var node=getNodeFromEvent(evt);
node.m_tooltip=null;
},onDoubleClick:function(evt){
var _ecb=ActionFactory_loadActionHandler(evt,this.getViewerObject());
if(_ecb&&this.getViewerObject().getStatus()=="complete"){
return _ecb.onDoubleClick(evt);
}
return true;
},onMouseDown:function(evt){
var oCV=this.getViewerObject();
var _ece=oCV.getActionFactory();
this._selectionAction=_ece.load("Selection");
if(this.isMobile()){
var _ecf=oCV.getSelectionController();
var _ed0=_ecf.pageClickedForMobile(evt);
if(this.isSelectionFilterEnabled()){
this.onSelectionChange();
}else{
if(_ed0){
this.onContextMenu(evt);
}
}
}else{
if(oCV.envParams["ui.action"]=="view"){
this._selectionAction.onMouseDown(evt);
}else{
if(oCV.getStatus()=="complete"){
if((evt.button==1||evt.button==0)){
if(!this._selectionAction.onMouseDown(evt)&&!_ece.load("RenameDataItem").onMouseDown(evt)){
this.initDragAndDrop();
_ece.load("DragDrop").onMouseDown(evt);
}
}else{
this._selectionAction.onMouseDown(evt);
}
}
}
}
},onMouseUp:function(evt){
if(this.isMobile()){
return;
}
var _ed2=getCrossBrowserNode(evt);
try{
var _ed3=_ed2.nodeName.toLowerCase();
if(_ed3=="input"||_ed3=="textarea"){
evt.cancelBubble=true;
return false;
}
}
catch(ex){
}
var _ed4=false;
if(this.getViewerObject().envParams["ui.action"]=="view"){
setNodeFocus(evt);
}else{
if(this.getViewerObject().getStatus()=="complete"){
_ed4|=DragDropAction_isDragging(evt);
DragDropAction_onmouseup(evt);
this.removeDragAndDrop();
setNodeFocus(evt);
}
}
if(!this._selectionAction){
var oCV=this.getViewerObject();
var _ed6=oCV.getActionFactory();
this._selectionAction=_ed6.load("Selection");
}
this._selectionAction.onMouseUp(evt,_ed4);
clearTextSelection();
},getContainerTypeForSelection:function(){
var _ed7=this.getViewerObject();
if(_ed7){
var _ed8=_ed7.getSelectionController();
return _ed8.getDataContainerType();
}
return null;
},onContextMenu:function(evt){
var _eda=this.getViewerObject();
if(_eda.getStatus()=="complete"||this.isSavedOutput()){
var _edb=_eda.getContextMenu();
var _edc=CCognosViewerToolbarHelper.updateContextMenuForCurrentSelection(_eda,_edb);
if(this.isMobile()){
var _edd=_eda.getSelectionController();
var _ede=_edd.getContainerType();
var _edf=_ede==="chart"?_edd.getChartTooltip():null;
if(this.getAnnotationStore()&&this.getAnnotationStore().hasAnnotation()){
var _ee0=this._genMobileCommentMenuItem(_edd);
if(_ee0){
_edc.push(_ee0);
}
var _ee1=this._genMobileCommentMenuItem();
if(_ee1){
var _ee2=_eda.findBlueDotMenu(_edc);
if(_ee2){
_ee2.push(_ee1);
}
}
}
var _ee3={"context":{"event":evt,"viewerContext":{"displayValues":_edd.getDisplayValues(),"chartTooltip":_edf,"containerType":_ede}},"menuItems":_edc};
if(typeof console!="undefined"&&console&&console.log){
console.log(_ee3);
}
this.fireEvent("com.ibm.bux.widget.contextMenu.update",null,_ee3);
}else{
this.fireEvent("com.ibm.bux.widget.contextMenu.update",null,_edc);
}
}
},_genMobileCommentMenuItem:function(_ee4){
var ctx=null;
if(_ee4){
if(_ee4.getSelections().length==1){
ctx=_ee4.getSelections()[0].getCtxAttributeString();
}
if(!ctx){
return null;
}
}
var _ee6=this.getAnnotationStore().getAsJSON(ctx);
if(_ee6.length>0){
return {"name":RV_RES.IDS_JS_ANNOTATIONS,"label":RV_RES.IDS_JS_ANNOTATIONS,"flatten":false,"comments":_ee6};
}
return null;
},initDragAndDrop:function(){
if(window.attachEvent){
document.attachEvent("onmouseup",DragDropAction_onmouseup);
document.attachEvent("onmousemove",DragDropAction_onmousemove);
}else{
if(document.addEventListener){
document.addEventListener("mouseup",DragDropAction_onmouseup,false);
document.addEventListener("mousemove",DragDropAction_onmousemove,false);
}
}
},removeDragAndDrop:function(){
if(window.detachEvent){
document.detachEvent("onmouseup",DragDropAction_onmouseup);
document.detachEvent("onmousemove",DragDropAction_onmousemove);
}else{
if(document.removeEventListener){
document.removeEventListener("mouseup",DragDropAction_onmouseup,false);
document.removeEventListener("mousemove",DragDropAction_onmousemove,false);
}
}
},onWidgetResize:function(evt){
var _ee8=evt.payload.resize;
if(_ee8){
if(!this.m_visible||(this.widgetSize&&this.widgetSize.h===_ee8.h&&this.widgetSize.w===_ee8.w)){
return;
}
var _ee9=!this.widgetSize;
this.widgetSize={h:_ee8.h,w:_ee8.w};
if(_ee9){
return;
}
if(!_ee8.autoResize){
this.executeAction(evt,"ResizeChart");
}
var oCV=this.getViewerObject();
if(oCV&&oCV.getPinFreezeManager()){
if(_ee8.autoResize){
oCV.getPinFreezeManager().processAutoResize(_ee8.w,_ee8.h);
}
setTimeout(function(){
oCV.getPinFreezeManager().refresh();
},100);
}
if(oCV.getTabController()){
oCV.getTabController().onResize(evt);
}
}
},getWidgetSize:function(){
return this.widgetSize;
},refreshAnnotationData:function(){
return this.getAnnotationHelper().refreshAnnotationData();
},fetchAnnotationData:function(){
this.getAnnotationHelper().fetchAnnotationData();
},reportContainsDijits:function(){
var _eeb=this.getAnnotationStore();
var _eec=_eeb.getAll();
for(var key in _eec){
if(typeof _eec[key]!=="function"){
return true;
}
}
return false;
},isSaveNecessary:function(){
var _eee=false;
if(this.isSavedOutput()){
var _eef=this.getAttributeValue("mostRecentSavedOutput");
var _ef0=_eef==="true"||_eef===true;
var _ef1=this.getAttributeValue("savedOutputSearchPath");
_eee=!_ef0&&_ef1==null;
}else{
var _ef2=this.getAttributeValue("originalReport");
var _ef3=this.getAttributeValue("savedReportName")||this.getAttributeValue("savedReportPath");
if(!this.isSavedReport(_ef2,_ef3)){
_eee=true;
}
}
return _eee;
},addAsNewComment:function(_ef4,text){
this.getAnnotationHelper().addAsNewComment(_ef4,text);
},onWidgetActionDone:function(_ef6){
if(_ef6&&_ef6.payload&&_ef6.payload.status===true){
this.getAnnotationHelper().addNewComment(this._pendingContextId,this._pendingCellValue);
}
this._pendingContextId=null;
this._pendingCellValue=null;
},commitComment:function(_ef7){
if(!_ef7.isNew){
return null;
}
if(!_ef7.isLoaded){
return this.getAnnotationHelper().commitComment(_ef7);
}
return null;
},getAnnotationStore:function(){
if(!this.annotationStore){
dojo["require"]("bux.data.AnnotationStore");
this.annotationStore=new bux.data.AnnotationStore(this,this.commitComment,this);
}
return this.annotationStore;
},fireEvent:function(_ef8,arg,_efa){
if(window.gViewerLogger){
var id=this.getViewerObject()?this.getViewerObject().getId()+" ":"";
window.gViewerLogger.log(id+_ef8,_efa,"json");
}
this.iContext.iEvents.fireEvent(_ef8,arg,_efa);
},onGetFilterableItems:function(evt){
this.getLoadManager().runWhenHasViewer(dojo.hitch(this,function(){
var _efd=false;
var _efe=this.getRAPCachedItem("filterableItems");
if(_efe==null&&this.isLiveReport()&&(this.getViewerObject().getStatus()=="complete"||this.isFaultStatusWithSpec())){
this.executeAction(evt,"GetFilterableItems");
_efd=true;
}else{
if(!_efe){
_efe={visible:[],hidden:[]};
}
if(this.isLiveReport()){
this.fireEvent("com.ibm.bux.filter.items.get.done",null,_efe);
}else{
this.savedOutputResponseHandler("com.ibm.bux.filter.items.get.done",_efe);
}
}
return _efd;
}));
},isFaultStatusWithSpec:function(){
var oVO=this.getViewerObject();
if(oVO.getStatus()==="fault"){
if(oVO.envParams["ui.spec"]){
return true;
}
}
return false;
},onGetFilterValues:function(oEvt){
this.getLoadManager().runWhenHasViewer(dojo.hitch(this,function(){
var _f01=oEvt.payload;
if(typeof oEvt.source!="undefined"&&typeof _f01!="undefined"){
if(typeof _f01.payload!="undefined"){
_f01=_f01.payload;
}
if(typeof _f01.source=="undefined"){
_f01.source=oEvt.source;
}
}
var _f02=false;
var _f03=this.isLiveReport();
var _f04=this.getViewerObject().getStatus();
var _f05=this.isFaultStatusWithSpec();
if(_f03&&(_f04==="complete"||_f05)){
var _f06=null;
if(!_f01.forceRefresh&&_f01.name){
_f06=this.getRAPCachedItem("filterValues."+_f01.name);
}
if(_f06){
this.fireEvent("com.ibm.bux.filter.values.get.done",null,_f06);
}else{
this.executeAction(oEvt,"GetFilterValues");
_f02=true;
}
}else{
if(this.getViewerObject().isWorking(_f04)){
var self=this;
var _f08=function(){
self.onGetFilterValues(oEvt);
};
setTimeout(_f08,10);
}else{
var _f09={};
if(_f01.name){
_f09.name=_f01.name;
}
this.fireEvent("com.ibm.bux.filter.values.get.done",null,_f09);
}
}
return _f02;
}));
},onGetFilterValuesCancel:function(evt){
if(evt&&evt.payload){
var oCV=this.getViewerObject();
var _f0c=oCV.getAction("GetFilterValues");
_f0c.setRequestParms(evt);
var _f0d=_f0c.getActionKey();
if(_f0d){
oCV.getViewerDispatcher().cancelRequest(_f0d);
}
}
},savedOutputResponseHandler:function(_f0e,_f0f){
var oCV=this.getViewerObject();
var _f11=dojo.toJson(_f0f);
var _f12="window[\"oCV"+oCV.getId()+"\"].getViewerWidget().fireEvent(\""+_f0e+"\", null, "+_f11+");";
if(oCV){
var _f13=window["oCV"+oCV.getId()];
if(typeof _f13=="object"){
setTimeout(_f12,1);
}
}
return _f12;
},handleGetFilterableItemsResponse:function(_f14){
var _f15={};
var json=this.getJsonFromResponse(_f14);
if(json){
_f15=json.filterableItems;
if(!_f15){
_f15={"visible":[],"invisible":[]};
}
this.addToRAPCache("filterableItems",_f15);
}
this.fireEvent("com.ibm.bux.filter.items.get.done",null,_f15);
},handleGetFilterValuesResponse:function(_f17,_f18){
var _f19={};
var json=this.getJsonFromResponse(_f17);
if(json&&json.filterValues){
_f19=json.filterValues;
if(_f19&&_f19.name){
this.addToRAPCache("filterValues."+_f19.name,_f19);
}
}
if(_f18&&_f18.name&&!_f19.name){
_f19.name=_f18.name;
}
_f19=dojo.clone(_f19);
this.fireEvent("com.ibm.bux.filter.values.get.done",null,_f19);
},getJsonFromResponse:function(_f1b){
var json=null;
if(_f1b&&_f1b.m_jsonResponse&&_f1b.m_jsonResponse.json){
json=dojo.eval("("+_f1b.m_jsonResponse.json+")");
}else{
if(_f1b&&_f1b.responseText){
json=dojo.eval("["+_f1b.responseText+"]");
if(json&&json[0]){
json=json[0];
}
}
}
return json;
},onContextChanged:function(evt){
if(evt){
this.getLoadManager().runWhenHasViewer(dojo.hitch(this,function(){
var _f1e=false;
var _f1f=dojo.clone(evt);
var _f20=this._getFilterPayload(_f1f);
this.m_oWidgetContextManager.convertSelectionToSelectValueControlPayload(_f20);
this.m_oWidgetContextManager.convertGenericToSelectValueControlPayload(_f20);
var _f21=this.getViewerObject();
var _f22=_f21.getRAPReportInfo();
if(_f22&&(_f22.containsFilters()||_f22.hasSlider())){
var _f23=_f20["com.ibm.widget.context"].values;
var _f24=this.m_oWidgetContextManager.getItemsInItemSpecification(_f20);
var _f25=dojo.clone(_f24);
for(var _f26 in _f25){
if(!_f22.isReferenced(_f26)&&_f24[_f26].values){
var mun=_f24[_f26].values[0].mun;
var _f28=_f22.hunHasFilterOrSlider(mun);
if(_f28&&!_f24[_f28]){
_f24[_f28]=_f24[_f26];
delete _f24[_f26];
_f23[_f28]=_f23[_f26];
delete _f23[_f26];
}
}
}
}
_f1f.payload=_f20;
_f1e=this.onGenericSelectValueControl(_f1f,true);
return _f1e;
}),evt.source);
}
},broadcastParameterChange:function(_f29){
var _f2a={"clientId":this.getWidgetId(),"com.ibm.widget.context":_f29};
this.fireEvent("com.ibm.widget.contextChanged.prompt",null,_f2a);
},broadcastContextChange:function(_f2b){
if(this.isSelectionFilterEnabled()){
var _f2c={"clientId":this.getWidgetId(),"com.ibm.widget.context":_f2b,"com.ibm.widget.context.bux.selection":{"selection":{"id":this.getWidgetId(),"valueType":"string"}}};
this.m_oWidgetContextManager.updateFilterContext(_f2c);
this.m_oWidgetContextManager.setSelectionFilterObjects(null);
this._fireContextChangedEvent(_f2c,true);
}
},onGenericDrill:function(evt){
this.m_handleDrill=false;
this.getLoadManager().runWhenHasViewer(dojo.hitch(this,function(){
var _f2e=false;
if(!(evt&&evt.payload)||this.isLimitedInteractiveMode()){
return _f2e;
}
if(evt.payload.cv_id===this.iContext.widgetId){
return _f2e;
}
var _f2f=this.m_oWidgetContextManager.getDrillActionType(evt.payload);
var _f30=this.m_oWidgetContextManager.genDrillSpecObjects(evt.payload);
var _f31=null;
if(_f2f==="DrillDown"){
_f31=this.getViewerObject().getAction("DrillDown");
}else{
if(_f2f==="DrillUp"){
_f31=this.getViewerObject().getAction("DrillUp");
}else{
return _f2e;
}
}
_f31.setKeepFocusOnWidget(false);
if(this.getViewerObject().isMetadataEmpty()||!this.shouldReportBeRunOnAction()){
_f31.setUseReportInfoSelection(true);
}
if(_f31.parseDrillSpecObjects(_f30)){
if(!this.shouldReportBeRunOnAction()){
this.getLoadManager().getDelayedLoadingContext().setForceRunReport(true);
}
_f31.execute();
_f2e=true;
}
this.m_handleDrill=true;
return _f2e;
}));
},setDoGetParametersOnLoad:function(_f32){
this.m_doGetParametersOnLoad=_f32;
},getDoGetParametersOnLoad:function(){
return this.m_doGetParametersOnLoad;
},onPromptLegacyPayload:function(evt){
try{
if(evt.payload.cv_id===this.iContext.widgetId){
return false;
}
var _f34=null;
this.getLoadManager().runWhenHasViewer(dojo.hitch(this,function(_f35){
_f34=false;
if(this.isSavedOutput()){
return _f34;
}
if(this.promptParametersRetrieved===false){
var _f36=this.getViewerObject().getAction("GetParameters");
_f36.setRequestParms(evt.payload);
_f36.execute();
_f34=true;
}else{
_f34=this.sharePrompts(evt.payload);
}
return _f34;
}));
return _f34;
}
catch(e){
return false;
}
},sharePrompts:function(_f37){
var _f38=this.getViewerObject().getAction("SharePrompt");
_f38.setRequestParms(_f37);
if(this.shouldReportBeRunOnAction()){
var _f39=this.getViewerObject().getDrillResetHUNs(_f37);
if(!_f39||_f39.length===0){
return _f38.executePrompt();
}else{
var _f3a={"drilledResetHUNs":_f39,"promptValues":_f38.getPromptValues()};
this.getViewerObject().executeAction("DrillReset",_f3a);
}
return true;
}
var _f3b=this.getLoadManager().getDelayedLoadingContext();
_f3b.setPromptValues(_f38.getPromptValues());
_f3b.setCascadingPromptParamsToClear(_f37.clearCascadePromptParams);
return false;
},onGenericPrompt:function(evt){
this.clearRAPCacheFilterValues();
this.m_oWidgetContextManager.handleIncomingPromptEvent(evt);
},setPromptParametersRetrieved:function(_f3d){
this.promptParametersRetrieved=_f3d;
},getEnvParam:function(_f3e){
return this.getViewerObject().envParams[_f3e];
},destroy:function(){
var _f3f=this.getViewerObject();
if(_f3f){
if(this.isSelectionFilterEnabled()){
if(this.selectionFilterSent()){
this.clearSelectionFilter();
}
}
if(this.onUnloadInProgress){
_f3f.destroy(false);
}else{
_f3f.destroy(true);
}
var _f40=function(_f41){
if(_f41&&_f41.parentNode&&_f41.parentNode.removeChild){
_f41.parentNode.removeChild(_f41);
}
};
var _f42=dojo.query("[namespaceId='"+this.getViewerId()+"'],[namespaceId='"+this.m_sScriptLoaderNamespace+"']",document.getElementsByTagName("head").item(0));
if(_f42&&_f42.length>0){
_f42.forEach(_f40);
}
_f42=dojo.query("> [namespaceId=\""+this.getViewerId()+"\"]",document.getElementsByTagName("body").item(0));
if(typeof _f42!="undefined"&&_f42&&_f42.length>0){
_f42.forEach(_f40);
}
if(this.getAnnotationHelper()){
this.getAnnotationHelper()._cleanupPreviousAnnotations();
}
}
if(this.annotationHelper){
this.annotationHelper.m_viewerIWidget=null;
}
this.annotationHelper=null;
if(this.savedOutput){
this.savedOutput.iWidget=null;
}
this.savedOutput=null;
if(this.m_oLoadManager){
this.m_oLoadManager.m_oWidget=null;
}
this.m_oLoadManager=null;
if(this.m_oWidgetContextManager){
this.m_oWidgetContextManager.m_widget=null;
}
this.m_oWidgetContextManager=null;
this.removeWindowEventListeners();
if(this.undoRedoQueue){
GUtil.destroyProperties(this.undoRedoQueue);
delete this.undoRedoQueue;
}
GUtil.destroyProperties(this.getAnnotationStore());
delete this.getAnnotationStore();
GUtil.destroyProperties(this.savedOutput);
delete this.savedOutput;
delete this.m_oCV;
_f3f=null;
},setSavedOutputsCMResponse:function(_f43){
this.savedOutputsCMResponse=_f43;
if(_f43==null){
var _f44=this.getViewerObject().getActionFactory();
var _f45=_f44.load("Snapshots");
_f45.resetMenu();
}
},getSavedOutputsCMResponse:function(){
if(typeof this.savedOutputsCMResponse=="undefined"||this.savedOutputsCMResponse==null){
return null;
}
return this.savedOutputsCMResponse;
},setSavedOutputSearchPath:function(_f46){
this.m_savedOutputSearchPath=_f46;
},getSavedOutputSearchPath:function(){
if(typeof this.m_savedOutputSearchPath=="undefined"){
return null;
}
return this.m_savedOutputSearchPath;
},initializeProperties:function(){
if(this.properties){
var _f47=this.getViewerObject();
this.properties.initialize(_f47.envParams);
}
},addToRAPCache:function(name,_f49){
if(!this.m_RAPCache){
this.m_RAPCache={};
}
this.m_RAPCache[name]=_f49;
},getRAPCachedItem:function(name){
if(this.m_RAPCache&&typeof this.m_RAPCache[name]!="undefined"){
return this.m_RAPCache[name];
}
return null;
},clearRAPCacheFilterValues:function(){
for(var key in this.m_RAPCache){
if(key.indexOf("filterValues.")===0){
delete this.m_RAPCache[key];
}
}
},clearRAPCache:function(){
this.m_RAPCache=null;
},reset:function(){
this.m_bCallGetAnnotations=true;
this.promptParametersRetrieved=false;
this.getViewerObject().envParams["reportPrompts"]="";
this.setSavedOutputsCMResponse(null);
this.getUndoRedoQueue().clearQueue();
if(this.isSelectionFilterEnabled){
this.clearSelectionFilter();
}
this.m_bSelectionFilterSwitch=false;
},handleFault:function(){
if(typeof console!="undefined"&&console&&console.log){
console.log("ViewrIWidget:handle fault is deprecated and should not be used anymore.");
}
var _f4c=this.getViewerObject();
var _f4d=new RequestHandler(_f4c);
_f4d.onFault();
},disableListenToForGlobalPrompt:function(){
this.fireEvent("com.ibm.bux.widget.updateEventFilter",null,{"*":{blockedEvents:["com.ibm.widget.contextChanged.prompt"]}});
var _f4e=this.getViewerObject();
if(window.gaRV_INSTANCES){
var _f4f={};
_f4f[this.iContext.widgetId]={blockedEvents:["com.ibm.widget.contextChanged.prompt"]};
for(var _f50=0;_f50<window.gaRV_INSTANCES.length;_f50++){
if(window.gaRV_INSTANCES[_f50].getId()!=_f4e.getId()){
var _f51=window.gaRV_INSTANCES[_f50].getViewerWidget();
if(_f51){
_f51.iContext.iEvents.fireEvent("com.ibm.bux.widget.updateEventFilter",null,_f4f);
}
}
}
}
},disableListenToForEvent:function(_f52){
this.fireEvent("com.ibm.bux.widget.updateEventFilter",null,{"*":{blockedEvents:_f52}});
var _f53=this.getViewerObject();
if(window.gaRV_INSTANCES){
var _f54={};
_f54[this.iContext.widgetId]={blockedEvents:_f52};
for(var _f55=0;_f55<window.gaRV_INSTANCES.length;_f55++){
if(window.gaRV_INSTANCES[_f55].getId()!=_f53.getId()){
var _f56=window.gaRV_INSTANCES[_f55].getViewerWidget();
if(_f56){
_f56.iContext.iEvents.fireEvent("com.ibm.bux.widget.updateEventFilter",null,_f54);
}
}
}
}
},handlePassportErrorFromDispatcher:function(){
if(this.viewerWidgetLastAction){
var _f57=GUtil.generateCallback(this[this.viewerWidgetLastAction.functionName],this.viewerWidgetLastAction.param,this);
dojo["require"]("bux.dialogs.IFrameDialog");
var _f58=new bux.dialogs.LogonDialog({okHandler:_f57,cancelHandler:dojo.hitch(this,function(){
this.fireEvent("com.ibm.bux.widget.action",null,{action:"deleteWidget"});
})});
_f58.startup();
_f58.show();
}
},showErrorMessage:function(_f59){
var _f5a=this.getViewerObject();
if(_f5a){
this.m_widgetErrorDlg=new FaultMessageDialog(_f5a,_f59);
this.m_widgetErrorDlg.renderInlineDialog();
}
},getErrorDlg:function(){
if(this.m_widgetErrorDlg){
return this.m_widgetErrorDlg;
}
return null;
},setErrorDlg:function(dlg){
this.m_widgetErrorDlg=dlg;
},clearErrorDlg:function(dlg){
if(this.getErrorDlg()!==null){
this.m_widgetErrorDlg.ok();
}
},onOpen:function(evt){
if(evt&&evt.payload&&evt.payload.author){
this.m_sDashboardOwnerId=evt.payload.author.cm$searchPath;
}
},onNotifyPreviousEventsAreDone:function(evt){
this.m_resizeReady=true;
},isDashboardOwner:function(){
if(typeof this.m_sDashboardOwnerId!=="undefined"&&typeof this.m_sUserId!=="undefined"){
return this.m_sDashboardOwnerId===this.m_sUserId;
}
},isCurrentUser:function(user){
return this.m_sUserId===user;
},findContainerDiv:function(){
var _f60=dojo.byId("RVContent"+this.getViewerObject().getId());
var _f61=_f60;
while(_f61){
if(_f61.style&&_f61.style.height&&_f61.style.height.indexOf("px")!=-1){
return _f61;
}
_f61=_f61.parentNode;
}
if(typeof console!="undefined"&&console&&console.log){
console.log("ViewrIWidget: Could not find the container div.");
}
return _f60;
},getPaneOnRight:function(){
return this.getAttributeValue("paneOnRight");
},getWidgetContextManager:function(){
return this.m_oWidgetContextManager;
},getInfoBarRenderedState:function(){
return this.m_oInfoBarRenderedState;
},refreshInfoBarRenderedState:function(_f62){
var len=_f62.length;
var _f64={};
for(var idx=0;idx<len;idx++){
var sId=_f62[idx];
if(this.m_oInfoBarRenderedState[sId]){
_f64[sId]=this.m_oInfoBarRenderedState[sId];
}
}
this.m_oInfoBarRenderedState=_f64;
},onGetWidgetContext:function(_f67){
var _f68=this.getWidgetContextManager().getWidgetContextObject();
if(!_f68){
_f68={};
}
this.fireEvent("com.ibm.widget.context.get.done",null,_f68);
},onGetCanvasContextDone:function(evt){
},onSetVisible:function(evt){
if(this.m_debugDelayedViewerLoadingMode===2){
return;
}
if(evt&&evt.payload){
this.m_visible=evt.payload.isVisible?true:false;
if(!this.m_visible){
if(this._cssLimitReached){
this.cleanupStyles();
}
return;
}
if(!this.getLoadManager().isViewerLoadInitiated()){
this.postReport(null);
}else{
this._updateOnVisible();
}
}
},_updateOnVisible:function(){
var _f6b=this.getLoadManager();
if(_f6b.isViewerReady()){
var oCV=this.getViewerObject();
if(this._cssLimitReached){
this.reloadStyles();
}
if(this.isSavedOutput()){
_f6b.getDelayedLoadingContext().setForceRunReport(false);
return;
}
if(!_f6b.getDelayedLoadingContext().isEmpty()){
_f6b.runWhenHasViewer(function(){
_f6b.runningReport();
var _f6d=oCV.getActionFactory();
var _f6e=_f6d.load("BuxRunReport");
var _f6f=_f6b.getDelayedLoadingContext();
var _f70={promptValues:_f6f.getPromptValues(),clearCascadeParamsList:_f6f.getCascadingPromptParamsToClear()};
_f6e.setRequestParams(_f70);
if(!oCV.getConversation()){
_f6e.setSendParameterValues(true);
}
var _f71=_f6e.execute();
_f6b.getDelayedLoadingContext().reset();
return _f71;
});
}else{
if(oCV.getPinFreezeManager()){
oCV.getPinFreezeManager().onSetVisible();
}
}
}else{
_f6b.setOnEmptyCallback(dojo.hitch(this,function(){
if(this.isVisible()){
this._updateOnVisible();
}
}));
}
},shouldReportBeRunOnAction:function(){
return (this.isVisible()&&this.getLoadManager().isViewerLoaded()&&this.getLoadManager().canRunReports());
},isVisible:function(){
if(this.m_debugDelayedViewerLoadingMode===2){
return true;
}
if(this.m_visible===null){
var _f72=this.iContext.getItemSet("buxdelayedload",false);
if(_f72){
this.m_visible=(_f72.getItemValue("widgetVisible")==="true");
}else{
this.m_visible=true;
}
}
return this.m_visible;
},isPastedWidget:function(){
return this._pastedWidget;
},setWidgetCopyPasteParameters:function(){
this.copyPasteResource=this.getAttributeValue("resource");
if(this.copyPasteResource){
this._pastedWidget=true;
if(this.getAttributeValue("copy.ciPublishedReportPath")&&this.getAttributeValue("originalReport")==null&&this.getSavedItem()==null){
this.ciPublishedReportPath=this.getAttributeValue("copy.ciPublishedReportPath");
}else{
if(this.getAttributeValue("originalReport")==null){
this.ciPublishedReportPath=this.getSavedItem();
this.setAttributeValue("copy.ciPublishedReportPath",this.ciPublishedReportPath);
}
}
this.removeAttributeValue("savedReportPath");
this.removeAttributeValue("savedReportPath.resource");
this.removeAttributeValue("resource");
}
},postSetWidgetCopyPasteParameters:function(){
if(this.copyPasteResource){
this.removeAttributeValue("copy.conversation");
this.copyPasteResource=null;
}
},isSelectionFilterEnabled:function(){
return this.m_bSelectionFilterSwitch;
},toggleSelectionFilterSwitch:function(){
this.m_bSelectionFilterSwitch=!this.isSelectionFilterEnabled();
var _f73=this.getViewerObject().getSelectionController();
if(_f73){
if(this.isSelectionFilterEnabled()){
_f73.setSelectionStyles(_f73.FILTER_SELECTION_STYLE);
_f73.repaintSelections();
}else{
_f73.resetAll();
}
}
},preprocessPageClicked:function(_f74,evt){
if(!this.isSelectionFilterEnabled()){
return;
}
var _f76=this.getViewerObject().getSelectionController();
_f76.setAllowHorizontalDataValueSelection(true);
if(_f74){
if(!_f76.hasSavedSelections()){
_f76.saveSelections();
}
_f76.setSelectionStyles(_f76.FILTER_SELECTION_CONTEXT_MENU_STYLE);
}else{
_f76.setSelectionStyles(_f76.FILTER_SELECTION_STYLE);
_f76.clearSavedSelections();
}
},ignoreEvent:function(evt){
stopEventBubble(evt);
},updateDrillThroughLinks:function(){
var oCV=this.getViewerObject();
if(!oCV){
return;
}
var _f79=this.isSelectionFilterEnabled();
var _f7a=oCV.envParams["ui.action"]=="view"||oCV.envParams["ui.action"]=="buxView";
var _f7b=_f79?"":"_temp";
var _f7c=_f79?"_temp":"";
var _f7d=["onclick","onkeypress","style"];
var _f7e=_f7a?"onclick"+_f7b:"dttargets";
var _f7f=document.getElementById("RVContent"+oCV.getId());
var _f80=getElementsByAttribute(_f7f,"*",_f7e);
if(!_f80){
return;
}
for(var i=0;i<_f80.length;i++){
var node=_f80[i];
if(node.nodeName.toLowerCase()!=="area"){
if(_f7a){
var _f83=node.getAttribute("onclick"+_f7b);
if(!_f83||(_f83.indexOf("doSingleDrillThrough")==-1&&_f83.indexOf("doMultipleDrillThrough"))){
continue;
}
for(var ii=0;ii<_f7d.length;ii++){
var _f85=_f7d[ii];
if(node.getAttribute(_f85+_f7b)){
this._renameAttribute(node,_f85+_f7b,_f85+_f7c);
}
}
}
this._updateCellStyle(node,_f79);
}
}
},_updateCellStyle:function(node,_f87){
if(node.nodeType==3){
return;
}
if(_f87&&node.className==="hy"){
this._renameAttribute(node,"class","class_temp");
}else{
if(!_f87&&node.getAttribute("class_temp")){
this._renameAttribute(node,"class_temp","class");
}
}
if(node.childNodes){
for(i=0;i<node.childNodes.length;i++){
this._updateCellStyle(node.childNodes[i],_f87);
}
}
},_renameAttribute:function(node,_f89,_f8a){
node.setAttribute(_f8a,node.getAttribute(_f89));
node.removeAttribute(_f89);
},addButtonToSavedToolbarButtons:function(name,_f8c,_f8d){
if(typeof name!="undefined"&&name!=null){
this.savedToolbarButtons[name]={};
this.savedToolbarButtons[name]["button"]=_f8c;
this.savedToolbarButtons[name]["position"]=_f8d;
}
},getButtonFromSavedToolbarButtons:function(name){
return this.savedToolbarButtons[name];
},removeFromSavedToolbarButtons:function(name){
if(typeof this.savedToolbarButtons[name]!="undefined"&&this.savedToolbarButtons[name]!=null){
delete this.savedToolbarButtons[name];
}
}});
function UndoRedoQueue(_f90){
this.m_queue=[];
this.m_queueLimit=20;
this.m_iCurrentPos=0;
this.m_widget=_f90;
this.m_bUndoRedoCalled=false;
this.m_lastAction=null;
this.currentUndoObj=null;
this.beenUsed=false;
this.m_originalSpec=null;
};
UndoRedoQueue.prototype.setOriginalSpec=function(spec){
if(this.m_queue.length==0){
this.m_originalSpec=spec;
}
};
UndoRedoQueue.prototype.clearQueue=function(){
while(this.m_queue.length>0){
this.m_queue.pop();
}
this.m_iCurrentPos=0;
};
UndoRedoQueue.prototype.getPosition=function(){
return this.m_iCurrentPos;
};
UndoRedoQueue.prototype.hasBeenUsed=function(){
return this.beenUsed;
};
UndoRedoQueue.prototype.getLength=function(){
return this.m_queue.length;
};
UndoRedoQueue.prototype.initUndoObj=function(obj){
if(this.m_queue.length==0){
var oCV=this.m_widget.getViewerObject();
var spec=this.m_originalSpec==null?oCV.envParams["ui.spec"]:this.m_originalSpec;
this.m_originalSpec=null;
this.m_queue.push({"spec":spec,"parameters":oCV.getExecutionParameters(),"tooltip":obj.tooltip,"infoBar":oCV.envParams["rapReportInfo"],"widgetProperties":this.m_widget.getProperties().getOldProperties(),"hasAVSChart":oCV.hasAVSChart(),"undoType":"server"});
this.m_iCurrentPos=this.m_queue.length-1;
this.beenUsed=true;
}
this.currentUndoObj=obj;
};
UndoRedoQueue.prototype.add=function(obj){
if(this.m_bUndoRedoCalled){
this.m_bUndoRedoCalled=false;
return;
}else{
if(this.currentUndoObj==null){
return;
}else{
if(obj.reportUpdated==true){
while(this.m_queue.length>this.m_queueLimit){
this.m_queue.shift();
}
this.clearEnd();
var _f96=this.m_widget.getViewerObject();
if(this.currentUndoObj.saveSpec==true||_f96.envParams["ui.doNotUseConversationForUndo"]==="true"){
this.currentUndoObj.spec=_f96.envParams["ui.spec"];
this.currentUndoObj.parameters=_f96.getExecutionParameters();
}else{
this.currentUndoObj.conversation=_f96.getConversation();
}
if(_f96.envParams["rapReportInfo"]){
this.currentUndoObj.infoBar=_f96.envParams["rapReportInfo"];
}
this.currentUndoObj.widgetProperties=this.m_widget.getProperties().getUndoInfo();
this.currentUndoObj.palette=_f96.m_sPalette;
if(this.m_widget.getProperties().getFlashCharts()){
this.currentUndoObj.hasAVSChart=_f96.hasAVSChart();
}
this.currentUndoObj.undoType="server";
this.finalizeAdd();
}
}
}
};
UndoRedoQueue.prototype.addClientSideUndo=function(obj){
if(this.m_bUndoRedoCalled){
this.m_bUndoRedoCalled=false;
return;
}
if(obj.undoCallback&&obj.redoCallback){
this.initUndoObj(obj);
this.currentUndoObj.undoType="client";
this.finalizeAdd();
}
};
UndoRedoQueue.prototype.finalizeAdd=function(){
this.m_queue.push(this.currentUndoObj);
this.m_iCurrentPos=this.m_queue.length-1;
this.m_bUndoRedoCalled=false;
this.m_lastAction="";
this.currentUndoObj=null;
this.beenUsed=true;
};
UndoRedoQueue.prototype.moveBack=function(){
if(this.m_iCurrentPos<=0){
return null;
}
var _f98=this.m_queue[this.m_iCurrentPos].undoType;
this.m_bUndoRedoCalled=true;
this.m_lastAction="undo";
this.m_iCurrentPos--;
this.m_viewerState={"parameters":this.m_widget.getViewerObject().getExecutionParameters(),"spec":this.m_widget.getViewerObject().envParams["ui.spec"]};
if(typeof this.m_queue[this.m_iCurrentPos]!="undefined"){
this.m_widget.getViewerObject().m_sPalette=this.m_queue[this.m_iCurrentPos].palette;
if(_f98=="client"){
return this.m_queue[this.m_iCurrentPos+1];
}
var _f99=this.m_iCurrentPos;
while(_f99>0&&this.m_queue[_f99]&&this.m_queue[_f99].undoType!="server"){
_f99--;
}
return this.m_queue[_f99];
}
return null;
};
UndoRedoQueue.prototype.moveForward=function(){
if(this.m_iCurrentPos>=this.m_queue.length){
return null;
}
this.m_bUndoRedoCalled=true;
this.m_iCurrentPos++;
this.m_lastAction="redo";
this.m_viewerState={"parameters":this.m_widget.getViewerObject().getExecutionParameters(),"spec":this.m_widget.getViewerObject().envParams["ui.spec"]};
if(typeof this.m_queue[this.m_iCurrentPos]!="undefined"){
this.m_widget.getViewerObject().m_sPalette=this.m_queue[this.m_iCurrentPos].palette;
return this.m_queue[this.m_iCurrentPos];
}
return null;
};
UndoRedoQueue.prototype.clearEnd=function(){
while(this.m_queue.length-1>this.m_iCurrentPos){
this.m_queue.pop();
}
};
UndoRedoQueue.prototype.handleCancel=function(){
if(this.m_lastAction=="undo"){
this.m_iCurrentPos++;
}else{
if(this.m_lastAction=="redo"){
this.m_iCurrentPos--;
}
}
if(this.m_lastAction=="redo"||this.m_lastAction=="undo"){
var _f9a=this.m_widget.getProperties();
var _f9b=this.m_queue[this.m_iCurrentPos];
if(_f9a&&_f9b&&_f9b.widgetProperties){
_f9a.doUndo(_f9b.widgetProperties);
}
}
this.m_lastAction="";
this.m_bUndoRedoCalled=false;
this.currentUndoObj=null;
};
UndoRedoQueue.prototype.handleFault=function(){
this.currentUndoObj=null;
this.m_bUndoRedoCalled=false;
};
UndoRedoQueue.prototype.getUndoTooltip=function(){
if(this.m_iCurrentPos>0){
return RV_RES.IDS_JS_UNDO+" "+this.m_queue[this.m_iCurrentPos].tooltip;
}
return RV_RES.IDS_JS_UNDO;
};
UndoRedoQueue.prototype.getRedoTooltip=function(){
if(this.m_iCurrentPos<(this.m_queue.length-1)){
return RV_RES.IDS_JS_REDO+" "+this.m_queue[this.m_iCurrentPos+1].tooltip;
}
return RV_RES.IDS_JS_REDO;
};
function CIWidgetSavedOutput(_f9c){
this.iWidget=_f9c;
this.bContainsChart=false;
this.bContainsDrillThrough=false;
this.bPagedOutput=true;
};
CIWidgetSavedOutput.prototype.getIWidget=function(){
return this.iWidget;
};
CIWidgetSavedOutput.prototype.isPagedOutput=function(){
return this.bPagedOutput;
};
CIWidgetSavedOutput.prototype.setPagedOutput=function(_f9d){
this.bPagedOutput=_f9d;
};
CIWidgetSavedOutput.prototype.getCognosViewer=function(){
return this.getIWidget().getViewerObject();
};
CIWidgetSavedOutput.prototype.getIframeWindow=function(){
return this.savedOutputWindow;
};
CIWidgetSavedOutput.prototype.getSavedOutputDiv=function(){
return this.savedOutputDiv;
};
CIWidgetSavedOutput.prototype.render=function(){
if(this.isPagedOutput()&&this.getFirstPage()){
this.currentPageIndex=0;
this._showPages([this.getFirstPage()]);
}else{
if(this.tabbedSavedOutput&&this.currentPageIndex&&this.pageNodes){
var _f9e=this.pageNodes[this.currentPageIndex].getAttribute("tabid");
this.switchSavedOutputTab(_f9e);
}else{
if(this.getCognosViewer()&&this.getCognosViewer().getCurrentlySelectedTab()){
this.switchSavedOutputTab(this.getCognosViewer().getCurrentlySelectedTab());
}else{
this.showHTMLFragment(this.getIframeWindow().document.body.innerHTML);
}
}
}
};
CIWidgetSavedOutput.prototype.outputDoneLoading=function(){
if(window["gReportWidgetLoadQueue"]){
window["gReportWidgetLoadQueue"].widgetDoneLoading(this.getIWidget());
}
this.getIWidget().setOriginalFormFields(null);
var _f9f=this.getCognosViewer();
var _fa0=_f9f.getId();
this.savedOutputWindow=dojo.byId("CVHiddenIFrame"+_fa0).contentWindow;
this.savedOutputDiv=dojo.byId("CVSavedOutputDiv"+_fa0);
var sc=_f9f.getSelectionController();
if(!sc.hasContextData()&&this.savedOutputWindow.onLoadEvent){
this.savedOutputWindow.onLoadEvent();
}
this._populatePageNode();
var _fa2=dojo.byId("_"+this.iWidget.iContext.widgetId+"_cv");
this.loadStyleInfoFromIframe(_fa2);
this.bContainsChart=typeof this.savedOutputWindow.displayChart=="function"?true:false;
this.bContainsDrillThrough=typeof this.savedOutputWindow.drillThroughTarget!="undefined"?true:false;
this.render();
this.getMetaDataFromIFrame();
if(this.bContainsDrillThrough){
window[_fa0+"drillTargets"]=this.getIframeWindow().drillTargets;
}
_f9f.fillInContextData();
_f9f.updateBorderCollapse();
this.getIWidget().updateToolbar();
_f9f.setReportRenderingDone(true);
var _fa3=GUtil.generateCallback(this.getIWidget().fetchAnnotationData,[],this.getIWidget());
var _fa4=this.getPageContextData(_fa3);
if(_fa4==0){
this.getIWidget().fetchAnnotationData();
}
this.fixDuplicateFormFields();
this.getIWidget().getLoadManager().processQueue();
delete _f9f.envParams["cv.outputKey"];
this.getIWidget().setXNodeId(null);
var _fa5=this.getIWidget();
var _fa6=function(){
_fa5.iContext.iEvents.fireEvent("com.ibm.bux.widget.render.done",null,{});
_f9f.renderTabs();
if(_f9f.getCurrentlySelectedTab()!=null){
_fa5.getSavedOutput().tabbedSavedOutput=true;
_fa5.getSavedOutput().switchSavedOutputTab(_f9f.getCurrentlySelectedTab());
}
};
setTimeout(_fa6,100);
};
CIWidgetSavedOutput.prototype._populatePageNode=function(){
this.pageNodes=[];
var node=this.getIframeWindow().document.body.firstChild;
while(node){
if(node.nodeName.toLowerCase()=="table"){
this.pageNodes.push(node);
}
node=node.nextSibling;
}
};
CIWidgetSavedOutput.prototype.switchSavedOutputTab=function(_fa8,_fa9){
if(!this.pageNodes){
return;
}
if(_fa9){
if(!this.lastVisitedPage){
this.lastVisitedPage={};
}
if(this.isPagedOutput()){
var _faa=this.pageNodes[this.currentPageIndex].getAttribute("tabid");
this.lastVisitedPage[_faa]=this.currentPageIndex;
if(this.lastVisitedPage[_fa8]){
this.currentPageIndex=this.lastVisitedPage[_fa8];
this._showPages([this.pageNodes[this.currentPageIndex]]);
return;
}
}
}
var _fab=[];
for(var i=0;i<this.pageNodes.length;i++){
var node=this.pageNodes[i];
if(node&&node.getAttribute&&node.getAttribute("tabid")==_fa8){
_fab.push(node);
this.currentPageIndex=i;
if(this.isPagedOutput()){
break;
}
}
}
this._showPages(_fab);
};
CIWidgetSavedOutput.prototype.fixDuplicateFormFields=function(){
var _fae=document.getElementById("formWarpRequest"+this.getCognosViewer().getId());
if(_fae){
for(var _faf=0;_faf<_fae.elements.length;_faf++){
var name=_fae.elements[_faf].name;
if(name&&name.length>0){
if(_fae[name].length>1){
var _fb1=_fae[name][_fae[name].length-1].value;
while(_fae[name].length>1){
_fae[name][1].parentNode.removeChild(_fae[name][1]);
}
if(_fae[name][0]){
_fae[name][0].value=_fb1;
}
_fae[name].value=_fb1;
}
}
}
}
};
CIWidgetSavedOutput.prototype.getPageContextData=function(_fb2){
var _fb3={};
dojo.query("[ctx]",this.getSavedOutputDiv()).forEach(function(item){
var ctx=item.getAttribute("ctx");
var _fb6=ctx.split(":");
for(var i=0;i<_fb6.length;i++){
var _fb8=_fb6[i];
if(_fb8&&_fb8.length>0){
_fb3[_fb8]=true;
}
}
});
var _fb9=[];
for(var item in _fb3){
_fb9.push(item);
}
return this.getCognosViewer().getSelectionController().fetchContextData(_fb9,_fb2);
};
CIWidgetSavedOutput.prototype.loadStyleInfoFromIframe=function(_fbb){
var _fbc=null;
var _fbd=this.savedOutputWindow.document;
for(var _fbe=0;_fbe<_fbd.childNodes.length;_fbe++){
if(_fbd.childNodes[_fbe].childNodes&&_fbd.childNodes[_fbe].childNodes.length>0){
_fbc=_fbd.childNodes[_fbe];
break;
}
}
window.gScriptLoader.loadStyles(_fbc.firstChild,this.iWidget.getViewerId());
var _fbf=dojo.query("link",_fbc);
var _fc0="";
for(i=0;i<_fbf.length;i++){
var href=_fbf[i].getAttribute("href");
if(href){
_fc0+="<link href=\""+href+"\" />";
}
}
window.gScriptLoader.loadCSS(_fc0,_fbb,true,this.iWidget.getViewerId());
};
CIWidgetSavedOutput.prototype.getFirstPage=function(){
return this.pageNodes[0];
};
CIWidgetSavedOutput.prototype.getLastPage=function(){
return this.pageNodes?this.pageNodes[this.pageNodes.length-1]:null;
};
CIWidgetSavedOutput.prototype.writeNavLinks=function(){
var _fc2="";
if(this.isPagedOutput()){
if(this.tabbedSavedOutput&&!isNaN(this.currentPageIndex)){
var _fc3=this.pageNodes[this.currentPageIndex].getAttribute("tabid");
if(this.currentPageIndex>0&&this.pageNodes[this.currentPageIndex-1].getAttribute("tabid")==_fc3){
_fc2+=" firstPage previousPage ";
}
if(this.currentPageIndex<(this.pageNodes.length-1)&&this.pageNodes[this.currentPageIndex+1].getAttribute("tabid")==_fc3){
_fc2+=" nextPage lastPage ";
}
}else{
if(this.currentPageIndex>0){
_fc2+=" firstPage previousPage ";
}
if(this.currentPageIndex<(this.pageNodes.length-1)){
_fc2+=" nextPage lastPage ";
}
}
}
this.getCognosViewer().writeNavLinks(_fc2,true);
};
CIWidgetSavedOutput.prototype.pageAction=function(_fc4){
switch(_fc4){
case "firstPage":
if(this.tabbedSavedOutput){
var _fc5=this.pageNodes[this.currentPageIndex].getAttribute("tabid");
for(var i=0;i<this.pageNodes.length;i++){
var node=this.pageNodes[i];
if(node&&node.getAttribute&&node.getAttribute("tabid")==_fc5){
this.currentPageIndex=i;
break;
}
}
}else{
this.currentPageIndex=0;
}
break;
case "previousPage":
this.currentPageIndex=this.currentPageIndex-1;
break;
case "nextPage":
this.currentPageIndex=this.currentPageIndex+1;
break;
case "lastPage":
if(this.tabbedSavedOutput){
var _fc5=this.pageNodes[this.currentPageIndex].getAttribute("tabid");
var _fc8=false;
for(var i=0;i<this.pageNodes.length;i++){
var node=this.pageNodes[i];
if(node&&node.getAttribute&&node.getAttribute("tabid")==_fc5){
_fc8=true;
}else{
if(_fc8){
this.currentPageIndex=i-1;
break;
}
}
}
}else{
this.currentPageIndex=this.pageNodes.length-1;
}
break;
}
this._showPages([this.pageNodes[this.currentPageIndex]]);
};
CIWidgetSavedOutput.prototype._showPages=function(_fc9){
var oCV=this.getCognosViewer();
oCV.getSelectionController().clearSelectedObjects();
if(_fc9.length==1){
this.showHTMLFragment(_fc9[0].innerHTML);
}else{
var _fcb="";
for(var i=0;i<_fc9.length;i++){
_fcb+=_fc9[i].innerHTML;
}
this.showHTMLFragment(_fcb);
}
this.writeNavLinks();
if(this.tabbedSavedOutput&&this.lastVisitedPage){
this.getIWidget().placeTabControlInView();
}else{
oCV.setKeepFocus(true);
}
oCV.doneLoadingUpdateA11Y("complete");
var _fcd=GUtil.generateCallback(this.getIWidget().fetchAnnotationData,[],this.getIWidget());
var _fce=this.getPageContextData(_fcd);
if(_fce==0){
this.getIWidget().fetchAnnotationData();
}
};
CIWidgetSavedOutput.prototype.getMetaDataFromIFrame=function(){
if(typeof this.getIframeWindow().getSelectionController=="function"){
var _fcf=this.getIframeWindow().getSelectionController();
if(_fcf){
var _fd0=this.getCognosViewer().getSelectionController();
_fd0.addMetaData(_fcf.getCCDManager().m_md);
_fd0.addContextData(_fcf.getCCDManager().m_cd);
_fd0.setSelectionBasedFeaturesEnabled(true);
}
}
};
CIWidgetSavedOutput.prototype.processDrillThrough=function(_fd1){
if(this.bContainsDrillThrough&&(typeof this.bOldOutput=="undefined"||this.bOldOutput==true)){
var _fd2=new RegExp("onclick=\"doSingleDrillThrough[^\"]*\"|onclick='doMultipleDrillThrough[^']*'","gim");
var aM=_fd1.match(_fd2);
if(aM){
if(typeof this.bOldOutput=="undefined"&&aM.length>0&&aM[0].indexOf("'_THIS_'")>0){
this.bOldOutput=false;
}else{
this.bOldOutput=true;
var _fd4="";
var quot="'";
if(aM.length>0){
_fd4=aM[0].charAt(aM[0].length-1);
}
if(_fd4=="'"){
quot="\"";
}
for(var i=0;i<aM.length;i++){
_fd1=_fd1.replace(aM[i],aM[i].substring(0,aM[i].length-3)+","+quot+this.getCognosViewer().getId()+quot+");"+_fd4);
}
}
}
}
return _fd1;
};
CIWidgetSavedOutput.prototype.processChart=function(_fd7){
if(isIE()){
_fd7=_fd7.replace(/preSelectNode\(event\);/g,getCognosViewerObjectRefAsString(this.getCognosViewer().getId())+".pcc(event);");
}else{
_fd7=_fd7.replace(/preSelectNode\(event\);/g,"");
}
var _fd8=this.getCognosViewer().getId();
var _fd9=document.getElementById("CVHiddenIFrame"+_fd8);
var _fda=_fd9.src;
if(_fda.indexOf("repository")>=0){
var _fdb=_fda.indexOf("content");
var _fdc=_fda.substring(0,_fdb);
_fd7=_fd7.replace(/src\=\"images\//g,"src=\""+_fdc+"images/");
}
_fd7=this.fixupChartUseMapValue(_fd7);
return _fd7.replace(/displayChart[^;].*;|var graphicSrc[^;].*;|var graphicName[^;].*;/g,"");
};
CIWidgetSavedOutput.prototype.fixupChartUseMapValue=function(_fdd){
var re=/usemap\s*=\s*"*#(\w+)"*/gi;
var _fdf,_fe0=[];
while((_fdf=re.exec(_fdd))){
_fe0.push(_fdf[1]);
}
for(var i=0;i<_fe0.length;i++){
var _fe2=new RegExp(_fe0[i],"g");
_fdd=_fdd.replace(_fe2,_fe0[i]+this.getCognosViewer().getId());
}
return _fdd;
};
CIWidgetSavedOutput.prototype.showHTMLFragment=function(_fe3){
if(this.bContainsChart){
_fe3=this.processChart(_fe3);
}
_fe3=this.processDrillThrough(_fe3);
_fe3=_fe3.replace(/_THIS_/g,this.getCognosViewer().getId());
this.getIWidget().loadStylesAndScripts(_fe3,this.getSavedOutputDiv(),false);
this.getIWidget().reselectSelectionFilterObjects();
this.getIWidget().addChromeWhitespaceHandler(this.getCognosViewer().getId());
};
function gInitializeViewer(obj){
if(window.gScriptLoader.hasCompletedExecution()){
var _fe5=obj.getViewerObject();
if(_fe5&&_fe5.inlineScriptsDoneExecuting==true){
clearInterval(obj.timer);
if(typeof _fe5.errorOccured!="undefined"){
obj.fireEvent("com.ibm.bux.widget.render.done",null,{});
}else{
if(typeof _fe5.getToolbar()!="undefined"){
_fe5.setViewerWidget(obj);
if(obj.isSelectionFilterEnabled()){
obj.updateDrillThroughLinks();
}
if(obj.isDashboardOwner()){
_fe5.addReportInfo();
}
if(obj.promptParametersRetrieved==true){
var _fe6=obj.getAttributeValue("viewerReportPrompts");
_fe5.envParams["reportPrompts"]=_fe6;
}else{
if(_fe5.envParams&&_fe5.envParams["widget.promptParametersRetrievedOnDrop"]=="true"){
obj.promptParametersRetrieved=true;
}
}
var _fe7=obj.getAttributeValue("syncNewWidgets");
if(_fe7===null||_fe7==="true"){
_fe7=true;
}else{
_fe7=false;
}
if(!_fe7&&(obj.isPastedWidget()||obj.isOpeningSavedDashboard()==false)){
obj.disableListenToForEvent(["com.ibm.widget.contextChanged.drill","com.ibm.widget.contextChanged.prompt","com.ibm.widget.contextChanged"]);
}
obj.fireEvent("com.ibm.bux.widget.setShowBordersWhenInnactive",null,(_fe5.m_flashChartsObjectIds.length!==0));
}
}
}
}
};
function gVWEvent(sId,evt,_fea){
var oCV=window["oCV"+sId];
if(oCV){
oCV.loadExtra();
var _fec=oCV.getViewerWidget();
if(_fec){
_fec[_fea](evt);
}
}
};
function ReportWidgetLoadQueue(_fed){
this._concurrentLoadSetting=_fed;
this._widgetsRunning=[];
this._queue=[];
};
ReportWidgetLoadQueue.prototype.add=function(_fee){
this._queue.push(_fee);
this.loadNextWidget();
};
ReportWidgetLoadQueue.prototype.widgetDoneLoading=function(_fef){
for(var i=0;i<this._widgetsRunning.length;++i){
var _ff1=this._widgetsRunning[i];
if(_ff1==_fef){
this._widgetsRunning.splice(i,1);
break;
}
}
this.loadNextWidget();
};
ReportWidgetLoadQueue.prototype.loadNextWidget=function(){
if(this._widgetsRunning.length<this._concurrentLoadSetting){
var _ff2=this._queue.shift();
if(typeof _ff2!="undefined"){
this._widgetsRunning.push(_ff2);
_ff2.postReport(null);
}
}
};
function CognosViewerAnnotation(){
this.m_oCV=null;
};
CognosViewerAnnotation.prototype.setCognosViewer=function(oCV){
this.m_oCV=oCV;
};
CognosViewerAnnotation.prototype.getCognosViewer=function(){
return this.m_oCV;
};
CognosViewerAnnotation.prototype.isEnabled=function(_ff4){
};
CognosViewerAnnotation.prototype.areAnnotationsEnabled=function(){
var _ff5=this.m_oCV.getViewerWidget();
return _ff5.getAnnotationHelper().isEnabled();
};
CognosViewerAnnotation.prototype.getMenuItemBaseString=function(){
};
CognosViewerAnnotation.prototype.getMenuItemIconClass=function(){
};
CognosViewerAnnotation.prototype.getSelections=function(){
var _ff6=[];
var _ff7=this.getCognosViewer();
if(_ff7){
var _ff8=_ff7.getSelectionController();
if(_ff8){
_ff6=_ff8.getSelections();
}
}
return _ff6;
};
CognosViewerAnnotation.prototype.hasAnnotation=function(){
var has=false;
var _ffa=this.getCognosViewer();
if(_ffa){
var _ffb=_ffa.getViewerWidget();
if(_ffb){
var _ffc=_ffb.getAnnotationStore();
if(_ffc){
has=_ffc.hasAnnotation();
}
}
}
return has;
};
function CognosViewerCellAnnotation(){
};
CognosViewerCellAnnotation.prototype=new CognosViewerAnnotation();
CognosViewerCellAnnotation.prototype.getMenuItemString=function(_ffd){
var _ffe=_ffd;
var _fff=this.getSelections();
if(_fff&&_fff.length==1){
var sel=_fff[0];
_ffe=sel.getDisplayValues()[0];
}
var text=this.getMenuItemBaseString();
if(_ffe&&_ffe.length>0){
text+=" - "+enforceTextDir(_ffe);
}
return text;
};
CognosViewerCellAnnotation.prototype.hasAnnotaionsOnSelectedCell=function(){
var _1002=this.getSelections();
if(_1002&&_1002.length==1){
var _1003=_1002[0].getCellRef();
var ctxId=this.getCognosViewer().findCtx(_1003);
var _1005=this.getCognosViewer().getViewerWidget();
if(_1005){
var _1006=_1005.getAnnotationStore();
if(_1006){
var _1007=_1006.get(ctxId);
if(_1007&&_1007.length>0){
return true;
}
}
}
}
return false;
};
CognosViewerCellAnnotation.prototype.getChangeableAnnotation=function(){
var _1008=this.getSelections();
if(_1008&&_1008.length==1){
var _1009=_1008[0].getCellRef();
var ctxId=this.getCognosViewer().findCtx(_1009);
var _100b=this.getCognosViewer().getViewerWidget();
if(_100b){
var _100c=_100b.getAnnotationStore();
if(_100c){
return _100c.getChangeableAnnotation(ctxId);
}
}
}
return null;
};
CognosViewerCellAnnotation.prototype.hasValidContextOnSelectedCell=function(){
var _100d=this.getSelections();
if(_100d&&_100d.length==1){
var _100e=_100d[0].getCellRef();
var ctxId=this.getCognosViewer().findCtx(_100e);
if(ctxId){
var ids=AnnotationCTXLookup.generateIDArrayFromCellCtxValue(ctxId);
for(var i=0;i<ids.length;i++){
var id=ids[i];
if(id!=="*"&&!(/^\d+$/).test(id)){
return false;
}
}
return true;
}
}
return false;
};
function NewAnnotation(){
};
NewAnnotation.prototype=new CognosViewerCellAnnotation();
NewAnnotation.prototype.isEnabled=function(_1013){
return this.areAnnotationsEnabled()&&(_1013!=="widgetActions")&&this.hasValidContextOnSelectedCell();
};
NewAnnotation.prototype.getMenuItemBaseString=function(){
return RV_RES.IDS_JS_ANNOTATION_NEW;
};
NewAnnotation.prototype.getMenuItemIconClass=function(){
return "NewAnnotation";
};
function EditAnnotation(){
};
EditAnnotation.prototype=new CognosViewerCellAnnotation();
EditAnnotation.prototype.isEnabled=function(_1014){
return this.areAnnotationsEnabled()&&(_1014!=="widgetActions")&&this.getChangeableAnnotation()!==null;
};
EditAnnotation.prototype.getMenuItemBaseString=function(){
return RV_RES.IDS_JS_ANNOTATION_EDIT;
};
EditAnnotation.prototype.getMenuItemIconClass=function(){
return "EditAnnotation";
};
function DeleteAnnotation(){
};
DeleteAnnotation.prototype=new CognosViewerCellAnnotation();
DeleteAnnotation.prototype.isEnabled=function(_1015){
return this.areAnnotationsEnabled()&&(_1015!=="widgetActions")&&this.getChangeableAnnotation()!==null;
};
DeleteAnnotation.prototype.getMenuItemString=function(_1016){
return this.getMenuItemBaseString();
};
DeleteAnnotation.prototype.getMenuItemBaseString=function(){
return RV_RES.IDS_JS_ANNOTATION_DELETE;
};
DeleteAnnotation.prototype.getMenuItemIconClass=function(){
return "DeleteAnnotation";
};
function CognosViewerWidgetAnnotation(){
};
CognosViewerWidgetAnnotation.prototype=new CognosViewerAnnotation();
CognosViewerWidgetAnnotation.prototype.getMenuItemString=function(){
var _1017=this.getCognosViewer().getViewerWidget().getDisplayName();
var text=this.getMenuItemBaseString();
if(_1017&&_1017.length>0){
_1017=enforceTextDir(_1017);
text+=" - "+_1017;
}
return text;
};
CognosViewerWidgetAnnotation.prototype.hasWidgetLevelAnnotations=function(){
var _1019=false;
var _101a=this.getCognosViewer().getViewerWidget();
if(_101a){
var _101b=_101a.getAnnotationStore();
var _101c=_101b.get(_101b.WIDGET_CONTEXT);
if(_101c&&_101c.length>0){
_1019=true;
}
}
return _1019;
};
CognosViewerWidgetAnnotation.prototype.getWidgetLevelChangeableAnnotation=function(){
var _101d=this.getCognosViewer().getViewerWidget();
if(_101d){
var _101e=_101d.getAnnotationStore();
if(_101e){
return _101e.getChangeableAnnotation(_101e.WIDGET_CONTEXT);
}
}
return null;
};
CognosViewerWidgetAnnotation.prototype.hasValidSelection=function(_101f){
var _1020=this.m_oCV.getSelectionController();
var _1021=_1020.getSelections();
var _1022=false;
if(_1020.hasSelectedChartNodes()){
_1022=(_1020.getSelectedChartNodes()[0].m_contextIds.length>0);
}
return (_101f==="widgetActions")||(_1021.length!=1&&!_1022);
};
function NewWidgetAnnotation(){
};
NewWidgetAnnotation.prototype=new CognosViewerWidgetAnnotation();
NewWidgetAnnotation.prototype.isEnabled=function(_1023){
return this.areAnnotationsEnabled()&&(_1023!=="contextMenu")&&this.hasValidSelection(_1023);
};
NewWidgetAnnotation.prototype.getMenuItemBaseString=function(){
return RV_RES.IDS_JS_WIDGET_ANNOTATION_NEW;
};
NewWidgetAnnotation.prototype.getMenuItemIconClass=function(){
return "NewWidgetAnnotation";
};
function EditWidgetAnnotation(){
};
EditWidgetAnnotation.prototype=new CognosViewerWidgetAnnotation();
EditWidgetAnnotation.prototype.isEnabled=function(_1024){
return (this.areAnnotationsEnabled()&&(_1024!=="contextMenu")&&this.hasValidSelection(_1024)&&this.getWidgetLevelChangeableAnnotation())?true:false;
};
EditWidgetAnnotation.prototype.getMenuItemBaseString=function(){
return RV_RES.IDS_JS_WIDGET_ANNOTATION_EDIT;
};
EditWidgetAnnotation.prototype.getMenuItemIconClass=function(){
return "EditWidgetAnnotation";
};
function DeleteWidgetAnnotation(){
};
DeleteWidgetAnnotation.prototype=new CognosViewerWidgetAnnotation();
DeleteWidgetAnnotation.prototype.isEnabled=function(_1025){
return (this.areAnnotationsEnabled()&&(_1025!=="contextMenu")&&this.hasValidSelection(_1025)&&this.getWidgetLevelChangeableAnnotation())?true:false;
};
DeleteWidgetAnnotation.prototype.getMenuItemBaseString=function(){
return RV_RES.IDS_JS_WIDGET_ANNOTATION_DELETE;
};
DeleteWidgetAnnotation.prototype.getMenuItemIconClass=function(){
return "DeleteWidgetAnnotation";
};
function AnnotationCTXLookup(_1026){
this.m_ccdManager=_1026;
this.m_md=this.m_ccdManager.m_md;
this.m_cd=this.m_ccdManager.m_cd;
this.m_RDIVALUE_KEY="annotationHook";
this.m_oContextDetailsMap={};
};
AnnotationCTXLookup.prototype.populateCtxDetailsForAllAnnotations=function(_1027){
for(var i=0,len=_1027.length;i<len;i++){
var anno=_1027[i];
var ctx=anno.ctx;
if(ctx){
this._populateCtxDetailsForOneCtxValue(ctx);
}
}
};
AnnotationCTXLookup.prototype._populateCtxDetailsForOneCtxValue=function(_102c){
if(_102c){
var _102d=this.generateIDArrayFromCellCtxValue(_102c);
for(var i=0,len=_102d.length;i<len;i++){
var id=_102d[i];
this._populateCtxDetailsForOneId(id);
}
}
};
AnnotationCTXLookup.generateIDArrayFromCellCtxValue=function(_1031){
if(_1031){
return _1031.replace(/::/g,":").split(":");
}
return null;
};
AnnotationCTXLookup.prototype.generateIDArrayFromCellCtxValue=AnnotationCTXLookup.generateIDArrayFromCellCtxValue;
AnnotationCTXLookup.prototype._populateCtxDetailsForOneId=function(id){
if(id.match(/\*/)){
return;
}
var _1033=this.m_oContextDetailsMap[id];
if(_1033){
return;
}else{
_1033={};
var _1034=this.m_cd[id];
if(_1034){
if(_1034.u){
_1033["u"]=_1034.u;
}
if(_1034.r){
_1033["r"]=_1034.r;
var _1035=this.m_md[_1034.r];
if(_1035){
if(_1035.usage!=="undefined"){
_1033["usage"]=_1035.usage;
}
if(_1035.dtype){
_1033.dtype=_1035.dtype;
}
}
}
this._populateRdiValueInDetail(_1033,id);
this.m_oContextDetailsMap[id]=_1033;
}
}
};
AnnotationCTXLookup.prototype._getMDValue=function(item,key1,key2){
if(typeof key2=="undefined"){
key2=key1;
}
if(typeof item[key1]!="undefined"&&typeof this.m_md[item[key1]][key2]!="undefined"){
return this.m_md[item[key1]][key2];
}
return null;
};
AnnotationCTXLookup.prototype._findMDValue=function(item,aKeys){
for(var i=0;i<aKeys.length;i++){
var value=this._getMDValue(item,aKeys[i]);
if(value!==null){
return value;
}
}
return null;
};
AnnotationCTXLookup.prototype._populateRdiValueInDetail=function(_103d,id){
var item=this.m_cd[id];
var aKeys=[];
var oRdi={};
oRdi[1]=this._findMDValue(item,["l","h","i","r"]);
if(this._getMDValue(item,"r","usage")==2){
oRdi[2]=this._findMDValue(item,["i","m","r"]);
}
_103d[this.m_RDIVALUE_KEY]=oRdi;
};
AnnotationCTXLookup.prototype.getDetail=function(id){
if(!id){
return null;
}
return this.m_oContextDetailsMap[id];
};
AnnotationCTXLookup.prototype.isAnnotatedId=function(_1043,_1044,id){
if(!_1043||!id){
return false;
}
if(_1043.match(/\*/)){
var _1046=this.getDetail(id);
if(_1046&&_1046[this.m_RDIVALUE_KEY]){
var rdi=_1046[this.m_RDIVALUE_KEY][1];
if(_1044.version>=2&&_1046[this.m_RDIVALUE_KEY][2]){
rdi=_1046[this.m_RDIVALUE_KEY][2];
}
return this._compareWithoutNS(_1044.rdi,rdi);
}else{
return false;
}
}else{
return _1043===id;
}
};
AnnotationCTXLookup.prototype._compareWithoutNS=function(rdi1,rdi2){
if(!rdi1||!rdi2){
return false;
}
if(rdi1!==rdi2){
var _104a=rdi2.indexOf("].[");
if(_104a>0){
return rdi1.lastIndexOf(rdi2.substr(_104a))>0;
}
return false;
}
return true;
};
AnnotationCTXLookup.prototype.isAnnotatedCell=function(_104b,_104c){
if(!_104b||!_104b.ctx||!_104c){
return false;
}
this._populateCtxDetailsForOneCtxValue(_104c);
var _104d=this.generateIDArrayFromCellCtxValue(_104b.ctx);
var _104e=this.generateIDArrayFromCellCtxValue(_104c);
if(!this.isAnnotatedId(_104d[0],_104b,_104e[0])){
return false;
}
var _104f=this._generateDataItemIDArrayFromAnnotationIDs(_104d);
var _1050=this._generateDataItemIDArrayFromCellIDs(_104e);
if(_104f.length>_1050.length){
return false;
}
for(var i=0,len=_104f.length;i<len;i++){
for(var j=0,jLen=_1050.length;j<jLen;j++){
if(_104f[i]===_1050[j]){
_104f[i]=true;
_1050[j]=true;
break;
}
}
}
for(i=0,len=_104f.length;i<len;i++){
if(_104f[i]!==true){
return false;
}
}
for(i=0,len=_1050.length;i<len;i++){
if(_1050[i]!==true){
return false;
}
}
return true;
};
AnnotationCTXLookup.prototype._generateDataItemIDArrayFromCellIDs=function(_1055){
var _1056=[];
for(var i=1,len=_1055.length;i<len;i++){
var id=_1055[i];
var _105a=this.getDetail(id);
if(this._isDataItem(_105a)){
_1056.splice(0,0,id);
}
}
return _1056;
};
AnnotationCTXLookup.dtypeLookup={"1":true,"25":true,"26":true,"27":true,"28":true,"29":true,"30":true,"31":true,"32":true,"34":true,"35":true,"36":true,"43":true,"45":true,"55":true,"56":true};
AnnotationCTXLookup.prototype._isDataItem=function(_105b){
if(_105b){
var usage=_105b.usage;
var dtype=_105b.dtype;
if(usage===0||usage===1||(usage===3&&AnnotationCTXLookup.dtypeLookup[dtype]===true)){
return true;
}
}
return false;
};
AnnotationCTXLookup.prototype._generateDataItemIDArrayFromAnnotationIDs=function(_105e){
var _105f=[];
for(var i=1,len=_105e.length;i<len;i++){
var id=_105e[i];
if(id.match(/\*/)===null){
_105f.splice(0,0,id);
}
}
return _105f;
};
dojo.provide("bux.reportViewer.ReportInfo");
dojo.require("bux.Tooltip");
dojo.declare("bux.reportViewer.ReportInfo",bux.TooltipBase,{templateString:"<div class=\"dijitTooltip dijitTooltipLeft\" id=\"dojoTooltip\">\n\t<div class=\"dijitTooltipContainer dijitTooltipContents\" dojoAttachPoint=\"containerNode\" waiRole='alert'></div>\n\t<div class=\"dijitTooltipConnector\"></div>\n</div>\n",title:"",text:"",linkText:null,linkScript:null,constructor:function(args){
if(args.focusElement){
dojo.connect(args.focusElement,"onfocus",this,"_onHover");
dojo.connect(args.focusElement,"onblur",this,"_onUnHover");
}
},createMarkup:function(){
var _1064=this.connectId+"_linkId";
var _1065=dojo.isIE||dojo.isTrident?"\"#\"":"\"javascript:void(0);\"";
var _1066="";
_1066+="<table role=\"presentation\" class=\"bux-tooltip-table\" cellspacing=\"0\" cellpadding=\"0\">";
_1066+="<tr>";
_1066+="<td class=\"bux-tooltip-title\">";
_1066+=html_encode(this.title);
_1066+="</td>";
_1066+="</tr>";
_1066+="<tr>";
_1066+="<td class=\"bux-tooltip-text\">";
_1066+=html_encode(this.text);
_1066+="</td>";
_1066+="</tr>";
_1066+="<tr>";
if(this.linkScript){
_1066+="<td class=\"bux-tooltip-text\">";
_1066+="<a role=\"link\" id=\""+_1064+"\" href="+_1065+" onmousedown=\""+this.linkScript+"\">"+html_encode(this.linkText)+"</a>";
_1066+="</td>";
}else{
_1066+="<td></td>";
}
_1066+="</tr>";
_1066+="</table>";
return _1066;
}});
dojo.provide("ViewerIWidgetInlineDialog");
dojo.require("dijit._base.focus");
dojo.declare("ViewerIWidgetInlineDialog",null,{constructor:function(oCV,sHTML,_1069,_106a){
this.initialize(oCV,sHTML);
this.m_aButtons=_1069;
this.m_sButtonContainerId=_106a;
},initialize:function(oCV,sHTML){
this.m_oCV=oCV;
this.m_html=sHTML;
this.m_viewerDiv=dojo.byId("RVContent"+this.m_oCV.getId());
this.positionOptions={horizontal:"center",vertical:"center"};
this.onScrollHandle=null;
this.m_dialogDiv=null;
if(this.m_oCV.getViewerWidget){
this.m_background=this.m_oCV.getViewerWidget().getReportBlocker();
}
},setVerticalPositionOption:function(_106d){
this.positionOptions.vertical=_106d;
},getDialogDiv:function(){
return this.m_dialogDiv;
},initializeDialog:function(){
this.m_dialogDiv=document.createElement("div");
dojo.addClass(this.m_dialogDiv,"inlineDialog");
this.m_dialogDiv.style.display="none";
this.m_dialogDiv.innerHTML=this.m_html;
dojo.place(this.m_dialogDiv,this.m_background.getNode().nextSibling,"before");
var _106e=dojo.byId(this.m_sButtonContainerId);
if(_106e&&this.m_aButtons&&this.m_aButtons.length>0){
dojo.forEach(this.m_aButtons,function(_106f){
var span=document.createElement("span");
_106e.appendChild(span);
var _1071=new dijit.form.Button(_106f,span);
});
}
},createBackgroundTabCatchDiv:function(){
if(this.m_tabCatch==null){
this.m_tabCatch=dojo.byId("BACKGROUND_TABCATCH"+this.m_oCV.getId());
if(!this.m_tabCatch){
this.m_tabCatch=document.createElement("div");
this.m_tabCatch.id="BACKGROUND_TABCATCH"+this.m_oCV.getId();
this.m_tabCatch.style.display="none";
this.m_tabCatch.style.position="absolute";
this.m_tabCatch.style.left="0";
this.m_tabCatch.style.top="0";
this.m_tabCatch.style.height="0px";
this.m_tabCatch.style.width="0px";
this.m_tabCatch.setAttribute("tabIndex","0");
if(this.m_viewerDiv.firstChild){
dojo.place(this.m_tabCatch,this.m_viewerDiv.firstChild,"before");
}else{
this.m_viewerDiv.appendChild(this.m_tabCatch);
}
}
}
},initializeBackground:function(){
this.createBackgroundTabCatchDiv();
},initializeKeyboardSupport:function(){
var _1072=dijit._getTabNavigable(this.m_dialogDiv);
var _1073=_1072.lowest||_1072.first;
var _1074=_1072.last||_1072.highest||_1073;
if(_1073){
this.m_tabCatch.onfocus=function(){
dijit.focus(_1073);
};
this.m_background.getNode().onfocus=function(){
dijit.focus(_1073);
};
}
if(_1074&&_1073){
_1074.onblur=function(){
dijit.focus(_1073);
};
}else{
if(_1073){
_1073.onblur=function(){
dijit.focus(_1073);
};
}
}
if(this.m_oCV.getKeepFocus()!=false&&_1073&&_1073.focus){
_1073.focus();
}
},show:function(){
this.m_oCV.setVisibleDialog(this);
if(this.m_tabCatch==null){
this.initializeBackground();
}
if(this.m_dialogDiv==null){
this.initializeDialog();
}
this.m_background.setClassNameOverride("inlineDialog-background-error");
this.m_background.show();
this.m_tabCatch.style.display="block";
this.m_dialogDiv.style.display="block";
this.initializeKeyboardSupport();
},hide:function(){
this.m_oCV.setVisibleDialog(null);
if(this.onScrollHandle!=null){
dojo.disconnect(this.onScrollHandle);
this.onScrollHandle=null;
}
if(this.m_background!=null){
this.m_background.hide();
}
if(this.m_tabCatch!=null){
this.m_tabCatch.style.display="none";
}
if(this.m_dialogDiv!=null){
this.m_dialogDiv.style.display="none";
}
},destroy:function(){
this.hide();
if(this.m_dialogDiv!=null){
this.m_dialogDiv.parentNode.removeChild(this.m_dialogDiv);
this.m_dialogDiv=null;
}
if(this.m_tabCatch!=null){
this.m_tabCatch.parentNode.removeChild(this.m_tabCatch);
this.m_tabCatch=null;
}
if(this.m_background!=null){
this.m_background.destroy();
this.m_background=null;
}
},setDebugHelper:function(_1075){
var _1076=document.createElement("div");
_1076.style.zIndex="100";
_1076.style.display="block";
_1076.style.position="relative";
_1076.style.backgroundColor="#FFFFFF";
_1076.innerHTML="<table><tr><td>"+"<a href=\"#\" onclick=\""+_1075+".show();\">show</a>"+"     "+"<a href=\"#\" onclick=\""+_1075+".hide();\">hide</a></td></tr></table>";
document.body.insertBefore(_1076,document.body.firstChild);
}});
dojo.provide("bux.reportViewer.Properties");
dojo.declare("bux.reportViewer.Properties",null,{iWidget:null,masterDialogSpec:null,masterDialogSpecProperties:null,flashChartSpec:null,isFlashChartOptionEnabled:true,oldProperties:null,dialogDisplayValues:null,constructor:function(_1077,_1078){
this.isInitialized=false;
this.initializeDialogDisplayValues();
this.oldProperties={};
this.iWidget=_1077;
if(_1078==="<empty>"){
return;
}
var json=dojo.eval("["+_1078+"]");
if(json&&json[0]){
this.initializeWithSavedPropertyValues(json[0]);
}
},initializeDialogDisplayValues:function(){
this.dialogDisplayValues={flashCharts:{value:null,canUndo:true,runReport:true},rowsPerPage:{value:null,canUndo:true,runReport:true},promptUserOnLoad:{value:false},retrieveAll:{value:false,refreshSavedOutput:true},showExpandCollapseIcon:{value:null}};
},clearDialogSpec:function(){
this.masterDialogSpec=null;
this.masterDialogSpecProperties=null;
},initializeWithSavedPropertyValues:function(_107a){
for(var prop in _107a){
if(typeof prop!="undefined"&&prop!=null){
if(this.dialogDisplayValues[prop]){
this.dialogDisplayValues[prop].value=_107a[prop];
}else{
this.dialogDisplayValues[prop]={value:_107a[prop],canUndo:false};
}
}
}
},setProperty:function(_107c,value){
this.dialogDisplayValues[_107c].value=value;
},getProperty:function(_107e){
if(this.dialogDisplayValues[_107e]){
return this.dialogDisplayValues[_107e].value;
}
return null;
},getOldProperty:function(_107f){
if(this.oldProperties&&this.oldProperties[_107f]){
return this.oldProperties[_107f].value;
}
return null;
},getOldProperties:function(){
var _1080={};
for(var prop in this.oldProperties){
if(this.dialogDisplayValues[prop].canUndo===true){
_1080[prop]={};
_1080[prop].value=this.oldProperties[prop].value;
}
}
return _1080;
},onGet:function(){
this.copyPropertyValues(this.dialogDisplayValues,this.oldProperties);
if(!this.masterDialogSpec){
this.initializeDialogSpec();
}else{
this.updateDialogSpec();
}
var _1082={tabTitle:this._getReportWidgetTabTitle(),properties:this.dialogDisplayValues,propertiesDialogSpec:this.masterDialogSpec};
return _1082;
},_getReportWidgetTabTitle:function(){
var _1083;
if(this.iWidget&&this.iWidget.getViewerObject()){
_1083=RV_RES.IDS_REPORT_WIDGET_PROPERTY_TAB_TITLE;
}
return _1083;
},onSet:function(_1084){
if(this.isSavedOutput()){
this.updateSavedOutput();
}else{
if(!this.runReportWithNewOptions()){
this._updateReport();
}
}
},_updateReport:function(){
var _1085=this.getProperty("showExpandCollapseIcon");
if(this.getOldProperty("showExpandCollapseIcon")!=_1085){
var oCV=this.iWidget.getViewerObject();
if(_1085===true){
oCV.insertExpandIconsForAllCrosstabs();
}else{
oCV.removeExpandIconsForAllCrosstabs();
}
}
},copyPropertyValues:function(from,to){
for(var prop in from){
if(!to[prop]){
to[prop]={};
}
to[prop].value=from[prop].value;
}
},doUndo:function(_108a){
this.copyPropertyValues(_108a,this.dialogDisplayValues);
},getUndoInfo:function(){
if(!this.isInitialized){
var oCV=this.iWidget.getViewerObject();
this.initialize(oCV.envParams);
}
var _108c={};
for(var prop in this.dialogDisplayValues){
if(this.dialogDisplayValues[prop].canUndo===true){
_108c[prop]={value:this.getProperty(prop)};
}
}
return _108c;
},shouldUpdateReport:function(_108e){
for(var prop in this.dialogDisplayValues){
if(this.dialogDisplayValues[prop][_108e]==true&&this.getOldProperty(prop)!=this.getProperty(prop)){
return true;
}
}
return false;
},runReportWithNewOptions:function(){
if(this.shouldUpdateReport("runReport")){
var oCV=this.iWidget.getViewerObject();
var _1091=oCV.getAction("RunReport");
_1091.setReuseQuery(true);
_1091.execute();
this.iWidget.getUndoRedoQueue().initUndoObj({"tooltip":this.getUndoHint(),"saveSpec":this.saveSpecForUndo()});
return true;
}
return false;
},updateSavedOutput:function(){
if(this.shouldUpdateReport("refreshSavedOutput")){
var _1092=this.iWidget.getSavedOutput();
_1092.setPagedOutput(!this.getRetrieveAll());
_1092.render();
}
},toString:function(){
var str="{";
for(var prop in this.dialogDisplayValues){
var _1095=this.getProperty(prop);
if(_1095!=null&&typeof _1095!=="undefined"){
if(str!="{"){
str+=", ";
}
str+="\""+prop+"\": ";
str+=(typeof (_1095)=="string")?_1095.toString():dojo.toJson(_1095);
}
}
str+="}";
return str;
},isSavedOutput:function(){
return this.iWidget.getViewerObject().envParams["ui.action"]==="view";
},getUndoHint:function(){
return RV_RES.IDS_JS_WIDGET_PROPERTIES;
},saveSpecForUndo:function(){
return false;
},getRetrieveAll:function(){
return this.getProperty("retrieveAll");
},getPromptUserOnLoad:function(){
return this.getProperty("promptUserOnLoad");
},getFlashCharts:function(){
return this.getProperty("flashCharts");
},getRowsPerPage:function(){
return this.getProperty("rowsPerPage");
},getOriginalReportLocation:function(_1096){
if(_1096.getAttributeValue&&!_1096.getAttributeValue("originalReport")){
return RV_RES.IDS_JS_PROPERTY_ORIGINAL_REPORT_LOCATION+" "+RV_RES.IDS_JS_PROPERTY_ORIGINAL_REPORT_LOCATION_UNAVAILABLE;
}
var _1097=_1096.getViewerObject().envParams["originalReportLocation"];
if(typeof _1097=="undefined"||_1097==null||_1097=="Unavailable"){
return RV_RES.IDS_JS_PROPERTY_ORIGINAL_REPORT_LOCATION+" "+RV_RES.IDS_JS_PROPERTY_ORIGINAL_REPORT_LOCATION_UNAVAILABLE;
}
return (RV_RES.IDS_JS_PROPERTY_ORIGINAL_REPORT_LOCATION+" "+_1097);
},getShowExpandCollapseIconFlag:function(){
return this.getProperty("showExpandCollapseIcon");
},getAdvancedServerProperty:function(_1098){
if(!this.iWidget&&!this.iWidget.getViewerObject()){
return null;
}
return this.iWidget.getViewerObject().getAdvancedServerProperty(_1098);
},initializeShowExpandCollapseIconFlag:function(){
var _1099=this.getAdvancedServerProperty("VIEWER_JS_EXPAND_COLLAPSE_CONTROLS_DEFAULT");
this.bHideExpandCollapseOption=(!_1099);
if(this.bHideExpandCollapseOption){
return;
}
if(this.getShowExpandCollapseIconFlag()===null){
this.setProperty("showExpandCollapseIcon",_1099.toLowerCase()==="on");
}
},initialize:function(_109a){
if(this.isInitialized){
return;
}
this.isInitialized=true;
this.initializeFlashChartSettings(_109a.flashChartOption);
this.initializeShowExpandCollapseIconFlag();
if(this.getRowsPerPage()==null){
if(_109a["run.verticalElements"]!=null){
this.setProperty("rowsPerPage",_109a["run.verticalElements"]);
}else{
this.setProperty("rowsPerPage",20);
}
}
this.initializeDialogSpec();
},createViewReportSpecLink:function(){
var oCV=this.iWidget.getViewerObject();
var _109c=oCV.envParams["ui.spec"];
if(oCV.bCanUseReportStudio&&_109c&&_109c.length>0&&oCV.envParams["ui.action"]!="view"){
return {columns:[{propertyName:"viewReportSpecification",uiElementType:"link",label:RV_RES.IDS_JS_SHOW_REPORT_SPEC,eventHandler:this,onClickAction:dojo.hitch(this,this.onClickViewReportSpecification)}]};
}else{
return {};
}
},isBlackListedOption:function(_109d){
return this.iWidget.getViewerObject().isBlacklisted(_109d);
},createFlashChartOption:function(){
var _109e=[{columns:[{propertyName:"flashCharts",uiElementType:"checkBox",label:RV_RES.IDS_JS_PROPERTY_FLASHCHARTS}]},{columns:[{uiElementType:"hSpacer"}]}];
return _109e;
},getShowExpandCollapseIconOptionSpec:function(){
var spec=[{columns:[{propertyName:"showExpandCollapseIcon",uiElementType:"checkBox",label:RV_RES.IDS_JS_PROPERTY_SHOW_EXPAND_COLLAPSE_ICON}]},{columns:[{uiElementType:"hspacer"}]}];
return spec;
},generateDialogSpec:function(role){
var _10a1;
if(role=="consume"){
_10a1=[{columns:[{propertyName:"rowsPerPage",uiElementType:"textBox",type:"number",label:RV_RES.IDS_JS_PROPERTY_ROWS_PER_PAGE}]}];
this.masterDialogSpec={rows:_10a1};
}else{
var _10a2=this.createViewReportSpecLink();
_10a1=[{columns:[{propertyName:"rowsPerPage",uiElementType:"textBox",type:"number",label:RV_RES.IDS_JS_PROPERTY_ROWS_PER_PAGE,constraints:{min:1,max:1000},required:true,invalidMessage:RV_RES.IDS_JS_PROPERTY_ROWS_PER_PAGE_ERROR}]},{columns:[{uiElementType:"hspacer"}]},{columns:[{propertyName:"promptUserOnLoad",uiElementType:"checkBox",label:RV_RES.IDS_JS_PROPERTY_PROMPT_ON_LOAD}]},{columns:[{propertyName:"retrieveAll",uiElementType:"checkBox",label:RV_RES.IDS_JS_PROPERTY_RETRIEVE_ENTIRE_REPORT}]},_10a2,{columns:[{propertyName:"originalReportLocation",uiElementType:"text",label:this.getOriginalReportLocation(this.iWidget),allowWrapping:true}]}];
if(this.isFlashChartOptionEnabled&&!this.hasAVSChart()&&role!=="consume"){
var _10a3=this.createFlashChartOption();
_10a1=_10a3.concat(_10a1);
}
if(!this.bHideExpandCollapseOption&&!this.isBlackListedOption("ExpandMember")){
_10a1=this.getShowExpandCollapseIconOptionSpec().concat(_10a1);
}
this.masterDialogSpec={rows:_10a1};
}
if(this.masterDialogSpec&&this.masterDialogSpec.rows){
this.masterDialogSpecProperties={};
for(var r in this.masterDialogSpec.rows){
var row=this.masterDialogSpec.rows[r];
if(row.columns){
for(var c in row.columns){
var col=row.columns[c];
if(col.propertyName){
this.masterDialogSpecProperties[col.propertyName]=col;
}
}
}
}
}
},updateDialogSpec:function(){
if(this.masterDialogSpecProperties){
if(this.masterDialogSpecProperties.originalReportLocation){
this.masterDialogSpecProperties.originalReportLocation.label=this.getOriginalReportLocation(this.iWidget);
}
}
},initializeDialogSpec:function(){
var _10a8=this.iWidget.getUserRole();
this.generateDialogSpec(_10a8);
},hasAVSChart:function(){
if(this.iWidget==null||typeof this.iWidget.getViewerObject()=="undefined"){
return false;
}
var oCV=this.iWidget.getViewerObject();
if(typeof oCV=="undefined"){
return false;
}
return oCV.hasAVSChart();
},initializeFlashChartSettings:function(value){
if(!value){
return;
}
var json=(typeof value==="string")?(eval(value)):value;
var _10ac=json[0];
this.setProperty("flashCharts",_10ac.defaultValue);
this.isFlashChartOptionEnabled=!_10ac.isOptionDisabled;
},onClickViewReportSpecification:function(){
var _10ad=this.iWidget.getViewerObject().envParams["ui.spec"];
this._viewSpecInWindow(_10ad);
},_getWindowOptions:function(w,h){
var _10b0="resizable=yes,scrollbars=yes,menubar=no,directories=no,location=no,status=no,toolbar=no,titlebar=no";
var left=(screen.width-w)/2;
var top=(screen.height-h)/2;
_10b0+=",top="+top;
_10b0+=",left="+left;
_10b0+=",width="+w;
_10b0+=",height="+h;
return _10b0;
},_viewSpecInWindow:function(_10b3){
var _10b4=dijit.getViewport();
var _10b5="debugWindow"+this.iWidget.getViewerObject().getId();
var _10b6=this._getWindowOptions(_10b4.w,_10b4.h);
var _10b7=window.open("",_10b5,_10b6);
var head="<html><body><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\">"+"<tbody><tr><td>"+"<textarea wrap=\"off\" style=\"font-family:arial; font-size: 10px; overflow: auto; width:100%; height:";
head+=_10b4.h*0.95;
head+="px;\">";
var tail="</textarea></td></tr></tbody></table></body></html>";
_10b7.document.write(head+html_encode(_10b3)+tail);
}});
dojo.require("bux.reportViewer.Properties");
dojo.provide("ActiveReportIWidgetProperties");
dojo.declare("ActiveReportIWidgetProperties",[bux.reportViewer.Properties],{initializeDialogDisplayValues:function(){
this.dialogDisplayValues={activeReportState:{value:null,canUndo:false,runReport:false}};
},getActiveReportState:function(){
return this.getProperty("activeReportState");
},setActiveReportState:function(_10ba){
this.setProperty("activeReportState",_10ba);
},initialize:function(_10bb){
if(this.isInitialized){
return;
}
this.isInitialized=true;
this.initializeDialogSpec();
},initializeDialogSpec:function(){
var _10bc=[{columns:[{propertyName:"originalReportLocation",uiElementType:"text",label:this.getOriginalReportLocation(this.iWidget),allowWrapping:true}]},{columns:[{propertyName:"ActiveReportOutputVersion",uiElementType:"text",label:this._getAcitveReportOutputVersion(this.iWidget),allowWrapping:true}]}];
if(this.iWidget.isDebugMode()){
_10bc.push({columns:[{propertyName:"PublicVariables",uiElementType:"text",label:this._getPublicVariableNames(this.iWidget),allowWrapping:true}]});
}
this.masterDialogSpec={rows:_10bc};
},_getAcitveReportOutputVersion:function(_10bd){
var _10be=_10bd.getActiveReportOutputVersion();
if(_10be==null){
_10be=RV_RES.IDS_JS_PROPERTY_ACTIVEREPORT_OUTPUT_VERSION_UNAVAILABLE;
}
return (RV_RES.IDS_JS_PROPERTY_ACTIVEREPORT_OUTPUT_VERSION+" "+_10be);
},_getPublicVariableNames:function(_10bf){
var _10c0=_10bf.getPublicVariableNames();
var _10c1="";
for(var name in _10c0){
var sType=_10c0[name];
if(_10c1.length>0){
_10c1+=", ";
}
_10c1+=name;
_10c1+=(sType==="D")?" (Discrete)":"(Range)";
}
if(_10c1.length>0){
_10c1="Public Variables: "+_10c1;
}
return _10c1;
},_getReportWidgetTabTitle:function(){
var _10c4;
if(this.iWidget&&this.iWidget.getViewerObject()){
_10c4=RV_RES.IDS_ACTIVE_REPORT_WIDGET_PROPERTY_TAB_TITLE;
}
return _10c4;
}});
function RAPReportInfo(_10c5,oCV){
this.m_reportInfoJSON=_10c5;
this.m_containerInfoJSON={};
this.m_iContainerCount=0;
this.m_bPromptPart=null;
this.m_bSingleContainer=null;
this.m_bDetailFilteringDisabled=null;
this.m_aDrilledOnHUNs=null;
this.m_bPassTrackingToBUA=null;
this.m_sDisplayTypes=null;
this.m_bContainsInteractiveDataContainer=null;
this.m_bContainsFilters=false;
this.m_bContainsSlider=false;
this.m_referenceInfoObject={};
this.initializeContainerInfo();
this._addNonVisibleReferences(this.m_reportInfoJSON.reportLevelProperties);
this._populateHun(oCV);
};
RAPReportInfo.prototype.initializeContainerInfo=function(){
if(this.m_reportInfoJSON){
var _10c7=this.m_reportInfoJSON.containers;
if(_10c7){
this.m_iContainerCount=_10c7.length;
for(var _10c8=0;_10c8<this.m_iContainerCount;++_10c8){
var _10c9=_10c7[_10c8].container;
this.m_containerInfoJSON[_10c9]=_10c7[_10c8];
this.m_containerInfoJSON[_10c9].m_itemInfoJSON=this._initializeItemInfo(_10c7[_10c8].itemInfo);
this.m_containerInfoJSON[_10c9].m_drillabilityJSON=this._initializeDrillability(_10c7[_10c8].drillability);
this._addFilterReferences(_10c7[_10c8].filter);
this._addSliderReferences(_10c7[_10c8].sliders);
this.m_containerInfoJSON[_10c9].layoutIndex=_10c8;
if(_10c7[_10c8].filter){
this.m_bContainsFilters=true;
}
if(_10c7[_10c8].sliders){
this.m_bContainsSlider=true;
}
}
}
}
};
RAPReportInfo.prototype._initializeItemInfo=function(_10ca){
var _10cb={};
for(var idx in _10ca){
_10cb[_10ca[idx].item]=_10ca[idx];
this.m_referenceInfoObject[_10ca[idx].item]=true;
}
return _10cb;
};
RAPReportInfo.prototype._initializeDrillability=function(_10cd){
var _10ce={};
for(var idx in _10cd){
_10ce[_10cd[idx].item]=_10cd[idx];
this.m_referenceInfoObject[_10cd[idx].item]=true;
}
return _10ce;
};
RAPReportInfo.prototype._addFilterReferences=function(_10d0){
for(var idx in _10d0){
this.m_referenceInfoObject[_10d0[idx].item]=true;
if(_10d0[idx].type==="contextSlice"&&_10d0[idx].hierarchyName){
this.m_referenceInfoObject[_10d0[idx].hierarchyName]=true;
}
}
};
RAPReportInfo.prototype._addSliderReferences=function(_10d2){
for(var idx in _10d2){
this.m_referenceInfoObject[_10d2[idx].name]=true;
}
};
RAPReportInfo.prototype._addNonVisibleReferences=function(_10d4){
if(_10d4&&_10d4.nonVisibleFiltersMemberItemInfo){
for(var i=0;i<_10d4.nonVisibleFiltersMemberItemInfo.length;i++){
this.m_referenceInfoObject[_10d4.nonVisibleFiltersMemberItemInfo[i]]=true;
}
}
};
RAPReportInfo.prototype.isReferenced=function(item){
return (this.m_referenceInfoObject[item])?true:false;
};
RAPReportInfo.prototype.getDrillability=function(_10d7,_10d8){
if(!_10d8){
return this.m_containerInfoJSON[_10d7].m_drillabilityJSON;
}else{
return this.m_containerInfoJSON[_10d7].m_drillabilityJSON[_10d8];
}
};
RAPReportInfo.prototype.getContainers=function(){
return this.m_containerInfoJSON;
};
RAPReportInfo.prototype.getContainer=function(lid){
return this.m_containerInfoJSON[lid];
};
RAPReportInfo.prototype.getContainerIds=function(_10da){
var _10db=[];
for(containerName in this.m_containerInfoJSON){
var _10dc=this.m_containerInfoJSON[containerName];
if(_10dc&&_10dc.displayTypeId==_10da){
_10db.push(_10dc.container);
}
}
return _10db;
};
RAPReportInfo.prototype.getContainerFromPos=function(iPos){
return this.m_reportInfoJSON.containers[iPos];
};
RAPReportInfo.prototype.getReportLevelProperties=function(){
return this.m_reportInfoJSON.reportLevelProperties;
};
RAPReportInfo.prototype.getItemInfo=function(_10de,_10df){
if(!_10df){
return this.m_containerInfoJSON[_10de].m_itemInfoJSON;
}
if(this.m_containerInfoJSON[_10de]){
return this.m_containerInfoJSON[_10de].m_itemInfoJSON[_10df];
}
return null;
};
RAPReportInfo.prototype.isReportLevel_nonVisibleFilterItem=function(_10e0){
if(_10e0&&_10e0.length>0){
var _10e1=this.m_reportInfoJSON.reportLevelProperties;
if(_10e1){
if(_10e1&&_10e1.nonVisibleFiltersMemberItemInfo){
for(var i=0;i<_10e1.nonVisibleFiltersMemberItemInfo.length;i++){
if(_10e0===_10e1.nonVisibleFiltersMemberItemInfo[i]){
return true;
}
}
}
}
}
return false;
};
RAPReportInfo.prototype.isChildContainer=function(lid){
return ((this.m_containerInfoJSON[lid]&&this.m_containerInfoJSON[lid].parentContainer)?true:false);
};
RAPReportInfo.prototype.getItemDetails=function(_10e4,sHun){
var obj=null;
for(var lid in this.m_containerInfoJSON){
var oItem=this.getItemInfo(lid,_10e4);
if(oItem&&oItem.hun===sHun){
obj={};
obj.item=oItem.item;
if(oItem.hun){
obj.hun=oItem.hun;
}
obj.lid=lid;
obj.queryName=oItem.queryName;
break;
}
}
return (obj)?obj:null;
};
RAPReportInfo.prototype.getItemDetailsByHun=function(sHun){
var _10ea=null;
for(var lid in this.m_containerInfoJSON){
var _10ec=this.getItemInfo(lid);
for(var sName in _10ec){
var oItem=_10ec[sName];
if(oItem.hun===sHun){
_10ea=sName;
break;
}
}
}
return (_10ea?this.getItemDetails(_10ea,sHun):null);
};
RAPReportInfo.prototype._populateHun=function(oCV){
if(oCV){
var _10f0=oCV.getSelectionController().getCCDManager();
var _10f1=oCV.envParams;
var _10f2=oCV.getRAPReportInfo();
var _10f3=false;
for(var lid in this.m_containerInfoJSON){
var _10f5=this.m_containerInfoJSON[lid].m_itemInfoJSON;
for(var _10f6 in _10f5){
var oItem=_10f5[_10f6];
if(oItem.hun){
continue;
}
var sHun=this.getHUNForItem(oItem,_10f0,lid,_10f2);
if(sHun){
oItem.hun=sHun;
_10f3=true;
}
}
}
if(_10f3&&typeof JSON!="undefined"&&JSON!=null&&JSON.stringify){
_10f1["rapReportInfo"]=JSON.stringify(this.m_reportInfoJSON);
}
}
};
RAPReportInfo.prototype.getHUNForItem=function(oItem,_10fa,lid,_10fc){
var sHun=this.getHUNFromCCDManager(_10fa,oItem);
var _10fe=null;
if(!sHun&&_10fc){
_10fe=_10fc.getItemInfo(lid,oItem.item);
if(_10fe){
sHun=_10fe.hun;
}
}
return sHun;
};
RAPReportInfo.prototype.getHUNFromCCDManager=function(_10ff,oItem){
var _1101={};
var sHUN=null;
var _1103=this._findQueryMetadataId(_10ff,_1101,oItem.queryName);
if(_1103){
sHUN=_10ff.GetHUNForRDI(oItem.item,_1103);
}
return sHUN;
};
RAPReportInfo.prototype._findQueryMetadataId=function(_1104,oMap,_1106){
if(oMap[_1106]){
return oMap[_1106];
}
var ctxId=_1104.GetMetadataIdForQueryName(_1106);
if(ctxId){
oMap[_1106]=ctxId;
return ctxId;
}
return null;
};
RAPReportInfo.prototype.isPromptPart=function(){
if(this.m_bPromptPart===null){
if(this.m_reportInfoJSON.reportLevelProperties&&this.m_reportInfoJSON.reportLevelProperties.promptWidget===true){
this.m_bPromptPart=true;
}else{
this.m_bPromptPart=false;
}
}
return this.m_bPromptPart;
};
RAPReportInfo.prototype.getContainerCount=function(){
return this.m_iContainerCount;
};
RAPReportInfo.prototype.isSingleContainer=function(){
if(this.m_bSingleContainer===null){
if(this.m_iContainerCount===1&&this.m_reportInfoJSON.reportLevelProperties&&this.m_reportInfoJSON.reportLevelProperties.singleContainerReport===true){
this.m_bSingleContainer=true;
}else{
this.m_bSingleContainer=false;
}
}
return this.m_bSingleContainer;
};
RAPReportInfo.prototype.isDetailFilteringDisabled=function(){
if(this.m_bDetailFilteringDisabled===null){
if(this.m_reportInfoJSON.reportLevelProperties&&this.m_reportInfoJSON.reportLevelProperties.detailFilteringDisabled===true){
this.m_bDetailFilteringDisabled=true;
}else{
this.m_bDetailFilteringDisabled=false;
}
}
return this.m_bDetailFilteringDisabled;
};
RAPReportInfo.prototype.getPassTrackingtoBUA=function(){
if(this.m_bPassTrackingToBUA===null){
if(this.m_reportInfoJSON.reportLevelProperties&&this.m_reportInfoJSON.reportLevelProperties.shouldNotPassTrackingtoBUA===true){
this.m_bPassTrackingToBUA=false;
}else{
this.m_bPassTrackingToBUA=true;
}
}
return this.m_bPassTrackingToBUA;
};
RAPReportInfo.prototype.getDrilledOnHUNs=function(){
if(!this.m_aDrilledOnHUNs&&this.m_reportInfoJSON.reportLevelProperties&&this.m_reportInfoJSON.reportLevelProperties.drilledOnHUNs){
this.m_aDrilledOnHUNs=this.m_reportInfoJSON.reportLevelProperties.drilledOnHUNs;
}
return this.m_aDrilledOnHUNs;
};
RAPReportInfo.prototype.getDisplayTypes=function(_1108){
if(this.m_sDisplayTypes===null||_1108){
var _1109="";
var _110a=[];
for(var lid in this.m_containerInfoJSON){
if(!_1108||lid!=_1108){
_110a.push(this.m_containerInfoJSON[lid].displayTypeId);
}
}
_1109=_110a.join(",");
if(_1109==""&&this.isPromptPart()){
_1109="promptWidget";
}
if(!_1108){
this.m_sDisplayTypes=_1109;
}
return _1109;
}
return this.m_sDisplayTypes;
};
RAPReportInfo.prototype.isChart=function(lid){
var id=lid.toLowerCase();
return id!="mapchart"&&id.match("chart$")=="chart";
};
RAPReportInfo.prototype.isViz=function(lid){
if(this.m_containerInfoJSON[lid]){
var _110f=this.m_containerInfoJSON[lid].displayTypeId;
if(_110f){
return (_110f.toLowerCase()=="viz");
}
}
return false;
};
RAPReportInfo.prototype.isInteractiveDataContainer=function(lid){
var _1111=false;
if(this.m_containerInfoJSON[lid]){
var _1112=this.m_containerInfoJSON[lid].displayTypeId;
if(_1112){
var id=_1112.toLowerCase();
_1111=id=="crosstab"||id=="list"||id=="viz"||this.isChart(id);
}
}
return _1111;
};
RAPReportInfo.prototype.containsInteractiveDataContainer=function(){
if(this.m_bContainsInteractiveDataContainer==null){
this.m_bContainsInteractiveDataContainer=false;
for(var lid in this.m_containerInfoJSON){
if(this.isInteractiveDataContainer(lid)){
this.m_bContainsInteractiveDataContainer=true;
break;
}
}
}
return this.m_bContainsInteractiveDataContainer;
};
RAPReportInfo.prototype.containsFilters=function(){
return this.m_bContainsFilters;
};
RAPReportInfo.prototype.getFilterObject=function(_1115,_1116){
for(var lid in this.m_containerInfoJSON){
var _1118=this.getFilterObjectFromContainer(lid,_1115,_1116);
if(_1118){
return _1118;
}
}
return null;
};
RAPReportInfo.prototype.getFilterObjectFromContainer=function(lid,_111a,_111b){
var _111c=this.m_containerInfoJSON[lid];
if(_111c&&_111c.filter){
var _111d=_111c.filter.length;
for(var i=0;i<_111d;++i){
var _111f=_111c.filter[i];
if(_111a==_111f.item){
if(!_111b||(_111f.itemLabel&&_111f.itemLabel.length>0)){
return _111f;
}
}
}
}
return null;
};
RAPReportInfo.prototype.hunHasFilterOrSlider=function(_1120){
if(!_1120){
return null;
}
for(var lid in this.m_containerInfoJSON){
var _1122=this.m_containerInfoJSON[lid];
if(_1122&&_1122.filter){
var _1123=_1122.filter.length;
for(var i=0;i<_1123;++i){
var _1125=_1122.filter[i];
if(_1125.HUN&&_1120.indexOf(_1125.HUN)==0){
return _1125.item;
}
}
}
if(_1122&&_1122.sliders){
var _1123=_1122.sliders.length;
for(var i=0;i<_1123;++i){
var _1126=_1122.sliders[i];
if(_1126.hun&&_1120.indexOf(_1126.hun)==0){
return _1126.name;
}
}
}
}
return null;
};
RAPReportInfo.prototype.hasSlider=function(){
return this.m_bContainsSlider;
};
RAPReportInfo.prototype.collectSliderSetFromReportInfo=function(){
var _1127={};
for(var lid in this.m_containerInfoJSON){
var _1129=this.m_containerInfoJSON[lid].sliders;
if(_1129){
for(var _112a=0;_112a<_1129.length;++_112a){
var _112b=_1129[_112a].clientId;
_1127[_112b]=_1129[_112a];
}
}
}
return _1127;
};
RAPReportInfo.prototype._getEventTimings=function(){
return (this.m_reportInfoJSON&&this.m_reportInfoJSON.reportLevelProperties&&this.m_reportInfoJSON.reportLevelProperties.eventTimings)?this.m_reportInfoJSON.reportLevelProperties.eventTimings:null;
};
RAPReportInfo.prototype.destroy=function(){
GUtil.destroyProperties(this);
};
function DelayedLoadingContext(id){
this.widgetid=id;
this.m_promptValues=null;
};
DelayedLoadingContext.prototype.setPromptValues=function(_112d){
if(_112d===null){
this.m_promptValues=null;
return;
}
if(!this.m_promptValues){
this.m_promptValues={};
}
applyJSONProperties(this.m_promptValues,_112d);
};
DelayedLoadingContext.prototype.getPromptValues=function(){
return this.m_promptValues;
};
DelayedLoadingContext.prototype.setForceRunReport=function(_112e){
this.m_forceRunReport=_112e;
};
DelayedLoadingContext.prototype.getForceRunReport=function(){
return this.m_forceRunReport;
};
DelayedLoadingContext.prototype.isEmpty=function(){
return !(this.m_promptValues||this.m_forceRunReport);
};
DelayedLoadingContext.prototype.reset=function(){
delete (this.m_promptValues);
this.m_promptValues=null;
this.m_forceRunReport=false;
delete (this._cascadingPromptParamsToClear);
};
DelayedLoadingContext.prototype.setCascadingPromptParamsToClear=function(_112f){
this._cascadingPromptParamsToClear=_112f;
};
DelayedLoadingContext.prototype.getCascadingPromptParamsToClear=function(){
return this._cascadingPromptParamsToClear;
};
function ViewerLoadManager(_1130){
this.m_oWidget=_1130;
this.m_oDelayedLoadingContext=new DelayedLoadingContext();
this.m_aQueue=[];
this.m_fOnEmptyCallback=null;
this.m_bPendingRequest=false;
this.m_bViewerLoadInitiated=false;
this.m_bCanRunReports=false;
};
ViewerLoadManager.prototype.viewerLoadInitiated=function(){
this.m_bViewerLoadInitiated=true;
};
ViewerLoadManager.prototype.isViewerLoadInitiated=function(){
return this.m_bViewerLoadInitiated;
};
ViewerLoadManager.prototype.canRunReports=function(){
return this.m_bCanRunReports;
};
ViewerLoadManager.prototype.runningReport=function(){
if(!this.m_bCanRunReports){
this._queue({fCallback:dojo.hitch(this,function(){
this.m_bCanRunReports=true;
return false;
})});
}
};
ViewerLoadManager.prototype.isViewerReady=function(){
if(!this.isViewerLoaded()){
return false;
}
if(!this._isEmpty()||this.m_fOnEmptyCallback||this.m_bPendingRequest){
return false;
}
return true;
};
ViewerLoadManager.prototype.isViewerLoaded=function(){
var oCV=this.m_oWidget.getViewerObject();
if(!oCV){
return false;
}
if(this.m_oWidget.isLiveReport()){
var _1132=oCV.getStatus();
return _1132==="complete"||_1132==="prompting"||_1132==="fault";
}
return true;
};
ViewerLoadManager.prototype.runWhenHasViewer=function(f,_1134){
if(this.isViewerReady()){
this._run(f);
return true;
}else{
var _1135={fCallback:f};
if(_1134){
_1135.sGroupId=_1134;
}
this._queue(_1135);
if(!this.m_bViewerLoadInitiated){
this.getDelayedLoadingContext().setForceRunReport(true);
this.m_oWidget.setRunReportOption(false);
this.m_oWidget.postReport(null);
}
return false;
}
};
ViewerLoadManager.prototype.processQueue=function(){
this.m_bPendingRequest=false;
var _1136=false;
while(!_1136&&!this._isEmpty()){
var _1137=this.m_aQueue.shift();
while(_1137.sGroupId&&!this._isEmpty()&&this.m_aQueue[0].sGroupId===_1137.sGroupId){
_1137=this.m_aQueue.shift();
}
_1136=this._run(_1137.fCallback);
}
if(this._isEmpty()&&!_1136&&this.m_fOnEmptyCallback){
var _1138=this.m_fOnEmptyCallback;
this.m_fOnEmptyCallback=null;
_1138();
}
};
ViewerLoadManager.prototype._run=function(f){
var _113a=f.call();
if(_113a){
this.m_bPendingRequest=true;
}
return _113a;
};
ViewerLoadManager.prototype._isEmpty=function(){
return !this.m_aQueue.length;
};
ViewerLoadManager.prototype._queue=function(_113b){
this.m_aQueue.push(_113b);
};
ViewerLoadManager.prototype.setOnEmptyCallback=function(_113c){
this.m_fOnEmptyCallback=_113c;
};
ViewerLoadManager.prototype.getDelayedLoadingContext=function(){
return this.m_oDelayedLoadingContext;
};
function XmlHttpObject(){
this.m_formFields=new CDictionary();
this.xmlHttp=XmlHttpObject.createRequestObject();
this.m_requestIndicator=null;
this.m_httpCallbacks={};
this.m_asynch=true;
this.m_headers=null;
};
XmlHttpObject.prototype.setHeaders=function(_113d){
this.m_headers=_113d;
};
XmlHttpObject.prototype.getHeaders=function(){
return this.m_headers;
};
XmlHttpObject.prototype.newRequest=function(){
var _113e=new XmlHttpObject();
_113e.init(this.m_action,this.m_gateway,this.m_url,this.m_asynch);
this.executeHttpCallback("newRequest");
return _113e;
};
XmlHttpObject.prototype.abortHttpRequest=function(){
if(this.xmlHttp!=null){
this.xmlHttp.abort();
this.xmlHttp=null;
this.executeHttpCallback("cancel");
this.m_httpCallbacks={};
}
};
XmlHttpObject.prototype.cancel=function(){
this.abortHttpRequest();
};
XmlHttpObject.prototype.executeHttpCallback=function(_113f){
if(this.m_httpCallbacks&&this.m_httpCallbacks[_113f]){
var _1140=this.concatResponseArguments(this.m_httpCallbacks.customArguments);
var _1141=GUtil.generateCallback(this.m_httpCallbacks[_113f].method,_1140,this.m_httpCallbacks[_113f].object);
_1141();
return true;
}
return false;
};
XmlHttpObject.prototype.setCallbacks=function(_1142){
if(!this.m_httpCallbacks){
this.m_httpCallbacks={};
}
for(callback in _1142){
this.m_httpCallbacks[callback]=_1142[callback];
}
};
XmlHttpObject.prototype.getCallbacks=function(){
return this.m_httpCallbacks;
};
XmlHttpObject.createRequestObject=function(){
var _1143=null;
if(window.XMLHttpRequest){
_1143=new XMLHttpRequest();
}else{
if(window.ActiveXObject){
_1143=new ActiveXObject("Msxml2.XMLHTTP");
}else{
}
}
return _1143;
};
XmlHttpObject.prototype.waitForXmlHttpResponse=function(){
var _1144=this.xmlHttp;
if(_1144&&_1144.readyState===4){
if(_1144.status===200){
this.httpSuccess();
}else{
this.httpError();
}
}else{
}
};
XmlHttpObject.prototype.init=function(_1145,_1146,url,_1148){
this.m_action=_1145;
this.m_gateway=_1146;
this.m_url=url;
this.m_asynch=_1148;
};
XmlHttpObject.prototype.httpSuccess=function(){
this.executeHttpCallback("postHttpRequest");
this.executeHttpCallback("entryComplete");
this.executeHttpCallback("complete");
this.m_httpCallbacks=null;
};
XmlHttpObject.prototype.httpError=function(){
this.executeHttpCallback("entryFault");
this.executeHttpCallback("fault");
this.m_httpCallbacks=null;
};
XmlHttpObject.prototype.forceSynchronous=function(){
this.m_asynch=false;
};
XmlHttpObject.prototype.sendRequest=function(){
this.sendHtmlRequest(this.m_action,this.m_gateway,this.m_url,this.m_asynch);
};
XmlHttpObject.prototype.sendHtmlRequest=function(_1149,_114a,url,async){
var _114d=this.xmlHttp;
if(_114d){
_114d.open(_1149,_114a,async);
if(async){
_114d.onreadystatechange=GUtil.generateCallback(this.waitForXmlHttpResponse,[],this);
}else{
_114d.onreadystatechange=GUtil.generateCallback(this.waitForXmlHttpResponse,[],this);
if(!isIE()){
_114d.onload=GUtil.generateCallback(this.httpSuccess,[],this);
_114d.onerror=GUtil.generateCallback(this.httpError,[],this);
}
}
_114d.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
if(this.m_headers){
for(header in this.m_headers){
_114d.setRequestHeader(header,this.m_headers[header]);
}
}
this.executeHttpCallback("preHttpRequest");
var _114e=this.convertFormFieldsToUrl();
if(url){
_114e+=url;
}
_114d.send(_114e);
}
};
XmlHttpObject.prototype.getResponseXml=function(){
return (this.xmlHttp)?this.xmlHttp.responseXML:null;
};
XmlHttpObject.prototype.getResponseText=function(){
return (this.xmlHttp)?this.xmlHttp.responseText:"";
};
XmlHttpObject.prototype.getResponseHeader=function(item){
return (this.xmlHttp)?this.xmlHttp.getResponseHeader(item):null;
};
XmlHttpObject.prototype.getStatus=function(){
return this.xmlHttp.status;
};
XmlHttpObject.prototype.addFormField=function(name,value){
this.m_formFields.add(name,value);
};
XmlHttpObject.prototype.getFormFields=function(){
return this.m_formFields;
};
XmlHttpObject.prototype.getFormField=function(_1152){
return this.m_formFields.get(_1152);
};
XmlHttpObject.prototype.clearFormFields=function(){
this.m_formFields=new CDictionary();
};
XmlHttpObject.prototype.convertFormFieldsToUrl=function(){
var url="";
var _1154=this.m_formFields.keys();
for(var index=0;index<_1154.length;index++){
if(index>0){
url+="&";
}
url+=encodeURIComponent(_1154[index])+"="+encodeURIComponent(this.m_formFields.get(_1154[index]));
}
return url;
};
XmlHttpObject.prototype.concatResponseArguments=function(_1156){
var _1157=[this];
if(_1156){
_1157=_1157.concat(_1156);
}
return _1157;
};
function AsynchRequest(_1158,_1159){
AsynchRequest.baseConstructor.call(this);
this.m_gateway=_1158;
this.m_webContentRoot=_1159;
this.m_callbacks={};
this.m_soapFault=null;
this.m_faultDialog=null;
this.m_promptDialog=null;
this.m_logonDialog=null;
};
AsynchRequest.prototype=new XmlHttpObject();
AsynchRequest.baseConstructor=XmlHttpObject;
AsynchRequest.prototype.parent=XmlHttpObject.prototype;
AsynchRequest.prototype.getTracking=function(){
return "";
};
AsynchRequest.prototype.getConversation=function(){
return "";
};
AsynchRequest.prototype.getPrimaryAction=function(){
return "";
};
AsynchRequest.prototype.getActionState=function(){
return "";
};
AsynchRequest.prototype.getAsynchStatus=function(){
return "";
};
AsynchRequest.prototype.getResult=function(){
return null;
};
AsynchRequest.prototype.getSoapFault=function(){
return this.m_soapFault;
};
AsynchRequest.prototype.constructFaultEnvelope=function(){
return null;
};
AsynchRequest.prototype.getPromptHTMLFragment=function(){
return "";
};
AsynchRequest.prototype.isRAPWaitTrue=function(){
return false;
};
AsynchRequest.prototype.getRAPRequestCache=function(){
return null;
};
AsynchRequest.prototype.getMainConversation=function(){
return null;
};
AsynchRequest.prototype.getMainTracking=function(){
return null;
};
AsynchRequest.prototype.construct=function(){
};
AsynchRequest.prototype.executeCallback=function(_115a){
if(this.m_callbacks[_115a]){
var _115b=this.concatResponseArguments(this.m_callbacks.customArguments);
var _115c=GUtil.generateCallback(this.m_callbacks[_115a].method,_115b,this.m_callbacks[_115a].object);
_115c();
return true;
}
return false;
};
AsynchRequest.prototype.setCallbacks=function(_115d){
if(!this.m_callbacks){
this.m_callbacks={};
}
for(callback in _115d){
this.m_callbacks[callback]=_115d[callback];
}
};
AsynchRequest.prototype.getCallbacks=function(){
return this.m_callbacks;
};
AsynchRequest.prototype.newRequest=function(){
var _115e=this.construct();
_115e.setHeaders(this.getHeaders());
if(this.getFormFields().exists("b_action")){
_115e.addFormField("b_action",this.getFormField("b_action"));
}
if(this.getFormFields().exists("cv.catchLogOnFault")){
_115e.addFormField("cv.catchLogOnFault",this.getFormField("cv.catchLogOnFault"));
}
_115e.setPromptDialog(this.m_promptDialog);
_115e.setFaultDialog(this.m_faultDialog);
_115e.setLogonDialog(this.m_logonDialog);
_115e.m_asynch=this.m_asynch;
if(this.m_callbacks.newRequest){
var _115f=GUtil.generateCallback(this.m_callbacks.newRequest.method,[_115e],this.m_callbacks.newRequest.object);
_115f();
}
return _115e;
};
AsynchRequest.prototype.success=function(){
var _1160=this.getAsynchStatus();
switch(_1160){
case "stillWorking":
case "working":
this.working();
break;
case "prompting":
this.prompting();
break;
case "fault":
case "complete":
case "conversationComplete":
this.complete();
break;
default:
this.complete();
break;
}
};
AsynchRequest.prototype.setFaultDialog=function(_1161){
if(_1161 instanceof IFaultDialog){
if(typeof console!="undefined"){
console.log("AsynchRequest.prototype.setFaultDialog is deprecated");
}
this.m_faultDialog=_1161;
}else{
if(_1161&&typeof console!="undefined"){
console.log("The parameter faultDialog must be an instance of IFaultDialog");
}
}
};
AsynchRequest.prototype.setPromptDialog=function(_1162){
if(_1162 instanceof IPromptDialog){
if(typeof console!="undefined"){
console.log("AsynchRequest.prototype.setPromptDialog is deprecated");
}
this.m_promptDialog=_1162;
}else{
if(_1162&&typeof console!="undefined"){
console.log("The parameter promptDialog must be an instance of IPromptDialog");
}
}
};
AsynchRequest.prototype.setLogonDialog=function(_1163){
if(_1163 instanceof ILogOnDialog){
if(typeof console!="undefined"){
console.log("AsynchRequest.prototype.setLogonDialog is deprecated");
}
this.m_logonDialog=_1163;
}else{
if(_1163&&typeof console!="undefined"){
console.log("The parameter logOnDialog must be an instance of ILogOnDialog");
}
}
};
AsynchRequest.prototype.resubmitRequest=function(){
var _1164=this.newRequest();
_1164.m_formFields=this.m_formFields;
_1164.sendRequest();
return _1164;
};
AsynchRequest.prototype.sendRequest=function(){
var _1165=this;
var _1166={"complete":{"object":_1165,"method":_1165.successHandler},"fault":{"object":_1165,"method":_1165.errorHandler}};
this.init("POST",this.m_gateway,"",this.m_asynch);
this.executeCallback("preHttpRequest");
this.parent.setCallbacks.call(this,_1166);
this.parent.sendRequest.call(this);
};
AsynchRequest.prototype.errorHandler=function(){
this.executeCallback("postHttpRequest");
this.executeCallback("entryFault");
this.executeCallback("error");
};
AsynchRequest.prototype.successHandler=function(){
this.executeCallback("postHttpRequest");
if(typeof window["AsynchRequestPromptDialog"]!="undefined"&&window["AsynchRequestPromptDialog"]!=null){
window["AsynchRequestPromptDialog"].hide();
window["AsynchRequestPromptDialog"]=null;
}
if(this.getResponseHeader("Content-type").indexOf("text/html")!=-1){
var _1167=this.getResponseText();
if(_1167.indexOf("<ERROR_CODE>CAM_PASSPORT_ERROR</ERROR_CODE>")!=-1){
this.passportTimeout();
}else{
this.executeCallback("entryFault");
if(!this.executeCallback("fault")){
var _1168=window.open("","","height=400,width=500");
if(_1168!=null){
_1168.document.write(_1167);
}
}
}
}else{
this.m_soapFault=this.constructFaultEnvelope();
if(this.m_soapFault!=null){
var _1169=XMLHelper_FindChildByTagName(this.m_soapFault,"CAM",true);
if(_1169!=null&&XMLHelper_FindChildByTagName(_1169,"promptInfo",true)){
this.passportTimeout();
}else{
this.fault();
}
}else{
this.success();
}
}
};
AsynchRequest.prototype.cancel=function(){
this.parent.cancel.call(this);
var _116a=this.getFormField("m_tracking");
if(_116a){
var _116b=new XmlHttpObject();
_116b.init("POST",this.m_gateway,"",false);
if(this.getFormField("cv.outputKey")){
_116b.addFormField("b_action","cvx.high");
_116b.addFormField("cv.outputKey",this.getFormField("cv.outputKey"));
_116b.setHeaders(this.getHeaders());
}else{
_116b.addFormField("b_action","cognosViewer");
}
_116b.addFormField("cv.responseFormat","successfulRequest");
_116b.addFormField("ui.action","cancel");
_116b.addFormField("m_tracking",_116a);
if(this.getFormField("cv.debugDirectory")){
_116b.addFormField("cv.debugDirectory",this.getFormField("cv.debugDirectory"));
}
_116b.sendRequest();
this.executeCallback("cancel");
}
};
AsynchRequest.prototype.working=function(){
this.executeCallback("working");
var _116c=this.newRequest();
_116c.addFormField("m_tracking",this.getTracking());
if(this.getFormField("cv.outputKey")){
_116c.addFormField("cv.outputKey",this.getFormField("cv.outputKey"));
_116c.addFormField("b_action","cvx.high");
}
if(this.isRAPWaitTrue()){
_116c.m_formFields=this.m_formFields;
_116c.addFormField("m_tracking",this.getTracking());
_116c.addFormField("rapWait","true");
var _116d=this.getRAPRequestCache();
if(_116d!==null&&typeof _116d!="undefined"){
_116c.addFormField("rapRequestCache",_116d);
}
var _116e=this.getMainConversation();
if(_116e){
_116c.addFormField("mainConversation",_116e);
}
var _116f=this.getMainTracking();
if(_116f){
_116c.addFormField("mainTracking",_116f);
}
}else{
_116c.addFormField("ui.action","wait");
_116c.addFormField("ui.primaryAction",this.getPrimaryAction());
_116c.addFormField("cv.actionState",this.getActionState());
if(this.getFormField("ui.preserveRapTags")){
_116c.addFormField("ui.preserveRapTags",this.getFormField("ui.preserveRapTags"));
}
if(this.getFormField("ui.backURL")){
_116c.addFormField("ui.backURL",this.getFormField("ui.backURL"));
}
if(this.getFormField("errURL")){
_116c.addFormField("errURL",this.getFormField("errURL"));
}
if(this.getFormField("cv.showFaultPage")){
_116c.addFormField("cv.showFaultPage",this.getFormField("cv.showFaultPage"));
}
if(this.getFormField("cv.catchLogOnFault")){
_116c.addFormField("cv.catchLogOnFault",this.getFormField("cv.catchLogOnFault"));
}
}
if(this.getFormField("bux")){
_116c.addFormField("bux",this.getFormField("bux"));
}
if(this.getFormField("cv.debugDirectory")){
_116c.addFormField("cv.debugDirectory",this.getFormField("cv.debugDirectory"));
}
_116c.sendRequest();
};
AsynchRequest.prototype.prompting=function(){
this.executeCallback("entryComplete");
if(!this.executeCallback("prompting")){
if(this.m_promptDialog!=null){
this.showPromptPage();
}else{
if(typeof console!="undefined"){
console.log("An unhandled prompt response was returned: %o",this.xmlHttp);
}
}
}
this.executeCallback("postEntryComplete");
};
AsynchRequest.prototype.promptPageOkCallback=function(_1170){
var _1171=this.newRequest();
_1171.addFormField("ui.action","forward");
_1171.addFormField("m_tracking",this.getTracking());
_1171.addFormField("ui.conversation",this.getConversation());
_1171.addFormField("ui.primaryAction",this.getPrimaryAction());
_1171.addFormField("cv.actionState",this.getActionState());
for(var _1172 in _1170){
_1171.addFormField(_1172,_1170[_1172]);
}
_1171.sendRequest();
window["AsynchRequestObject"]=null;
};
AsynchRequest.prototype.promptPageCancelCallback=function(){
window["AsynchRequestPromptDialog"].hide();
this.complete();
};
AsynchRequest.prototype.showPromptPage=function(){
window["AsynchRequestObject"]=this;
window["AsynchRequestPromptDialog"]=this.m_promptDialog;
var _1173=this.m_promptDialog.getViewerId()==null?"":"?cv.id="+this.m_promptDialog.getViewerId();
window["AsynchRequestPromptDialog"].initialize(this.m_webContentRoot+"/rv/showStandalonePrompts.html"+_1173,400,400);
window["AsynchRequestPromptDialog"].show();
};
AsynchRequest.prototype.passportTimeout=function(){
this.executeCallback("entryFault");
if(!this.executeCallback("passportTimeout")){
if(this.m_logonDialog!=null){
this.m_logonDialog.show(response.getSoapFault());
}else{
if(typeof console!="undefined"){
console.log("An unhandled passport timeout fault was returned: %o",this.getSoapFault());
}
}
}
};
AsynchRequest.prototype.fault=function(){
this.executeCallback("entryFault");
if(!this.executeCallback("fault")){
if(this.m_faultDialog!=null){
this.m_faultDialog.show(this.getSoapFault());
}else{
if(typeof console!="undefined"){
console.log("An unhandled soap fault was returned: %o",this.getSoapFault());
}
}
}
};
AsynchRequest.prototype.complete=function(){
this.executeCallback("entryComplete");
this.executeCallback("complete");
this.executeCallback("postEntryComplete");
};
AsynchRequest.prototype.getSoapFaultCode=function(){
var _1174=this.constructFaultEnvelope();
if(_1174){
var _1175=XMLHelper_FindChildByTagName(_1174,"faultcode",true);
if(_1175!=null){
return XMLHelper_GetText(_1175);
}
}
return null;
};
AsynchRequest.prototype.getSoapFaultDetailMessageString=function(){
var _1176=this.constructFaultEnvelope();
if(_1176){
var entry=XMLHelper_FindChildByTagName(_1176,"messageString",true);
if(entry!=null){
return XMLHelper_GetText(entry);
}
}
return null;
};
function AsynchDATARequest(_1178,_1179){
AsynchDATARequest.baseConstructor.call(this,_1178,_1179);
this.m_oResponseState=null;
this.m_sResponseState=null;
this.m_endOfStateIdx=-1;
this.cStatePrefix="<xml><state>";
this.cStateSuffix="</state></xml>";
};
AsynchDATARequest.prototype=new AsynchRequest();
AsynchDATARequest.baseConstructor=AsynchRequest;
AsynchDATARequest.prototype.getEndOfStateIdx=function(){
if(this.m_endOfStateIdx==-1){
var _117a=this.getResponseText().substring(0,12);
if(_117a==this.cStatePrefix){
this.m_endOfStateIdx=this.getResponseText().indexOf(this.cStateSuffix);
if(this.m_endOfStateIdx!=-1){
this.m_endOfStateIdx+=this.cStateSuffix.length;
}
}
}
return this.m_endOfStateIdx;
};
AsynchDATARequest.prototype.getResponseStateText=function(){
if(!this.m_sResponseState){
this.getResponseState();
}
return this.m_sResponseState;
};
AsynchDATARequest.prototype.getResponseState=function(){
if(this.m_oResponseState==null&&this.getEndOfStateIdx()!=-1){
this.m_sResponseState=this.getResponseText().substring(this.cStatePrefix.length,this.getEndOfStateIdx()-this.cStateSuffix.length);
if(this.m_sResponseState!=null){
this.m_sResponseState=xml_decode(this.m_sResponseState);
this.m_oResponseState=eval("("+this.m_sResponseState+")");
}
}
return this.m_oResponseState;
};
AsynchDATARequest.prototype.getAsynchStatus=function(){
if(this.getResponseState()!=null&&typeof this.getResponseState().m_sStatus!="undefined"){
return this.getResponseState().m_sStatus;
}
return "unknown";
};
AsynchDATARequest.prototype.getTracking=function(){
if(this.getResponseState()!=null&&typeof this.getResponseState().m_sTracking!="undefined"){
return this.getResponseState().m_sTracking;
}
return "";
};
AsynchDATARequest.prototype.getConversation=function(){
if(this.getResponseState()!=null&&typeof this.getResponseState().m_sConversation!="undefined"){
return this.getResponseState().m_sConversation;
}
return "";
};
AsynchDATARequest.prototype.getPrimaryAction=function(){
if(this.getResponseState()!=null&&typeof this.getResponseState().envParams!="undefined"&&this.getResponseState().envParams["ui.primaryAction"]!="undefined"){
return this.getResponseState().envParams["ui.primaryAction"];
}
return "";
};
AsynchDATARequest.prototype.getActionState=function(){
if(this.getResponseState()!=null&&typeof this.getResponseState().m_sActionState!="undefined"){
return this.getResponseState().m_sActionState;
}
return "";
};
AsynchDATARequest.prototype.getResult=function(){
if(this.getEndOfStateIdx()!=-1){
return this.getResponseText().substring(this.getEndOfStateIdx(),this.getResponseText().length);
}
return "";
};
AsynchDATARequest.prototype.getDebugLogs=function(){
if(this.getResponseState()!=null&&typeof this.getResponseState().debugLogs!="undefined"){
return this.getResponseState().debugLogs;
}
return "";
};
AsynchDATARequest.prototype.getPromptHTMLFragment=function(){
return this.getResult();
};
AsynchDATARequest.prototype.constructFaultEnvelope=function(){
if(this.m_soapFault==null){
var state=this.getResponseState();
if(state!=null){
if(state.m_sSoapFault){
var _117c=state.m_sSoapFault;
this.m_soapFault=XMLBuilderLoadXMLFromString(_117c);
}
}
}
return this.m_soapFault;
};
AsynchDATARequest.prototype.construct=function(){
var _117d=new AsynchDATARequest(this.m_gateway,this.m_webContentRoot);
_117d.setCallbacks(this.m_callbacks);
if(this.getFormFields().exists("cv.responseFormat")){
_117d.addFormField("cv.responseFormat",this.getFormField("cv.responseFormat"));
}else{
_117d.addFormField("cv.responseFormat","data");
}
return _117d;
};
AsynchDATARequest.prototype.getEnvParam=function(param){
var _117f=this.getResponseState();
if(_117f&&typeof _117f.envParams!="undefined"&&typeof _117f.envParams[param]!="undefined"){
return _117f.envParams[param];
}
return null;
};
AsynchDATARequest.prototype.isRAPWaitTrue=function(){
var _1180=this.getEnvParam("rapWait");
if(_1180!=null){
return _1180=="true"?true:false;
}
return false;
};
AsynchDATARequest.prototype.getRAPRequestCache=function(){
return this.getEnvParam("rapRequestCache");
};
AsynchDATARequest.prototype.getMainConversation=function(){
return this.getEnvParam("mainConversation");
};
AsynchDATARequest.prototype.getMainTracking=function(){
return this.getEnvParam("mainTracking");
};
function AsynchJSONRequest(_1181,_1182){
AsynchJSONRequest.baseConstructor.call(this,_1181,_1182);
this.m_jsonResponse=null;
};
AsynchJSONRequest.prototype=new AsynchRequest();
AsynchJSONRequest.baseConstructor=AsynchRequest;
AsynchJSONRequest.prototype.getJSONResponseObject=function(){
if(this.m_jsonResponse==null){
if(this.getResponseHeader("Content-type").indexOf("application/json")!=-1){
var text=this.getResponseText();
if(text!=null){
var _1184=this.removeInvalidCharacters(text);
this.m_jsonResponse=eval("("+_1184+")");
}
}
}
return this.m_jsonResponse;
};
AsynchJSONRequest.prototype.getTracking=function(){
var _1185=this.getJSONResponseObject();
if(_1185){
return _1185.tracking;
}
return "";
};
AsynchJSONRequest.prototype.getConversation=function(){
var _1186=this.getJSONResponseObject();
if(_1186){
return _1186.conversation;
}
return "";
};
AsynchJSONRequest.prototype.getAsynchStatus=function(){
var _1187=this.getJSONResponseObject();
if(_1187){
return _1187.status;
}
return "unknown";
};
AsynchJSONRequest.prototype.getPrimaryAction=function(){
var _1188=this.getJSONResponseObject();
if(_1188){
return _1188.primaryAction;
}
return "";
};
AsynchJSONRequest.prototype.getActionState=function(){
var _1189=this.getJSONResponseObject();
if(_1189){
return _1189.actionState;
}
return "";
};
AsynchJSONRequest.prototype.getDebugLogs=function(){
var _118a=this.getJSONResponseObject();
if(_118a){
return _118a.debugLogs;
}
return "";
};
AsynchJSONRequest.prototype.isRAPWaitTrue=function(){
var _118b=this.getJSONResponseObject();
if(_118b){
return (_118b.rapWait==="true");
}
return false;
};
AsynchJSONRequest.prototype.getRAPRequestCache=function(){
var _118c=this.getJSONResponseObject();
if(_118c){
var _118d=_118c.rapRequestCache;
if(_118d!==null&&typeof _118d!="undefined"){
return _118d;
}
}
return null;
};
AsynchJSONRequest.prototype.getMainConversation=function(){
var _118e=this.getJSONResponseObject();
if(_118e){
return _118e.mainConversation;
}
return null;
};
AsynchJSONRequest.prototype.getMainTracking=function(){
var _118f=this.getJSONResponseObject();
if(_118f){
return _118f.mainTracking;
}
return null;
};
AsynchJSONRequest.prototype.getResult=function(){
var _1190=this.getJSONResponseObject();
if(_1190&&_1190.json){
var _1191=this.removeInvalidCharacters(_1190.json);
return eval("("+_1191+")");
}
return null;
};
AsynchJSONRequest.prototype.removeInvalidCharacters=function(text){
if(text){
text=text.replace(/(\n|\r|\t)+/g,"");
}
return text;
};
AsynchJSONRequest.prototype.getPromptHTMLFragment=function(){
var _1193=this.getJSONResponseObject();
if(_1193&&_1193.promptHTMLFragment){
return _1193.promptHTMLFragment;
}
return "";
};
AsynchJSONRequest.prototype.constructFaultEnvelope=function(){
if(this.m_soapFault==null){
var _1194=this.getJSONResponseObject();
if(_1194.status=="fault"){
this.m_soapFault=XMLBuilderLoadXMLFromString(_1194.fault);
}
}
return this.m_soapFault;
};
AsynchJSONRequest.prototype.construct=function(){
var _1195=new AsynchJSONRequest(this.m_gateway,this.m_webContentRoot);
_1195.setCallbacks(this.m_callbacks);
if(this.getFormFields().exists("cv.responseFormat")){
_1195.addFormField("cv.responseFormat",this.getFormField("cv.responseFormat"));
}else{
_1195.addFormField("cv.responseFormat","asynchJSON");
}
return _1195;
};
function IFaultDialog(){
};
IFaultDialog.prototype.show=function(){
if(typeof console!="undefined"){
console.log("Required method IFaultDialog:show not implemented.");
}
};
IFaultDialog.prototype.handleUnknownHTMLResponse=function(){
if(typeof console!="undefined"){
console.log("Required method IFaultDialog:handlerUnknownHTMLResponse not implemented.");
}
};
function ILogOnDialog(){
};
ILogOnDialog.prototype.show=function(_1196){
if(typeof console!="undefined"){
console.log("Required method ILogOnDialog:show not implemented.");
}
};
ILogOnDialog.prototype.handleUnknownHTMLResponse=function(_1197){
if(typeof console!="undefined"){
console.log("Required method ILogOnDialog:handleUnknownHTMLResponse not implemented.");
}
};
function IPromptDialog(){
};
IPromptDialog.prototype.initialize=function(url,width,_119a){
if(typeof console!="undefined"){
console.log("Required method IModalDialog:initialize not implemented.");
}
};
IPromptDialog.prototype.show=function(){
if(typeof console!="undefined"){
console.log("Required method IModalDialog:show not implemented.");
}
};
IPromptDialog.prototype.hide=function(){
if(typeof console!="undefined"){
console.log("Required method IModalDialog:hide not implemented.");
}
};
function IRequestHandler(){
};
IRequestHandler.prototype.preHttpRequest=function(_119b){
if(typeof console!="undefined"){
console.log("Required method IRequestHandler:preHttpRequest not implemented.");
}
};
IRequestHandler.prototype.postHttpRequest=function(_119c){
if(typeof console!="undefined"){
console.log("Required method IRequestHandler:postHttpRequest not implemented.");
}
};
IRequestHandler.prototype.postComplete=function(_119d){
if(typeof console!="undefined"){
console.log("Required method IRequestHandler:postComplete not implemented.");
}
};
IRequestHandler.prototype.onComplete=function(_119e){
if(typeof console!="undefined"){
console.log("Required method IRequestHandler:onComplete not implemented.");
}
};
IRequestHandler.prototype.onPostEntryComplete=function(_119f){
if(typeof console!="undefined"){
console.log("Required method IRequestHandler:onPostEntryComplete not implemented.");
}
};
IRequestHandler.prototype.onFault=function(_11a0){
if(typeof console!="undefined"){
console.log("Required method IRequestHandler:onFault not implemented.");
}
};
IRequestHandler.prototype.onPrompting=function(_11a1){
if(typeof console!="undefined"){
console.log("Required method IRequestHandler:onPrompting not implemented.");
}
};
IRequestHandler.prototype.onWorking=function(_11a2){
if(typeof console!="undefined"){
console.log("Required method IRequestHandler:onWorking not implemented.");
}
};
IRequestHandler.prototype.setWorkingDialog=function(_11a3){
if(typeof console!="undefined"){
console.log("Required method IRequestHandler:setWorkingDialog not implemented.");
}
};
IRequestHandler.prototype.setRequestIndicator=function(_11a4){
if(typeof console!="undefined"){
console.log("Required method IRequestHandler:setExecutionCursor not implemented.");
}
};
function IRequestIndicator(){
};
IRequestIndicator.prototype.show=function(){
if(typeof console!="undefined"){
console.log("Required method IRequestIndicator:show not implemented.");
}
};
IRequestIndicator.prototype.hide=function(){
if(typeof console!="undefined"){
console.log("Required method IRequestIndicator:hide not implemented.");
}
};
function BaseRequestHandler(oCV){
if(oCV){
this.m_oCV=oCV;
this.m_workingDialog=null;
this.m_requestIndicator=null;
this.m_faultDialog=null;
this.m_logOnDialog=null;
this.m_promptDialog=null;
this.m_httpRequestConfig=this.m_oCV.getConfig()&&this.m_oCV.getConfig().getHttpRequestConfig()?this.m_oCV.getConfig().getHttpRequestConfig():null;
}
};
BaseRequestHandler.prototype=new IRequestHandler();
BaseRequestHandler.prototype.onError=function(_11a6){
};
BaseRequestHandler.prototype.onComplete=function(){
};
BaseRequestHandler.prototype.onPrompting=function(){
};
BaseRequestHandler.prototype.resubmitInSafeMode=function(){
};
BaseRequestHandler.prototype.massageHtmlBeforeDisplayed=function(){
};
BaseRequestHandler.prototype.onPostEntryComplete=function(){
this._processDelayedLoadingQueue();
};
BaseRequestHandler.prototype.getViewer=function(){
return this.m_oCV;
};
BaseRequestHandler.prototype.setDispatcherEntry=function(_11a7){
this.m_oDispatcherEntry=_11a7;
};
BaseRequestHandler.prototype.getDispatcherEntry=function(){
return this.m_oDispatcherEntry;
};
BaseRequestHandler.prototype.processInitialResponse=function(_11a8){
this.updateViewerState(_11a8);
};
BaseRequestHandler.prototype.setLogOnDialog=function(_11a9){
if(_11a9==null){
this.m_logOnDialog=null;
}else{
if(_11a9 instanceof ILogOnDialog){
this.m_logOnDialog=_11a9;
}else{
if(_11a9&&typeof console!="undefined"){
console.log("The parameter logOnDialog must be an instance of ILogOnDialog");
}
}
}
};
BaseRequestHandler.prototype.setWorkingDialog=function(_11aa){
if(_11aa==null){
this.m_workingDialog=null;
}else{
if(this.m_httpRequestConfig&&this.m_httpRequestConfig.getWorkingDialog()){
this.m_workingDialog=this.m_httpRequestConfig.getWorkingDialog();
}else{
if(_11aa instanceof IRequestIndicator){
this.m_workingDialog=_11aa;
}else{
if(_11aa&&typeof console!="undefined"){
console.log("The parameter workingDialog must be an instance of IRequestIndicator");
}
}
}
}
};
BaseRequestHandler.prototype.getWorkingDialog=function(){
return this.m_workingDialog;
};
BaseRequestHandler.prototype.setRequestIndicator=function(_11ab){
if(_11ab==null){
this.m_requestIndicator=null;
}else{
if(this.m_httpRequestConfig&&this.m_httpRequestConfig.getRequestIndicator()){
this.m_requestIndicator=this.m_httpRequestConfig.getRequestIndicator();
}else{
if(_11ab instanceof IRequestIndicator){
this.m_requestIndicator=_11ab;
}else{
if(_11ab&&typeof console!="undefined"){
console.log("The parameter requestIndicator must be an instance of IRequestIndicator");
}
}
}
}
};
BaseRequestHandler.prototype.getRequestIndicator=function(){
return this.m_requestIndicator;
};
BaseRequestHandler.prototype.setFaultDialog=function(_11ac){
if(_11ac==null){
this.m_faultDialog=null;
}else{
if(_11ac instanceof IFaultDialog){
this.m_faultDialog=_11ac;
}else{
if(_11ac&&typeof console!="undefined"){
console.log("The parameter faultDialog must be an instance of IFaultDialog");
}
}
}
};
BaseRequestHandler.prototype.setPromptDialog=function(_11ad){
if(_11ad==null){
this.m_promptDialog=null;
}else{
if(_11ad instanceof IPromptDialog){
this.m_promptDialog=_11ad;
}else{
if(_11ad&&typeof console!="undefined"){
console.log("The parameter promptDialog must be an instance of IPromptDialog");
}
}
}
};
BaseRequestHandler.prototype.preHttpRequest=function(_11ae){
if(_11ae&&typeof _11ae.getFormField=="function"){
if(_11ae.getFormField("ui.action")!="wait"&&_11ae.getFormField("rapWait")!="true"){
if(this.m_requestIndicator){
this.m_requestIndicator.show();
}
}
}
};
BaseRequestHandler.prototype.postHttpRequest=function(_11af){
if(_11af&&typeof _11af.getAsynchStatus=="function"){
var _11b0=_11af.getAsynchStatus();
if(_11b0!="working"&&_11b0!="stillWorking"){
if(this.m_workingDialog){
this.m_workingDialog.hide();
}
if(this.m_requestIndicator){
this.m_requestIndicator.hide();
}
}
}else{
if(this.m_workingDialog){
this.m_workingDialog.hide();
}
if(this.m_requestIndicator){
this.m_requestIndicator.hide();
}
}
};
BaseRequestHandler.prototype.onFault=function(_11b1){
var oCV=this.getViewer();
if(this.m_workingDialog){
this.m_workingDialog.hide();
}
if(this.m_requestIndicator){
this.m_requestIndicator.hide();
}
if(typeof FaultDialog=="undefined"){
if(typeof console!="undefined"){
console.log("An unhandled fault was returned: %o",_11b1);
}
return;
}
if(!this.m_faultDialog){
this.m_faultDialog=new FaultDialog(this.getViewer());
}
if(_11b1&&_11b1.getResponseHeader&&_11b1.getResponseHeader("Content-type").indexOf("text/html")!=-1){
this.m_faultDialog.handleUnknownHTMLResponse(_11b1.getResponseText());
}else{
if(_11b1&&_11b1.getSoapFault){
this.m_faultDialog.show(_11b1.getSoapFault());
}else{
if(oCV.getSoapFault()){
var _11b3=XMLBuilderLoadXMLFromString(oCV.getSoapFault());
this.m_faultDialog.show(_11b3);
oCV.setSoapFault("");
}else{
if(typeof console!="undefined"){
console.log("An unhandled fault was returned: %o",_11b1);
}
}
}
}
};
BaseRequestHandler.prototype.isAuthenticationFault=function(_11b4){
var oCV=this.getViewer();
var _11b6=null;
if(_11b4&&_11b4.getSoapFault){
_11b6=_11b4.getSoapFault();
}else{
if(oCV.getSoapFault()){
_11b6=XMLBuilderLoadXMLFromString(oCV.getSoapFault());
}
}
if(_11b6!=null){
var _11b7=XMLHelper_FindChildByTagName(_11b6,"CAM",true);
return (_11b7!=null&&XMLHelper_FindChildByTagName(_11b7,"promptInfo",true)!=null);
}
return false;
};
BaseRequestHandler.prototype.onPassportTimeout=function(_11b8){
var oCV=this.getViewer();
if(this.m_workingDialog){
this.m_workingDialog.hide();
}
if(this.m_requestIndicator){
this.m_requestIndicator.hide();
}
if(!this.m_logOnDialog){
this.m_logOnDialog=new LogOnDialog(this.getViewer());
}
if(_11b8&&_11b8.getResponseHeader&&_11b8.getResponseHeader("Content-type").indexOf("text/html")!=-1){
this.m_logOnDialog.handleUnknownHTMLResponse(_11b8.getResponseText());
}else{
if(_11b8&&_11b8.getSoapFault){
this.m_logOnDialog.show(_11b8.getSoapFault());
}else{
if(oCV.getSoapFault()){
var _11ba=XMLBuilderLoadXMLFromString(oCV.getSoapFault());
this.m_logOnDialog.show(_11ba);
oCV.setSoapFault("");
}else{
if(typeof console!="undefined"){
console.log("BaseRequestHandler.prototype.onPassportTimeout: An unhandled authentication fault was returned: %o",_11b8);
}
}
}
}
};
BaseRequestHandler.prototype.onWorking=function(_11bb){
if(this.m_workingDialog){
var _11bc=_11bb&&typeof _11bb.getAsynchStatus=="function"&&_11bb.getAsynchStatus()=="stillWorking"?true:false;
if(!_11bc){
if(this.m_requestIndicator){
this.m_requestIndicator.hide();
}
this.m_workingDialog.show();
}
}
};
BaseRequestHandler.prototype.onCancel=function(){
if(this.m_workingDialog){
this.m_workingDialog.hide();
}
if(this.m_requestIndicator){
this.m_requestIndicator.hide();
}
var oCV=this.getViewer();
oCV.gbPromptRequestSubmitted=false;
this._processDelayedLoadingQueue();
};
BaseRequestHandler.prototype._processDelayedLoadingQueue=function(){
var oCV=this.getViewer();
if(oCV&&oCV.getViewerWidget()){
var _11bf=oCV.getViewerWidget();
if(_11bf.getLoadManager()){
_11bf.getLoadManager().processQueue();
}
}
};
BaseRequestHandler.prototype.onPrompting=function(_11c0){
var oCV=this.getViewer();
if(this.m_workingDialog){
this.m_workingDialog.hide();
}
if(this.m_requestIndicator){
this.m_requestIndicator.hide();
}
if(!this.m_promptDialog){
this.m_promptDialog=new PromptDialog(this.getViewer());
}
window["AsynchRequestObject"]=_11c0;
window["AsynchRequestPromptDialog"]=this.m_promptDialog;
var _11c2="?cv.id="+oCV.getId();
window["AsynchRequestPromptDialog"].initialize(oCV.getWebContentRoot()+"/rv/showStandalonePrompts.html"+_11c2,400,400);
window["AsynchRequestPromptDialog"].show();
};
BaseRequestHandler.prototype.processDATAReportResponse=function(_11c3){
var oCV=this.getViewer();
if(!oCV||oCV.m_destroyed){
if(console){
console.warn("Tried to process a data response on an invalid CCognosViewer",oCV);
}
return;
}
var _11c5=_11c3.getResponseState();
if(!_11c5){
this.resubmitInSafeMode();
}
if(this.loadReportHTML(_11c3.getResult())===false){
this.resubmitInSafeMode();
}
this.updateViewerState(_11c5);
};
BaseRequestHandler.prototype.updateViewerState=function(_11c6){
var oCV=this.getViewer();
applyJSONProperties(oCV,_11c6);
var _11c8=oCV.getStatus();
if(typeof oCV.envParams["ui.spec"]!="undefined"&&oCV.envParams["ui.spec"].indexOf("&lt;")===0){
oCV.envParams["ui.spec"]=xml_decode(oCV.envParams["ui.spec"]);
}
if(_11c8!="fault"){
if(oCV.envParams["rapReportInfo"]){
this._processRapReportInfo(oCV);
}
if(typeof _11c6.clientunencodedexecutionparameters!="undefined"){
var _11c9=document.getElementById("formWarpRequest"+oCV.getId());
if(_11c9!=null&&typeof _11c9["clientunencodedexecutionparameters"]!="undefined"){
_11c9["clientunencodedexecutionparameters"].value=_11c6.clientunencodedexecutionparameters;
}
if(typeof document.forms["formWarpRequest"]!="undefined"&&typeof document.forms["formWarpRequest"]["clientunencodedexecutionparameters"]!="undefined"){
document.forms["formWarpRequest"]["clientunencodedexecutionparameters"].value=_11c6.clientunencodedexecutionparameters;
}
}
}else{
oCV.setTracking("");
}
};
BaseRequestHandler.prototype._processRapReportInfo=function(oCV){
if(oCV.envParams["rapReportInfo"]){
var _11cb=eval("("+oCV.envParams["rapReportInfo"]+")");
if(typeof RAPReportInfo!="undefined"){
var _11cc=new RAPReportInfo(_11cb,oCV);
oCV.setRAPReportInfo(_11cc);
}
}
};
BaseRequestHandler.prototype.loadReportHTML=function(_11cd){
var oCV=this.getViewer();
if(window.IBM&&window.IBM.perf){
window.IBM.perf.log("viewer_gotHtml",oCV);
}
if(oCV.m_undoStack.length>0){
oCV.m_undoStack[oCV.m_undoStack.length-1].m_bRefreshPage=true;
}
oCV.pageNavigationObserverArray=[];
oCV.m_flashChartsObjectIds=[];
var sHTML=_11cd.replace(/<form[^>]*>/gi,"").replace(/<\/form[^>]*>/gi,"");
oCV.m_sHTML=sHTML;
oCV.setHasPrompts(false);
var id=oCV.getId();
var _11d1=document.getElementById("RVContent"+id);
var _11d2=document.getElementById("CVReport"+id);
if(sHTML.match(/prompt\/control\.js|PRMTcompiled\.js|prmt_core\.js/gi)){
oCV.setHasPrompts(true);
_11d2.style.display="none";
}
if(window.gScriptLoader){
var _11d3=oCV.getViewerWidget()?true:false;
var _11d4=oCV.getViewerWidget()?document.getElementById("_"+oCV.getViewerWidget().iContext.widgetId+"_cv"):_11d2;
sHTML=window.gScriptLoader.loadCSS(sHTML,_11d4,_11d3,id);
}
if(oCV.sBrowser=="ie"){
sHTML="<span style='display:none'>&nbsp;</span>"+sHTML;
}
_11d2.innerHTML=sHTML;
this.massageHtmlBeforeDisplayed();
if(window.gScriptLoader){
var _11d5=GUtil.generateCallback(oCV.showLoadedContent,[_11d1],oCV);
oCV.m_resizeReady=false;
if(!window.gScriptLoader.loadAll(_11d2,_11d5,id,true)){
if(window.gScriptLoader.containsAjaxWarnings()){
return false;
}
}
}else{
_11d1.style.display="block";
}
oCV.updateOutputForA11ySupport();
this._clearFindState();
return true;
};
BaseRequestHandler.prototype._clearFindState=function(){
var oCV=this.getViewer();
var _11d7=oCV.getState()&&oCV.getState().getFindState()?oCV.getState().getFindState():null;
if(_11d7&&!_11d7.findOnServerInProgress()){
oCV.getState().clearFindState();
}
};
BaseRequestHandler.prototype.showReport=function(){
var oCV=this.getViewer();
var _11d9=document.getElementById("CVReport"+oCV.getId());
if(_11d9){
_11d9.style.display="";
}
};
BaseRequestHandler.prototype.postComplete=function(){
var oCV=this.getViewer();
if(oCV.shouldWriteNavLinks()){
oCV.writeNavLinks(oCV.getSecondaryRequests().join(" "));
}
if(oCV.getStatus()==="complete"){
oCV.m_undoStack=[new CognosViewerSession(oCV)];
}
};
BaseRequestHandler.prototype.onAsynchStatusUpdate=function(_11db){
if(this.m_httpRequestConfig){
var _11dc=this.m_httpRequestConfig.getReportStatusCallback(_11db);
if(_11dc){
_11dc();
}
}
};
BaseRequestHandler.prototype.addCallbackHooks=function(){
if(!this.m_httpRequestConfig){
return;
}
this._addCallback("complete","onComplete");
this._addCallback("working","onWorking");
this._addCallback("prompting","onPrompting");
};
BaseRequestHandler.prototype._addCallback=function(_11dd,_11de){
var _11df=_11dd;
var _11e0=this[_11de];
this[_11de]=function(_11e1){
_11e0.apply(this,arguments);
var _11e2=null;
if(_11e1&&typeof _11e1.getAsynchStatus=="function"){
_11e2=_11e1.getAsynchStatus();
}else{
_11e2=_11df=="complete"?this.getViewer().getStatus():_11df;
}
if(_11e2=="stillWorking"){
return;
}
var _11e3=this.m_httpRequestConfig.getReportStatusCallback(_11e2);
if(typeof _11e3=="function"){
setTimeout(_11e3,10);
}
};
};
dojo.provide("FaultDialog");
dojo.declare("FaultDialog",IFaultDialog,{m_soapFault:null,m_errorMessage:null,m_oCV:null,constructor:function(oCV){
this.m_oCV=oCV;
},show:function(_11e5){
this.m_soapFault=_11e5;
this.m_oCV.m_resizeReady=true;
this.renderInlineDialog();
this.m_oCV.getViewerWidget().setErrorDlg(this);
},handleUnknownHTMLResponse:function(_11e6){
if(_11e6){
var _11e7=window.open("","","height=400,width=500");
if(_11e7!=null){
_11e7.document.write(_11e6);
}
}
},canRetryRequest:function(){
var _11e8=true;
var _11e9=XMLHelper_FindChildrenByTagName(this.m_soapFault,"allowRetry",true);
if(_11e9.length>0){
_11e8=(XMLHelper_GetText(_11e9[0],false)==="true");
}
return _11e8;
},isWarningMessage:function(){
return false;
},getButtons:function(){
var _11ea=[{label:RV_RES.IDS_JS_OK,action:dojo.hitch(this,this.ok)}];
if(this.canRetryRequest()){
_11ea.push({label:RV_RES.IDS_JS_RETRY,action:dojo.hitch(this,this.retry)});
}
return _11ea;
},renderInlineDialog:function(){
var _11eb={"type":this.isWarningMessage()?"warning":"error","message":this.getErrorMessage(),"buttons":this.getButtons()};
var _11ec=this.getDetails();
if(_11ec&&_11ec.length>0){
_11eb.details=_11ec;
}
this.m_oCV.getViewerWidget().fireEvent("com.ibm.bux.widget.notification",null,_11eb);
},setErrorMessage:function(_11ed){
this.m_errorMessage=_11ed;
},getErrorMessage:function(){
if(this.m_errorMessage==null){
var _11ee=XMLHelper_FindChildrenByTagName(this.m_soapFault,"message",true);
if(_11ee.length>0){
var _11ef=XMLHelper_FindChildByTagName(_11ee[0],"messageString",false);
this.checkAndSetErrorMessage(XMLHelper_GetText(_11ef,false));
}
}
return this.m_errorMessage;
},checkAndSetErrorMessage:function(_11f0){
this.m_detailMessageStartIndex=1;
if(_11f0.indexOf("RSV-BBP-0038")==0){
_11f0=RV_RES.IDS_CONV_CANCELED_ERROR;
this.m_detailMessageStartIndex=0;
}
this.m_errorMessage=_11f0;
},getDetails:function(){
var _11f1="";
var _11f2=XMLHelper_FindChildrenByTagName(this.m_soapFault,"message",true);
if(_11f2.length>0){
if(typeof this.m_detailMessageStartIndex==="undefined"||this.m_detailMessageStartIndex===null){
this.m_detailMessageStartIndex=1;
}
for(var _11f3=this.m_detailMessageStartIndex;_11f3<_11f2.length;++_11f3){
var _11f4=XMLHelper_FindChildByTagName(_11f2[_11f3],"messageString",false);
_11f1+=XMLHelper_GetText(_11f4,false)+"\n";
}
}
return _11f1;
},retry:function(){
var _11f5=this.m_oCV.getRetryDispatcherEntry();
this.hide();
if(_11f5){
_11f5.retryRequest();
}else{
var _11f6=this.m_oCV.getViewerWidget().getOriginalFormFields();
if(_11f6&&(_11f6.get("b_action")=="cvx"||_11f6.get("b_action")=="cvx.high")){
_11f6.add("b_action","cognosViewer");
}
this.m_oCV.executeAction("RetryRequest",_11f6);
}
},ok:function(){
var _11f7=this.m_oCV.getRetryDispatcherEntry();
this.hide();
if(_11f7){
_11f7.onCloseErrorDlg();
}
},hide:function(){
this.m_oCV.getViewerWidget().fireEvent("com.ibm.bux.widget.notification",null,{remove:1});
this.m_oCV.getViewerWidget().setErrorDlg(null);
this.m_oCV.setRetryDispatcherEntry(null);
}});
function buxErrorPage_toggleErrorDetails(event,cvId,_11fa){
if((event.button==0&&(event.keyCode=="0"||typeof event.keyCode=="undefined"))||event.keyCode=="32"||event.keyCode=="13"){
var _11fb=document.getElementById("buxErrorPageDetailContentOuter"+cvId);
var _11fc=document.getElementById("buxErrorPageDetails"+cvId);
var _11fd=document.getElementById("titlePaneTitle"+cvId);
var _11fe=(_11fc.style.display=="none");
dojo.removeClass(_11fb,_11fe?"dijitTitlePaneContentOuterClosed":"dijitTitlePaneContentOuterOpen");
dojo.addClass(_11fb,_11fe?"dijitTitlePaneContentOuterOpen":"dijitTitlePaneContentOuterClosed");
dojo.removeClass(_11fd,_11fe?"dijitClose":"dijitOpen");
dojo.addClass(_11fd,_11fe?"dijitOpen":"dijitClose");
_11fc.style.display=_11fe?"":"none";
}
};
function ModalFaultDialog(){
};
ModalFaultDialog.prototype=new FaultDialog();
ModalFaultDialog.prototype.show=function(_11ff){
var _1200="";
var _1201="",_1202="";
var _1203=XMLHelper_FindChildrenByTagName(_11ff,"message",true);
if(_1203.length>0){
for(var _1204=1;_1204<_1203.length;++_1204){
_1202=XMLHelper_FindChildByTagName(_1203[_1204],"messageString",false);
_1200+=XMLHelper_GetText(_1202,false)+"\n";
}
_1202=XMLHelper_FindChildByTagName(_1203[0],"messageString",false);
_1201=XMLHelper_GetText(_1202,false);
}
bux.messageBox(bux.MB_ERROR,_1201,"",_1200);
};
dojo.provide("GlobalPromptFaultDialog");
dojo.require("FaultDialog");
dojo.declare("GlobalPromptFaultDialog",FaultDialog,{m_sendRequestOnOK:false,setSendRequestOnOK:function(_1205){
this.m_sendRequestOnOK=_1205;
},ok:function(){
this.hide();
this.m_oCV.getViewerWidget().disableListenToForGlobalPrompt();
if(this.m_sendRequestOnOK){
var _1206=this.m_oCV.getRetryDispatcherEntry();
var _1207=null;
if(_1206){
_1207=_1206.getOriginalFormFields();
}else{
_1207=this.m_oCV.getViewerWidget().getOriginalFormFields();
}
if(_1207&&_1207.exists("widget.globalPromptInfo")){
_1207.remove("widget.globalPromptInfo");
}
this.retry();
}
}});
dojo.provide("FaultMessageDialog");
dojo.declare("FaultMessageDialog",FaultDialog,{m_oCV:null,m_errorMessage:"",constructor:function(oCV,_1209){
this.m_errorMessage=_1209;
},getErrorMessage:function(){
return this.m_errorMessage;
},getDetails:function(){
return "";
},canRetryRequest:function(){
return false;
}});
dojo.provide("WarningMessageDialog");
dojo.declare("WarningMessageDialog",FaultMessageDialog,{constructor:function(oCV,_120b){
},isWarningMessage:function(){
return true;
}});
function LogOnDialog(oCV){
if(oCV){
this.m_oCV=oCV;
}
};
LogOnDialog.prototype=new ILogOnDialog();
LogOnDialog.prototype.getViewer=function(){
return this.m_oCV;
};
LogOnDialog.prototype.handleUnknownHTMLResponse=function(_120d){
this.show(null);
};
LogOnDialog.prototype.show=function(_120e){
var _120f=this.getPromptInfoNamespacesFromAuthenticationFault(_120e);
if(window["CVEditContentActionInstance"]){
window["CVEditContentActionInstance"].transitionFromBUA();
}
IWidgetLogonhandler.handleLogon(this.getViewer().getId(),_120f);
};
LogOnDialog.prototype.getPromptInfoNamespacesFromAuthenticationFault=function(_1210){
if(!_1210){
return null;
}
var _1211=XMLHelper_FindChildByTagName(_1210,"CAM",true);
if(_1211==null){
return null;
}
var _1212=XMLHelper_FindChildByTagName(_1211,"promptInfo",true);
if(_1212==null){
return null;
}
var _1213=XMLHelper_FindChildByTagName(_1211,"displayObjects",true);
if(_1213==null){
return null;
}
var items=XMLHelper_FindChildrenByTagName(_1213,"item",true);
if(items==null||items.length!=1){
return null;
}
var _1215=items[0];
if(_1215==null){
return null;
}
var _1216=XMLHelper_FindChildByTagName(_1215,"name",true);
var name=XMLHelper_GetText(_1216,false);
if(name==="CAMNamespace"){
var _1218=XMLHelper_FindChildByTagName(_1215,"value",true);
var value=XMLHelper_GetText(_1218,false);
if(value!=null){
return value;
}
}
return null;
};
dojo.provide("LogOnHandler");
dojo.declare("LogOnHandler",null,{constructor:function(){
this.m_cvIdList=[];
},handleLogon:function(cvId,_121b){
this.m_cvIdList.push(cvId);
if(this.m_cvIdList.length==1){
dojo["require"]("bux.dialogs.IFrameDialog");
var _121c=(_121b==null||_121b.length==0)?new bux.dialogs.LogonDialog({okHandler:GUtil.generateCallback(this.okHandler,[],this),cancelHandler:GUtil.generateCallback(this.cancelHandler,[],this)}):new bux.dialogs.LogonDialog({okHandler:GUtil.generateCallback(this.okHandler,[],this),cancelHandler:GUtil.generateCallback(this.cancelHandler,[],this),params:{"h_CAM_action":"logonAs","CAMNamespace":_121b}});
_121c.startup();
_121c.show();
}
},okHandler:function(){
for(var index=0;index<this.m_cvIdList.length;++index){
var cvId=this.m_cvIdList[index];
var oCV=window["oCV"+cvId];
if(index===0&&oCV.getViewerWidget){
oCV.getViewerWidget().fireEvent("com.ibm.bux.widget.action",null,{action:"refreshAfterLogon"});
}
if(oCV.getRetryDispatcherEntry()){
oCV.getRetryDispatcherEntry().retryRequest();
}else{
var _1220=oCV.getViewerWidget().getOriginalFormFields();
if(_1220){
oCV.executeAction("RetryRequest",_1220);
}
}
}
this.m_cvIdList=[];
},cancelHandler:function(){
for(var index=0;index<this.m_cvIdList.length;++index){
var cvId=this.m_cvIdList[index];
var oCV=window["oCV"+cvId];
if(oCV.getRetryDispatcherEntry()){
oCV.getRetryDispatcherEntry().onCloseErrorDlg();
}
}
this.m_cvIdList=[];
}});
IWidgetLogonhandler=new LogOnHandler();
function PromptDialog(oCV){
this.m_oCV=oCV;
this.m_url="";
this.m_width=0;
this.m_height=0;
this.m_dialogImpl=null;
};
PromptDialog.prototype=new IPromptDialog();
PromptDialog.prototype.initialize=function(url,width,_1227){
this.m_url=url;
this.m_width=width;
this.m_height=_1227;
};
PromptDialog.prototype.show=function(){
this.m_dialogImpl=new bux.dialogs.IFrameDialog();
this.m_dialogImpl.src=this.m_url;
this.m_dialogImpl.width=this.m_width;
this.m_dialogImpl.height=this.m_height;
this.m_dialogImpl.startup();
this.m_dialogImpl.show();
};
PromptDialog.prototype.hide=function(){
this.m_dialogImpl.hide();
this.m_dialogImpl.destroy();
delete this.m_dialogImpl;
this.m_dialogImpl=null;
};
function RequestHandler(oCV){
if(oCV){
RequestHandler.baseConstructor.call(this,oCV);
this.m_originalFormFields=null;
this.m_forceRaiseSharePrompt=false;
}
};
RequestHandler.prototype=new BaseRequestHandler();
RequestHandler.baseConstructor=BaseRequestHandler;
RequestHandler.prototype.parent=BaseRequestHandler.prototype;
RequestHandler.prototype.postHttpRequest=function(_1229){
var oCV=this.getViewer();
this.parent.postHttpRequest.call(this,_1229);
};
RequestHandler.prototype.setForceRaiseSharePrompt=function(bFlag){
this.m_forceRaiseSharePrompt=bFlag;
};
RequestHandler.prototype.preHttpRequest=function(_122c){
var oCV=this.getViewer();
var _122e=oCV.getViewerWidget();
oCV.setCurrentNodeFocus(null);
if(this.doRaiseSharePromptEvent(_122c)){
if(oCV.widgetHasPromptParameters()){
this.setRequestIndicator(new BaseRequestExecutedIndicator(oCV));
var _122f=this.getListOfCascadingPromptParametersToReset(oCV,_122c);
oCV.raisePromptEvent(oCV.envParams["reportPrompts"],_122c.getFormFields(),_122f);
}else{
if(!(_122e&&_122e.promptParametersRetrieved==true)){
var _1230=oCV.getAction("GetParameters");
_1230.isPrimaryPromptWidget=true;
_1230.execute();
}
}
}
oCV.resetRaiseSharePromptEventFlag();
this.parent.preHttpRequest.call(this,_122c);
};
RequestHandler.prototype.getListOfChangedPromptParameters=function(oCV,_1232){
var _1233=oCV.getOldParameters();
if(!_1233){
return null;
}
var _1234=[];
for(var _1235 in _1233){
oldParmValueItems=_1233[_1235].m_parmValueItems;
var _1236=_1232.getFormFields().get("p_"+_1235);
if(!_1236){
continue;
}
for(var j=0;j<oldParmValueItems.length;++j){
var _1238=sXmlEncode(oldParmValueItems[j].m_useValue);
if(_1236.indexOf(_1238)<0){
_1234.push("p_"+_1235);
}
}
}
return _1234;
};
RequestHandler.prototype.getListOfCascadingPromptParametersToReset=function(oCV,_123a){
if(!oCV.preProcessControlArray){
return null;
}
var _123b=this.getListOfChangedPromptParameters(oCV,_123a);
if(!_123b||!_123b.length){
return null;
}
var _123c=[];
var _123d=oCV.preProcessControlArray.length;
var _123e=_123b.slice();
for(var k=0;k<_123d;k++){
var _1240=(oCV.preProcessControlArray[k]);
if(!_1240.getCascadeOnParameter){
return;
}
var _1241=_1240.getCascadeOnParameter();
if(!_1241){
continue;
}
var _1242=_1240.getParameterName();
var _1243=_1241.getName();
if(this.contains(_123e,_1243)&&!this.contains(_123e,_1242)){
_123e.push(_1242);
_123c.push(_1242);
}
}
return _123c;
};
RequestHandler.prototype.contains=function(a,obj){
var i=a.length;
while(i--){
if(a[i]===obj){
return true;
}
}
return false;
};
RequestHandler.prototype.doRaiseSharePromptEvent=function(_1247){
var oCV=this.getViewer();
var _1249=false;
var _124a=_1247.getFormField("ui.action");
if(((typeof _124a!=="undefined"&&(_124a==="forward"||_124a==="back"))&&oCV.m_raiseSharePromptEvent)||this.m_forceRaiseSharePrompt){
_1249=true;
var _124b=null;
var _124c=false;
var _124d=0;
var _124e=_1247.getFormFields();
var keys=_124e.keys();
for(_124b in keys){
_124b=keys[_124b];
if(_124b=="_promptControl"&&_124e.get(_124b)=="search"){
_1249=false;
break;
}else{
if(_124b.indexOf("p_")===0){
if(_124b.indexOf("p_credential:")===0){
_124c=true;
}else{
_124d+=1;
}
}
}
}
if(_1249&&_124c&&_124d===0){
_1249=false;
}
}
return _1249;
};
RequestHandler.prototype.onComplete=function(_1250){
var oCV=this.getViewer();
if(oCV&&!oCV.m_destroyed){
this.parent.onComplete.call(this,_1250);
this.processDATAReportResponse(_1250);
this.postComplete();
}else{
if(console){
console.warn("Tried to complete a request on an invalid CCognosViewer",oCV);
}
}
};
RequestHandler.prototype.onPrompting=function(_1252){
var oCV=this.getViewer();
if(oCV&&!oCV.m_destroyed){
var _1254=oCV.getViewerWidget();
_1254.hideToolbarAndContextMenu();
this.onComplete(_1252);
}else{
if(console){
console.warn("Tried to prompt on an invalid CCognosViewer",oCV);
}
}
};
RequestHandler.prototype.onError=function(_1255){
var oCV=this.getViewer();
if(_1255&&oCV){
var _1257=oCV.getViewerWidget();
if(typeof console!="undefined"&&console&&console.log){
console.log("Viewer http error: "+_1255.getResponseText()+" "+_1255.getStatus());
}
_1257.fireEvent("com.ibm.bux.widget.action",null,{action:"httpError",responseText:_1255.getResponseText(),status:_1255.getStatus()});
}
};
RequestHandler.prototype.onFault=function(_1258){
var oCV=this.getViewer();
var _125a=oCV.getViewerWidget();
var _125b=oCV.getRetryDispatcherEntry();
if(_125b&&_125b.getOriginalFormFields()){
this.m_originalFormFields=_125b.getOriginalFormFields();
}else{
this.m_originalFormFields=_125a.getOriginalFormFields();
}
if(window["gReportWidgetLoadQueue"]){
window["gReportWidgetLoadQueue"].widgetDoneLoading(_125a);
}
if(this.isGlobalPromptException()){
this.handleGlobalPromptException();
}
if(this.isMissingMemberException(oCV,_1258)){
this.handleMissingMemberException(oCV);
}
if(oCV.envParams&&oCV.envParams["updateToolbar"]==="true"){
_125a.savedOutputMenuUpdated=false;
_125a.updateToolbar();
}
if(oCV.envParams&&oCV.envParams["ui.action"]==="buxView"){
_125a.setSavedOutputsCMResponse(null);
}
if(typeof _125a.postOnFault=="function"){
_125a.postOnFault();
}
this.parent.onFault.call(this,_1258);
if(_125b&&_1258&&_1258.getResponseState){
var _125c=_1258.getResponseState();
if(_125c){
this.updateViewerState(_125c);
}
this.onPostEntryComplete();
}
};
RequestHandler.prototype.handleGlobalPromptException=function(){
var oCV=this.getViewer();
var _125e=new GlobalPromptFaultDialog(oCV);
oCV.disableRaiseSharePromptEvent();
if(this.m_originalFormFields&&!this.m_originalFormFields.exists("sharedPromptRequest")){
_125e.setSendRequestOnOK(true);
}
_125e.setErrorMessage(RV_RES.IDS_JS_GLOBAL_PROMPTS_NOT_RESPONDING_WARNING);
this.setFaultDialog(_125e);
};
RequestHandler.prototype.isGlobalPromptException=function(){
var oCV=this.getViewer();
if(this.m_originalFormFields){
if(this.m_originalFormFields.exists("sharedPromptRequest")||(this.m_originalFormFields.get("ui.reportDrop")==="true"&&this.m_originalFormFields.exists("widget.globalPromptInfo"))){
return true;
}
}
return false;
};
RequestHandler.prototype.postComplete=function(){
var oCV=this.getViewer();
if(oCV.getStatus()=="complete"&&!oCV.inlineScriptsDoneExecuting){
var _1261=this;
setTimeout(function(){
_1261.postComplete();
},10);
return;
}
this.parent.postComplete.call(this);
if(oCV&&oCV.m_destroyed){
if(console){
console.warn("Tried to postComplete on an invalid CCognosViewer",oCV);
}
return;
}
var _1262=oCV.getViewerWidget();
if(window["gReportWidgetLoadQueue"]){
window["gReportWidgetLoadQueue"].widgetDoneLoading(_1262);
}
this.showReport();
oCV.getSelectionController().clearSelectionData();
oCV.addPageAdornments();
_1262.savedOutputMenuUpdated=false;
if(oCV.getStatus()!="prompting"){
_1262.fetchAnnotationData();
_1262.getUndoRedoQueue().add({"reportUpdated":true});
}
_1262.updateToolbar();
oCV.m_stateSet=true;
oCV.doneLoading();
if(typeof _1262.postComplete=="function"){
_1262.postComplete();
}
};
RequestHandler.prototype.updateViewerState=function(_1263){
var oCV=this.getViewer();
if(oCV&&oCV.m_destroyed){
if(console){
console.warn("Tried to update state on an invalid CCognosViewer",oCV);
}
return;
}
this.parent.updateViewerState.call(this,_1263);
var _1265=oCV.getStatus();
if(_1265!="fault"){
if(oCV.envParams["buxToolbarPayload"]){
oCV.setToolbar(eval(oCV.envParams["buxToolbarPayload"]));
delete oCV.envParams["buxToolbarPayload"];
}
if(oCV.envParams["buxContextMenuPayload"]){
oCV.setContextMenu(eval(oCV.envParams["buxContextMenuPayload"]));
delete oCV.envParams["buxContextMenuPayload"];
}
if(oCV.envParams.reportPrompts){
oCV.getViewerWidget().setPromptParametersRetrieved(true);
}
if(oCV.envParams.reRunObject){
var _1266=document.getElementById("formWarpRequest"+oCV.getId());
if(_1266["reRunObj"]){
_1266["reRunObj"].value=oCV.envParams.reRunObject;
}else{
_1266.appendChild(createHiddenFormField("reRunObj",oCV.envParams.reRunObject));
}
}
}
};
RequestHandler.prototype.processInitialResponse=function(_1267){
var oCV=this.getViewer();
var _1269=oCV.getViewerWidget();
if(_1269!=null){
if(_1269.shouldUseSavedReportInfo()){
oCV.envParams["rapReportInfo"]=_1269.getAttributeValue("rapReportInfo");
}
this.parent.processInitialResponse.call(this,_1267);
_1269.fireEvent("com.ibm.bux.widget.render.done",null,{noAutoResize:true});
this.getViewer().renderTabs();
oCV.getPinFreezeManager().fromJSONString(_1269.getAttributeValue("PinFreezeInfo"));
var _126a=oCV.getStatus();
if(_126a!="working"&&_126a!="stillWorking"){
delete oCV.envParams["cv.outputKey"];
_1269.setXNodeId(null);
}
switch(_126a){
case "complete":
_1269.setOriginalFormFields(null);
this.postComplete();
break;
case "working":
case "stillWorking":
oCV.getWorkingDialog().show();
setTimeout(getCognosViewerObjectRefAsString(oCV.getId())+".executeCallback(\"wait\");",10);
break;
case "prompting":
_1269.hideToolbarAndContextMenu();
break;
case "fault":
if(this.isAuthenticationFault()){
this.onPassportTimeout();
}else{
this.onFault();
}
}
this.showReport();
this.onPostEntryComplete();
oCV.m_stateSet=true;
this.onAsynchStatusUpdate(_126a);
}else{
var _126b=this;
setTimeout(function(){
_126b.processInitialResponse(_1267);
},100);
}
};
RequestHandler.prototype.onPostEntryComplete=function(){
var oCV=this.getViewer();
if(oCV&&oCV.getViewerWidget()){
var _126d=oCV.getViewerWidget();
_126d.getLoadManager().processQueue();
}
};
RequestHandler.prototype.isMissingMemberException=function(oCV,_126f){
if(oCV.bMissingMemberException){
return true;
}
if(_126f&&_126f.getResponseState){
var _1270=_126f.getResponseState();
if(_1270&&_1270.envParams&&_1270.envParams.bMissingMemberException){
this._populateMissingMemberDetails(oCV,_1270);
return true;
}
}
return false;
};
RequestHandler.prototype._populateMissingMemberDetails=function(oCV,_1272){
if(!oCV||!_1272||!_1272.envParams){
return;
}
oCV.bCanEditContent=_1272.envParams.bCanEditContent;
oCV.bHasParameters=_1272.envParams.bHasParameters;
if(_1272.envParams["ui.spec"]){
if(oCV.envParams){
if(!oCV.envParams["ui.spec"]){
oCV.envParams["ui.spec"]=xml_decode(_1272.envParams["ui.spec"]);
}
}
}
};
RequestHandler.prototype.handleMissingMemberException=function(oCV){
var _1274=null;
_1274=(oCV.bCanEditContent)?RV_RES.IDS_JS_MISSING_MEMBER_ERROR_MSG_FOR_SPEC_PARAM:RV_RES.IDS_JS_MISSING_MEMBER_ERROR_MSG_WITH_NO_BUA;
var _1275=new MissingMemberFaultDialog(oCV,_1274,oCV.bCanEditContent,oCV.bHasParameters);
this.setFaultDialog(_1275);
};
RequestHandler.prototype.massageHtmlBeforeDisplayed=function(){
var oCV=this.getViewer();
if(!oCV){
return;
}
var _1277=oCV.getViewerWidget();
if(!_1277){
return;
}
_1277.updateDrillThroughLinks();
};
function BaseRequestExecutedIndicator(oCV){
this.m_oCV=oCV;
if(oCV){
this.m_oCVId=oCV.getId();
if(oCV.getViewerWidget()){
this.m_background=oCV.getViewerWidget().getReportBlocker();
}
}
};
BaseRequestExecutedIndicator.prototype=new IRequestIndicator();
BaseRequestExecutedIndicator.prototype.getViewer=function(){
return this.m_oCV;
};
BaseRequestExecutedIndicator.prototype.show=function(){
this.m_background.setClassNameOverride("report-blocker");
this.m_background.show();
};
BaseRequestExecutedIndicator.prototype.hide=function(){
if(this.m_background){
this.m_background.hide();
}
};
function RequestExecutedIndicator(oCV){
RequestExecutedIndicator.baseConstructor.call(this,oCV);
};
RequestExecutedIndicator.prototype=new BaseRequestExecutedIndicator();
RequestExecutedIndicator.baseConstructor=BaseRequestExecutedIndicator;
RequestExecutedIndicator.prototype.parent=BaseRequestExecutedIndicator.prototype;
RequestExecutedIndicator.prototype.show=function(){
var oCV=this.getViewer();
var cvid=oCV.getId();
var _127c=document.getElementById("executionCursor"+cvid);
var _127d=document.getElementById("formWarpRequest"+cvid);
if(!_127c&&_127d){
_127c=document.createElement("span");
_127c.className="executionCursor";
_127c.setAttribute("id","executionCursor"+cvid);
var _127e="<img alt=\"\" src=\""+oCV.getWebContentRoot()+"/rv/images/action_busy_32x32.gif"+"\"/>";
_127c.innerHTML=_127e;
_127d.appendChild(_127c);
}
this.parent.show.call(this);
};
RequestExecutedIndicator.prototype.hide=function(){
var _127f=document.getElementById("executionCursor"+this.getViewer().getId());
if(_127f!=null){
_127f.parentNode.removeChild(_127f);
}
this.parent.hide.call(this);
};
dojo.provide("WorkingDialog");
dojo.declare("WorkingDialog",IRequestIndicator,{constructor:function(oCV){
this.m_oCV=oCV;
this.m_sNamespace=oCV.getId();
this.m_sGateway=oCV.getGateway();
try{
var _1281=[];
if(oCV.getAdvancedServerProperty("VIEWER_JS_HIDE_CANCEL_BUTTON")!="true"){
_1281.push({"class":"icdDialogButton",label:RV_RES.CANCEL,onClick:dojo.hitch(this,this.doCancel)});
}
this.m_waitPageDialog=new ViewerIWidgetInlineDialog(this.getCognosViewer(),this.getWaitPageHTML(),_1281,"waitButtonContainer_"+this.getCognosViewer().getId());
}
catch(e){
if(console&&console.log){
console.log(e);
}
}
},setSimpleWorkingDialogFlag:function(flag){
},getCognosViewer:function(){
return this.m_oCV;
},show:function(){
this.m_waitPageDialog.show();
},getWaitPageHTML:function(){
var id=this.getCognosViewer().getId();
return "<table cellspacing=\"4\" cellpadding=\"0\" border=\"0\" wairole=\"presentation\" role=\"presentation\" style=\"width:100%;height:100%\">"+"<tbody><tr><td align=\"center\">"+"<div class=\"dijitInline widget_load_background\" role=\"presentation\" tabindex=\"0\">"+"<div id=\"working"+id+"\" class=\"widget_load\" aria-labelledby=\"working"+id+"\">"+RV_RES.IDS_JS_WAIT_PAGE_LOADING+"</div>"+"<div id=\"waitButtonContainer_"+id+"\" class=\"icdDialogButtonBar\" style=\"text-align:center;padding-left:12px;padding-right:12px;\"></div>"+"</div>"+"</td></tr></tbody>"+"</table>";
},hide:function(){
this.m_waitPageDialog.hide();
this.m_cancelCallback=null;
},setCancelCallback:function(_1284){
this.m_cancelCallback=_1284;
},doCancel:function(){
var oCV=this.getCognosViewer();
if(this.m_cancelCallback){
this.m_cancelCallback();
this.m_cancelCallback=null;
}else{
var _1286=oCV.cancel();
if(_1286){
var _1287=oCV.getViewerWidget().getUndoRedoQueue();
if(_1287){
_1287.handleCancel();
}
}
}
if(oCV.isReportRenderingDone()){
this.hide();
}else{
var _1288={action:"deleteWidget"};
oCV.getViewerWidget().iContext.iEvents.fireEvent("com.ibm.bux.widget.action",null,_1288);
}
}});
dojo.provide("ModalFaultMessageDialog");
dojo.declare("ModalFaultMessageDialog",IFaultDialog,{m_errorMessage:"",m_errorDetails:"",constructor:function(_1289,_128a){
this.m_errorMessage=_1289;
this.m_errorDetails=_128a;
},getErrorMessage:function(){
return this.m_errorMessage;
},getDetails:function(){
return this.m_errorDetails;
},show:function(){
bux.messageBox(bux.MB_ERROR,this.getErrorMessage(),"",this.getDetails());
}});
dojo.provide("MissingMemberFaultDialog");
dojo.declare("MissingMemberFaultDialog",FaultDialog,{m_oCV:null,m_errorMessage:null,m_bHasBUACapability:false,m_bHasParameters:false,constructor:function(oCV,_128c,_128d,_128e){
this.m_errorMessage=_128c;
this.m_bHasBUACapability=_128d;
this.m_bHasParameters=_128e;
},getErrorMessage:function(){
return this.m_errorMessage;
},canRetryRequest:function(){
return false;
},getButtons:function(){
var _128f=[];
if(this.m_bHasBUACapability){
_128f.push({label:RV_RES.IDS_JS_EDIT,action:dojo.hitch(this,this.invokeEditContentAction)});
}
_128f.push({label:RV_RES.IDS_JS_CLOSE,action:dojo.hitch(this,this.ok)});
return _128f;
},invokeEditContentAction:function(){
var _1290={};
_1290.oFaultDialog=this;
_1290.bHasParameters=this.m_bHasParameters;
this.m_oCV.executeAction("EditContent",{"MissingMemberRecoveryMode":_1290});
}});
function ViewerDispatcher(){
this.m_activeRequest=null;
this.m_requestQueue=[];
this.m_bUsePageRequest=false;
};
ViewerDispatcher.prototype.getActiveRequest=function(){
return this.m_activeRequest;
};
ViewerDispatcher.prototype.setUsePageRequest=function(_1291){
this.m_bUsePageRequest=_1291;
};
ViewerDispatcher.prototype.getUsePageRequest=function(){
return this.m_bUsePageRequest;
};
ViewerDispatcher.prototype.dispatchRequest=function(_1292){
if(this.m_activeRequest==null){
this.startRequest(_1292);
}else{
if(_1292.canBeQueued()==true){
this.m_requestQueue.push(_1292);
}else{
if(window.cognosViewerDebug&&console&&console.warn){
console.warn("Warning! Dropped a dispatcher entry!");
}
}
}
};
ViewerDispatcher.prototype.startRequest=function(_1293){
this.m_activeRequest=_1293;
if(_1293!=null){
_1293.setUsePageRequest(this.m_bUsePageRequest);
_1293.sendRequest();
}
};
ViewerDispatcher.prototype.cancelRequest=function(key){
for(var i=0;i<this.m_requestQueue.length;i++){
var _1296=this.m_requestQueue[i];
if(_1296.getKey()===key){
_1296.setCallbacks({"onEntryComplete":null});
_1296.cancelRequest(false);
this.m_requestQueue.splice(i,1);
i--;
}
}
if(this.m_activeRequest&&this.m_activeRequest.getKey()===key){
this.m_activeRequest.setCallbacks({"onEntryComplete":null});
this.m_activeRequest.cancelRequest(false);
this.requestComplete();
}
};
ViewerDispatcher.prototype.possibleUnloadEvent=function(){
if(this.m_activeRequest){
this.m_activeRequest.possibleUnloadEvent();
}
};
ViewerDispatcher.prototype.requestComplete=function(_1297){
this.startRequest(this.nextRequest());
};
ViewerDispatcher.prototype.nextRequest=function(){
var _1298=null;
if(this.m_requestQueue.length>0){
_1298=this.m_requestQueue.shift();
if(_1298.getKey()!=null){
while(this.m_requestQueue.length>0&&this.m_requestQueue[0].getKey()==_1298.getKey()){
_1298=this.m_requestQueue.shift();
}
}
}
return _1298;
};
ViewerDispatcher.prototype.queueIsEmpty=function(){
return (this.m_requestQueue.length==0);
};
function DispatcherEntry(oCV){
this.m_oCV=oCV;
this.m_requestKey=null;
this.m_canBeQueued=false;
this.m_originalFormFields=null;
this.m_bUsePageRequest=false;
if(oCV){
if(!this.m_request){
this.m_request=new XmlHttpObject();
this.m_request.init("POST",this.m_oCV.getGateway(),"",true);
}
if(!this.m_requestHandler){
this.setRequestHandler(new BaseRequestHandler(oCV));
}
DispatcherEntry.prototype.setDefaultFormFields.call(this);
this.setCallbacks({"entryComplete":{"object":this,"method":this.onEntryComplete},"entryFault":{"object":this,"method":this.onEntryFault},"newRequest":{"object":this,"method":this.onNewRequest},"fault":{"object":this,"method":this.onFault},"error":{"object":this,"method":this.onError},"passportTimeout":{"object":this,"method":this.onPassportTimeout},"working":{"object":this,"method":this.onWorking},"prompting":{"object":this,"method":this.onPrompting},"preHttpRequest":{"object":this,"method":this.onPreHttpRequest},"postHttpRequest":{"object":this,"method":this.onPostHttpRequest},"postEntryComplete":{"object":this,"method":this.onPostEntryComplete}});
}
};
DispatcherEntry.prototype.setHeaders=function(_129a){
this.m_request.setHeaders(_129a);
};
DispatcherEntry.prototype.getHeaders=function(){
return this.m_request.getHeaders();
};
DispatcherEntry.prototype.setOriginalFormFields=function(_129b){
this.m_originalFormFields=_129b;
};
DispatcherEntry.prototype.getOriginalFormFields=function(){
return this.m_originalFormFields;
};
DispatcherEntry.prototype.setRequestHandler=function(_129c){
_129c.addCallbackHooks();
this.m_requestHandler=_129c;
};
DispatcherEntry.prototype.getRequestHandler=function(){
return this.m_requestHandler;
};
DispatcherEntry.prototype.setWorkingDialog=function(_129d){
if(this.getRequestHandler()){
this.m_requestHandler.setWorkingDialog(_129d);
}
};
DispatcherEntry.prototype.setRequestIndicator=function(_129e){
if(this.getRequestHandler()){
this.getRequestHandler().setRequestIndicator(_129e);
}
};
DispatcherEntry.prototype.forceSynchronous=function(){
this.getRequest().forceSynchronous();
};
DispatcherEntry.prototype.setUsePageRequest=function(_129f){
this.m_bUsePageRequest=_129f;
};
DispatcherEntry.prototype.getUsePageRequest=function(){
return this.m_bUsePageRequest;
};
DispatcherEntry.prototype.setDefaultFormFields=function(){
var _12a0=this.getViewer().envParams;
this.addFormField("b_action","cognosViewer");
this.addFormField("cv.catchLogOnFault","true");
this.addDefinedNonNullFormField("protectParameters",_12a0["protectParameters"]);
this.addDefinedNonNullFormField("ui.routingServerGroup",_12a0["ui.routingServerGroup"]);
this.addDefinedNonNullFormField("cv.debugDirectory",_12a0["cv.debugDirectory"]);
this.addDefinedNonNullFormField("cv.showFaultPage",_12a0["cv.showFaultPage"]);
this.addDefinedNonNullFormField("cv.useRAPDrill",_12a0["cv.useRAPDrill"]);
this.addDefinedNonNullFormField("container",_12a0["container"]);
this.addNonEmptyStringFormField("cv.objectPermissions",_12a0["cv.objectPermissions"]);
};
DispatcherEntry.prototype.getViewer=function(){
return this.m_oCV;
};
DispatcherEntry.prototype.prepareRequest=function(){
};
DispatcherEntry.addWidgetInfoToFormFields=function(_12a1,_12a2){
if(_12a1){
var _12a3=_12a1.getBUXRTStateInfoMap();
if(_12a3){
_12a2.addFormField("cv.buxRTStateInfo",_12a3);
}
var _12a4=_12a1.getDisplayName();
if(_12a4&&_12a4.length>0){
_12a2.addFormField("displayTitle",_12a4);
}
}
};
DispatcherEntry.prototype.canBeQueued=function(){
return this.m_canBeQueued;
};
DispatcherEntry.prototype.setCanBeQueued=function(_12a5){
this.m_canBeQueued=_12a5;
};
DispatcherEntry.prototype.getKey=function(){
return this.m_requestKey;
};
DispatcherEntry.prototype.setKey=function(key){
this.m_requestKey=key;
};
DispatcherEntry.prototype.setRequest=function(_12a7){
this.m_request=_12a7;
};
DispatcherEntry.prototype.getRequest=function(){
return this.m_request;
};
DispatcherEntry.prototype.setCallbacks=function(_12a8){
this.getRequest().setCallbacks(_12a8);
};
DispatcherEntry.prototype.getCallbacks=function(){
return this.getRequest().getCallbacks();
};
DispatcherEntry.prototype.sendRequest=function(){
this.prepareRequest();
var _12a9=this.getRequest().getFormFields();
var _12aa=_12a9.keys();
if(!this.m_originalFormFields){
this.m_originalFormFields=new CDictionary();
for(var index=0;index<_12aa.length;index++){
this.m_originalFormFields.add(_12aa[index],_12a9.get(_12aa[index]));
}
}
this.getRequest().sendRequest();
};
DispatcherEntry.prototype.onNewRequest=function(_12ac){
this.setRequest(_12ac);
};
DispatcherEntry.prototype.retryRequest=function(){
var oCV=this.getViewer();
oCV.setRetryDispatcherEntry(null);
var _12ae=this.getRequest().newRequest();
_12ae.setHeaders(null);
this.setRequest(_12ae);
var _12af=this.m_originalFormFields.keys();
for(var index=0;index<_12af.length;index++){
var _12b1=_12af[index];
var _12b2=this.m_originalFormFields.get(_12b1);
if(_12b1=="cv.responseFormat"&&_12b2=="iWidget"){
this.addFormField("cv.responseFormat","data");
}else{
if(_12b1=="ui.action"&&_12b2=="wait"){
this.addFormField("ui.action",this.m_originalFormFields.get("ui.primaryAction"));
}else{
if(_12b1!="m_tracking"&&_12b1!="cv.outputKey"){
this.addFormField(_12b1,_12b2);
}
}
}
}
this.addFormField("widget.reloadToolbar","true");
if(this.m_oCV.getViewerWidget()){
this.addFormField("cv.buxCurrentUserRole",this.m_oCV.getViewerWidget().getUserRole());
}
this.addNonEmptyStringFormField("cv.objectPermissions",oCV.envParams["cv.objectPermissions"]);
this.addNonEmptyStringFormField("limitedInteractiveMode",oCV.envParams["limitedInteractiveMode"]);
this.m_oCV.getViewerDispatcher().dispatchRequest(this);
};
DispatcherEntry.prototype.abortHttpRequest=function(){
if(!this.m_bCancelCalled){
if(this.getRequestHandler()){
this.getRequestHandler().onCancel();
}
this.m_bCancelCalled=true;
this.getRequest().abortHttpRequest();
this.onEntryComplete();
}
};
DispatcherEntry.prototype.cancelRequest=function(_12b3){
if(!this.m_bCancelCalled){
this.m_bCancelCalled=true;
if(this.getRequestHandler()){
this.getRequestHandler().onCancel();
}
if(_12b3){
this.getRequest().forceSynchronous();
}
this.getRequest().cancel();
this.onEntryComplete();
}
};
DispatcherEntry.prototype.getFormFields=function(){
return this.m_request.getFormFields();
};
DispatcherEntry.prototype.getFormField=function(name){
if(this.m_request){
return this.m_request.getFormField(name);
}else{
return "";
}
};
DispatcherEntry.prototype.clearFormFields=function(){
this.m_request.clearFormFields();
};
DispatcherEntry.prototype.formFieldExists=function(name){
if(this.m_request){
return this.m_request.getFormFields().exists(name);
}
return false;
};
DispatcherEntry.prototype.removeFormField=function(name){
if(this.formFieldExists(name)){
this.m_request.getFormFields().remove(name);
}
};
DispatcherEntry.prototype.addFormField=function(name,value){
this.m_request.addFormField(name,value);
};
DispatcherEntry.prototype.addDefinedNonNullFormField=function(name,value){
if(typeof value!="undefined"&&value!=null){
this.addFormField(name,value);
}
};
DispatcherEntry.prototype.addDefinedFormField=function(name,value){
if(typeof value!="undefined"){
this.addFormField(name,value);
}
};
DispatcherEntry.prototype.addNonNullFormField=function(name,value){
if(value!=null){
this.addFormField(name,value);
}
};
DispatcherEntry.prototype.addNonEmptyStringFormField=function(name,value){
if(typeof value!="undefined"&&value!=null&&value!=""){
this.addFormField(name,value);
}
};
DispatcherEntry.prototype.onWorking=function(_12c1,arg1){
if(this.getRequestHandler()){
this.getRequestHandler().onWorking(_12c1);
}
};
DispatcherEntry.prototype.onFault=function(_12c3){
if(this.getRequestHandler()){
this.getRequestHandler().onFault(_12c3);
}
};
DispatcherEntry.prototype.onError=function(_12c4){
if(this.m_bCancelCalled){
return;
}
if(this.getRequestHandler()){
this.getRequestHandler().onError(_12c4);
}
};
DispatcherEntry.prototype.possibleUnloadEvent=function(){
this.setCallbacks({"error":{}});
};
DispatcherEntry.prototype.onPreHttpRequest=function(_12c5){
if(this.getRequestHandler()){
this.getRequestHandler().preHttpRequest(_12c5);
}
};
DispatcherEntry.prototype.onPostHttpRequest=function(_12c6){
if(this.getRequestHandler()){
this.getRequestHandler().postHttpRequest(_12c6);
}
};
DispatcherEntry.prototype.onPassportTimeout=function(_12c7){
if(this.getRequestHandler()){
this.getRequestHandler().onPassportTimeout(_12c7);
}
};
DispatcherEntry.prototype.onPrompting=function(_12c8){
if(this.getRequestHandler()){
this.getRequestHandler().onPrompting(_12c8);
}
};
DispatcherEntry.prototype.onEntryComplete=function(_12c9){
if(!this.m_oCV._beingDestroyed){
this.m_oCV.getViewerDispatcher().requestComplete(this);
}
};
DispatcherEntry.prototype.onEntryFault=function(_12ca){
this.m_oCV.setFaultDispatcherEntry(this);
this.m_oCV.resetViewerDispatcher();
if(!this.m_bCancelCalled){
this.m_oCV.setRetryDispatcherEntry(this);
}
};
DispatcherEntry.prototype.onCloseErrorDlg=function(){
var _12cb=this.getCallbacks();
if(_12cb["closeErrorDlg"]){
var _12cc=GUtil.generateCallback(_12cb["closeErrorDlg"].method,[],_12cb["closeErrorDlg"].object);
_12cc();
}
};
DispatcherEntry.prototype.onPostEntryComplete=function(){
if(this.getRequestHandler()){
this.getRequestHandler().onPostEntryComplete();
}
this.executeCallback("postComplete");
};
DispatcherEntry.prototype.executeCallback=function(_12cd){
var _12ce=this.getCallbacks();
if(_12ce[_12cd]){
var _12cf=(_12ce.customArguments)?[this,_12ce.customArguments]:[this];
var _12d0=GUtil.generateCallback(_12ce[_12cd].method,_12cf,_12ce[_12cd].object);
_12d0();
return true;
}
return false;
};
function DataDispatcherEntry(oCV){
if(oCV){
this.setRequest(new AsynchDATARequest(oCV.getGateway(),oCV.getWebContentRoot()));
}
DataDispatcherEntry.baseConstructor.call(this,oCV);
};
DataDispatcherEntry.prototype=new DispatcherEntry();
DataDispatcherEntry.baseConstructor=DispatcherEntry;
function JSONDispatcherEntry(oCV){
if(oCV){
this.setRequest(new AsynchJSONRequest(oCV.getGateway(),oCV.getWebContentRoot()));
}
JSONDispatcherEntry.prototype.setDefaultFormFields.call(this);
JSONDispatcherEntry.baseConstructor.call(this,oCV);
};
JSONDispatcherEntry.prototype=new DispatcherEntry();
JSONDispatcherEntry.baseConstructor=DispatcherEntry;
JSONDispatcherEntry.prototype.setDefaultFormFields=function(){
this.addFormField("cv.responseFormat","JSON");
};
function AsynchDataDispatcherEntry(oCV){
if(oCV){
var _12d4=new AsynchDATARequest(oCV.getGateway(),oCV.getWebContentRoot());
this.setRequest(_12d4);
AsynchDataDispatcherEntry.baseConstructor.call(this,oCV);
AsynchDataDispatcherEntry.prototype.setDefaultFormFields.call(this);
}
};
AsynchDataDispatcherEntry.prototype=new DispatcherEntry();
AsynchDataDispatcherEntry.baseConstructor=DispatcherEntry;
AsynchDataDispatcherEntry.prototype.setDefaultFormFields=function(){
this.addFormField("cv.responseFormat","data");
};
function AsynchJSONDispatcherEntry(oCV){
if(oCV){
var _12d6=new AsynchJSONRequest(oCV.getGateway(),oCV.getWebContentRoot());
this.setRequest(_12d6);
AsynchJSONDispatcherEntry.baseConstructor.call(this,oCV);
AsynchJSONDispatcherEntry.prototype.setDefaultFormFields.call(this);
}
};
AsynchJSONDispatcherEntry.prototype=new DispatcherEntry();
AsynchJSONDispatcherEntry.baseConstructor=DispatcherEntry;
AsynchJSONDispatcherEntry.prototype.setDefaultFormFields=function(){
this.addFormField("cv.responseFormat","asynchJSON");
};
function ReportDispatcherEntry(oCV){
ReportDispatcherEntry.baseConstructor.call(this,oCV);
if(oCV){
ReportDispatcherEntry.prototype.setDefaultFormFields.call(this);
this.setRequestHandler(new RequestHandler(oCV));
this.setWorkingDialog(oCV.getWorkingDialog());
this.setRequestIndicator(oCV.getRequestIndicator());
this.setCallbacks({"complete":{"object":this,"method":this.onComplete},"prompting":{"object":this,"method":this.onComplete}});
}
};
ReportDispatcherEntry.prototype=new AsynchDataDispatcherEntry();
ReportDispatcherEntry.baseConstructor=AsynchDataDispatcherEntry;
ReportDispatcherEntry.prototype.parent=AsynchDataDispatcherEntry.prototype;
ReportDispatcherEntry.prototype.prepareRequest=function(){
var _12d8=this.getFormField("ui.action");
var _12d9=this.getViewer().getActionState();
if(_12d9!==""&&(_12d8=="wait"||_12d8=="forward"||_12d8=="back")){
this.addFormField("cv.actionState",_12d9);
}
var _12da=["nextPage","previousPage","firstPage","lastPage","reportAction","cancel","wait"];
var _12db=true;
for(var i=0;i<_12da.length;i++){
if(_12da[i]==_12d8){
_12db=false;
break;
}
}
if(_12db){
this.getViewer().clearTabs();
}
if(this.getViewer().getCurrentlySelectedTab()&&!this.formFieldExists("generic.anyURI.http://developer.cognos.com/ceba/constants/runOptionEnum#pageGroup")){
this.addFormField("generic.anyURI.http://developer.cognos.com/ceba/constants/runOptionEnum#pageGroup",this.getViewer().getCurrentlySelectedTab());
}
};
ReportDispatcherEntry.prototype.setDefaultFormFields=function(){
var oCV=this.getViewer();
var _12de=oCV.envParams;
this.addFormField("cv.id",oCV.getId());
if(_12de["cv.showFaultPage"]){
this.addFormField("cv.showFaultPage",_12de["cv.showFaultPage"]);
}else{
this.addFormField("cv.showFaultPage","false");
}
this.addDefinedNonNullFormField("ui.object",_12de["ui.object"]);
this.addDefinedNonNullFormField("ui.primaryAction",_12de["ui.primaryAction"]);
this.addDefinedNonNullFormField("ui.objectClass",_12de["ui.objectClass"]);
this.addNonEmptyStringFormField("specificationType",_12de["specificationType"]);
this.addNonEmptyStringFormField("cv.promptForDownload",_12de["cv.promptForDownload"]);
this.addNonEmptyStringFormField("ui.conversation",oCV.getConversation());
this.addNonEmptyStringFormField("m_tracking",oCV.getTracking());
var _12df=oCV.getExecutionParameters();
this.addNonEmptyStringFormField("executionParameters",_12df);
var sCAF=oCV.getCAFContext();
this.addDefinedNonNullFormField("ui.cafcontextid",sCAF);
};
ReportDispatcherEntry.prototype.onWorking=function(_12e1,arg1){
var _12e3=_12e1.getResponseState();
var _12e4=this.getRequestHandler();
if(_12e4){
var _12e5=_12e4.getWorkingDialog();
if(_12e5&&_12e5.setSecondaryRequests&&_12e3.m_aSecRequests){
_12e5.setSecondaryRequests(_12e3.m_aSecRequests);
}
}
DispatcherEntry.prototype.onWorking.call(this,_12e1,arg1);
if(_12e4){
this.getRequestHandler().updateViewerState(_12e3);
}
};
ReportDispatcherEntry.prototype.onComplete=function(_12e6,arg1){
if(this.getRequestHandler()){
this.getRequestHandler().onComplete(_12e6);
}
};
function ViewerDispatcherEntry(oCV){
ViewerDispatcherEntry.baseConstructor.call(this,oCV);
if(oCV){
ViewerDispatcherEntry.prototype.setDefaultFormFields.call(this);
this.setCallbacks({"prompting":{"object":this,"method":this.onPrompting}});
var _12e9=oCV.getViewerWidget();
if(_12e9.m_originalFormFields){
this.setOriginalFormFields(_12e9.m_originalFormFields);
_12e9.m_originalFormFields=null;
}
}
};
ViewerDispatcherEntry.prototype=new ReportDispatcherEntry();
ViewerDispatcherEntry.baseConstructor=ReportDispatcherEntry;
ViewerDispatcherEntry.prototype.parent=ReportDispatcherEntry.prototype;
ViewerDispatcherEntry.prototype.prepareRequest=function(){
this.parent.prepareRequest.call(this);
var _12ea=this.getViewer().getViewerWidget();
if(this.getFormField("widget.reloadToolbar")){
this.addFormField("cv.buxCurrentUserRole",_12ea.getUserRole());
}
if(_12ea){
DispatcherEntry.addWidgetInfoToFormFields(_12ea,this);
}
this.getViewer().inlineScriptsDoneExecuting=false;
};
ViewerDispatcherEntry.prototype.setDefaultFormFields=function(){
var oCV=this.getViewer();
var _12ec=oCV.getViewerWidget();
var _12ed=oCV.envParams;
this.addFormField("bux","true");
this.addFormField("cv.showFaultPage","false");
this.addDefinedNonNullFormField("baseReportModificationTime",_12ed["baseReportModificationTime"]);
this.addDefinedNonNullFormField("originalReport",_12ed["originalReport"]);
this.addDefinedNonNullFormField("ui.reportDrop",_12ed["ui.reportDrop"]);
this.addDefinedNonNullFormField("ui.preserveRapTags",_12ed["ui.preserveRapTags"]);
if(_12ec.getProperties()){
var _12ee=_12ec.getProperties().getFlashCharts();
if(_12ee!=null){
this.addDefinedNonNullFormField("savedFlashChartOption",_12ee);
if(_12ed.hasAVSChart){
this.addDefinedNonNullFormField("hasAVSChart",_12ed.hasAVSChart);
}else{
this.addDefinedNonNullFormField("hasAVSChart",oCV.hasAVSChart());
}
}
}
var _12ef=_12ec.getAttributeValue("gateway");
if(_12ef){
this.addDefinedNonNullFormField("cv.gateway",_12ef);
}
var _12f0=_12ec.getAttributeValue("webcontent");
if(_12f0){
this.addDefinedNonNullFormField("cv.webcontent",_12f0);
}
if(oCV.envParams["cv.outputKey"]){
this.addFormField("cv.outputKey",oCV.envParams["cv.outputKey"]);
this.addFormField("b_action","cvx.high");
delete oCV.envParams["cv.outputKey"];
}
if(_12ec.getXNodeId()){
this.setHeaders({"X-Node-ID":_12ec.getXNodeId()});
_12ec.setXNodeId(null);
}
};
ViewerDispatcherEntry.prototype.onPrompting=function(_12f1){
if(this.getRequestHandler()){
this.getRequestHandler().onPrompting(_12f1);
}
};
function Blocker(oCVId){
this.oCV_Id=oCVId;
this.m_viewerDiv=dojo.byId("RVContent"+this.oCV_Id);
this.m_containerDiv=this._findContainerDiv();
this.initialize();
};
Blocker.prototype._findContainerDiv=function(){
var _12f3=null;
if(!this.m_containerDiv){
_12f3=this.m_viewerDiv;
while(_12f3){
if(_12f3.style&&_12f3.style.height&&_12f3.style.height.indexOf("px")!=-1){
return _12f3;
}
_12f3=_12f3.parentNode;
}
}
if(typeof console!="undefined"&&console&&console.log){
console.log("ViewerIWidgetInlineDialog: Could not find the container div for showing the dialog.");
}
return this.m_viewerDiv;
};
Blocker.prototype.setClassNameOverride=function(_12f4){
if(!_12f4){
return;
}
this.m_classNameOverride=_12f4;
this.applyClassNameOverride();
};
Blocker.prototype.applyClassNameOverride=function(){
if(!this.m_classNameOverride||!this.m_background){
return;
}
dojo.removeClass(this.m_background);
dojo.addClass(this.m_background,this.m_classNameOverride);
};
Blocker.prototype.getNode=function(){
return this.m_background;
};
Blocker.prototype.initialize=function(){
if(!this.m_background){
this.m_background=dojo.byId("BACKGROUND"+this.oCV_Id);
if(!this.m_background){
this.m_background=document.createElement("div");
this.m_background.id="BACKGROUND"+this.oCV_Id;
this.m_background.className="report-blocker";
this.m_background.tabIndex="0";
dojo.place(this.m_background,this.m_containerDiv,"before");
}
}
};
Blocker.prototype.show=function(){
if(this.m_background){
this.m_background.style.display="block";
}
};
Blocker.prototype.hide=function(){
if(this.m_background){
this.m_background.style.display="none";
}
};
Blocker.prototype.destroy=function(){
if(this.m_background!=null){
this.m_background.parentNode.removeChild(this.m_background);
this.m_background=null;
}
};
function ReselectAction(oCV,_12f6){
this.m_aSelectionFilterObjects=_12f6;
this.m_oCV=oCV;
this.m_oSC=oCV.getSelectionController();
this.m_cd=this.m_oSC.getCCDManager().m_cd;
this.m_md=this.m_oSC.getCCDManager().m_md;
this.m_nReportDiv=oCV.getReportDiv();
this.m_oRAPReportContainers=oCV.getRAPReportInfo().getContainers();
};
ReselectAction.prototype.executeAction=function(){
this.mapCdMd();
if(this.show()){
var oVW=this.m_oCV.getViewerWidget();
if(oVW){
var _12f8=oVW.m_oWidgetContextManager.genSelectionPayload(this.m_oCV,oVW.getWidgetId());
oVW.setSelectionFilterSent(true);
oVW.fireEvent("com.ibm.bux.data.filterCache.init",null,_12f8);
if(oVW.isPastedWidget()&&!oVW.pastedSelectedBroadcasted){
oVW.pastedSelectedBroadcasted=true;
oVW.onSelectionChange();
}
}
}
};
ReselectAction.prototype.mapCdMd=function(){
var _12f9=this.m_aSelectionFilterObjects;
for(var i in _12f9){
var _12fb=_12f9[i];
var oItem=_12fb.selectedItem;
var aCtx=[];
var _12fe=null;
var _12ff=this._findMdIndex("q",_12fb.query);
_12fe=this._setNewCtx(oItem,_12ff);
if(_12fe){
aCtx.push(_12fe);
}else{
continue;
}
for(var j in _12fb.context){
var _1301=_12fb.context[j];
_12fe=this._setNewCtx(_1301,_12ff);
if(_12fe){
aCtx.push(_12fe);
}
}
_12fb.ctxArray=aCtx;
}
};
ReselectAction.prototype._setNewCtx=function(oItem,_1303){
var _1304=null;
var ctxId=null;
if(oItem.isMeasure==="true"){
_1304=this._findMdIndex(oItem.mdProperty,oItem.mdValue,_1303);
if(_1304){
oItem.ctxRef={"property":oItem.mdProperty,"mdIndex":_1304};
return oItem.ctxRef;
}
}else{
if(oItem.mun){
_1304=this._findMdIndex("m",oItem.mun,_1303);
ctxId=this._getContextIdForCdProperty(_1303,"m",_1304);
}else{
_1304=this._findMdIndex(oItem.mdProperty,oItem.mdValue,_1303);
ctxId=this._getContextIdForCdPropertyAndMdProperty(_1303,"u",oItem.use,oItem.mdProperty,_1304);
}
if(ctxId){
oItem.ctxId=ctxId;
return oItem.ctxId;
}
}
return null;
};
ReselectAction.prototype._getContextIdForCdProperty=function(_1306,_1307,_1308){
var ctxid=null;
for(var j in this.m_cd){
if(this.m_cd[j].q==_1306&&this.m_cd[j][_1307]==_1308){
ctxid=j;
break;
}
}
return ctxid;
};
ReselectAction.prototype._getContextIdForCdPropertyAndMdProperty=function(_130b,_130c,_130d,_130e,_130f){
var ctxid=null;
for(var j in this.m_cd){
if(this.m_cd[j].q==_130b&&this.m_cd[j][_130e]==_130f&&this.m_cd[j][_130c]==_130d){
ctxid=j;
break;
}
}
return ctxid;
};
ReselectAction.prototype._findMdIndex=function(_1312,value,_1314){
var _1315=null;
for(var j in this.m_md){
if(this.m_md[j][_1312]===value){
if(this.m_md[j]["q"]&&_1314){
if(this.m_md[j]["q"]==_1314){
_1315=j;
break;
}
}else{
_1315=j;
break;
}
}
}
return _1315;
};
ReselectAction.prototype.show=function(){
var _1317=false;
var oCV=this.m_oCV;
var oVW=oCV.getViewerWidget();
var _131a=oCV.getReportDiv();
var _131b=null;
var _131c=null;
var _131d=null;
oVW.preprocessPageClicked(false);
if(oVW&&_131a){
for(var _131e in this.m_aSelectionFilterObjects){
var _131f=this.m_aSelectionFilterObjects[_131e];
var _1320=(_131f.selectedItem.isMeasure==="true");
var _1321=true;
if(_1320){
var _1322=_131f.context;
for(var idx in _1322){
if(_1322[idx].isMeasure!=="true"){
_1321=false;
break;
}
}
if(_1321){
continue;
}
}
var aCtx=_131f.ctxArray;
if(aCtx&&aCtx.length>0){
_131b=this._getLayoutContainers(_131f.lid);
var _1325=false;
for(var _1326=0;!_1325&&_1326<_131b.length;_1326++){
if(/img|IMG/.test(_131b[_1326].tagName)){
var _1327=_131b[_1326];
for(_131d=null;!_131d&&_1327.parentNode;){
_1327=_1327.parentNode;
var _1328=_1327.getElementsByTagName("map");
if(_1328&&_1328.length>0){
_131d=_1328[0];
}
}
}else{
_131d=_131b[_1326].parentNode;
}
if(_131d){
var _1329=this._buildCtxQueryRegExp(aCtx);
_131c=getElementsByAttribute(_131d,"*","ctx",null,-1,_1329);
var _132a=_131f.selectedItem;
for(var idx in _131c){
if(_131c[idx].getAttribute){
if(_1320&&_132a.isDataValueOrChartElement==="false"&&(_131c[idx].getAttribute("type")==="datavalue"||_131c[idx].getAttribute("type")==="chartElement")){
continue;
}
if(this.isMatchingCell(aCtx,_131c[idx])){
var _132b=_131c[idx];
if(_132b.tagName==="SPAN"||_132b.tagName==="span"){
var _132c=_132b.parentNode.tagName;
if(_132c=="td"||_132c=="TD"||_132c=="TH"||_132c=="th"){
if(_132b.parentNode.getAttribute("ctx")==_132b.getAttribute("ctx")){
continue;
}
}
}
var evt={"target":_132b,"button":1,"ctrlKey":true};
this.m_oSC.pageClicked(evt);
_1325=true;
_1317=true;
}
}
}
}
}
}
}
}
return _1317;
};
ReselectAction.prototype.isMatchingCell=function(aCtx,_132f){
var _1330=_132f.getAttribute("ctx");
if(!_1330||_1330.length==0){
return false;
}
var _1331=_1330.replace(/::/g,":").split(":");
var _1332=0;
var _1333=null;
var _1334=0;
var _1335=null;
var _1336=0;
var _1337=false;
for(;_1332<_1331.length;_1332++){
if(_1331[_1332].length>0){
_1333=_1331[_1332++];
break;
}
}
_1335=aCtx[_1334];
if(typeof _1335=="string"){
if(_1335==_1333){
_1336++;
}
}else{
if(this.m_cd[_1333][_1335.property]==_1335.mdIndex){
_1336++;
}
}
if(_1336!=1){
return false;
}
if(aCtx.length==1){
_1337=true;
}
for(_1334=1;!_1337&&_1334<aCtx.length;_1334++){
_1335=aCtx[_1334];
if(typeof _1335=="string"){
for(_1332=1;_1332<_1331.length;_1332++){
if(_1331[_1332].length>0&&_1331[_1332]!="0"){
_1333=_1331[_1332];
if(_1335==_1333){
_1336++;
_1331[_1332]="0";
break;
}
}
}
}else{
for(_1332=1;_1332<_1331.length;_1332++){
if(_1331[_1332].length>0&&_1331[_1332]!="0"){
_1333=_1331[_1332];
if(this.m_cd[_1333][_1335.property]==_1335.mdIndex){
_1336++;
_1331[_1332]="0";
break;
}
}
}
}
if(aCtx.length==_1336){
_1337=true;
}
}
return _1337;
};
ReselectAction.prototype._buildCtxQueryRegExp=function(aCtx){
var _1339="";
var _133a=false;
var i=0;
if(typeof aCtx[i]=="string"){
_1339+="^"+aCtx[i];
}else{
_1339+="^[\\d:]+";
}
i++;
var _133c="";
for(;!_133a&&i<aCtx.length;i++){
if(typeof aCtx[i]=="string"){
if(_133c.length>0){
_133c+="+";
}
_133c+=aCtx[i];
_133a=true;
}else{
if(i<aCtx.length-1){
if(_133c.length>0){
_133c+="+";
}
_133c+="[\\d:]";
}
}
}
if(_133c.length>0){
_1339+=":{1,}"+_133c;
}
return new RegExp(_1339);
};
ReselectAction.prototype._getLayoutContainers=function(sLid){
var _133e="";
if(this.m_oRAPReportContainers&&this.m_oRAPReportContainers[sLid]){
_133e=sLid+".+";
}else{
for(var name in this.m_oRAPReportContainers){
if(_133e.length>0){
_133e+="|";
}
_133e+=name+".+";
}
}
return getElementsByAttribute(this.m_nReportDiv,"*","lid",null,-1,new RegExp(_133e));
};
function ViewerA11YHelper(oCV){
this.m_oCV=oCV;
};
ViewerA11YHelper.prototype.onFocus=function(evt){
var _1342=getCrossBrowserNode(evt);
_1342=ViewerA11YHelper.findChildOfTableCell(_1342);
this.updateCellAccessibility(_1342,false);
};
ViewerA11YHelper.prototype.onKeyDown=function(evt){
evt=(evt)?evt:((event)?event:null);
var _1344=getCrossBrowserNode(evt);
if(ViewerA11YHelper.isTableCell(_1344)){
for(var i=0;i<_1344.childNodes.length;i++){
if(_1344.childNodes[i].nodeName.toLowerCase()=="span"){
_1344=_1344.childNodes[i];
break;
}
}
}
if(!this.isValidNodeToSelect(_1344)){
return true;
}
_1344=ViewerA11YHelper.findChildOfTableCell(_1344);
if(_1344){
if(evt.keyCode=="39"){
if(this.m_oCV.getState()&&this.m_oCV.getState().getFindState()&&evt.ctrlKey&&evt.shiftKey){
this.m_oCV.executeAction("FindNext");
}else{
this.moveRight(_1344);
}
return stopEventBubble(evt);
}else{
if(evt.keyCode=="37"){
this.moveLeft(_1344);
return stopEventBubble(evt);
}else{
if(evt.keyCode=="38"){
this.moveUp(_1344);
return stopEventBubble(evt);
}else{
if(evt.keyCode=="40"){
this.moveDown(_1344);
return stopEventBubble(evt);
}else{
if(evt.keyCode=="13"){
if(this.m_oCV.isBux){
if(this.m_oCV.getViewerWidget().isSelectionFilterEnabled()){
this.m_oCV.getViewerWidget().preprocessPageClicked(false,evt);
if(this.m_oCV.getSelectionController().pageClicked(evt)!==false){
this.m_oCV.JAWSTalk(RV_RES.IDS_JS_SELECTION_FILTER_INFO_JAWS);
this.m_oCV.getViewerWidget().updateToolbar();
}
}else{
this.m_oCV.getSelectionController().pageClicked(evt);
var _1346=this.m_oCV.getActionFactory().load("Selection");
_1346.onKeyDown(evt);
}
this.m_oCV.getViewerWidget().onSelectionChange();
}else{
this.m_oCV.de(evt);
}
}else{
if(evt.keyCode=="32"){
if(this.m_oCV.isBux){
this.m_oCV.getViewerWidget().preprocessPageClicked(false);
if(this.m_oCV.getSelectionController().pageClicked(evt)!==false&&this.m_oCV.getViewerWidget().isSelectionFilterEnabled()){
this.m_oCV.JAWSTalk(RV_RES.IDS_JS_SELECTION_FILTER_INFO_JAWS);
}
this.m_oCV.getViewerWidget().updateToolbar();
this.m_oCV.getViewerWidget().onSelectionChange();
}else{
this.m_oCV.getSelectionController().pageClicked(evt);
}
return stopEventBubble(evt);
}else{
if(evt.keyCode=="46"&&this.m_oCV.isBux){
if(typeof this.m_oCV.envParams!="undefined"&&typeof this.m_oCV.envParams["ui.action"]!="undefined"&&this.m_oCV.envParams["ui.action"]!="view"&&!this.m_oCV.isLimitedInteractiveMode()){
var _1347=this.m_oCV.getActionFactory().load("Delete");
if(!this.m_oCV.isBlacklisted("Delete")&&_1347.canDelete()){
_1347.execute();
return stopEventBubble(evt);
}
}
}else{
if(this.m_oCV.isBux&&evt.ctrlKey==true&&evt.shiftKey==true&&evt.keyCode=="49"){
var lid=this.m_oCV.getSelectionController().getSelectionObjectFactory().getLayoutElementId(_1344);
if(lid!=""){
lid=lid.split(this.m_oCV.getId())[0];
var _1349=-1;
var _134a=this.m_oCV.getRAPReportInfo();
if(_134a){
var _134b=_134a.getContainer(lid);
if(typeof _134b.layoutIndex!="undefined"){
_1349=_134b.layoutIndex;
}
}
var _134c=document.getElementById("infoBarHeaderButton"+_1349+this.m_oCV.getId());
if(_134c!==null){
this.m_oCV.setCurrentNodeFocus(getCrossBrowserNode(evt));
_134c.focus();
}
}
return stopEventBubble(evt);
}else{
if(!this.m_oCV.isBux&&evt.shiftKey==true&&evt.keyCode=="121"){
var ocv=this.m_oCV;
var _134e=function(){
if(typeof evt.clientX=="undefined"||typeof evt.clientY=="undefined"){
var _134f=clientToScreenCoords(evt.target,document.body);
evt.clientX=_134f.leftCoord;
evt.clientY=_134f.topCoord;
}
ocv.dcm(evt,true);
};
if(isFF()){
setTimeout(_134e,0);
}else{
_134e.call();
}
return stopEventBubble(evt);
}else{
if(this.m_oCV.isBux&&(evt.keyCode=="93"||(evt.shiftKey==true&&evt.keyCode=="121"))){
var _1350=this.m_oCV.getViewerWidget();
var _1351=this.m_oCV.getSelectionController();
_1350.preprocessPageClicked(true);
_1351.pageClicked(evt);
_1350.updateToolbar();
_1350.onContextMenu(evt);
}
}
}
}
}
}
}
}
}
}
}
};
ViewerA11YHelper.prototype.isValidNodeToSelect=function(node){
return this.getValidNodeToSelect(node)?true:false;
};
ViewerA11YHelper.prototype.getValidNodeToSelect=function(node){
if(node&&node.style&&node.style.visibility!="hidden"&&node.style.display!="none"){
var _1354=node.nodeName.toLowerCase();
if((_1354=="span"&&(!node.getAttribute("class")||node.getAttribute("class").indexOf("expandButton")===-1))||(_1354=="div"&&node.getAttribute("flashchartcontainer")=="true")||(_1354=="div"&&node.getAttribute("chartcontainer")=="true")||(_1354=="img"&&(!node.id||node.id.indexOf("sortimg")!==0))){
return node;
}
if(ViewerA11YHelper.isSemanticNode(node)){
var child=node.childNodes&&node.childNodes.length?node.childNodes[0]:null;
if(child){
return this.getValidNodeToSelect(child);
}
}
}
return null;
};
ViewerA11YHelper.isSemanticNode=function(node){
if(!ViewerA11YHelper.isSemanticNode._semanticNodeNames){
ViewerA11YHelper.isSemanticNode._semanticNodeNames=["strong","em","h1","h2","h3","h4","h5","h6"];
}
var _1357=node.nodeName.toLowerCase();
for(var i=0;i<ViewerA11YHelper.isSemanticNode._semanticNodeNames.length;i++){
if(_1357===ViewerA11YHelper.isSemanticNode._semanticNodeNames[i]){
return true;
}
}
return false;
};
ViewerA11YHelper.isTableCell=function(node){
var _135a=node.nodeName.toLowerCase();
return _135a==="td"||_135a==="th";
};
ViewerA11YHelper.findChildOfTableCell=function(_135b){
var _135c=_135b;
while(_135c&&_135c.parentNode){
if(ViewerA11YHelper.getTableCell(_135c)){
break;
}
_135c=_135c.parentNode;
}
return _135c;
};
ViewerA11YHelper.getTableCell=function(node){
var _135e=node.parentNode;
if(ViewerA11YHelper.isTableCell(_135e)){
return _135e;
}
if(ViewerA11YHelper.isSemanticNode(_135e)&&ViewerA11YHelper.isTableCell(_135e.parentNode)){
return _135e.parentNode;
}
return null;
};
ViewerA11YHelper.prototype.moveRight=function(_135f){
var _1360=this.getNextNonTextSibling(_135f);
_1360=this.getValidNodeToSelect(_1360);
if(_1360){
this.setFocusToNode(_1360);
return true;
}
var _1361=ViewerA11YHelper.getTableCell(_135f);
_1361=this.getPfMainOutputCell(_1361);
while(_1361.nextSibling){
if(this.moveToTD(_1361.nextSibling)){
return true;
}
_1361=_1361.nextSibling;
}
var _1362=_1361.parentNode;
while(_1362.nextSibling){
var _1363=_1362.nextSibling;
if(this.moveToTD(_1363.childNodes[0])){
return true;
}
_1362=_1362.nextSibling;
}
return false;
};
ViewerA11YHelper.prototype.moveLeft=function(_1364){
var _1365=this.getPreviousNonTextSibling(_1364);
_1365=this.getValidNodeToSelect(_1365);
if(_1365){
this.setFocusToNode(_1365);
return true;
}
var _1366=ViewerA11YHelper.getTableCell(_1364);
_1366=this.getPfMainOutputCell(_1366);
while(_1366.previousSibling){
if(this.moveToTDFromTheRight(_1366.previousSibling)){
return true;
}
_1366=_1366.previousSibling;
}
var _1367=_1366.parentNode;
while(_1367.previousSibling){
var _1368=_1367.previousSibling;
if(this.moveToTDFromTheRight(_1368.lastChild)){
return true;
}
_1367=_1367.previousSibling;
}
return false;
};
ViewerA11YHelper.prototype.moveDown=function(_1369){
var _136a=ViewerA11YHelper.getTableCell(_1369);
_136a=this.getPfMainOutputCell(_136a);
var _136b=this.getColumnIndex(_136a);
_136b+=this.getColSpanFromRowSpans(_136a);
var _136c=_136a.parentNode;
if(_136a.rowSpan&&_136a.rowSpan>1){
var _136d=_136a.rowSpan;
for(var _136e=1;_136e<_136d;_136e++){
_136c=_136c.nextSibling;
}
}
var _136f=false;
while(_136c){
if(_136c.nextSibling){
_136c=_136c.nextSibling;
}else{
if(_136a.nextSibling&&!_136f){
_136c=_136c.parentNode.firstChild;
_136f=true;
_136b++;
}else{
return false;
}
}
if(this.doMoveUpDown(_136c,_136b)){
return true;
}
}
return false;
};
ViewerA11YHelper.prototype.moveUp=function(_1370){
var _1371=ViewerA11YHelper.getTableCell(_1370);
_1371=this.getPfMainOutputCell(_1371);
var _1372=_1371.parentNode;
var _1373=this.getColumnIndex(_1371);
_1373+=this.getColSpanFromRowSpans(_1371);
var _1374=false;
while(_1372){
if(_1372.previousSibling){
_1372=_1372.previousSibling;
}else{
if(_1371.previousSibling&&!_1374){
_1372=_1372.parentNode.lastChild;
_1374=true;
_1373--;
}else{
return false;
}
}
if(this.doMoveUpDown(_1372,_1373)){
return true;
}
}
return false;
};
ViewerA11YHelper.prototype.getNextNonTextSibling=function(node){
while(node.nextSibling){
node=node.nextSibling;
if(node.nodeName.toLowerCase()!="#text"){
return node;
}
}
if(ViewerA11YHelper.isSemanticNode(node.parentNode)){
return this.getNextNonTextSibling(node.parentNode);
}
return null;
};
ViewerA11YHelper.prototype.doMoveUpDown=function(_1376,_1377){
if(_1376!=null){
var _1378=_1376.firstChild;
var pos=this.getColSpanFromRowSpans(_1378);
while(_1378){
if(pos==_1377){
return this.moveToTDFromTheRight(_1378);
}else{
if(pos>_1377){
break;
}
}
var _137a=0;
if(_1378.colSpan){
_137a=_1378.colSpan;
}else{
_137a++;
}
pos+=_137a;
_1378=_1378.nextSibling;
}
}
};
ViewerA11YHelper.prototype.moveToTDFromTheRight=function(td){
td=this.getPfVisibleCell(td);
var _137c=td.childNodes;
for(var _137d=_137c.length-1;_137d>=0;_137d--){
var node=this.getValidNodeToSelect(_137c[_137d]);
if(node){
if(node.childNodes&&node.childNodes[0]&&node.childNodes[0].nodeName.toLowerCase()=="span"){
node=node.childNodes[0];
}
if(node.tabIndex!=-1&&node.tabIndex!=0){
node.tabIndex=-1;
}
this.setFocusToNode(node);
return true;
}
}
return false;
};
ViewerA11YHelper.prototype.moveToTD=function(td){
td=this.getPfVisibleCell(td);
var _1380=td.childNodes;
for(var _1381=0;_1381<_1380.length;_1381++){
var node=this.getValidNodeToSelect(_1380[_1381]);
if(node){
if(node.childNodes&&node.childNodes[0]&&node.childNodes[0].nodeName.toLowerCase()=="span"){
node=node.childNodes[0];
}
if(node.tabIndex!=-1&&node.tabIndex!=0){
node.tabIndex=-1;
}
this.setFocusToNode(node);
return true;
}
}
return false;
};
ViewerA11YHelper.prototype.setFocusToNode=function(node){
this.m_oCV.setCurrentNodeFocus(node);
this.updateCellAccessibility(node,false);
node.focus();
if(this.m_oCV.m_pinFreezeManager){
var _1384=this.m_oCV.m_pinFreezeManager.nodeToContainer(node);
if(_1384){
_1384.updateScroll(node);
}
}
};
ViewerA11YHelper.prototype.getPfMainOutputCell=function(_1385){
var main=null;
var slid=_1385.getAttribute("pfslid");
if(slid){
var lid=PinFreezeContainer.getLidFromSlid(slid);
if(lid&&this.m_oCV.m_pinFreezeManager){
lid=this.m_oCV.m_pinFreezeManager.removeNamespace(lid);
var _1389=this.m_oCV.m_pinFreezeManager.getContainer(lid);
if(_1389){
main=_1389.getMain(_1385);
}
}
}
return main?main:_1385;
};
ViewerA11YHelper.prototype.getPreviousNonTextSibling=function(node){
while(node.previousSibling){
node=node.previousSibling;
if(node.nodeName.toLowerCase()!="#text"){
return node;
}
}
if(ViewerA11YHelper.isSemanticNode(node.parentNode)){
return this.getPreviousNonTextSibling(node.parentNode);
}
return null;
};
ViewerA11YHelper.prototype.getColumnIndex=function(node){
var _138c=0;
while(node.previousSibling){
node=node.previousSibling;
if(node.rowSpan==1){
if(node.colSpan){
_138c+=node.colSpan;
}else{
_138c++;
}
}
}
return _138c;
};
ViewerA11YHelper.prototype.getPfVisibleCell=function(_138d){
var copy=null;
var slid=_138d.getAttribute("pfslid");
if(slid){
var lid=PinFreezeContainer.getLidFromSlid(slid);
if(lid&&this.m_oCV.m_pinFreezeManager){
lid=this.m_oCV.m_pinFreezeManager.removeNamespace(lid);
var _1391=this.m_oCV.m_pinFreezeManager.getContainer(lid);
if(_1391){
copy=_1391.getCopy(_138d);
}
}
}
return copy?copy:_138d;
};
ViewerA11YHelper.prototype.updateCellAccessibility=function(_1392,force){
if(!_1392){
return false;
}
var _1394=false;
var _1395=false;
var _1396=false;
var _1397=_1392.getAttribute("ctx")!=null?_1392:_1392.parentNode;
if(_1392.getAttribute("flashChartContainer")!="true"){
if(_1397.getAttribute("ctx")!=null){
if(this.m_oCV.isBux){
var _1398=this.m_oCV.getAction("DrillUpDown");
_1398.updateDrillability(this.m_oCV,_1397);
_1394=_1398.canDrillDown();
_1395=_1398.canDrillUp();
}else{
var _1399=_1397.getAttribute("ctx");
var ctxID=_1399.indexOf(":")==-1?_1399:_1399.substring(0,_1399.indexOf(":"));
var _139b=this.m_oCV.getSelectionController();
_1394=_139b.canDrillDown(ctxID);
_1395=_139b.canDrillUp(ctxID);
}
}
_1396=_1392.parentNode.getAttribute("dtTargets")?true:false;
}
var _139c=_1392.nodeName.toLowerCase()=="img";
var _139d=_1392.parentNode.getAttribute("type")=="columnTitle";
if(!_139c&&(force||((_1392.getAttribute("aria-labelledby")!=null||_139d||this.m_oCV.isAccessibleMode())))){
var _139e="";
if(_1392.parentNode.getAttribute("cc")=="true"){
_139e+=" "+RV_RES.IDS_JS_CROSSTAB_CORNER;
}
if(_1392.innerHTML.length===0){
_139e+=" "+RV_RES.IDS_JS_EMPTY_CELL;
}
if(_1394&&_1395){
_139e+=" "+RV_RES.IDS_JS_DRILL_DOWN_UP_JAWS;
}else{
if(_1394){
_139e+=" "+RV_RES.IDS_JS_DRILL_DOWN_JAWS;
}else{
if(_1395){
_139e+=" "+RV_RES.IDS_JS_DRILL_UP_JAWS;
}
}
}
if(_1396){
_139e+=" "+RV_RES.IDS_JS_DRILL_THROUGH_JAWS;
}
if(_1392.altText&&_1392.altText.length>0){
_139e=_1392.altText;
}else{
if(_1392.getAttribute("flashChartContainer")=="true"){
_139e=RV_RES.IDS_JS_CHART_IMAGE;
}
}
if(this.m_oCV.isBux){
var _139f=_1392.previousSibling;
if(_139f){
var wid=_139f.getAttribute("widgetid");
if(wid&&wid.indexOf("comment")){
_139e+=" "+RV_RES.IDS_JS_ANNOTATION_JAWS;
}
}
if(_1392.getAttribute("rp_name")||_1392.parentNode.getAttribute("rp_name")){
_139e+=" "+RV_RES.IDS_JS_LABEL_HAS_BEEN_RENAMED;
}
if(_1392.nextSibling&&_1392.nextSibling.getAttribute("class")=="sortIconVisible"){
_139e+=" "+_1392.nextSibling.getAttribute("alt");
}
}
if(_139e.length>0){
this.addAriaLabelledByOnCell(_1392,_139e);
}
}
if(_1395||_1394||_1396){
this.addDrillAccessibilityAttributes(_1392,_1396);
}
if(_1392.attachEvent){
_1392.attachEvent("onblur",this.onBlur);
}else{
_1392.addEventListener("blur",this.onBlur,false);
}
if((isIE()&&_1392.getAttribute("tabIndex")!=0)||_139c){
_1392.setAttribute("modifiedTabIndex","true");
_1392.setAttribute("oldTabIndex",_1392.getAttribute("tabIndex"));
_1392.setAttribute("tabIndex",0);
}
};
ViewerA11YHelper.prototype.addAriaLabelledByOnCell=function(_13a1,_13a2){
var _13a3=0;
var _13a4=_13a1;
while(_13a4.previousSibling){
_13a3++;
_13a4=_13a4.previousSibling;
}
var _13a5=_13a1.getAttribute("ariaHiddenSpanId");
if(_13a5&&document.getElementById(_13a5)){
document.getElementById(_13a5).innerHTML=_13a2;
}else{
if(!_13a1.parentNode.id&&!_13a1.id){
_13a1.parentNode.id=Math.random();
}
var _13a6=document.createElement("span");
_13a6.style.visibility="hidden";
_13a6.style.display="none";
_13a6.id=(_13a1.id==""?_13a1.parentNode.id:_13a1.id)+"_"+_13a3;
_13a6.innerHTML=_13a2;
_13a1.parentNode.appendChild(_13a6);
var _13a7="";
if(_13a1.getAttribute("aria-labelledby")!=null){
_13a7+=_13a1.getAttribute("aria-labelledby");
}else{
if(_13a1.id==""){
_13a1.id=_13a1.parentNode.id+"_main_"+_13a3;
}
_13a7+=_13a1.id;
}
_13a7+=" "+_13a6.id;
_13a1.setAttribute("aria-labelledby",_13a7);
_13a1.setAttribute("ariaHiddenSpanId",_13a6.id);
}
};
ViewerA11YHelper.prototype.addDrillAccessibilityAttributes=function(_13a8,_13a9){
if(!_13a8.getAttribute("oldClassName")){
if(!_13a9){
_13a8.setAttribute("oldClassName",_13a8.className);
_13a8.className="dl "+_13a8.className;
}
if(!_13a8.getAttribute("role")){
_13a8.setAttribute("role","link");
}
}
};
ViewerA11YHelper.prototype.onBlur=function(evt){
var _13ab=null;
if(isIE()){
_13ab=getNodeFromEvent(evt,true);
}else{
_13ab=this;
}
_13ab=ViewerA11YHelper.findChildOfTableCell(_13ab);
if(_13ab){
if(_13ab.getAttribute("oldClassName")){
_13ab.className=_13ab.getAttribute("oldClassName");
_13ab.removeAttribute("oldClassName");
}
if(_13ab.getAttribute("modifiedTabIndex")=="true"){
_13ab.removeAttribute("modifiedTabIndex");
_13ab.removeAttribute("tabIndex");
if(_13ab.getAttribute("oldTabIndex")){
_13ab.setAttribute("tabIndex",_13ab.getAttribute("oldTabIndex"));
}
_13ab.removeAttribute("oldTabIndex");
}
var _13ac=_13ab.getAttribute("ariaHiddenSpanId");
if(_13ac){
var _13ad=document.getElementById(_13ac);
if(_13ad){
_13ad.innerHTML="";
}
}
}
};
ViewerA11YHelper.prototype.getColSpanFromRowSpans=function(_13ae){
var _13af=0;
var _13b0=_13ae.parentNode;
var _13b1=0;
while(_13b0){
var _13b2=_13b0.firstChild;
var _13b3=this.getColumnCount(_13b0)-_13b1;
while(_13b2&&_13b2.rowSpan>1&&_13b3>0&&_13b2!=_13ae){
_13af+=_13b2.colSpan;
_13b2=_13b2.nextSibling;
_13b3--;
}
if(_13b0.childNodes.length>_13b1){
_13b1=this.getColumnCount(_13b0);
}
_13b0=_13b0.previousSibling;
}
return _13af;
};
ViewerA11YHelper.prototype.getColumnCount=function(_13b4){
var _13b5=0;
var node=_13b4.firstChild;
while(node){
_13b5+=node.colSpan;
node=node.nextSibling;
}
return _13b5;
};
ViewerA11YHelper.prototype.addLabelledByForItemsOutsideOfContainers=function(){
if(!this.m_oCV.isAccessibleMode()){
return;
}
var _13b7=document.getElementById("RVContent"+this.m_oCV.getId());
if(!_13b7){
return;
}
var _13b8=getElementsByAttribute(_13b7,"span","tabindex","0");
if(!_13b8){
return;
}
for(var i=0;i<_13b8.length;i++){
var span=_13b8[i];
this.updateCellAccessibility(span,false);
}
};
function CtxArrayPlaceHolder(){
};
var self=window;
function CDrillManager(oCV){
this.m_drawDrillTargets=false;
this.setCV(oCV);
};
CDrillManager.prototype=new CViewerHelper();
CDrillManager.prototype.getSelectionController=function(){
var _13bc;
try{
_13bc=getCognosViewerSCObjectRef(this.getCV().getId());
}
catch(e){
_13bc=null;
}
return _13bc;
};
CDrillManager.prototype.getSelectedObject=function(){
var _13bd=this.getSelectionController();
if(_13bd==null){
return null;
}
var _13be=null;
var _13bf=null;
if(_13bd.hasSelectedChartNodes()){
_13bf=_13bd.getSelectedChartNodes();
}else{
_13bf=_13bd.getSelections();
}
if(_13bf&&_13bf.length==1){
_13be=_13bf[0];
}
return _13be;
};
CDrillManager.prototype.canDrillUp=function(){
if(this.getDrillOption("drillUp")==true&&this.hasMuns()){
return true;
}
return false;
};
CDrillManager.prototype.canDrillDown=function(){
if(this.getDrillOption("drillDown")==true){
return true;
}
return false;
};
CDrillManager.prototype.hasMuns=function(_13c0){
if(typeof _13c0=="undefined"){
_13c0=this.getSelectedObject();
}
if(_13c0==null){
return false;
}
var _13c1=_13c0.getMuns();
var muns="";
for(var _13c3=0;_13c3<_13c1.length&&muns=="";++_13c3){
if(typeof _13c1[_13c3][0]!="undefined"){
muns+=_13c1[_13c3][0];
}
}
return (muns!="");
};
CDrillManager.prototype.getRefQuery=function(){
var _13c4="";
var _13c5=this.getSelectedObject();
if(_13c5==null){
return "";
}
var _13c6=_13c5.getRefQueries();
for(var i=0;i<_13c6.length;i++){
if(_13c6[i]!=null){
for(var j=0;j<_13c6[i].length;j++){
if(_13c6[i][j]!=null&&_13c6[i][j]!=""){
return _13c6[i][j];
}
}
}
}
return _13c4;
};
CDrillManager.prototype.isIsolated=function(){
var _13c9=this.getSelectionController();
if(_13c9==null||_13c9.getDrillUpDownEnabled()==false){
return false;
}
var _13ca=this.getSelectedObject();
if(_13ca==null){
return false;
}
if(_13ca instanceof CSelectionChartObject&&_13c9!=null){
var _13cb=_13ca.getArea();
if(_13cb!=null){
var _13cc=_13cb.getAttribute("isolated");
if(typeof _13cc!="undefined"&&_13cc!=null&&_13cc=="true"){
return true;
}
}
}else{
var _13cd=_13ca.getCellRef();
if(typeof _13cd=="object"&&_13cd!=null){
var _13ce=_13cd.getElementsByTagName("span");
if(_13ce!=null&&typeof _13ce!="undefined"&&_13ce.length>0){
var _13cf=_13ce[0].getAttribute("isolated");
if(_13cf!=null&&_13cf!="undefined"&&_13cf=="true"){
return true;
}
}
}
}
return false;
};
CDrillManager.prototype.getDrillOption=function(_13d0){
var _13d1=this.getSelectionController();
if(_13d1==null||_13d1.getDrillUpDownEnabled()==false||typeof _13d0=="undefined"){
return false;
}
var _13d2=this.getSelectedObject();
if(_13d2==null){
return false;
}
if(this.isIsolated()){
if(_13d0=="drillDown"){
return false;
}else{
if(_13d0=="drillUp"){
return true;
}
}
}
if(_13d0=="drillDown"){
if(_13d2 instanceof CSelectionChartObject&&_13d1!=null){
var _13d3=_13d2.getArea();
if(_13d3!=null){
var _13d4=_13d3.getAttribute("isChartTitle");
if(typeof _13d4!="undefined"&&_13d4!=null&&_13d4=="true"){
return false;
}
}
}
}
var _13d5=_13d2.getDrillOptions();
var _13d6=(typeof DrillContextMenuHelper!=="undefined"&&DrillContextMenuHelper.needsDrillSubMenu(this.m_oCV));
for(var idx=0;idx<_13d5.length;++idx){
var _13d8=(_13d6)?_13d5[idx].length:1;
for(var level=0;level<_13d8;++level){
var _13da=_13d5[idx][level];
if(_13da=="3"){
return true;
}else{
if(_13d0=="drillUp"&&_13da=="1"){
return true;
}else{
if(_13d0=="drillDown"&&_13da=="2"){
return true;
}
}
}
}
}
return false;
};
CDrillManager.prototype.canDrillThrough=function(){
var _13db=this.getSelectionController();
if(_13db==null||_13db.getModelDrillThroughEnabled()==false){
return false;
}
return true;
};
CDrillManager.prototype.singleClickDrillEvent=function(evt,app){
var _13de=this.getSelectionController();
if(_13de!=null){
if(this.getCV().bCanUseCognosViewerSelection==true){
_13de.pageClicked(evt);
}
}
var node=getCrossBrowserNode(evt);
try{
if(node.className&&node.className.indexOf("dl")==0){
if(this.canDrillDown()){
this.singleClickDrillDown(evt,app);
return true;
}else{
if(this.canDrillUp()){
this.singleClickDrillUp(evt,app);
return true;
}
}
}
}
catch(e){
}
if(app=="RV"){
return this.getDrillThroughParameters("execute",evt);
}
return false;
};
CDrillManager.prototype.singleClickDrillDown=function(evt,app){
if(app=="QS"){
this.qsDrillDown();
}else{
this.rvDrillDown();
}
};
CDrillManager.prototype.singleClickDrillUp=function(evt,app){
if(app=="QS"){
this.qsDrillUp();
}else{
this.rvDrillUp();
}
};
CDrillManager.prototype.getDrillParameters=function(_13e4,_13e5,_13e6,_13e7){
var _13e8=[];
var _13e9=this.getSelectedObject();
if(_13e9==null){
return _13e8;
}
if(typeof _13e5=="undefined"){
_13e5=true;
}
var _13ea=_13e9.getDataItems();
var _13eb=_13e9.getMuns();
var _13ec=_13e9.getDimensionalItems("lun");
var _13ed=_13e9.getDimensionalItems("hun");
var _13ee=_13e9.getDrillOptions();
if(typeof _13ea=="undefined"||typeof _13eb=="undefined"||typeof _13ee=="undefined"||_13eb==null||_13ea==null||_13ee==null){
return _13e8;
}
if(_13eb.length!=_13ea.length){
return _13e8;
}
var _13ef=_13eb.length;
for(var _13f0=0;_13f0<_13ef;++_13f0){
if(_13ea[_13f0].length!=0){
var _13f1=(_13e7)?this.findUserSelectedDrillItem(_13e7,_13ea[_13f0]):0;
if(_13f1<0){
continue;
}
if((_13e6===true)||this.getDrillOption(_13e4)){
if(_13eb[_13f0][_13f1]==""||_13e8.toString().indexOf(_13eb[_13f0][_13f1],0)==-1){
_13e8[_13e8.length]=_13ea[_13f0][_13f1];
_13e8[_13e8.length]=_13eb[_13f0][_13f1];
if(_13e5===true){
_13e8[_13e8.length]=_13ec[_13f0][_13f1];
_13e8[_13e8.length]=_13ed[_13f0][_13f1];
}
}
}
}
}
return _13e8;
};
CDrillManager.prototype.findUserSelectedDrillItem=function(_13f2,_13f3){
for(var _13f4=0;_13f4<_13f3.length;++_13f4){
if(_13f2==_13f3[_13f4]){
return _13f4;
}
}
return -1;
};
CDrillManager.prototype.getModelDrillThroughContext=function(_13f5){
var _13f6="";
if(this.canDrillThrough()===true){
if(typeof gUseNewSelectionContext=="undefined"){
var _13f7="";
if(typeof getConfigFrame!="undefined"){
_13f7=decodeURIComponent(getConfigFrame().cfgGet("PackageBase"));
}else{
if(this.getCV().getModelPath()!==""){
_13f7=this.getCV().getModelPath();
}
}
_13f6=getViewerSelectionContext(this.getSelectionController(),new CSelectionContext(_13f7));
}else{
var _13f8=new CParameterValues();
var _13f9=this.getSelectionController();
if(_13f9){
var _13fa=_13f9.getAllSelectedObjects();
for(var _13fb=0;_13fb<_13fa.length;++_13fb){
var _13fc=_13fa[_13fb];
var _13fd=_13fc.getMuns();
var _13fe=_13fc.getMetadataItems();
var _13ff=_13fc.getUseValues();
for(var _1400=0;_1400<_13fe.length;++_1400){
for(var idx=0;idx<_13fe[_1400].length;++idx){
if(_13fe[_1400][idx]==null||_13fe[_1400][idx]==""){
continue;
}
var name=_13fe[_1400][idx];
var _1403;
if(_13fd[_1400][idx]!=null&&_13fd[_1400][idx]!=""){
_1403=_13fd[_1400][idx];
}else{
_1403=_13ff[_1400][idx];
}
var _1404=_13ff[_1400][idx];
_13f8.addSimpleParmValueItem(name,_1403,_1404,"true");
}
}
}
}
var _1405=_13f5.XMLBuilderCreateXMLDocument("context");
_13f6=_13f8.generateXML(_13f5,_1405);
}
}
return _13f6;
};
CDrillManager.prototype.rvDrillUp=function(_1406){
this.getCV().executeAction("DrillUp",_1406);
};
CDrillManager.prototype.rvDrillDown=function(_1407){
this.getCV().executeAction("DrillDown",_1407);
};
CDrillManager.prototype.rvBuildXMLDrillParameters=function(_1408,_1409){
var _140a=this.getDrillParameters(_1408,true,false,_1409);
if(_140a.length==0){
return drillParams;
}
return this.buildDrillParametersSpecification(_140a);
};
CDrillManager.prototype.buildDrillParametersSpecification=function(_140b){
var _140c="<DrillParameters>";
var idx=0;
while(idx<_140b.length){
_140c+="<DrillGroup>";
_140c+="<DataItem>";
_140c+=sXmlEncode(_140b[idx++]);
_140c+="</DataItem>";
_140c+="<MUN>";
_140c+=sXmlEncode(_140b[idx++]);
_140c+="</MUN>";
_140c+="<LUN>";
_140c+=sXmlEncode(_140b[idx++]);
_140c+="</LUN>";
_140c+="<HUN>";
_140c+=sXmlEncode(_140b[idx++]);
_140c+="</HUN>";
_140c+="</DrillGroup>";
}
_140c+="</DrillParameters>";
return _140c;
};
CDrillManager.prototype.getAuthoredDrillsForCurrentSelection=function(){
var _140e=null;
var _140f=this.getAuthoredDrillThroughTargets();
if(_140f.length>0){
var _1410="<AuthoredDrillTargets>";
for(var _1411=0;_1411<_140f.length;++_1411){
_1410+=eval("\""+_140f[_1411]+"\"");
}
_1410+="</AuthoredDrillTargets>";
var cv=this.getCV();
var _1413=cv.getAction("AuthoredDrill");
var _1414=cv.getDrillTargets();
if(_1414.length>0){
_140e=_1413.getAuthoredDrillThroughContext(_1410,_1414);
}
}
return _140e;
};
CDrillManager.prototype.getAuthoredDrillsForGotoPage=function(){
var _1415="";
var _1416=this.getAuthoredDrillsForCurrentSelection();
if(_1416){
_1415=XMLBuilderSerializeNode(_1416);
}
return _1415;
};
CDrillManager.prototype.launchGoToPage=function(_1417,_1418){
var _1419=this.getSelectionController();
if((_1419!=null&&_1419.getModelDrillThroughEnabled()==true)||(typeof _1417!="undefined"&&_1417!=null&&_1417!="")){
var _141a=this.getAuthoredDrillsForGotoPage();
var _141b=this.getModelDrillThroughContext(self);
var form=document.getElementById("drillForm");
if(form!=null){
document.body.removeChild(form);
}
form=document.createElement("form");
var cvid=this.getCVId();
var _141e=document.forms["formWarpRequest"+cvid];
form.setAttribute("id","drillForm");
form.setAttribute("name","drillForm");
form.setAttribute("target",_141e.getAttribute("target"));
form.setAttribute("method","post");
form.setAttribute("action",_141e.getAttribute("action"));
form.style.display="none";
document.body.appendChild(form);
if(this.getCV().getModelPath()!==""){
form.appendChild(createHiddenFormField("modelPath",this.getCV().getModelPath()));
}
if(typeof _141e["ui.object"]!="undefined"&&_141e["ui.object"].value!=""){
form.appendChild(createFormField("drillSource",_141e["ui.object"].value));
}else{
if(typeof this.getCV().envParams["ui.spec"]!="undefined"){
form.appendChild(createFormField("sourceSpecification",this.getCV().envParams["ui.spec"]));
}
}
if(_141a!=""){
form.appendChild(createHiddenFormField("m","portal/drillthrough.xts"));
form.appendChild(createFormField("invokeGotoPage","true"));
form.appendChild(createFormField("m","portal/drillthrough.xts"));
form.appendChild(createFormField("modelDrillEnabled",_1419.getModelDrillThroughEnabled()));
if(typeof gUseNewSelectionContext=="undefined"){
form.appendChild(createFormField("newSelectionContext","true"));
}
}else{
if(typeof gUseNewSelectionContext=="undefined"){
form.appendChild(createHiddenFormField("m","portal/goto2.xts"));
}else{
form.appendChild(createHiddenFormField("m","portal/goto.xts"));
}
}
form.appendChild(createHiddenFormField("b_action","xts.run"));
form.appendChild(createHiddenFormField("drillTargets",_141a));
if(typeof gUseNewSelectionContext=="undefined"){
form.appendChild(createHiddenFormField("drillContext",_141b));
}else{
form.appendChild(createHiddenFormField("modeledDrillthru",_141b));
}
form.appendChild(createHiddenFormField("errURL","javascript:window.close();"));
if(typeof _1418!="undefined"&&_1418==true){
form.appendChild(this.createFormField("directLaunch","true"));
}
var _141f="";
if(this.getCV().envParams["ui.routingServerGroup"]){
_141f=this.getCV().envParams["ui.routingServerGroup"];
}
form.appendChild(createHiddenFormField("ui.routingServerGroup",_141f));
if(this.getCV().getExecutionParameters()!=""){
form.appendChild(createHiddenFormField("encExecutionParameters",this.getCV().getExecutionParameters()));
}
if(_141e.lang&&_141e.lang.value!=""){
form.appendChild(createHiddenFormField("lang",_141e.lang.value));
}
if(!this.getCV()||!this.getCV().launchGotoPageForIWidgetMobile(drillForm)){
if(typeof this.getCV().launchGotoPage==="function"){
this.getCV().launchGotoPage(form);
}else{
var _1420="winNAT_"+(new Date()).getTime();
var sPath=this.getCV().getWebContentRoot()+"/rv/blankDrillWin.html?cv.id="+cvid;
window.open(sPath,_1420,"toolbar,location,status,menubar,resizable,scrollbars=1");
form.target=_1420;
}
}
}
};
CDrillManager.prototype.buildSearchPageXML=function(_1422,pkg,model,_1425,_1426,_1427,_1428){
var _1429=null;
if(typeof _1422.XMLElement=="function"){
_1429=_1422.XMLBuilderCreateXMLDocument("cognosSearch");
_1422.XMLBuilderSetAttributeNodeNS(_1429.documentElement,"xmlns:cs","http://developer.cognos.com/schemas/cs/1/");
var _142a=_1429.createElement("package");
if(typeof pkg=="string"&&pkg!==""){
_142a.appendChild(_1429.createTextNode(pkg));
}
_1429.documentElement.appendChild(_142a);
var _142b=_1429.createElement("model");
if(typeof model=="string"&&model!==""){
_142b.appendChild(_1429.createTextNode(model));
}
_1429.documentElement.appendChild(_142b);
var _142c=_1429.createElement("selectedContext");
_1422.XMLBuilderSetAttributeNodeNS(_142c,"xmlns:xs","http://www.w3.org/2001/XMLSchema");
_1422.XMLBuilderSetAttributeNodeNS(_142c,"xmlns:bus","http://developer.cognos.com/schemas/bibus/3/");
_1422.XMLBuilderSetAttributeNodeNS(_142c,"SOAP-ENC:arrayType","bus:parameterValue[]","http://schemas.xmlsoap.org/soap/encoding/");
_1422.XMLBuilderSetAttributeNodeNS(_142c,"xmlns:xsd","http://www.w3.org/2001/XMLSchema");
_1422.XMLBuilderSetAttributeNodeNS(_142c,"xsi:type","SOAP-ENC:Array","http://www.w3.org/2001/XMLSchema-instance");
_1429.documentElement.appendChild(_142c);
for(var _142d in _1425){
var _142e=_1429.createElement("item");
_1422.XMLBuilderSetAttributeNodeNS(_142e,"xsi:type","bus:parameterValue","http://www.w3.org/2001/XMLSchema-instance");
var _142f=_1422.XMLBuilderCreateElementNS("http://developer.cognos.com/schemas/bibus/3/","bus:name",_1429);
_1422.XMLBuilderSetAttributeNodeNS(_142f,"xsi:type","xs:string","http://www.w3.org/2001/XMLSchema-instance");
_142f.appendChild(_1429.createTextNode(_1425[_142d].name));
var _1430=_1422.XMLBuilderCreateElementNS("http://developer.cognos.com/schemas/bibus/3/","bus:value",_1429);
_1422.XMLBuilderSetAttributeNodeNS(_1430,"xsi:type","SOAP-ENC:Array","http://www.w3.org/2001/XMLSchema-instance");
_1422.XMLBuilderSetAttributeNodeNS(_1430,"SOAP-ENC:arrayType","bus:parmValueItem[]","http://schemas.xmlsoap.org/soap/encoding/");
for(var j=0;j<_1425[_142d].values.length;j++){
var _1432=_1429.createElement("item");
_1422.XMLBuilderSetAttributeNodeNS(_1432,"xsi:type","bus:simpleParmValueItem","http://www.w3.org/2001/XMLSchema-instance");
var _1433=_1422.XMLBuilderCreateElementNS("http://developer.cognos.com/schemas/bibus/3/","bus:use",_1429);
_1422.XMLBuilderSetAttributeNodeNS(_1433,"xsi:type","xs:string","http://www.w3.org/2001/XMLSchema-instance");
_1433.appendChild(_1429.createTextNode(_1425[_142d].values[j][0]));
var _1434=_1422.XMLBuilderCreateElementNS("http://developer.cognos.com/schemas/bibus/3/","bus:display",_1429);
_1422.XMLBuilderSetAttributeNodeNS(_1434,"xsi:type","xs:string","http://www.w3.org/2001/XMLSchema-instance");
var _1435=_1425[_142d].values[j][1]==null?"":_1425[_142d].values[j][1];
_1434.appendChild(_1429.createTextNode(_1435));
_1432.appendChild(_1433);
_1432.appendChild(_1434);
_1430.appendChild(_1432);
}
_142e.appendChild(_142f);
_142e.appendChild(_1430);
_142c.appendChild(_142e);
}
var _1436=_1429.createElement("defaultMeasure");
_1429.documentElement.appendChild(_1436);
_1427.buildXML(_1422,_1429,"data");
var _1437=_1429.createElement("filter");
_1429.documentElement.appendChild(_1437);
}
return _1429;
};
CDrillManager.prototype.openSearchPage=function(_1438,_1439){
this.getModelDrillThroughContext(self);
var _143a=document.getElementById("searchPage");
if(_143a!=null){
document.body.removeChild(_143a);
}
_143a=document.createElement("form");
_143a.setAttribute("id","searchPage");
_143a.setAttribute("name","searchPage");
_143a.setAttribute("method","post");
_143a.setAttribute("target",_143a.name);
_143a.setAttribute("action",this.getCV().getGateway()+"/gosearch");
_143a.style.display="none";
document.body.appendChild(_143a);
_143a.appendChild(createHiddenFormField("csn.action","search"));
_143a.appendChild(createHiddenFormField("csn.drill",_1439));
var _143b=window.open("",_143a.name,"directories=no,location=no,status=no,toolbar=no,resizable=yes,scrollbars=yes,top=100,left=100,height=480,width=640");
_143b.focus();
_143a.submit();
};
CDrillManager.prototype.launchSearchPage=function(){
var _143c=this.getSelectionController();
var _143d=document.forms["formWarpRequest"+this.getCVId()];
var _143e=this.determineSelectionsForSearchPage(_143c);
var _143f=this.getSearchContextDataSpecfication(_143c);
var spXML=this.buildSearchPageXML(self,_143d.packageBase.value,this.getCV().getModelPath(),_143e,[],_143f,[]);
this.openSearchPage(_143d.packageBase.value,XMLBuilderSerializeNode(spXML));
};
CDrillManager.prototype.qsDrillDown=function(){
if(!this.canDrillDown()){
getConfigFrame().dlgGenericSelectionMessage(false);
return;
}
var _1441="DD:";
this.qsSendDrillCommand(_1441);
};
CDrillManager.prototype.qsDrillUp=function(){
if(!this.canDrillUp()){
getConfigFrame().dlgGenericSelectionMessage(false);
return;
}
var _1442="DU:";
this.qsSendDrillCommand(_1442);
};
CDrillManager.prototype.qsSendDrillCommand=function(_1443){
var _1444;
if(_1443=="DU:"){
_1444="drillUp";
}else{
_1444="drillDown";
}
var _1445=this.getDrillParameters(_1444,false,false);
if(_1445.length==0){
getConfigFrame().dlgGenericSelectionMessage(false);
return;
}
for(var idx=0;idx<_1445.length;++idx){
_1443+=getConfigFrame().escapeParam(_1445[idx]);
if(idx+1<_1445.length){
_1443+=",";
}
}
getConfigFrame().sendCmd(_1443,"",true);
};
CDrillManager.prototype.qsLaunchGoToPage=function(_1447){
var _1448=this.getSelectionController();
if(_1448!=null&&_1448.getModelDrillThroughEnabled()==true){
var _1449=this.getModelDrillThroughContext(cf);
if(_1449==""){
getConfigFrame().dlgGenericSelectionMessage(false);
return;
}
var _144a=document.getElementById("gotoPage");
if(_144a!=null){
document.body.removeChild(_144a);
}
_144a=document.createElement("form");
_144a.setAttribute("id","gotoPage");
_144a.setAttribute("name","gotoPage");
_144a.setAttribute("method","post");
_144a.style.display="none";
document.body.appendChild(_144a);
var _144b=getConfigFrame();
_144a.appendChild(this.createFormField("objpath",decodeURIComponent(_144b.cfgGet("PackageBase"))));
if(typeof gUseNewSelectionContext=="undefined"){
_144a.appendChild(this.createFormField("m","portal/goto2.xts"));
}else{
_144a.appendChild(this.createFormField("m","portal/goto.xts"));
}
_144a.appendChild(this.createFormField("b_action","xts.run"));
if(typeof gUseNewSelectionContext=="undefined"){
_144a.appendChild(this.createFormField("drillContext",_1449));
}else{
_144a.appendChild(this.createFormField("modeledDrillthru",_1449));
}
if(typeof getConfigFrame().routingServerGroup!="undefined"){
_144a.appendChild(this.createFormField("ui.routingServerGroup",getConfigFrame().routingServerGroup));
}
if(typeof _1447!="undefined"&&_1447==true){
_144a.appendChild(this.createFormField("directLaunch","true"));
}
var _144c=_144b.goApplicationManager.getReportManager().getParameterManager().getExecutionParameters();
if(_144c){
_144a.appendChild(this.createFormField("encExecutionParameters",_144c));
}
var _144d="winNAT_"+(new Date()).getTime();
var sPath=this.getCV().getWebContentRoot()+"/rv/blankDrillWin.html?cv.id="+this.getCVId();
window.open(sPath,_144d,"toolbar,location,status,menubar,resizable,scrollbars=1");
_144a.target=_144d;
}
};
CDrillManager.prototype.qsLaunchSearchPage=function(){
var cf=getConfigFrame();
var _1450=goWindowManager.getSelectionController();
var _1451=this.determineSelectionsForSearchPage(_1450);
var _1452=this.getSearchContextDataSpecfication(_1450);
var _1453=decodeURIComponent(cf.cfgGet("PackageBase"));
var spXML=this.buildSearchPageXML(cf,_1453,decodeURIComponent(cf.cfgGet("cmLastModel")),_1451,[],_1452,[]);
this.openSearchPage(_1453,cf.XMLBuilderSerializeNode(spXML));
};
CDrillManager.prototype.determineSelectionsForSearchPage=function(_1455){
var _1456=new CtxArrayPlaceHolder();
var _1457=_1455.getAllSelectedObjects();
for(var i=0;i<_1457.length;i++){
var _1459=_1457[i].getColumnName();
if(!this.containsByIndiceInArray(_1456,_1459)){
_1456[_1459]={};
_1456[_1459].name=_1459;
_1456[_1459].values=[];
}
var idx0="";
var muns=_1457[i].getMuns();
if(muns!=null&&muns.length>0){
idx0=muns[0][0];
}
var idx1=_1457[i].getDisplayValues()[0];
if(!(this.containsInArray(_1456[_1459].values,0,idx0)&&this.containsInArray(_1456[_1459].values,1,idx1))){
_1456[_1459].values[_1456[_1459].values.length]=[idx0,idx1];
}
}
return _1456;
};
CDrillManager.prototype.getSearchContextDataSpecfication=function(_145d){
var _145e=new CParameterValues();
var _145f=_145d.getCCDManager();
var _1460=_145f.m_cd;
for(var ctxId in _1460){
var _1462=_145f.GetUsage(ctxId);
if(_1462!="2"){
var _1463=_145f.GetRDIValue(ctxId);
var _1464=_145f.GetDisplayValue(ctxId);
_145e.addSimpleParmValueItem(_1463,_1463,_1464,"true");
}
}
return _145e;
};
CDrillManager.prototype.containsByIndiceInArray=function(a,v){
for(var i in a){
if(i==v){
return true;
}
}
return false;
};
CDrillManager.prototype.containsInArray=function(a,idx,v){
for(var i in a){
if(a[i][idx]==v){
return true;
}
}
return false;
};
CDrillManager.prototype.createFormField=function(name,value){
var _146e=document.createElement("input");
_146e.setAttribute("type","hidden");
_146e.setAttribute("name",name);
_146e.setAttribute("value",value);
return (_146e);
};
CDrillManager.prototype.getAuthoredDrillThroughTargets=function(){
var _146f=[];
var _1470=this.getSelectionController();
var _1471=null;
if(_1470!=null){
if(_1470.getSelectedColumnIds().length==1){
var _1472=_1470.getSelections();
for(var _1473=0;_1473<_1472.length;++_1473){
var _1474=_1472[_1473];
_1471=_1474.getCellRef();
while(_1471){
if(_1471.getAttribute("dtTargets")!=null){
_146f.push("<rvDrillTargets>"+_1471.getAttribute("dtTargets")+"</rvDrillTargets>");
break;
}
_1471=XMLHelper_GetFirstChildElement(_1471);
}
}
}else{
if(_1470.hasSelectedChartNodes()){
var _1475=_1470.getSelectedChartNodes();
var _1476=_1475[0];
_1471=_1476.getArea();
if(_1471.getAttribute("dtTargets")!=null){
_146f.push("<rvDrillTargets>"+_1471.getAttribute("dtTargets")+"</rvDrillTargets>");
}
}else{
if(_1470.getSelectedDrillThroughImage()!=null){
var _1477=_1470.getSelectedDrillThroughImage();
if(_1477&&_1477.getAttribute("dtTargets")!=null){
_146f.push("<rvDrillTargets>"+_1477.getAttribute("dtTargets")+"</rvDrillTargets>");
}
}else{
if(_1470.getSelectDrillThroughSingleton()!=null){
var _1478=_1470.getSelectDrillThroughSingleton();
if(_1478&&_1478.getAttribute("dtTargets")!=null){
_146f.push("<rvDrillTargets>"+_1478.getAttribute("dtTargets")+"</rvDrillTargets>");
}
}
}
}
}
}
return _146f;
};
CDrillManager.prototype.getDrillThroughParameters=function(_1479,evt){
if(typeof _1479=="undefined"){
_1479="query";
}
var _147b=[];
if(typeof evt!="undefined"){
var _147c=getCrossBrowserNode(evt,true);
try{
while(_147c){
if(typeof _147c.getAttribute!="undefined"&&_147c.getAttribute("dtTargets")){
_147b.push("<rvDrillTargets>"+_147c.getAttribute("dtTargets")+"</rvDrillTargets>");
break;
}
_147c=_147c.parentNode;
}
}
catch(e){
return false;
}
}else{
var oCV=this.getCV();
var _147e=oCV.getDrillMgr();
var _147f=_147e.getSelectionController();
if(_147f!=null){
var _1480=null;
if(_147f.hasSelectedChartNodes()){
var _1481=_147f.getSelectedChartNodes();
var _1482=_1481[0];
_1480=_1482.getArea();
}
if(_1480!=null){
_147b.push("<rvDrillTargets>"+_1480.getAttribute("dtTargets")+"</rvDrillTargets>");
}else{
_147b=this.getAuthoredDrillThroughTargets();
}
}
}
if(_147b.length>0){
var _1483="<AuthoredDrillTargets>";
for(var _1484=0;_1484<_147b.length;++_1484){
_1483+=eval("\""+_147b[_1484]+"\"");
}
_1483+="</AuthoredDrillTargets>";
var _1485=this.getCV().getAction("AuthoredDrill");
if(_1479=="query"){
_1485.populateContextMenu(_1483);
this.showOtherMenuItems();
}else{
if(this.getCV().envParams["cv.id"]=="AA"){
this.getCV().m_viewerFragment.raiseAuthoredDrillClickEvent();
}else{
_1485.execute(_1483);
}
}
return true;
}else{
if(_1479=="query"){
this.showOtherMenuItems();
return true;
}else{
return false;
}
}
};
CDrillManager.prototype.executeAuthoredDrill=function(_1486){
var _1487=decodeURIComponent(_1486);
var _1488=this.getCV().getAction("AuthoredDrill");
_1488.executeDrillTarget(_1487);
};
CDrillManager.prototype.doesMoreExist=function(_1489){
for(var i=0;i<_1489.getNumItems();i++){
var _148b=_1489.get(i);
if(_148b!=null){
if((_148b instanceof CMenuItem)&&(_148b.getLabel()==RV_RES.RV_MORE)&&(_148b.getAction()==this.getCVObjectRef()+".getDrillMgr().launchGoToPage();")){
return true;
}
}
}
return false;
};
CDrillManager.prototype.showOtherMenuItems=function(){
var cv=this.getCV();
var _148d=cv.rvMainWnd;
var _148e=_148d.getToolbarControl();
var _148f=null;
var _1490=null;
if(typeof _148e!="undefined"&&_148e!=null){
_148f=_148e.getItem("goto");
if(_148f){
_1490=_148f.getMenu();
}
}
var _1491=_148d.getContextMenu();
var _1492=_148d.getUIHide();
var _1493=null;
if(typeof _1491!="undefined"&&_1491!=null&&_1491.getGoToMenuItem()){
_1493=_1491.getGoToMenuItem().getMenu();
}
var _1494=null;
var _1495=this.getSelectionController();
if(_1490!=null){
if(this.doesMoreExist(_1490)==false){
if(typeof gMenuSeperator!="undefined"&&_1490.getNumItems()>0&&(cv.bCanUseCognosViewerIndexSearch||_1492.indexOf(" RV_TOOLBAR_BUTTONS_GOTO_RELATED_LINKS ")==-1)){
_1490.add(gMenuSeperator);
}
var _1496=new CMenuItem(_1490,RV_RES.RV_MORE,this.getCVObjectRef()+".getDrillMgr().launchGoToPage();","",gMenuItemStyle,cv.getWebContentRoot(),cv.getSkin());
if(_1492.indexOf(" RV_TOOLBAR_BUTTONS_GOTO_RELATED_LINKS ")!=-1){
_1496.hide();
}else{
if(_1495==null||_1495.getModelDrillThroughEnabled()==false){
_1496.disable();
}
}
}
}
if(_1493!=null){
if(typeof gMenuSeperator!="undefined"&&_1493.getNumItems()>0&&(cv.bCanUseCognosViewerIndexSearch||_1492.indexOf(" RV_CONTEXT_MENU_GOTO_RELATED_LINKS ")==-1)){
_1493.add(gMenuSeperator);
}
var _1497=new CMenuItem(_1493,RV_RES.RV_MORE,this.getCVObjectRef()+".getDrillMgr().launchGoToPage();","",gMenuItemStyle,cv.getWebContentRoot(),cv.getSkin());
if(_1492.indexOf(" RV_CONTEXT_MENU_GOTO_RELATED_LINKS ")!=-1){
_1497.hide();
}else{
if(_1495==null||_1495.getModelDrillThroughEnabled()==false){
_1497.disable();
}
}
}
if(_1494!=null&&_1495!=null){
var _1498=_1495.getAllSelectedObjects();
if(_1498==null||_1498.length===0){
_1494.disable();
}
}
if(_1490!=null){
_1490.draw();
if(_1490.isVisible()){
_1490.show();
}
}
if(_1493!=null){
_1493.draw();
if(_1493.isVisible()){
_1493.show();
}
}
};
CDrillManager.prototype.ddc=function(evt){
var node=getNodeFromEvent(evt);
if(node!=null&&node.getAttribute("ddc")!=="1"){
node.setAttribute("ddc","1");
if(node.getAttribute("dtTargets")){
node.className="dl "+node.className;
node.setAttribute("href","#");
return;
}
var _149b=this.getSelectionController();
if(_149b!=null){
var _149c=_149b.getSelectionObjectFactory().getSelectionChartObject(node);
if(_149c!=null){
var _149d=_149c.getDrillOptions();
for(var idx=0;idx<_149d.length;++idx){
var _149f=_149d[idx][0];
if((node.getAttribute("isChartTitle")==="true"&&_149f=="1")||_149f=="3"||_149f=="2"){
node.className="dl "+node.className;
node.setAttribute("href","#");
break;
}
}
}
}
}
};
function CImageMapHighlight(map,_14a1){
this.m_webContentRoot=_14a1;
this.createHighlight=CImageMapHighlight.prototype.createHighlightElement;
this.initialize(map);
};
CImageMapHighlight.prototype.initialize=function(map){
this.m_map=map;
this.m_areas={};
this.m_areaNodes={};
this.m_visibleAreas=[];
this.initImageBlank();
this.m_divCanvas=null;
this.m_creationNode=null;
this._setMapAreasId();
this.m_sDefaultFillColour="#F7E1BC";
this.m_sDefaultStrokeColour="#F0A630";
this.m_sFillColour=this.m_sDefaultFillColour;
this.m_sStrokeColour=this.m_sDefaultStrokeColour;
};
CImageMapHighlight.prototype.setFillColour=function(_14a3){
this.m_sFillColour=(!_14a3)?this.m_sDefaultFillColour:_14a3;
};
CImageMapHighlight.prototype.getFillColour=function(){
return this.m_sFillColour;
};
CImageMapHighlight.prototype.setStrokeColour=function(_14a4){
this.m_sStrokeColour=(!_14a4)?this.m_sDefaultStrokeColour:_14a4;
};
CImageMapHighlight.prototype.getStrokeColour=function(){
return this.m_sStrokeColour;
};
CImageMapHighlight.prototype.resetColours=function(){
this.m_sStrokeColour=this.m_sDefaultStrokeColour;
this.m_sFillColour=this.m_sDefaultFillColour;
};
CImageMapHighlight.prototype.initImageBlank=function(){
var img=this._getChartImageFromMap();
if(img===null){
return;
}
this.m_img=img;
this.m_sImageHeight=img.offsetHeight+"px";
this.m_sImageWidth=img.offsetWidth+"px";
this.m_sUseMap=img.getAttribute("usemap");
this.m_imgLid=img.getAttribute("lid");
this.m_imgBlank=img.ownerDocument.createElement("IMG");
this.m_imgBlank.src=this.m_webContentRoot+"/rv/images/blank.gif";
this.m_imgBlank.style.height=this.m_sImageHeight;
this.m_imgBlank.style.width=this.m_sImageWidth;
this.m_imgBlank.style.position="absolute";
this.m_imgBlank.border="0";
this.m_imgBlank.useMap=this.m_sUseMap;
this.m_imgBlank.setAttribute("lid",this.m_imgLid);
this.m_imgBlank.setAttribute("rsvpchart",img.getAttribute("rsvpchart"));
this.m_imgBlank.alt=img.alt;
if(this.m_bShowPointer){
this.m_imgBlank.style.cursor="auto";
}
this.m_imgBlank.v_bIsBlankImageMapImg=true;
img.parentNode.insertBefore(this.m_imgBlank,img);
this.f_copyStyle(img,this.m_imgBlank);
this.m_imgBlank.style.borderColor="transparent";
};
CImageMapHighlight.prototype._getChartImageFromMap=function(){
var map=this.m_map;
var _14a7=null;
var _14a8=null;
var _14a9=map.nextSibling;
while(_14a9){
if(_14a9.tagName=="DIV"){
var _14aa=_14a9.firstChild;
while(_14aa){
if((_14aa.tagName=="SPAN"||_14aa.tagName=="DIV")&&_14aa.getAttribute("chartcontainer")=="true"){
_14a8=_14aa;
break;
}
_14aa=_14aa.nextSibling;
}
}
if(_14a8){
break;
}
_14a9=_14a9.nextSibling;
}
if(_14a8){
var _14ab=_14a8.children;
var _14ac=_14ab.length;
for(var i=0;i<_14ac;i++){
var el=_14ab[i];
if(el.tagName=="IMG"&&el.getAttribute("rsvpchart")=="true"&&el.getAttribute("usemap")=="#"+map.name){
_14a7=el;
break;
}
}
}
return _14a7;
};
CImageMapHighlight.prototype._AREA_ID="aid";
CImageMapHighlight.prototype._setMapAreasId=function(){
var _14af=this.m_map.getAttribute("lid")+"_";
var areas=this.m_map.childNodes;
var _14b1=areas.length;
for(var i=0;i<_14b1;i++){
var a=areas[i];
var id=_14af+i;
a.setAttribute(this._AREA_ID,id);
this.m_areaNodes[id]=a;
}
};
CImageMapHighlight.prototype.isAreaInitialized=function(area){
return (area.getAttribute(this._AREA_ID)===null?false:true);
};
CImageMapHighlight.prototype.getAreaId=function(area){
var _14b7=area.getAttribute(this._AREA_ID);
if(_14b7===null){
this.initialize(area.parentNode);
_14b7=area.getAttribute(this._AREA_ID);
}
return _14b7+this.getFillColour();
};
CImageMapHighlight.prototype.getAreaFromId=function(_14b8){
return this.m_areaNodes[_14b8];
};
CImageMapHighlight.prototype.highlightArea=function(area,_14ba){
var _14bb=this.getAreaId(area);
if(!_14ba){
var _14bc=this.m_visibleAreas;
var _14bd=_14bc.length;
for(var i=0;i<_14bd;i++){
if(_14bb!=_14bc[i]){
this.hideAreaById(_14bc[i]);
}
}
this.m_visibleAreas=[];
}
this._highlightArea(area);
};
CImageMapHighlight.prototype.highlightAreas=function(areas,_14c0){
if(!_14c0){
this.hideAllAreas();
}
this._highlightAreas(areas);
};
CImageMapHighlight.prototype._highlightAreas=function(areas){
var _14c2=areas.length;
for(var i=0;i<_14c2;i++){
this._highlightArea(areas[i]);
}
};
CImageMapHighlight.prototype._highlightArea=function(area){
var _14c5=this.getAreaId(area);
if(!this.highlightAreaExists(_14c5)){
var _14c6=this.createHighlight(area);
if(_14c6){
this.m_areas[_14c5]=_14c6;
_14c6.style.visibility="visible";
area.setAttribute("highlighted","true");
}
}else{
if(this.m_areas[_14c5].style.visibility=="hidden"){
this.m_areas[_14c5].style.visibility="visible";
area.setAttribute("highlighted","true");
}
}
this.m_visibleAreas.push(_14c5);
};
CImageMapHighlight.prototype.highlightAreaExists=function(_14c7){
return this.m_areas[_14c7]?true:false;
};
CImageMapHighlight.prototype.hideAreaById=function(_14c8){
if(this.m_areas[_14c8]&&this.m_areas[_14c8].style.visibility){
this.m_areas[_14c8].style.visibility="hidden";
}
};
CImageMapHighlight.prototype.hideAreas=function(areas){
var _14ca=areas.length;
for(var i=0;i<_14ca;i++){
this.hideArea(areas[i]);
}
};
CImageMapHighlight.prototype.hideArea=function(area){
this.hideAreaById(this.getAreaId(area));
area.setAttribute("highlighted","false");
};
CImageMapHighlight.prototype.hideAllAreas=function(){
var _14cd=this.m_visibleAreas;
var _14ce=_14cd.length;
for(var i=0;i<_14ce;i++){
this.hideAreaById(_14cd[i]);
var _14d0=this.getAreaFromId(_14cd[i]);
if(_14d0){
_14d0.setAttribute("highlighted","false");
}
}
this.m_visibleAreas=[];
};
CImageMapHighlight.prototype.isAreaHighlighted=function(area){
var _14d2=this.getAreaId(area);
return this.m_areas[_14d2]&&this.m_areas[_14d2].style.visibility=="visible";
};
CImageMapHighlight.prototype.removeAreaHighlights=function(areas){
};
CImageMapHighlight.prototype.removeAllAreaHighlights=function(){
};
CImageMapHighlight.prototype.destroy=function(area){
this.removeAllAreaHighlights();
};
CImageMapHighlight.prototype.createHighlightElement=function(_14d5,_14d6){
var doc=_14d5.ownerDocument;
if(!this.m_divCanvas){
for(var _14d8=this.m_img.parentNode;_14d8;_14d8=_14d8.parentNode){
if((_14d8.nodeName=="DIV")&&(_14d8.getAttribute("sSpecName")=="block")){
var _14d9=doc.defaultView.getComputedStyle(_14d8,null);
var _14da=_14d9.overflow;
if((_14da=="auto")||(_14da=="scroll")&&(_14d9.position!="relative")){
_14d8.style.position="relative";
}
}
}
this.m_divCanvas=doc.createElementNS("http://www.w3.org/2000/svg","svg");
this.m_divCanvas.style.height=this.m_sImageHeight;
this.m_divCanvas.style.width=this.m_sImageWidth;
this.m_divCanvas.style.position="absolute";
this.m_img.parentNode.insertBefore(this.m_divCanvas,this.m_imgBlank);
this.f_copyStyle(this.m_imgBlank,this.m_divCanvas);
this.m_divCanvas.style.display=this.m_bHiddenCanvas?"none":"block";
}
var _14db=doc.createElementNS("http://www.w3.org/2000/svg","polyline");
var _14dc=_14d5.getAttribute("coords");
_14db.setAttribute("points",_14d5.getAttribute("coords")+" "+_14dc.substr(0,_14dc.indexOf(",",_14dc.indexOf(",")+1)));
_14db.style.position="absolute";
_14db.style.top="0px";
_14db.style.left="0px";
_14db.style.visibility="hidden";
_14db.setAttribute("stroke",_14d6?"#F7CB83":this.getStrokeColour());
_14db.setAttribute("stroke-width",(_14d5.getAttribute("type")=="legendLabel")?"1pt":"1.75pt");
_14db.setAttribute("fill",_14d6?"#F7E1BC":this.getFillColour());
_14db.setAttribute("fill-opacity","0.4");
this.m_divCanvas.appendChild(_14db);
return _14db;
};
CImageMapHighlight.prototype.f_copyStyle=function(_14dd,_14de){
var a=["margin","marginTop","marginRight","marginBottom","marginLeft","border","borderTop","borderRight","borderBottom","borderLeft"];
var _14e0=a.length;
for(var i=0;i<_14e0;i++){
var _14e2=a[i];
var _14e3=_14dd.style[_14e2];
if(_14e3){
_14de.style[_14e2]=_14e3;
}
}
};
function CSelectionXml(_14e4,_14e5,_14e6){
this.queries={};
this.burstContext=_14e4||"";
this.expressionLocale=_14e5||"";
this.contentLocale=_14e6||"";
};
function SC_SingleSelection(){
this.rows=[];
this.cols=[];
this.sections=[];
this.measures=[];
this.layoutElementId="";
};
function SC_SingleQuery(){
this.selections=[];
this.slicers=[];
this.filters=[];
};
function SC_SingleSlicer(){
};
function SC_SingleDetailFilter(){
};
function SC_SingleSummaryFilter(){
};
CSelectionXml.prototype.BuildSelectionFromController=function(sc){
if(sc){
var _14e8=sc.getAllSelectedObjects();
for(var s=0;s<_14e8.length;++s){
var _14ea=_14e8[s];
var _14eb=_14ea.getSelectedContextIds();
var muns=_14ea.getMuns();
var _14ed=muns.length;
var _14ee=new SC_SingleSelection();
_14ee.layoutElementId=_14ea.getLayoutElementId();
var _14ef=null;
for(var i=0;i<_14ed;++i){
var j,ctxId,_14f3;
if(i===0&&_14ed===1){
for(j=0;j<muns[i].length;++j){
ctxId=_14eb[i][j];
if(ctxId!=0){
if(j===0){
_14ef=sc.getRefQuery(ctxId);
_14f3=_14ea.getDisplayValues()[j];
this._buildMeasureSelection(sc,ctxId,_14ee.measures,_14f3,j,_14ea.getLayoutType());
}else{
if(sc.getUsageInfo(ctxId)!=2){
this._buildEdgeSelection(sc,ctxId,_14ee.cols,j);
}
}
}
}
}else{
for(j=0;j<muns[i].length;++j){
ctxId=_14eb[i][j];
if(ctxId!=0){
if(i===0){
_14f3=_14ea.getDisplayValues()[j];
_14ef=sc.getRefQuery(ctxId);
this._buildMeasureSelection(sc,ctxId,_14ee.measures,_14f3,j,_14ea.getLayoutType());
}else{
if(i===1){
this._buildEdgeSelection(sc,ctxId,_14ee.rows,j);
}else{
if(i===2){
this._buildEdgeSelection(sc,ctxId,_14ee.cols,j);
}else{
this._buildSectionSelection(sc,ctxId,_14ee.sections,j);
}
}
}
}
}
}
}
this.AddSelection(_14ef,_14ee);
}
}
};
CSelectionXml.prototype.AddSelection=function(_14f4,_14f5){
if(!this.queries[_14f4]){
this.queries[_14f4]=new SC_SingleQuery();
}
this.queries[_14f4].selections.push(_14f5);
};
CSelectionXml.prototype._buildMeasureSelection=function(sc,ctxId,_14f8,_14f9,idx,_14fb){
if(_14fb==""||_14fb==null){
_14fb="datavalue";
}
if(ctxId){
_14f8.push({name:sc.getRefDataItem(ctxId),values:[{use:sc.getUseValue(ctxId),display:_14f9}],order:idx,hun:sc.getHun(ctxId),dataType:_14fb,usage:sc.getUsageInfo(ctxId),dtype:sc.getDataType(ctxId),selection:"true"});
}
};
CSelectionXml.prototype._buildEdgeSelection=function(sc,ctxId,edges,idx){
if(ctxId){
edges.push({name:sc.getRefDataItem(ctxId),values:[{use:this.getUseValue(sc,ctxId),display:sc.getDisplayValue(ctxId)}],order:idx,lun:sc.getLun(ctxId),hun:sc.getHun(ctxId),dataType:"columnTitle",usage:sc.getUsageInfo(ctxId),dtype:sc.getDataType(ctxId)});
}
};
CSelectionXml.prototype._buildSectionSelection=function(sc,ctxId,_1502,idx){
if(ctxId){
_1502.push({name:sc.getRefDataItem(ctxId),values:[{use:this.getUseValue(sc,ctxId),display:sc.getDisplayValue(ctxId)}],order:idx,lun:sc.getLun(ctxId),hun:sc.getHun(ctxId),dataType:"section",usage:sc.getUsageInfo(ctxId),dtype:sc.getDataType(ctxId),queryRef:sc.getRefQuery(ctxId)});
}
};
CSelectionXml.prototype.getUseValue=function(sc,ctxId){
var _1506=sc.getMun(ctxId);
if(_1506==""){
_1506=sc.getUseValue(ctxId);
}
return _1506;
};
CSelectionXml.prototype.toXml=function(){
var _1507=XMLBuilderCreateXMLDocument("selections");
var _1508=_1507.documentElement;
XMLBuilderSetAttributeNodeNS(_1508,"xmlns:xs","http://www.w3.org/2001/XMLSchema");
XMLBuilderSetAttributeNodeNS(_1508,"xmlns:bus","http://developer.cognos.com/schemas/bibus/3/");
XMLBuilderSetAttributeNodeNS(_1508,"SOAP-ENC:arrayType","bus:parameterValue[]","http://schemas.xmlsoap.org/soap/encoding/");
XMLBuilderSetAttributeNodeNS(_1508,"xmlns:xsd","http://www.w3.org/2001/XMLSchema");
XMLBuilderSetAttributeNodeNS(_1508,"xsi:type","SOAP-ENC:Array","http://www.w3.org/2001/XMLSchema-instance");
_1508.setAttribute("contentLocale",this.contentLocale);
_1508.setAttribute("expressionLocale",this.expressionLocale);
for(var q in this.queries){
this._queryToXml(_1508,q,this.queries[q]);
}
this._burstToXml(_1508);
return XMLBuilderSerializeNode(_1507);
};
CSelectionXml.prototype._queryToXml=function(_150a,name,obj){
var _150d=_150a.ownerDocument.createElement("query");
_150d.setAttribute("name",name);
for(var _150e=0;_150e<obj.selections.length;++_150e){
this._selectionToXml(_150d,obj.selections[_150e]);
}
for(var _150f=0;_150f<obj.slicers.length;++_150f){
this._slicersToXml(_150d,obj.slicers[_150f]);
}
for(var _1510=0;_1510<obj.selections.length;++_1510){
this._filtersToXml(_150d,obj.selections[_1510]);
}
_150a.appendChild(_150d);
};
CSelectionXml.prototype._selectionToXml=function(_1511,_1512){
var doc=_1511.ownerDocument;
var _1514=doc.createElement("selection");
_1511.appendChild(_1514);
this._edgeToXml(_1514,"row",_1512.rows);
this._edgeToXml(_1514,"column",_1512.cols);
this._edgeToXml(_1514,"measure",_1512.measures);
this._edgeToXml(_1514,"section",_1512.sections);
var _1515=doc.createElement("layoutElementId");
_1515.appendChild(doc.createTextNode(_1512.layoutElementId));
_1514.appendChild(_1515);
};
CSelectionXml.prototype._edgeToXml=function(_1516,sEdge,_1518){
var doc=_1516.ownerDocument;
var _151a=doc.createElement(sEdge+"s");
_1516.appendChild(_151a);
for(var i=0;i<_1518.length;++i){
var _151c=doc.createElement(sEdge);
_151a.appendChild(_151c);
var edge=_1518[i];
for(var j in edge){
if(j!=="name"&&j!=="values"){
_151c.setAttribute(j,edge[j]!==null?edge[j]:"");
}
}
this._itemToXml(_151c,edge.name,edge.values);
}
};
CSelectionXml.prototype._itemToXml=function(_151f,name,_1521){
var doc=_151f.ownerDocument;
var _1523=doc.createElement("item");
XMLBuilderSetAttributeNodeNS(_1523,"xsi:type","bus:parameterValue","http://www.w3.org/2001/XMLSchema-instance");
var _1524=XMLBuilderCreateElementNS("http://developer.cognos.com/schemas/bibus/3/","bus:name",doc);
XMLBuilderSetAttributeNodeNS(_1524,"xsi:type","xs:string","http://www.w3.org/2001/XMLSchema-instance");
_1524.appendChild(doc.createTextNode(name));
_1523.appendChild(_1524);
var _1525=XMLBuilderCreateElementNS("http://developer.cognos.com/schemas/bibus/3/","bus:value",doc);
XMLBuilderSetAttributeNodeNS(_1525,"xsi:type","SOAP-ENC:Array","http://www.w3.org/2001/XMLSchema-instance");
XMLBuilderSetAttributeNodeNS(_1525,"SOAP-ENC:arrayType","bus:parmValueItem[]","http://schemas.xmlsoap.org/soap/encoding/");
_1523.appendChild(_1525);
for(var j=0;j<_1521.length;j++){
var _1527=doc.createElement("item");
XMLBuilderSetAttributeNodeNS(_1527,"xsi:type","bus:simpleParmValueItem","http://www.w3.org/2001/XMLSchema-instance");
var _1528=XMLBuilderCreateElementNS("http://developer.cognos.com/schemas/bibus/3/","bus:use",doc);
XMLBuilderSetAttributeNodeNS(_1528,"xsi:type","xs:string","http://www.w3.org/2001/XMLSchema-instance");
if(_1521[j].use){
_1528.appendChild(doc.createTextNode(_1521[j].use));
}else{
if(_1521[j].display){
_1528.appendChild(doc.createTextNode(_1521[j].display));
}else{
_1528.appendChild(doc.createTextNode(""));
}
}
var _1529=XMLBuilderCreateElementNS("http://developer.cognos.com/schemas/bibus/3/","bus:display",doc);
XMLBuilderSetAttributeNodeNS(_1529,"xsi:type","xs:string","http://www.w3.org/2001/XMLSchema-instance");
if(_1521[j].display){
_1529.appendChild(doc.createTextNode(_1521[j].display));
}else{
_1529.appendChild(doc.createTextNode(""));
}
_1527.appendChild(_1528);
_1527.appendChild(_1529);
_1525.appendChild(_1527);
}
_151f.appendChild(_1523);
};
CSelectionXml.prototype._burstToXml=function(_152a){
var doc=_152a.ownerDocument;
var _152c=doc.createElement("burst-context");
_152c.appendChild(doc.createTextNode(this.burstContext));
_152a.appendChild(_152c);
};
CSelectionXml.prototype._slicersToXml=function(_152d,_152e){
};
CSelectionXml.prototype._filtersToXml=function(_152f,_1530){
};
CSubscriptionManager.k_SubscriptionWizardName="subscriptionWizard";
function CSubscriptionManager(cv){
this.m_cv=cv;
this.m_bInitialized=false;
this.m_aWatchRules=null;
this.m_sEmail="";
this.m_sAlertNewVersionConfirm="";
this.m_sQueryNotificationResponse="";
this.m_bAllowNotification=false;
this.m_bAllowSubscription=false;
this.m_bCanCreateNewWatchRule=false;
this.m_bCanGetNotified=false;
this.m_bAllowAnnotations=false;
this.m_bCanCreateAnnotations=false;
this.m_windowOptions="width=450,height=350,toolbar=0,location=0,status=0,menubar=0,resizable,scrollbars=1";
};
CSubscriptionManager.prototype.getViewer=function(){
return this.m_cv;
};
CSubscriptionManager.prototype.Initialize=function(_1532){
try{
var _1533=_1532.getJSONResponseObject();
var _1534=document.forms["formWarpRequest"+this.m_cv.getId()];
if(_1533["annotationInfo"]){
var _1535=_1533["annotationInfo"];
this.m_AnnotationsCount=_1535.annotations.length;
this.m_annotations=_1535.annotations;
this.m_bAllowAnnotations=_1535.allowAnnotations;
this.m_bCanCreateAnnotations=_1535.traverse=="true";
return true;
}
if(_1533["subscriptionInfo"]){
var _1536=_1533["subscriptionInfo"];
if(!this.m_bInitialized){
this.m_sEmail=_1536.sEmail;
this.m_bAllowNotification=_1536.bAllowNotification;
this.m_bAllowSubscription=_1536.bAllowSubscription;
this.m_sAlertNewVersionConfirm=_1536.sAlertNewVersionConfirm;
if(_1534["ui.action"]&&_1534["ui.action"].value=="view"){
if(_1534["ui.format"]){
this.m_bCanCreateNewWatchRule=(_1534["ui.format"].value=="HTML")&&this.m_cv.bCanUseCognosViewerConditionalSubscriptions&&this.m_bAllowSubscription;
}
this.m_bCanGetNotified=(!_1534["ui.burstKey"]||(_1534["ui.burstKey"]&&_1534["ui.burstKey"].value==""))&&this.m_bAllowNotification;
}
}
if(_1536.sQueryNotificationResponse){
this.m_sQueryNotificationResponse=_1536.sQueryNotificationResponse;
}
if(_1536.aWatchRules){
var _1537=_1536.aWatchRules;
this.m_aWatchRules=[];
for(var i=0;i<_1537.length;i++){
this.m_aWatchRules.push(_1537[i]);
}
}
this.m_bInitialized=true;
return true;
}
}
catch(exception){
return false;
}
return false;
};
CSubscriptionManager.prototype.IsValidSelectionForNewRule=function(){
var _1539=this.m_cv.getSelectionController();
if(_1539&&!_1539.hasSelectedChartNodes()){
var _153a=_1539.getAllSelectedObjects();
if(_153a.length===1){
if(_153a[0]!=null&&_153a[0].getLayoutType()!="columnTitle"){
return true;
}
}
}
return false;
};
CSubscriptionManager.prototype.CanCreateNewWatchRule=function(){
if(typeof this.m_cv.UIBlacklist!="undefined"&&this.m_cv.UIBlacklist.indexOf(" RV_TOOLBAR_BUTTONS_ALERT_USING_NEW_WATCH_RULE ")!=-1){
return false;
}
if(!this.m_bInitialized&&this.getViewer().envParams["ui.action"]=="view"){
var oCV=this.getViewer();
var _153c=new JSONDispatcherEntry(oCV);
_153c.setKey("subscriptionManager");
_153c.forceSynchronous();
_153c.addFormField("ui.action","getSubscriptionInfo");
_153c.addFormField("cv.responseFormat","subscriptionManager");
_153c.addFormField("contextMenu","true");
this.addCommonFormFields(_153c);
_153c.setCallbacks({"complete":{"object":this,"method":this.Initialize}});
oCV.dispatchRequest(_153c);
}
return this.m_bCanCreateNewWatchRule;
};
CSubscriptionManager.prototype.CanModifyWatchRule=function(){
return this.m_cv.bCanUseCognosViewerConditionalSubscriptions&&this.m_bAllowSubscription;
};
CSubscriptionManager.prototype.CanGetNotified=function(){
if(typeof this.m_cv.UIBlacklist!="undefined"&&this.m_cv.UIBlacklist.indexOf(" RV_TOOLBAR_BUTTONS_ALERT_ABOUT_NEW_VERSIONS ")!=-1){
return false;
}
return this.m_bCanGetNotified;
};
CSubscriptionManager.prototype.UpdateSubscribeMenu=function(){
var _153d=this.getStandaloneViewerToolbarControl();
var _153e=_153d?_153d.getItem("watchNewVersions"):null;
var _153f=this.m_cv.getWebContentRoot();
var sSkin=this.m_cv.getSkin();
if(_153e){
var _1541=_153e.getMenu();
this.ClearSubscriptionMenu();
var _1542=false;
if(this.CanGetNotified()){
if(this.m_sQueryNotificationResponse=="on"){
new CMenuItem(_1541,RV_RES.RV_DO_NOT_ALERT_NEW_VERSION,"javascript:"+this.m_cv.getObjectId()+".getSubscriptionManager().DeleteNotification();",_153f+"/rv/images/action_remove_from_list.gif",gMenuItemStyle,_153f,sSkin);
_1542=true;
}else{
if(this.m_sQueryNotificationResponse=="off"&&this.m_sEmail!=""){
new CMenuItem(_1541,RV_RES.RV_ALERT_NEW_VERSION,"javascript:"+this.m_cv.getObjectId()+".getSubscriptionManager().AddNotification();",_153f+"/rv/images/action_add_to_list.gif",gMenuItemStyle,_153f,sSkin);
_1542=true;
}
}
}
if(this.CanCreateNewWatchRule()){
if(_1542){
_1541.add(gMenuSeperator);
}
var _1543=new CMenuItem(_1541,RV_RES.RV_NEW_WATCH_RULE,"javascript:"+this.m_cv.getObjectId()+".getSubscriptionManager().NewSubscription();",_153f+"/rv/images/action_new_subscription.gif",gMenuItemStyle,_153f,sSkin);
if(!this.IsValidSelectionForNewRule()){
_1543.disable();
}
_1542=true;
}
var _1544="";
if(typeof this.m_cv.UIBlacklist!="undefined"){
_1544=this.m_cv.UIBlacklist;
}
var _1545;
if(_1544.indexOf(" RV_TOOLBAR_BUTTONS_RULES ")==-1){
if(_1542){
_1541.add(gMenuSeperator);
}
if(this.m_aWatchRules&&this.m_aWatchRules.length>0){
var _1546=this.CanModifyWatchRule();
for(var sub=0;sub<this.m_aWatchRules.length;++sub){
var menu=new CMenuItem(_1541,this.m_aWatchRules[sub].name,"",_153f+"/rv/images/icon_subscription.gif",gMenuItemStyle,_153f,sSkin);
var _1549=menu.createCascadedMenu(gMenuStyle);
_1549.m_oCV=this.m_cv;
if(_1546&&_1544.indexOf(" RV_TOOLBAR_BUTTONS_RULES_MODIFY ")==-1){
new CMenuItem(_1549,RV_RES.RV_MODIFY_WATCH_RULE,this.m_cv.getObjectId()+".getSubscriptionManager().ModifySubscription("+sub+");",_153f+"/rv/images/action_edit.gif",gMenuItemStyle,_153f,sSkin);
}
if(_1544.indexOf(" RV_TOOLBAR_BUTTONS_RULES_DELETE ")==-1){
new CMenuItem(_1549,RV_RES.RV_DELETE_WATCH_RULE,this.m_cv.getObjectId()+".getSubscriptionManager().DeleteSubscription("+sub+");",_153f+"/rv/images/action_delete.gif",gMenuItemStyle,_153f,sSkin);
}
}
}else{
_1545=new CMenuItem(_1541,RV_RES.RV_NO_WATCH_RULES,"","",gMenuItemStyle,_153f,sSkin);
_1545.disable();
}
}
if(_1541.getNumItems()==0){
_1545=new CMenuItem(_1541,RV_RES.RV_NO_WATCH_RULES,"","",gMenuItemStyle,_153f,sSkin);
_1545.disable();
}
_1541.setForceCallback(false);
_1541.draw();
if(_1541.isVisible()){
_1541.show();
}
_1541.setForceCallback(true);
}
};
CSubscriptionManager.prototype.UpdateAnnotationMenu=function(){
var _154a=this.getStandaloneViewerToolbarControl();
var _154b=_154a?_154a.getItem("addAnnotations"):null;
var _154c=this.m_cv.getWebContentRoot();
var sSkin=this.m_cv.getSkin();
var _154e=_154b.getMenu();
this.ClearAnnotationMenu();
var menu=new CMenuItem(_154e,RV_RES.RV_NEW_COMMENT,"javascript:"+this.m_cv.getObjectId()+".getSubscriptionManager().NewAnnotation();",_154c+"/rv/images/action_comment_add.gif",gMenuItemStyle,_154c,sSkin);
var _1550=this.m_annotations.length;
if(_1550>0){
_154e.add(gMenuSeperator);
}
if(!this.m_bAllowAnnotations||!this.m_bCanCreateAnnotations){
menu.disable();
}
var _1551;
var bidi=isViewerBidiEnabled()?BidiUtils.getInstance():null;
for(var i=0;i<_1550;i++){
var _1554=this.m_annotations[i].defaultName;
_1551=_1554.length>60?_1554.substring(0,60)+"...":_1554;
if(isViewerBidiEnabled()){
_1551=bidi.btdInjectUCCIntoStr(_1551,getViewerBaseTextDirection());
}
var _1555=Boolean(this.m_annotations[i].permissions.read);
var _1556=Boolean(this.m_annotations[i].permissions.write);
var _1557=Boolean(this.m_annotations[i].permissions.traverse)&&Boolean(this.m_annotations[i].permissions.write);
var _1558="javascript:"+this.m_cv.getObjectId()+".getSubscriptionManager().ViewAnnotation("+i+");";
var _1559="javascript:alert('Permission denied')";
_1558=_1555?_1558:_1559;
if(i>0&&this.m_annotations[i].layoutElementId!=this.m_annotations[i-1].layoutElementId){
_154e.add(gMenuSeperator);
}
var _155a="/rv/images/action_comment.gif";
if(this.m_annotations[i].layoutElementId!=""){
_155a="/rv/images/action_subscribe.gif";
}
menu=new CMenuItem(_154e,_1551,_1558,_154c+_155a,gMenuItemStyle,_154c,sSkin);
var _155b=menu.createCascadedMenu(gMenuStyle);
var _155c=new CInfoPanel("300px",_154c,_155b.getId()+"_comments");
_155c.setParent(_155b);
_1554=this.m_annotations[i].defaultName;
var _155d=_1554.length>60?_1554.substring(0,60)+"...":_1554;
if(isViewerBidiEnabled()){
_155d=bidi.btdInjectUCCIntoStr(_155d,getViewerBaseTextDirection());
}
_155c.addProperty(RV_RES.RV_VIEW_COMMENT_NAME,html_encode(_155d));
_155c.addSpacer(4);
var cmnt=this.m_annotations[i].description;
var _155f=cmnt.length>590?cmnt.substring(0,590)+"...":cmnt;
if(isViewerBidiEnabled()){
_155f=bidi.btdInjectUCCIntoStr(_155f,getViewerBaseTextDirection());
}
_155c.addProperty(RV_RES.RV_VIEW_COMMENT_CONTENTS,replaceNewLine(html_encode(_155f)));
_155c.addSpacer(4);
var _1560=this.m_annotations[i].modificationTime;
if(isViewerBidiEnabled()){
_1560=bidi.btdInjectUCCIntoStr(_1560,getViewerBaseTextDirection());
}
_155c.addProperty(RV_RES.RV_VIEW_COMMENT_MODTIME,_1560);
var _1561=this.m_annotations[i].owner.defaultName;
if(isViewerBidiEnabled()){
_1561=bidi.btdInjectUCCIntoStr(_1561,getViewerBaseTextDirection());
}
_155c.addProperty(RV_RES.RV_VIEW_COMMENT_OWNER,_1561);
_155b.add(_155c);
if(_1556||_1557){
_155b.add(gMenuSeperator);
}
new CMenuItem(_155b,RV_RES.RV_VIEW_COMMENT,this.m_cv.getObjectId()+".getSubscriptionManager().ViewAnnotation("+i+");",_154c+"/rv/images/action_comment_view.gif",gMenuItemStyle,_154c,sSkin);
if(_1556){
new CMenuItem(_155b,RV_RES.RV_MODIFY_WATCH_RULE,this.m_cv.getObjectId()+".getSubscriptionManager().ModifyAnnotation("+i+");",_154c+"/rv/images/action_comment_modify.gif",gMenuItemStyle,_154c,sSkin);
}
if(_1557){
new CMenuItem(_155b,RV_RES.RV_DELETE_WATCH_RULE,this.m_cv.getObjectId()+".getSubscriptionManager().DeleteAnnotation("+i+");",_154c+"/rv/images/action_comment_delete.gif",gMenuItemStyle,_154c,sSkin);
}
}
_154e.setForceCallback(false);
_154e.draw();
if(_154e.isVisible()){
_154e.show();
}
_154e.setForceCallback(true);
};
CSubscriptionManager.prototype.AddNotification=function(){
alert(this.m_sAlertNewVersionConfirm);
var oCV=this.getViewer();
var _1563=new DataDispatcherEntry(oCV);
_1563.setKey("subscriptionManager");
_1563.addFormField("ui.action","addNotification");
_1563.addFormField("cv.responseFormat","data");
this.addCommonFormFields(_1563);
oCV.dispatchRequest(_1563);
};
CSubscriptionManager.prototype.DeleteNotification=function(){
alert(RV_RES.RV_DO_NOT_ALERT_NEW_VERSION_CONFIRM);
var oCV=this.getViewer();
var _1565=new DataDispatcherEntry(oCV);
_1565.setKey("subscriptionManager");
_1565.addFormField("ui.action","deleteNotification");
_1565.addFormField("cv.responseFormat","data");
this.addCommonFormFields(_1565);
oCV.dispatchRequest(_1565);
};
CSubscriptionManager.prototype.NewAnnotation=function(){
var oFWR=document.forms["formWarpRequest"+this.m_cv.getId()];
var _1567=oFWR["ui.object"].value;
var form=GUtil.createHiddenForm("subscriptionForm","post",this.m_cv.getId(),CSubscriptionManager.k_SubscriptionWizardName);
GUtil.createFormField(form,"ui.object",_1567);
GUtil.createFormField(form,"b_action","xts.run");
GUtil.createFormField(form,"m","rv/annotation1.xts");
GUtil.createFormField(form,"backURL","javascript:window.close();");
GUtil.createFormField(form,"action_hint","create");
var sPath=this.m_cv.getWebContentRoot()+"/rv/blankSubscriptionWin.html?cv.id="+this.m_cv.getId();
window.open(sPath,form.target,this.m_windowOptions);
};
CSubscriptionManager.prototype.ViewAnnotation=function(idx){
var sub=this.m_annotations[idx];
var _156c=sub.searchPath;
var form=GUtil.createHiddenForm("subscriptionForm","post",this.m_cv.getId(),CSubscriptionManager.k_SubscriptionWizardName);
GUtil.createFormField(form,"ui.object",_156c);
GUtil.createFormField(form,"b_action","xts.run");
GUtil.createFormField(form,"m","rv/annotation1.xts");
GUtil.createFormField(form,"backURL","javascript:window.close();");
var sPath=this.m_cv.getWebContentRoot()+"/rv/blankSubscriptionWin.html?cv.id="+this.m_cv.getId();
window.open(sPath,form.target,this.m_windowOptions);
};
CSubscriptionManager.prototype.ModifyAnnotation=function(idx){
var sub=this.m_annotations[idx];
var _1571=this.m_annotations[idx].searchPath;
if(sub&&_1571){
var form=GUtil.createHiddenForm("subscriptionForm","post",this.m_cv.getId(),CSubscriptionManager.k_SubscriptionWizardName);
GUtil.createFormField(form,"ui.object",_1571);
GUtil.createFormField(form,"b_action","xts.run");
GUtil.createFormField(form,"m","rv/annotation1.xts");
GUtil.createFormField(form,"backURL","javascript:window.close();");
GUtil.createFormField(form,"action_hint","save");
var sPath=this.m_cv.getWebContentRoot()+"/rv/blankSubscriptionWin.html?cv.id="+this.m_cv.getId();
window.open(sPath,form.target,this.m_windowOptions);
}
};
CSubscriptionManager.prototype.DeleteAnnotation=function(idx){
var sub=this.m_annotations[idx];
if(sub&&sub.searchPath&&confirm(RV_RES.RV_CONFIRM_DELETE_WATCH_RULE)){
var oCV=this.getViewer();
var _1577=new DataDispatcherEntry(oCV);
_1577.setKey("subscriptionManager");
_1577.addFormField("ui.action","deleteAnnotation");
_1577.addFormField("cv.responseFormat","data");
this.addCommonFormFields(_1577,sub.searchPath);
oCV.dispatchRequest(_1577);
}
};
CSubscriptionManager.prototype.NewSubscription=function(){
var sc=this.m_cv.getSelectionController();
var oFWR=document.forms["formWarpRequest"+this.m_cv.getId()];
var _157a=oFWR.reRunObj.value;
if(_157a&&sc&&sc.getAllSelectedObjects().length===1){
var form=GUtil.createHiddenForm("subscriptionForm","post",this.m_cv.getId(),CSubscriptionManager.k_SubscriptionWizardName);
var fWR=document.getElementById("formWarpRequest"+this.m_cv.getId());
var _157d=new CSelectionXml(fWR["ui.burstID"].value,fWR["ui.contentLocale"].value,fWR["ui.outputLocale"].value);
_157d.BuildSelectionFromController(sc);
GUtil.createFormField(form,"rv.selectionSpecXML",_157d.toXml());
GUtil.createFormField(form,"rv.periodicalProducer",_157a);
GUtil.createFormField(form,"b_action","xts.run");
GUtil.createFormField(form,"m","subscribe/conditional_subscribe1.xts");
GUtil.createFormField(form,"backURL","javascript:window.close();");
var sPath=this.m_cv.getWebContentRoot()+"/rv/blankSubscriptionWin.html?cv.id="+this.m_cv.getId();
window.open(sPath,form.target,"toolbar,location,status,menubar,resizable,scrollbars=1");
}else{
}
};
CSubscriptionManager.prototype.DeleteSubscription=function(idx){
var sub=this.m_aWatchRules[idx];
if(sub&&sub.searchPath&&confirm(RV_RES.RV_CONFIRM_DELETE_WATCH_RULE)){
var oCV=this.getViewer();
var _1582=new DataDispatcherEntry(oCV);
_1582.setKey("subscriptionManager");
_1582.addFormField("ui.action","deleteSubscription");
_1582.addFormField("cv.responseFormat","data");
this.addCommonFormFields(_1582,sub.searchPath);
oCV.dispatchRequest(_1582);
}
};
CSubscriptionManager.prototype.ModifySubscription=function(idx){
var sub=this.m_aWatchRules[idx];
if(sub&&sub.searchPath){
var form=GUtil.createHiddenForm("subscriptionForm","post",this.m_cv.getId(),CSubscriptionManager.k_SubscriptionWizardName);
GUtil.createFormField(form,"m_obj",sub.searchPath);
GUtil.createFormField(form,"m_name",sub.name);
GUtil.createFormField(form,"b_action","xts.run");
GUtil.createFormField(form,"m_class","reportDataServiceAgentDefinition");
GUtil.createFormField(form,"m","portal/properties_subscription.xts");
GUtil.createFormField(form,"backURL","javascript:window.close();");
var sPath=this.m_cv.getWebContentRoot()+"/rv/blankSubscriptionWin.html?cv.id="+this.m_cv.getId();
window.open(sPath,form.target,"toolbar,location,status,menubar,resizable,scrollbars=1");
}
};
CSubscriptionManager.prototype.OpenSubscriptionMenu=function(){
var oCV=this.getViewer();
var _1588=new JSONDispatcherEntry(oCV);
_1588.setKey("subscriptionManager");
_1588.addFormField("ui.action","getSubscriptionInfo");
_1588.addFormField("cv.responseFormat","subscriptionManager");
this.addCommonFormFields(_1588);
_1588.setCallbacks({"complete":{"object":this,"method":this.OpenSubscriptionMenuResponse}});
oCV.dispatchRequest(_1588);
};
CSubscriptionManager.prototype.OpenAnnotationMenu=function(){
var oCV=this.getViewer();
var _158a=new JSONDispatcherEntry(oCV);
_158a.setKey("subscriptionManager");
_158a.addFormField("ui.action","getAnnotationInfo");
_158a.addFormField("cv.responseFormat","getAnnotations");
var _158b=oCV.envParams["ui.object"];
this.addCommonFormFields(_158a,_158b?_158b:"");
_158a.setCallbacks({"complete":{"object":this,"method":this.OpenAnnotationMenuResponse}});
oCV.dispatchRequest(_158a);
};
CSubscriptionManager.prototype.OpenAnnotationMenuResponse=function(_158c){
if(this.Initialize(_158c)){
this.UpdateAnnotationMenu();
}else{
this.ClearAnnotationMenu();
}
};
CSubscriptionManager.prototype.OpenSubscriptionMenuResponse=function(_158d){
if(this.Initialize(_158d)){
this.UpdateSubscribeMenu();
}else{
this.AddEmptySubscriptionMenuItem();
}
};
CSubscriptionManager.prototype.addCommonFormFields=function(_158e,_158f){
if(_158f&&_158f!=""){
_158e.addFormField("ui.object",_158f);
}else{
var _1590=document["formWarpRequest"+this.getViewer().getId()];
if(_1590&&_1590["reRunObj"]){
_158e.addFormField("ui.object",_1590["reRunObj"].value);
}
}
if(_158e.getFormField("ui.action")=="getSubscriptionInfo"){
_158e.addFormField("initialized",this.m_bInitialized?"true":"false");
}
_158e.addFormField("cv.id",this.getViewer().getId());
};
CSubscriptionManager.prototype.AddEmptySubscriptionMenuItem=function(){
var _1591=this.getStandaloneViewerToolbarControl();
if(_1591){
var _1592=_1591.getItem("watchNewVersions");
if(_1592){
_1592.getMenu().clear();
}
var _1593=this.m_cv.getWebContentRoot();
var sSkin=this.m_cv.getSkin();
var _1595=_1592.getMenu();
var _1596=new CMenuItem(_1595,RV_RES.RV_NO_WATCH_RULES,"","",gMenuItemStyle,_1593,sSkin);
_1596.disable();
_1595.setForceCallback(false);
_1595.draw();
if(_1595.isVisible()){
_1595.show();
}
_1595.setForceCallback(true);
}
};
CSubscriptionManager.prototype.ClearSubscriptionMenu=function(){
var _1597=this.getStandaloneViewerToolbarControl();
if(_1597){
var _1598=_1597.getItem("watchNewVersions");
if(_1598){
_1598.getMenu().clear();
}
}
};
CSubscriptionManager.prototype.ClearAnnotationMenu=function(){
var _1599=this.getStandaloneViewerToolbarControl();
if(_1599){
var _159a=_1599.getItem("addAnnotations");
if(_159a){
_159a.getMenu().clear();
}
}
};
CSubscriptionManager.prototype.ClearContextAnnotationMenu=function(){
var _159b=this.getStandaloneViewerContextMenu();
if(_159b){
var _159c=_159b.getFindCommentMenuItem();
if(_159c){
_159c.getMenu().clear();
}
}
};
CSubscriptionManager.prototype.getStandaloneViewerToolbarControl=function(){
if(typeof this.m_cv.rvMainWnd!="undefined"&&this.m_cv.rvMainWnd!=null&&typeof this.m_cv.rvMainWnd.getToolbarControl=="function"){
return this.m_cv.rvMainWnd.getToolbarControl();
}else{
return null;
}
};
CSubscriptionManager.prototype.getStandaloneViewerContextMenu=function(){
if(typeof this.m_cv.rvMainWnd!="undefined"&&this.m_cv.rvMainWnd!=null&&typeof this.m_cv.rvMainWnd.getContextMenu=="function"){
return this.m_cv.rvMainWnd.getContextMenu();
}else{
return null;
}
};
function CSelectionMetadata(){
this.m_sContextId="";
this.m_sDataItem="";
this.m_sMetadataModelItem="";
this.m_sUseValue="";
this.m_sUseValueType="";
this.m_sType=null;
this.m_sDisplayValue="";
this.m_sUsage=null;
this.m_refQuery=null;
this.m_sHun=null;
this.m_sDun=null;
};
CSelectionMetadata.prototype.setContextId=function(_159d){
this.m_sContextId=_159d;
};
CSelectionMetadata.prototype.getContextId=function(){
return this.m_sContextId;
};
CSelectionMetadata.prototype.setRefQuery=function(_159e){
this.m_refQuery=_159e;
};
CSelectionMetadata.prototype.getRefQuery=function(){
return this.m_refQuery;
};
CSelectionMetadata.prototype.setDataItem=function(_159f){
this.m_sDataItem=_159f;
};
CSelectionMetadata.prototype.getDataItem=function(){
return this.m_sDataItem;
};
CSelectionMetadata.prototype.setMetadataModelItem=function(_15a0){
this.m_sMetadataModelItem=_15a0;
};
CSelectionMetadata.prototype.getMetadataModelItem=function(){
return this.m_sMetadataModelItem;
};
CSelectionMetadata.prototype.setUseValue=function(_15a1){
this.m_sUseValue=_15a1;
};
CSelectionMetadata.prototype.getUseValue=function(){
return this.m_sUseValue;
};
CSelectionMetadata.prototype.setUseValueType=function(_15a2){
this.m_sUseValueType=_15a2;
};
CSelectionMetadata.prototype.setType=function(sType){
this.m_sType=sType;
};
CSelectionMetadata.prototype.getType=function(){
var sType=null;
switch(this.m_sUseValueType){
case 25:
case 27:
case 30:
case 32:
sType="memberUniqueName";
break;
case 26:
sType="memberCaption";
break;
case 1:
case 55:
case 56:
sType="string";
break;
case 2:
case 3:
case 4:
case 5:
case 6:
case 7:
case 8:
case 9:
case 10:
case 11:
case 12:
case 16:
case 17:
case 18:
case 19:
case 20:
case 22:
case 21:
case 23:
case 24:
case 54:
sType=parseInt(this.m_sUseValueType,10);
break;
}
return sType;
};
CSelectionMetadata.prototype.getUseValueType=function(){
if(this.m_sType==null){
this.m_sType=this.getType();
}
return this.m_sType;
};
CSelectionMetadata.prototype.setDisplayValue=function(_15a5){
this.m_sDisplayValue=_15a5;
};
CSelectionMetadata.prototype.getDisplayValue=function(){
return this.m_sDisplayValue;
};
CSelectionMetadata.prototype.setUsage=function(_15a6){
this.m_sUsage=_15a6;
};
CSelectionMetadata.prototype.getUsage=function(){
if(this.m_sUsage=="2"){
return "measure";
}else{
return "nonMeasure";
}
};
CSelectionMetadata.prototype.setHun=function(sHun){
this.m_sHun=sHun;
};
CSelectionMetadata.prototype.getHun=function(){
return this.m_sHun;
};
CSelectionMetadata.prototype.setDun=function(sDun){
this.m_sDun=sDun;
};
CSelectionMetadata.prototype.getDun=function(){
return this.m_sDun;
};
function CSelectionMetadataIterator(_15a9,_15aa){
this.m_axisIndex=_15aa;
this.m_index=0;
this.m_selectionObject=_15a9;
};
CSelectionMetadataIterator.prototype.getSelectionAxis=function(){
var _15ab=null;
if(typeof this.m_selectionObject=="object"&&this.m_axisIndex<this.m_selectionObject.getSelectedContextIds().length){
_15ab=this.m_selectionObject.getSelectedContextIds()[this.m_axisIndex];
}
return _15ab;
};
CSelectionMetadataIterator.prototype.hasNext=function(){
var _15ac=this.getSelectionAxis();
if(_15ac!=null){
return (this.m_index<_15ac.length);
}else{
return false;
}
};
CSelectionMetadataIterator.prototype.next=function(){
var _15ad=null;
if(this.hasNext()){
_15ad=new CSelectionMetadata();
_15ad.setContextId(this.m_selectionObject.m_contextIds[this.m_axisIndex][this.m_index]);
_15ad.setDataItem(this.m_selectionObject.getDataItems()[this.m_axisIndex][this.m_index]);
_15ad.setMetadataModelItem(this.m_selectionObject.getMetadataItems()[this.m_axisIndex][this.m_index]);
if(this.m_selectionObject.getMuns()[this.m_axisIndex][this.m_index]!=null&&this.m_selectionObject.getMuns()[this.m_axisIndex][this.m_index]!=""){
_15ad.setUseValue(this.m_selectionObject.getMuns()[this.m_axisIndex][this.m_index]);
_15ad.setType("memberUniqueName");
}else{
_15ad.setUseValue(this.m_selectionObject.getUseValues()[this.m_axisIndex][this.m_index]);
}
if(typeof this.m_selectionObject.m_selectionController=="object"){
var ctxId=this.m_selectionObject.getSelectedContextIds()[this.m_axisIndex][this.m_index];
if(this.m_selectionObject.useDisplayValueFromObject){
_15ad.setDisplayValue(this.m_selectionObject.getDisplayValues()[this.m_axisIndex]);
}else{
var _15af=null;
var _15b0=null;
if(this.m_axisIndex===0){
var _15b1=this.m_selectionObject.getCellRef();
if(_15b1&&_15b1.nodeName&&_15b1.nodeName.toLowerCase()==="td"){
_15b0=this.m_selectionObject.m_selectionController.getDisplayValueFromDOM(ctxId,_15b1.parentNode);
}
}
if(_15b0==null){
_15b0=this.m_selectionObject.m_selectionController.getDisplayValue(ctxId);
}
if(_15b0===""){
_15b0=this.m_selectionObject.m_selectionController.getUseValue(ctxId);
}
_15ad.setDisplayValue(_15b0);
}
_15ad.setUseValueType(this.m_selectionObject.m_selectionController.getDataType(ctxId));
_15ad.setUsage(this.m_selectionObject.m_selectionController.getUsageInfo(ctxId));
_15ad.setRefQuery(this.m_selectionObject.m_selectionController.getRefQuery(ctxId));
_15ad.setHun(this.m_selectionObject.m_selectionController.getHun(ctxId));
_15ad.setDun(this.m_selectionObject.m_selectionController.getDun(ctxId));
}
++this.m_index;
}
return _15ad;
};
function CAxisSelectionIterator(_15b2){
this.m_index=0;
this.m_selectionObject=_15b2;
};
CAxisSelectionIterator.prototype.hasNext=function(){
return ((typeof this.m_selectionObject=="object")&&(this.m_index<this.m_selectionObject.getSelectedContextIds().length));
};
CAxisSelectionIterator.prototype.next=function(){
var _15b3=null;
if(this.hasNext()){
_15b3=new CSelectionMetadataIterator(this.m_selectionObject,this.m_index);
++this.m_index;
}
return _15b3;
};
function getSelectionContextIds(_15b4){
var _15b5=[];
var _15b6=_15b4.getAllSelectedObjects();
if(_15b6!=null&&_15b6.length>0){
for(var index=0;index<_15b6.length;++index){
var _15b8=_15b6[index];
var _15b9=_15b8.getSelectedContextIds();
var _15ba=[];
for(var item=0;item<_15b9.length;++item){
var _15bc=_15b9[item].join(":");
_15ba.push(_15bc);
}
_15b5.push(_15ba.join("::"));
}
}
return _15b5;
};
function getViewerSelectionContext(_15bd,_15be,_15bf){
var _15c0=_15bf==true?_15bd.getAllSelectedObjectsWithUniqueCTXIDs():_15bd.getAllSelectedObjects();
if(_15c0!=null&&_15c0.length>0){
for(var index=0;index<_15c0.length;++index){
var _15c2={};
var _15c3=new CAxisSelectionIterator(_15c0[index]);
if(_15c3.hasNext()){
var _15c4=_15c3.next();
if(_15c4.hasNext()){
var _15c5=_15c4.next();
var _15c6=_15c5.getContextId();
_15c2[_15c6]=true;
var _15c7=_15be.addSelectedCell(_15c5.getDataItem(),_15c5.getMetadataModelItem(),_15c5.getUseValue(),_15c5.getUseValueType(),_15c5.getDisplayValue(),_15c5.getUsage(),{"queryName":_15c5.getRefQuery()});
if(_15c5.getHun()!=null){
_15c7.addProperty("HierarchyUniqueName",_15c5.getHun());
}
if(_15c5.getDun()!=null){
_15c7.addProperty("DimensionUniqueName",_15c5.getDun());
}
while(_15c4.hasNext()){
_15c5=_15c4.next();
_15c6=_15c5.getContextId();
if(typeof _15c2[_15c6]=="undefined"||_15c6===""){
_15c2[_15c6]=true;
var _15c8=_15c7.addDefiningCell(_15c5.getDataItem(),_15c5.getMetadataModelItem(),_15c5.getUseValue(),_15c5.getUseValueType(),_15c5.getDisplayValue(),_15c5.getUsage(),{"queryName":_15c5.getRefQuery()});
if(_15c5.getHun()!=null){
_15c8.addProperty("HierarchyUniqueName",_15c5.getHun());
}
if(_15c5.getDun()!=null){
_15c8.addProperty("DimensionUniqueName",_15c5.getDun());
}
}
}
while(_15c3.hasNext()){
_15c4=_15c3.next();
var _15c9=_15c7;
while(_15c4.hasNext()){
_15c5=_15c4.next();
_15c6=_15c5.getContextId();
if(typeof _15c2[_15c6]=="undefined"||_15c6===""){
_15c2[_15c6]=true;
_15c9=_15c9.addDefiningCell(_15c5.getDataItem(),_15c5.getMetadataModelItem(),_15c5.getUseValue(),_15c5.getUseValueType(),_15c5.getDisplayValue(),_15c5.getUsage(),{"queryName":_15c5.getRefQuery()});
if(_15c5.getHun()!=null){
_15c9.addProperty("HierarchyUniqueName",_15c5.getHun());
}
if(_15c5.getDun()!=null){
_15c9.addProperty("DimensionUniqueName",_15c5.getDun());
}
}
}
}
}
}
}
}
var _15ca=_15be.toString();
if(window.gViewerLogger){
window.gViewerLogger.log("Selection context",_15ca,"xml");
}
return _15ca;
};
dojo.provide("bux.dialogs.CalculationDialog");
dojo.require("bux.dialogs.BaseCustomContentDialog");
dojo.require("bux.layout.TableContainer");
dojo.require("dijit.form.NumberTextBox");
dojo.require("dijit.form.Button");
dojo.declare("viewer.dialogs.CalculationDialog",bux.dialogs.BaseCustomContentDialog,{sTitle:null,sLabel:null,sDescription:null,sContentLocale:null,okHandler:null,cancelHandler:null,startup:function(){
this.updateTitle(this.sTitle);
this.inherited(arguments);
var _15cb=new bux.layout.TableContainer({classname:"bux-InformationDialog"},this.contentContainer);
var cell=null,row=null;
if(this.sDescription){
row=new bux.layout.TableContainerRow({parentContainer:_15cb});
cell=new bux.layout.TableContainerCell({classname:"bux-dialog-info",parentContainer:row});
cell.addContent(document.createTextNode(this.sDescription));
dijit.setWaiState(this._buxBaseDialog.domNode,"describedBy",cell.id);
}
row=new bux.layout.TableContainerRow({parentContainer:_15cb});
cell=new bux.layout.TableContainerCell({classname:"bux-dialog-label",parentContainer:row});
this._calculationField=new dijit.form.NumberTextBox({required:true,onBlur:function(){
if(!this._cancelled&&!this.isValid()){
this.focus();
}
},_setOKBtnDisabled:function(_15ce,_15cf){
if(_15ce&&_15ce[0]&&_15ce[0].label===RV_RES.IDS_JS_OK){
_15ce[0].set("disabled",_15cf);
}
},isValid:function(){
var _15d0=this.validator(this.get("displayedValue"),this.get("constraints"));
this._setOKBtnDisabled(this.oDlgBtns,!_15d0);
return _15d0;
}});
if(this.sContentLocale!=null){
dojo.requireLocalization("dojo.cldr","number",this.sContentLocale);
this._calculationField.constraints={locale:this.sContentLocale};
}
var _15d1=document.createElement("label");
_15d1.appendChild(document.createTextNode(this.sLabel));
_15d1.setAttribute("for",this._calculationField.id);
cell.addContent(_15d1);
row=new bux.layout.TableContainerRow({parentContainer:_15cb});
cell=new bux.layout.TableContainerCell({classname:"bux-dialog-field",parentContainer:row});
cell.addContent(this._calculationField.domNode);
this._calculationField.oDlgBtns=this._buxBaseDialog._aButtonObjects;
},onOK:function(){
if(this._calculationField.state!="Error"){
this.inherited(arguments);
this.okHandler(this._calculationField.get("value"));
this.hide();
}
},onCancel:function(){
this._calculationField._cancelled=true;
this.inherited(arguments);
}});
dojo.provide("bux.dialogs.ConfirmationDialog");
viewer.dialogs.ConfirmationDialog=function(_15d2,_15d3,_15d4,_15d5,_15d6,_15d7){
dojo["require"]("bux.dialogs.InformationDialog");
var _15d8=new bux.dialogs.Confirm(_15d2,_15d3,_15d4,dojo.hitch(_15d6,_15d7,_15d6),_15d5);
return _15d8;
};
dojo.provide("bux.dialogs.SelectSnapshot");
dojo.require("bux.dialogs.BaseCustomContentDialog");
dojo.require("bux.layout.TableContainer");
dojo.require("dijit.form.NumberTextBox");
dojo.require("dijit.form.Button");
dojo.declare("viewer.dialogs.SelectSnapshot",bux.dialogs.BaseCustomContentDialog,{sTitle:null,sLabel:null,okHandler:null,cancelHandler:null,startup:function(){
this.updateTitle(this.sTitle);
this.inherited(arguments);
var _15d9=new bux.layout.TableContainer({classname:"bux-InformationDialog"},this.contentContainer);
var row=new bux.layout.TableContainerRow({parentContainer:_15d9});
var cell=new bux.layout.TableContainerCell({classname:"bux-dialog-label",parentContainer:row});
this.createSnapshotsControl();
var _15dc=document.createElement("label");
_15dc.appendChild(document.createTextNode(this.sLabel));
_15dc.setAttribute("for",this._snapshots.id);
cell.addContent(_15dc);
row=new bux.layout.TableContainerRow({parentContainer:_15d9});
cell=new bux.layout.TableContainerCell({classname:"bux-dialog-field",parentContainer:row});
cell.addContent(this._snapshots);
},onOK:function(){
this.inherited(arguments);
var _15dd=this._snapshots.selectedIndex;
var _15de=this._snapshots.options[_15dd];
this.okHandler(_15de.getAttribute("storeID"),_15de.value);
this.hide();
},createSnapshotsControl:function(){
this._snapshots=document.createElement("select");
this._snapshots.id=this.dialogId+"snapshots";
this._snapshots.setAttribute("size","8");
this._snapshots.setAttribute("name",this.dialogId+"snapshots");
var _15df=XMLHelper_FindChildByTagName(this.cmResponse,"result",true);
var _15e0=XMLHelper_FindChildrenByTagName(_15df,"item",false);
for(var _15e1=0;_15e1<_15e0.length;_15e1++){
var _15e2=_15e0[_15e1];
var _15e3=XMLHelper_GetText(XMLHelper_FindChildByTagName(_15e2,"creationTime_localized",true));
var _15e4=XMLHelper_FindChildByTagName(_15e2,"storeID",true);
var _15e5=XMLHelper_GetText(XMLHelper_FindChildByTagName(_15e4,"value",true));
var _15e6=XMLHelper_FindChildByTagName(_15e2,"creationTime",true);
var _15e7=XMLHelper_GetText(XMLHelper_FindChildByTagName(_15e6,"value",true));
this._snapshots.options[_15e1]=new Option(_15e3,_15e7);
this._snapshots.options[_15e1].setAttribute("storeID",_15e5);
if(this.currentSnapshotCreationTime==_15e7){
this._snapshots.options[_15e1].selected=true;
}
}
}});
function CognosViewerAction(){
this.m_oCV=null;
};
CognosViewerAction.prototype.setRequestParms=function(parms){
};
CognosViewerAction.prototype.onMouseOver=function(evt){
return false;
};
CognosViewerAction.prototype.onMouseOut=function(evt){
return false;
};
CognosViewerAction.prototype.onMouseDown=function(evt){
return false;
};
CognosViewerAction.prototype.onClick=function(evt){
return false;
};
CognosViewerAction.prototype.onDoubleClick=function(evt){
return false;
};
CognosViewerAction.prototype.updateMenu=function(_15ee){
return _15ee;
};
CognosViewerAction.prototype.addAdditionalOptions=function(_15ef){
};
CognosViewerAction.prototype.genSelectionContextWithUniqueCTXIDs=function(){
return false;
};
CognosViewerAction.prototype.doUndo=function(){
if(typeof console!="undefined"){
console.log("Required method doUndo not implemented.");
}
};
CognosViewerAction.prototype.doRedo=function(){
if(typeof console!="undefined"){
console.log("Required method doRedo not implemented.");
}
};
CognosViewerAction.prototype.forceRunSpecRequest=function(){
return false;
};
CognosViewerAction.prototype.preProcess=function(){
};
CognosViewerAction.prototype.setCognosViewer=function(oCV){
this.m_oCV=oCV;
};
CognosViewerAction.prototype.getCognosViewer=function(){
return this.m_oCV;
};
CognosViewerAction.prototype.getUndoRedoQueue=function(){
if(this.getCognosViewer().getViewerWidget()){
return this.getCognosViewer().getViewerWidget().getUndoRedoQueue();
}
return null;
};
CognosViewerAction.prototype.getViewerWidget=function(){
return this.m_oCV.getViewerWidget();
};
CognosViewerAction.prototype.getObjectDisplayName=function(){
var _15f1="";
if(this.m_oCV!=null){
if(typeof this.m_oCV.envParams["reportpart_id"]!="undefined"){
_15f1=this.m_oCV.envParams["reportpart_id"];
}else{
if(typeof this.m_oCV.envParams["ui.name"]!="undefined"){
_15f1=this.m_oCV.envParams["ui.name"];
}
}
}
return _15f1;
};
CognosViewerAction.prototype.getContainerId=function(_15f2){
var _15f3="";
if(_15f2&&_15f2.getAllSelectedObjects){
var _15f4=_15f2.getAllSelectedObjects();
if(_15f4){
var _15f5=_15f4[0];
if(_15f5&&_15f5.getLayoutElementId){
_15f3=this.removeNamespace(_15f5.getLayoutElementId());
}
}
}
return _15f3;
};
CognosViewerAction.prototype.removeNamespace=function(value){
var _15f7=value;
try{
if(value!=""){
var _15f8=value.indexOf(this.m_oCV.getId());
if(_15f8!=-1){
value=value.replace(this.m_oCV.getId(),"");
}
}
return value;
}
catch(e){
return _15f7;
}
};
CognosViewerAction.prototype.doAddActionContext=function(){
return true;
};
CognosViewerAction.prototype.getSelectionContext=function(){
return getViewerSelectionContext(this.m_oCV.getSelectionController(),new CSelectionContext(this.m_oCV.envParams["ui.object"]),this.genSelectionContextWithUniqueCTXIDs());
};
CognosViewerAction.prototype.getNumberOfSelections=function(){
var _15f9=-1;
if(this.m_oCV!=null&&this.m_oCV.getSelectionController()!=null){
_15f9=this.m_oCV.getSelectionController().getSelections().length;
}
return _15f9;
};
CognosViewerAction.prototype.buildDynamicMenuItem=function(_15fa,_15fb){
_15fa.action={name:"LoadMenu",payload:{action:_15fb}};
_15fa.items=[{"name":"loading","label":RV_RES.GOTO_LOADING,iconClass:"loading"}];
return _15fa;
};
CognosViewerAction.prototype.createCognosViewerDispatcherEntry=function(_15fc){
var oReq=new ViewerDispatcherEntry(this.getCognosViewer());
oReq.addFormField("ui.action",_15fc);
this.preProcess();
if(this.doAddActionContext()===true){
var _15fe=this.addActionContext();
oReq.addFormField("cv.actionContext",_15fe);
if(window.gViewerLogger){
window.gViewerLogger.log("Action context",_15fe,"xml");
}
}
oReq.addFormField("ui.object",this.m_oCV.envParams["ui.object"]);
if(typeof this.m_oCV.envParams["ui.spec"]!="undefined"){
oReq.addFormField("ui.spec",this.m_oCV.envParams["ui.spec"]);
}
if(this.m_oCV.getModelPath()!==""){
oReq.addFormField("modelPath",this.m_oCV.getModelPath());
}
if(typeof this.m_oCV.envParams["packageBase"]!="undefined"){
oReq.addFormField("packageBase",this.m_oCV.envParams["packageBase"]);
}
if(typeof this.m_oCV.envParams["rap.state"]!="undefined"){
oReq.addFormField("rap.state",this.m_oCV.envParams["rap.state"]);
}
if(typeof this.m_oCV.envParams["rapReportInfo"]!="undefined"){
oReq.addFormField("rap.reportInfo",this.m_oCV.envParams["rapReportInfo"]);
}
this.addAdditionalOptions(oReq);
return oReq;
};
CognosViewerAction.prototype.fireModifiedReportEvent=function(){
try{
var _15ff=this.getCognosViewer().getViewerWidget();
if(_15ff){
var _1600={"modified":true};
_15ff.fireEvent("com.ibm.bux.widget.modified",null,_1600);
}
}
catch(e){
}
};
CognosViewerAction.prototype.showCustomCursor=function(evt,id,_1603){
var _1604=document.getElementById(id);
if(_1604==null){
_1604=document.createElement("span");
_1604.className="customCursor";
_1604.setAttribute("id",id);
document.body.appendChild(_1604);
}
var _1605="<img src=\""+this.getCognosViewer().getWebContentRoot()+_1603+"\"/>";
_1604.innerHTML=_1605;
_1604.style.position="absolute";
_1604.style.left=(evt.clientX+15)+"px";
_1604.style.top=(evt.clientY+15)+"px";
_1604.style.display="inline";
};
CognosViewerAction.prototype.hideCustomCursor=function(id){
var _1607=document.getElementById(id);
if(_1607!=null){
_1607.style.display="none";
}
};
CognosViewerAction.prototype.selectionHasContext=function(){
var _1608=this.getCognosViewer().getSelectionController().getAllSelectedObjects();
var _1609=false;
if(_1608!=null&&_1608.length>0){
for(var i=0;i<_1608.length;i++){
if(_1608[i].hasContextInformation()){
_1609=true;
break;
}
}
}
return _1609;
};
CognosViewerAction.prototype.isInteractiveDataContainer=function(_160b){
var _160c=false;
if(typeof _160b!="undefined"&&_160b!=null){
var id=_160b.toLowerCase();
_160c=id=="crosstab"||id=="list"||this.getCognosViewer().getRAPReportInfo().isChart(id);
}
return _160c;
};
CognosViewerAction.prototype.getSelectedContainerId=function(){
var _160e=this.getCognosViewer();
var _160f=_160e.getSelectionController();
var _1610=null;
if(_160f!=null&&typeof _160f!="undefined"){
_1610=this.getContainerId(_160f);
}
return _1610;
};
CognosViewerAction.prototype.getSelectedReportInfo=function(){
var _1611=this.getCognosViewer();
var _1612=this.getSelectedContainerId();
var _1613=this.getReportInfo(_1612);
if(_1613==null){
var _1614=_1611.getRAPReportInfo();
if(_1614.getContainerCount()==1){
_1613=_1614.getContainerFromPos(0);
}
}
return _1613;
};
CognosViewerAction.prototype.getReportInfo=function(_1615){
var _1616=null;
if(_1615!=null&&_1615.length>0){
var _1617=this.getCognosViewer();
var _1618=_1617.getRAPReportInfo();
_1616=_1618.getContainer(_1615);
}
return _1616;
};
CognosViewerAction.prototype.isSelectionOnChart=function(){
var _1619=this.getCognosViewer();
if(_1619.getSelectionController().hasSelectedChartNodes()){
return true;
}
var _161a=this.getContainerId(_1619.getSelectionController());
if(typeof _161a!="undefined"){
var _161b=this.getReportInfo(_161a);
if(_161b!=null&&_161b.displayTypeId){
var _161c=_161b.displayTypeId.toLowerCase();
return _1619.getRAPReportInfo().isChart(_161c);
}
}
return false;
};
CognosViewerAction.prototype.ifContainsInteractiveDataContainer=function(){
var _161d=this.getCognosViewer().getRAPReportInfo();
if(_161d){
return _161d.containsInteractiveDataContainer();
}
return false;
};
CognosViewerAction.prototype.isPromptWidget=function(){
var oCV=this.getCognosViewer();
if(oCV.getRAPReportInfo()&&oCV.getRAPReportInfo().isPromptPart()){
return true;
}
return false;
};
CognosViewerAction.prototype.getLayoutComponents=function(){
var _161f=[];
var _1620=document.getElementById("rt"+this.m_oCV.getId());
if(_1620!=null){
_161f=getElementsByAttribute(_1620,"*","lid");
}
return _161f;
};
CognosViewerAction.prototype.addClientContextData=function(_1621){
var _1622=this.m_oCV.getSelectionController();
if(typeof _1622!="undefined"&&_1622!=null&&typeof _1622.getCCDManager!="undefined"&&_1622.getCCDManager()!=null){
var _1623=_1622.getCCDManager();
return ("<md>"+xml_encode(_1623.MetadataToJSON())+"</md>"+"<cd>"+xml_encode(_1623.ContextDataSubsetToJSON(_1621))+"</cd>");
}
return "";
};
CognosViewerAction.prototype.getDataItemInfoMap=function(){
var _1624=this.m_oCV.getSelectionController();
if(typeof _1624!="undefined"&&_1624!=null&&typeof _1624.getCCDManager!="undefined"&&_1624.getCCDManager()!=null){
var _1625=_1624.getCCDManager();
return ("<di>"+xml_encode(_1625.DataItemInfoToJSON())+"</di>");
}
return "";
};
CognosViewerAction.prototype.getRAPLayoutTag=function(_1626){
var _1627=null;
if(typeof _1626=="object"&&_1626!=null){
_1627=_1626.getAttribute("rap_layout_tag");
}
return _1627;
};
CognosViewerAction.prototype.addMenuItemChecked=function(_1628,_1629,_162a){
if(_1628){
if(this.getCognosViewer().isHighContrast()){
_1629["class"]="menuItemSelected";
}
_1629.iconClass="menuItemChecked";
}else{
if(_162a&&_162a.length>0){
_1629.iconClass=_162a;
}
}
};
CognosViewerAction.prototype.gatherFilterInfoBeforeAction=function(_162b){
var _162c=this.getCognosViewer().getViewerWidget();
_162c.filterRequiredAction=_162b;
_162c.clearRAPCache();
_162c.fireEvent("com.ibm.bux.widget.action",null,{action:"canvas.filters"});
};
CognosViewerAction.prototype.addClientSideUndo=function(_162d,_162e){
var _162f=GUtil.generateCallback(_162d.doUndo,_162e,_162d);
var _1630=GUtil.generateCallback(_162d.doRedo,_162e,_162d);
this.getUndoRedoQueue().addClientSideUndo({"tooltip":_162d.getUndoHint(),"undoCallback":_162f,"redoCallback":_1630});
this.getCognosViewer().getViewerWidget().updateToolbar();
};
CognosViewerAction.prototype.isValidMenuItem=function(){
var _1631=this.getCognosViewer();
var _1632=_1631.getViewerWidget();
if(this.isPromptWidget()){
return false;
}
return true;
};
CognosViewerAction.prototype.isPositiveInt=function(value){
if(typeof value==="undefined"||value===null){
return false;
}
var _1634=parseInt(value,10);
return value&&_1634===+value&&_1634>0&&value.indexOf(".")==-1;
};
CognosViewerAction.prototype.buildActionResponseObject=function(_1635,code,msg){
return {"status":_1635,"message":msg?msg:null,"code":code?code:null,getStatus:function(){
return this.status;
},getMessage:function(){
return this.message;
},getCode:function(){
return this.code;
}};
};
function LineageAction(){
};
LineageAction.prototype=new CognosViewerAction();
LineageAction.prototype.getCommonOptions=function(_1638){
_1638.addFormField("cv.responseFormat","asynchDetailMIMEAttachment");
_1638.addFormField("bux",this.m_oCV.getViewerWidget()?"true":"false");
_1638.addFormField("cv.id",this.m_oCV.envParams["cv.id"]);
};
LineageAction.prototype.getSelectionOptions=function(_1639){
var _163a=this.m_oCV.getSelectionController();
var _163b=getSelectionContextIds(_163a);
_1639.addFormField("context.format","initializer");
_1639.addFormField("context.type","reportService");
_1639.addFormField("context.selection","metadata,"+_163b.toString());
};
LineageAction.prototype.getPrimaryRequestOptions=function(_163c){
_163c.addFormField("specificationType","metadataServiceLineageSpecification");
_163c.addFormField("ui.action","runLineageSpecification");
_163c.addFormField("ui.object",this.m_oCV.envParams["ui.object"]);
};
LineageAction.prototype.getSecondaryRequestOptions=function(_163d){
_163d.addFormField("ui.conversation",this.m_oCV.getConversation());
_163d.addFormField("m_tracking",this.m_oCV.getTracking());
_163d.addFormField("ui.action","lineage");
};
LineageAction.prototype.updateMenu=function(_163e){
if(!this.getCognosViewer().bCanUseLineage){
return "";
}
_163e.disabled=!this.selectionHasContext();
return _163e;
};
LineageAction.prototype.execute=function(){
var oCV=this.getCognosViewer();
var _1640=new AsynchDataDispatcherEntry(oCV);
this.getCommonOptions(_1640);
this.getSelectionOptions(_1640);
if(oCV.getConversation()==""){
this.getPrimaryRequestOptions(_1640);
}else{
this.getSecondaryRequestOptions(_1640);
}
_1640.setCallbacks({"complete":{"object":this,"method":this.handleLineageResponse}});
if(!oCV.m_viewerFragment){
_1640.setRequestIndicator(oCV.getRequestIndicator());
var _1641=new WorkingDialog(oCV);
_1641.setSimpleWorkingDialogFlag(true);
_1640.setWorkingDialog(_1641);
}
oCV.dispatchRequest(_1640);
};
LineageAction.prototype.handleLineageResponse=function(_1642){
var oCV=this.getCognosViewer();
oCV.loadExtra();
oCV.setStatus(_1642.getAsynchStatus());
oCV.setConversation(_1642.getConversation());
oCV.setTracking(_1642.getTracking());
var _1644=null;
if(typeof MDSRV_CognosConfiguration!="undefined"){
_1644=new MDSRV_CognosConfiguration();
var _1645="";
if(this.m_oCV.envParams["metadataInformationURI"]){
_1645=this.m_oCV.envParams["metadataInformationURI"];
}
_1644.addProperty("lineageURI",_1645);
_1644.addProperty("gatewayURI",this.m_oCV.getGateway());
}
var _1646=this.m_oCV.envParams["ui.object"];
var _1647=getViewerSelectionContext(this.m_oCV.getSelectionController(),new CSelectionContext(_1646));
var _1648=new MDSRV_LineageFragmentContext(_1644,_1647);
_1648.setExecutionParameters(this.m_oCV.getExecutionParameters());
if(typeof _1646=="string"){
_1648.setReportPath(_1646);
}
_1648.setReportLineage(_1642.getResult());
_1648.open();
};
function ModifyReportAction(){
this.m_reuseConversation=true;
};
ModifyReportAction.prototype=new CognosViewerAction();
ModifyReportAction.prototype.addActionContextAdditionalParms=function(){
};
ModifyReportAction.prototype.runReport=function(){
return true;
};
ModifyReportAction.prototype.updateRunReport=function(){
};
ModifyReportAction.prototype.reuseQuery=function(){
return false;
};
ModifyReportAction.prototype.reuseGetParameter=function(){
return true;
};
ModifyReportAction.prototype.reuseConversation=function(_1649){
if(typeof _1649!="undefined"){
this.m_reuseConversation=_1649;
}
return this.m_reuseConversation;
};
ModifyReportAction.prototype.updateInfoBar=function(){
return true;
};
ModifyReportAction.prototype.getUndoHint=function(){
return "";
};
ModifyReportAction.prototype.isUndoable=function(){
return true;
};
ModifyReportAction.prototype.saveSpecForUndo=function(){
return false;
};
ModifyReportAction.prototype.keepFocusOnWidget=function(){
return true;
};
ModifyReportAction.prototype.keepRAPCache=function(){
return true;
};
ModifyReportAction.prototype.getActionKey=function(){
return null;
};
ModifyReportAction.prototype.canBeQueued=function(){
return false;
};
ModifyReportAction.prototype.getPromptOption=function(){
return "false";
};
ModifyReportAction.prototype.createActionDispatcherEntry=function(){
var _164a=new ModifyReportDispatcherEntry(this.m_oCV);
_164a.initializeAction(this);
return _164a;
};
ModifyReportAction.prototype.isSelectSingleMember=function(_164b){
var _164c=this.m_oCV.getRAPReportInfo();
var _164d=_164b.getDataItems();
if(_164c&&_164d.length>0){
var _164e=this.getContainerId(this.m_oCV.getSelectionController());
var _164f=_164c.getItemInfo(_164e,_164d[0][0]);
if(_164f.single=="true"){
return true;
}
}
return false;
};
ModifyReportAction.prototype.execute=function(){
var oCV=this.getCognosViewer();
oCV.setKeepFocus(this.keepFocusOnWidget());
this.updateRunReport();
if(this.runReport()==true){
var _1651=this.createActionDispatcherEntry();
this.addAdditionalOptions(_1651);
oCV.dispatchRequest(_1651);
}else{
var _1652=this.createCognosViewerDispatcherEntry("modifyReport");
_1652.setCallbacks({"complete":{"object":this,"method":this.updateReportSpecCallback}});
oCV.dispatchRequest(_1652);
}
this.fireModifiedReportEvent();
};
ModifyReportAction.prototype.updateReportSpecCallback=function(_1653){
var state=_1653.getResponseState();
var _1655=new RequestHandler(this.m_oCV);
_1655.updateViewerState(state);
if(!this.m_bUndoAdded){
this.m_bUndoAdded=true;
var _1656=this.getUndoRedoQueue();
if(_1656){
_1656.initUndoObj({"tooltip":this.getUndoHint(),"saveSpec":true});
_1656.add({"reportUpdated":true});
}
var _1657=this.getCognosViewer().getViewerWidget();
if(_1657){
_1657.updateToolbar();
}
}
};
ModifyReportAction.prototype.addActionContext=function(){
var _1658="<reportActions";
if(this.runReport()==false){
_1658+=" run=\"false\"";
}
_1658+=">";
_1658+=this.getReportActionContext();
_1658+="</reportActions>";
return _1658;
};
ModifyReportAction.prototype.getReportActionContext=function(){
var _1659=this.getCognosViewer();
var _165a=_1659.getSelectionController();
var _165b="<"+this.m_sAction+">";
var _165c=this.getContainerId(_165a);
if(_165c!=""){
_165b+="<id>"+xml_encode(_165c)+"</id>";
}
_165b+=this.getRTStateInfo();
_165b+=this.getSelectionContext();
var _165d=this.addActionContextAdditionalParms();
if(_165d!=null&&_165d!="undefined"){
_165b+=_165d;
}
_165b+="</"+this.m_sAction+">";
if(this.updateInfoBar()){
_165b+=this.getGetInfoActionContext();
}
return _165b;
};
ModifyReportAction.prototype.getGetInfoActionContext=function(){
return "<GetInfo/>";
};
ModifyReportAction.prototype.getRTStateInfo=function(){
var _165e=this.getCognosViewer().getViewerWidget();
if(_165e&&_165e.getBUXRTStateInfoMap){
var _165f=_165e.getBUXRTStateInfoMap();
return _165f?_165f:"";
}
return "";
};
ModifyReportAction.prototype.createEmptyMenuItem=function(){
return {name:"None",label:"(empty)",iconClass:"",action:null,items:null};
};
ModifyReportAction.prototype.getStateFromResponse=function(_1660){
var _1661=null;
if(_1660&&typeof _1660!="undefined"&&_1660.responseText&&typeof _1660.responseText!="undefined"&&_1660.responseText.length>0){
var _1662=XMLBuilderLoadXMLFromString(_1660.responseText);
var _1663=_1662.getElementsByTagName("state");
if(_1663!=null&&_1663.length>0){
try{
if(typeof _1663[0].text!="undefined"){
_1661=eval("("+_1663[0].text+")");
}else{
_1661=eval("("+_1663[0].textContent+")");
}
}
catch(e){
if(typeof console!="undefined"&&console&&console.log){
console.log(e);
}
}
}
}
return _1661;
};
ModifyReportAction.prototype.getSelectedCellTags=function(){
var _1664="";
var _1665=this.getCognosViewer().getSelectionController().getSelections();
for(var i=0;i<_1665.length;++i){
var _1667=_1665[i].getCellRef();
var _1668=_1665[i].getDataItems()[0];
if(typeof _1668=="undefined"||_1668==null){
_1668="";
}
var tag=this.getRAPLayoutTag(_1667);
if(tag!=null){
_1664+="<tag><tagValue>"+xml_encode(tag)+"</tagValue><dataItem>"+xml_encode(_1668)+"</dataItem></tag>";
}else{
_1664+="<tag><tagValue/><dataItem>"+xml_encode(_1668)+"</dataItem></tag>";
}
}
if(_1664!=""){
_1664="<selectedCellTags>"+_1664+"</selectedCellTags>";
}
return _1664;
};
ModifyReportAction.prototype.getIsNumericFromReportInfo=function(_166a){
var _166b=this.getSelectedReportInfo();
if(_166b!=null&&typeof _166b.itemInfo!="undefined"){
for(var item=0;item<_166b.itemInfo.length;++item){
if(_166a==_166b.itemInfo[item].item&&typeof _166b.itemInfo[item].numeric!="undefined"){
return (_166b.itemInfo[item].numeric=="true");
}
}
}
return false;
};
function CognosViewerCalculation(){
this.m_oCV=null;
};
CognosViewerCalculation.prototype.setCognosViewer=function(oCV){
this.m_oCV=oCV;
};
CognosViewerCalculation.prototype.getCognosViewer=function(){
return this.m_oCV;
};
CognosViewerCalculation.prototype.validSelectionLength=function(_166e){
try{
return _166e.getAllSelectedObjects().length>0;
}
catch(e){
return false;
}
};
CognosViewerCalculation.prototype.getDisplayValueFromSelection=function(_166f){
var _1670="";
if(!_166f){
return _1670;
}
if(_166f.getLayoutType()=="columnTitle"){
_1670=_166f.getDisplayValues()[0];
}else{
if(_166f.getLayoutType()=="datavalue"){
var _1671=this.m_oCV.getAction("CognosViewer");
var _1672=this.m_oCV.getSelectionController();
var _1673=_1671.getContainerId(_1672);
_1670=_166f.getDataItemDisplayValue(_1671.getReportInfo(_1673));
}
}
if(_1670.indexOf("+")!=-1||_1670.indexOf("-")!=-1||_1670.indexOf("*")!=-1||_1670.indexOf("/")!=-1){
_1670="("+_1670+")";
}
return _1670;
};
CognosViewerCalculation.prototype.getCalcSymbol=function(){
};
CognosViewerCalculation.prototype.getMenuItemString=function(_1674){
var _1675=this.getCognosViewer();
var _1676=_1675.getSelectionController();
var _1677="";
var _1678,index;
if(_1674){
try{
var _167a=_1676.getAllSelectedObjects().length;
if(_167a==1){
_1678=_1676.getAllSelectedObjects()[0];
if(this.m_bFlipSelection){
_1677=RV_RES.IDS_JS_CALCULATE_NUMBER+" "+this.getCalcSymbol()+" "+this.getDisplayValueFromSelection(_1678);
}else{
_1677=this.getDisplayValueFromSelection(_1678)+" "+this.getCalcSymbol()+" "+RV_RES.IDS_JS_CALCULATE_NUMBER;
}
}else{
if(this.m_bFlipSelection){
_167a--;
for(index=_167a;index>=0;index--){
_1678=_1676.getAllSelectedObjects()[index];
if(index!=_167a){
_1677+=" "+this.getCalcSymbol()+" ";
}
_1677+=this.getDisplayValueFromSelection(_1678);
}
}else{
for(index=0;index<_167a;index++){
_1678=_1676.getAllSelectedObjects()[index];
if(index>0){
_1677+=" "+this.getCalcSymbol()+" ";
}
_1677+=this.getDisplayValueFromSelection(_1678);
}
}
}
}
catch(e){
_1677=this.getCalcSymbol();
}
}else{
_1677=this.getCalcSymbol();
}
return _1677;
};
function PercentDifferenceCalculation(){
};
PercentDifferenceCalculation.prototype=new CognosViewerCalculation();
PercentDifferenceCalculation.prototype.validSelectionLength=function(_167b){
try{
return _167b.getAllSelectedObjects().length==2;
}
catch(e){
return false;
}
};
PercentDifferenceCalculation.prototype.getMenuItemString=function(_167c){
var _167d=this.getCognosViewer().getSelectionController();
var _167e=RV_RES.IDS_JS_CALCULATE_PERCENT_DIFFERENCE;
if(_167c){
try{
var _167f=_167d.getAllSelectedObjects().length;
_167e+=" (";
for(var index=0;index<_167f;index++){
var _1681=_167d.getAllSelectedObjects()[index];
if(index>0){
_167e+=", ";
}
_167e+=this.getDisplayValueFromSelection(_1681);
}
_167e+=")";
}
catch(e){
}
}
return _167e;
};
function PercentDifferenceCalculationSwapOrder(){
this.m_bFlipSelection=true;
};
PercentDifferenceCalculationSwapOrder.prototype=new PercentDifferenceCalculation();
PercentDifferenceCalculationSwapOrder.prototype.getMenuItemString=function(_1682){
var _1683=this.getCognosViewer().getSelectionController();
var _1684=RV_RES.IDS_JS_CALCULATE_PERCENT_DIFFERENCE;
if(_1682){
try{
var _1685=_1683.getAllSelectedObjects().length;
_1684+=" (";
_1685--;
for(var index=_1685;index>=0;index--){
var _1687=_1683.getAllSelectedObjects()[index];
if(index<_1685){
_1684+=", ";
}
_1684+=this.getDisplayValueFromSelection(_1687);
}
_1684+=")";
}
catch(e){
}
}
return _1684;
};
function AdditionCalculation(){
};
AdditionCalculation.prototype=new CognosViewerCalculation();
AdditionCalculation.prototype.getCalcSymbol=function(){
return "+";
};
function SubtractionCalculation(){
};
SubtractionCalculation.prototype=new CognosViewerCalculation();
SubtractionCalculation.prototype.getCalcSymbol=function(){
return "-";
};
SubtractionCalculation.prototype.validSelectionLength=function(_1688){
try{
var _1689=_1688.getAllSelectedObjects().length;
return _1689>0&&_1689<3;
}
catch(e){
return false;
}
};
function SubtractionCalculationSwapOrder(){
this.m_bFlipSelection=true;
};
SubtractionCalculationSwapOrder.prototype=new SubtractionCalculation();
function MultiplicationCalculation(){
};
MultiplicationCalculation.prototype=new CognosViewerCalculation();
MultiplicationCalculation.prototype.getCalcSymbol=function(){
return "*";
};
function DivisionCalculation(){
};
DivisionCalculation.prototype=new CognosViewerCalculation();
DivisionCalculation.prototype.getCalcSymbol=function(){
return "/";
};
DivisionCalculation.prototype.validSelectionLength=function(_168a){
try{
var _168b=_168a.getAllSelectedObjects().length;
return (_168b>0&&_168b<3);
}
catch(e){
return false;
}
};
function DivisionCalculationSwapOrder(){
this.m_bFlipSelection=true;
};
DivisionCalculationSwapOrder.prototype=new DivisionCalculation();
function CalculationAction(){
this.m_payload="";
this.m_menuBuilderClass=null;
this.m_defaultName="";
this.m_constant=null;
};
CalculationAction.prototype=new ModifyReportAction();
CalculationAction.prototype.getUndoHint=function(){
return RV_RES.IDS_JS_CALCULATION;
};
CalculationAction.prototype.keepRAPCache=function(){
return false;
};
CalculationAction.prototype.listRules=function(){
var _168c=this.getCognosViewer().getSelectionController();
var _168d=_168c.getSelections();
if(_168d.length>1){
var tmp={};
for(var i=0;i<_168d.length;++i){
var _1690=_168d[i].getColumnRef();
if(typeof tmp[_1690]=="undefined"){
tmp[_1690]=1;
}else{
return false;
}
}
}
return _168c.selectionsHaveCalculationMetadata();
};
CalculationAction.prototype.crosstabRules=function(){
var _1691=this.getCognosViewer().getSelectionController();
if(!_1691.areSelectionsColumnRowTitles()){
return false;
}
if(_1691.isRelational()){
if(!this.relationalCrosstabRules(_1691)){
return false;
}
}else{
if(!this.olapCrosstabRules(_1691)){
return false;
}
}
return true;
};
CalculationAction.prototype.relationalCrosstabRules=function(_1692){
return _1692.selectionsHaveCalculationMetadata();
};
CalculationAction.prototype.olapCrosstabRules=function(_1693){
if(!_1693.selectionsHaveCalculationMetadata()){
return false;
}
if(!this.sameDimension(_1693)){
return (typeof this.m_oCV.aQoSFunctions!="undefined")&&this.m_oCV.aQoSFunctions.toString().indexOf("MULTIPLE_MEASURE_DIMENSION_CALCULATIONS")!=-1&&_1693.selectionsAreMeasures();
}else{
if(this.sameHierarchy(_1693)){
return true;
}else{
return (typeof this.m_oCV.aQoSFunctions!="undefined")&&this.m_oCV.aQoSFunctions.toString().indexOf("VALUE_EXPRESSIONS_REF_MULTIPLE_HIERARCHIES_OF_SAME_DIMENSION")!=-1;
}
}
};
CalculationAction.prototype.sameDimension=function(_1694){
try{
var dim="";
var _1696=_1694.getAllSelectedObjects().length;
for(var _1697=0;_1697<_1696;_1697++){
if(dim.length==0){
dim=_1694.getAllSelectedObjects()[_1697].getDimensionalItems("dun")[0][0];
}else{
if(dim!=_1694.getAllSelectedObjects()[_1697].getDimensionalItems("dun")[0][0]){
return false;
}
}
}
return true;
}
catch(e){
return false;
}
};
CalculationAction.prototype.sameHierarchy=function(_1698){
try{
var dim="";
var _169a=_1698.getAllSelectedObjects().length;
for(var _169b=0;_169b<_169a;_169b++){
if(dim.length==0){
dim=_1698.getAllSelectedObjects()[_169b].getDimensionalItems("hun")[0][0];
}else{
if(dim!=_1698.getAllSelectedObjects()[_169b].getDimensionalItems("hun")[0][0]){
return false;
}
}
}
return true;
}
catch(e){
return false;
}
};
CalculationAction.prototype.addActionContextAdditionalParms=function(){
var _169c="";
if(this.m_constant!=null){
_169c+="<constant>"+xml_encode(this.m_constant)+"</constant>";
if(this.m_swapSelectionOrder){
_169c+="<constantFirst/>";
}
}
if(this.m_defaultName!=""){
_169c+="<columnName>"+xml_encode(this.m_defaultName)+"</columnName>";
}
return _169c;
};
CalculationAction.prototype.setRequestParms=function(parms){
if(parms!=null){
if(typeof parms.constant!=null){
this.m_constant=parms.constant;
}
}
};
CalculationAction.prototype.buildDefaultName=function(){
try{
var calc=this.getCognosViewer().getCalculation(this.m_menuBuilderClass);
this.m_defaultName=calc.getMenuItemString(true);
if(this.m_constant!=null){
var _169f=""+this.m_constant;
var _16a0=this.getCognosViewer().envParams["contentDecimalSeparator"];
if(typeof _16a0!="undefined"&&_16a0!=null&&_16a0!="."){
_169f=_169f.replace(".",_16a0);
}
this.m_defaultName=this.m_defaultName.replace(RV_RES.IDS_JS_CALCULATE_NUMBER,_169f);
}
}
catch(e){
this.m_defaultName="";
}
};
CalculationAction.prototype.preProcess=function(){
var _16a1=this.getNumberOfSelections();
this.buildDefaultName();
if(this.m_swapSelectionOrder&&_16a1==2){
var _16a2=this.getCognosViewer().getSelectionController();
var sel1=_16a2.getAllSelectedObjects()[0];
var sel2=_16a2.getAllSelectedObjects()[1];
_16a2.m_aSelectedObjects=[sel2,sel1];
}
};
CalculationAction.prototype.isFactCellOnCrosstabOrEmpty=function(){
var _16a5=this.m_oCV.getSelectionController();
var _16a6=_16a5.getAllSelectedObjects();
if(_16a6!=null&&typeof _16a6!="undefined"){
if(_16a6.length==0){
return true;
}else{
var _16a7=_16a6[0];
if(_16a5.getDataContainerType()=="crosstab"&&_16a7.getLayoutType()=="datavalue"){
return true;
}
}
}
return false;
};
CalculationAction.prototype.isSummaryOrAggregateCell=function(){
var _16a8=this.m_oCV.getSelectionController();
var _16a9=_16a8.getAllSelectedObjects();
if(_16a9!=null&&typeof _16a9!="undefined"){
var _16aa;
var _16ab=/\b(ol|il)\b/;
for(var i=0;i<_16a9.length;i++){
_16aa=_16a9[i].getCellRef();
if(_16aa!=null&&typeof _16aa!="undefined"){
if(_16a9[i].getLayoutType()=="summary"||(_16aa!=null&&_16ab.test(_16aa.className))){
return true;
}
}
_16aa=null;
}
}
return false;
};
CalculationAction.prototype.isLastSelectionSingleDimensionNested=function(){
var _16ad=this.m_oCV.getSelectionController();
var _16ae=_16ad.getAllSelectedObjects();
if(_16ae!=null&&typeof _16ae!="undefined"&&_16ae.length){
var _16af=_16ae[_16ae.length-1];
var _16b0=_16af.getDimensionalItems("dun")[0];
if(_16b0&&_16b0.length&&_16b0[0]){
for(var _16b1=1;_16b1<_16b0.length;++_16b1){
if(_16b0[_16b1]===_16b0[0]){
return true;
}
}
}
}
return false;
};
CalculationAction.prototype.areCalculationsPossible=function(){
var _16b2=this.getCognosViewer().getSelectionController();
if(this.isFactCellOnCrosstabOrEmpty()){
return false;
}
if(this.isSelectionOnChart()){
return false;
}
if(this.isSummaryOrAggregateCell()){
return false;
}
if(!_16b2.selectionsInSameDataContainer()){
return false;
}
if(_16b2.getDataContainerType()=="list"){
return this.listRules(_16b2);
}else{
if(_16b2.getDataContainerType()=="crosstab"&&!this.isLastSelectionSingleDimensionNested()){
return this.crosstabRules(_16b2);
}
}
return false;
};
CalculationAction.prototype.updateMenu=function(_16b3,_16b4){
_16b3.visible=this.ifContainsInteractiveDataContainer();
if(!_16b3.visible){
return _16b3;
}
if(!this.areCalculationsPossible()){
return this.toggleMenu(_16b3,false);
}
this.toggleMenu(_16b3,true);
if(this.m_oCV.aQoSFunctions){
_16b3=this.buildCalculationMenuItemsAgainstSelection(_16b3);
}else{
_16b3=this.buildDynamicMenuItem(_16b3,"Calculation");
}
return _16b3;
};
CalculationAction.prototype.toggleMenu=function(_16b5,_16b6){
if(_16b6){
_16b5.iconClass="calculate";
_16b5.disabled=false;
}else{
_16b5.iconClass="calculateDisabled";
_16b5.disabled=true;
}
return _16b5;
};
CalculationAction.prototype.buildMenu=function(_16b7,_16b8){
_16b7.visible=this.ifContainsInteractiveDataContainer();
if(!_16b7.visible){
return _16b7;
}
if(!this.areCalculationsPossible()){
return this.toggleMenu(_16b7,false);
}
this.toggleMenu(_16b7,true);
var _16b9=this.getCognosViewer();
if(typeof _16b9.aQoSFunctions=="undefined"){
this.fetchQoS(_16b7,_16b8,(typeof _16b8=="undefined")?false:true);
}
if(typeof _16b9.aQoSFunctions!="undefined"){
return this.buildCalculationMenuItemsAgainstSelection(_16b7);
}
};
CalculationAction.prototype.fetchQoS=function(_16ba,_16bb,_16bc){
var _16bd={customArguments:[_16ba,_16bb],"complete":{"object":this,"method":this.handleQoSResponse}};
var _16be=new AsynchJSONDispatcherEntry(this.m_oCV);
_16be.setCallbacks(_16bd);
_16be.addFormField("ui.action","getQualityOfService");
_16be.addFormField("parameterValues",this.m_oCV.getExecutionParameters());
_16be.addFormField("bux","true");
_16be.addNonEmptyStringFormField("modelPath",this.m_oCV.getModelPath());
_16be.addDefinedFormField("metaDataModelModificationTime",this.m_oCV.envParams["metaDataModelModificationTime"]);
if(!_16bc){
_16be.forceSynchronous();
}
this.m_oCV.dispatchRequest(_16be);
};
CalculationAction.prototype.handleQoSResponse=function(_16bf,_16c0,_16c1){
this.m_oCV.aQoSFunctions=_16bf.getResult();
this.buildCalculationMenuItemsAgainstSelection(_16c0,_16c1);
if(typeof _16c1=="function"){
_16c1();
}
};
CalculationAction.prototype.buildCalculationMenuItemsAgainstSelection=function(_16c2,_16c3){
var _16c4=this.m_oCV.aBuxCalculations;
var _16c5=[];
for(var _16c6=0;_16c6<_16c4.length;_16c6++){
var calc=this.m_oCV.getCalculation(_16c4[_16c6]);
if(this.m_oCV.aQoSFunctions==null||typeof this.m_oCV.aQoSFunctions=="undefined"){
_16c2.disabled=true;
_16c2.iconClass="calculate";
_16c2.items=null;
return _16c2;
}
if(calc&&calc.validSelectionLength(this.getCognosViewer().getSelectionController())&&this.m_oCV.aQoSFunctions.toString().indexOf(_16c4[_16c6])!=-1){
var _16c8={};
_16c8.name=_16c4[_16c6];
_16c8.label=calc.getMenuItemString(true);
_16c8.action={};
var _16c9="";
if(_16c4[_16c6].indexOf("SwapOrder")!=-1){
_16c9=_16c4[_16c6].substring(0,_16c4[_16c6].indexOf("SwapOrder"));
}else{
_16c9=_16c4[_16c6];
}
_16c8.iconClass=_16c9;
if(this.getNumberOfSelections()==1){
_16c8.action.name="ConstantOperandCalculation";
_16c8.action.payload=_16c4[_16c6];
}else{
_16c8.action.name=_16c4[_16c6];
_16c8.action.payload="";
}
if(_16c8.action.name=="PercentDifferenceCalculation"){
_16c5.push({separator:true});
}
_16c8.items=null;
_16c5.push(_16c8);
}
}
if(_16c5.length==0){
this.toggleMenu(_16c2,false);
_16c5.push({name:"None",label:RV_RES.IDS_JS_CALCULATION_SELECT_DATA,iconClass:"",action:null,items:null});
}else{
this.toggleMenu(_16c2,true);
}
_16c2.items=_16c5;
return _16c2;
};
function PercentDifferenceCalculationAction(){
this.m_sAction="PercentDifference";
this.m_menuBuilderClass="PercentDifferenceCalculation";
};
PercentDifferenceCalculationAction.prototype=new CalculationAction();
function PercentDifferenceCalculationSwapOrderAction(){
this.m_sAction="PercentDifference";
this.m_menuBuilderClass="PercentDifferenceCalculationSwapOrder";
this.m_swapSelectionOrder=true;
};
PercentDifferenceCalculationSwapOrderAction.prototype=new CalculationAction();
function AdditionCalculationAction(){
this.m_sAction="Addition";
this.m_menuBuilderClass="AdditionCalculation";
};
AdditionCalculationAction.prototype=new CalculationAction();
function SubtractionCalculationAction(){
this.m_sAction="Subtraction";
this.m_menuBuilderClass="SubtractionCalculation";
};
SubtractionCalculationAction.prototype=new CalculationAction();
function SubtractionCalculationSwapOrderAction(){
this.m_sAction="Subtraction";
this.m_menuBuilderClass="SubtractionCalculationSwapOrder";
this.m_swapSelectionOrder=true;
};
SubtractionCalculationSwapOrderAction.prototype=new CalculationAction();
function MultiplicationCalculationAction(){
this.m_sAction="Multiplication";
this.m_menuBuilderClass="MultiplicationCalculation";
};
MultiplicationCalculationAction.prototype=new CalculationAction();
function DivisionCalculationAction(){
this.m_sAction="Division";
this.m_menuBuilderClass="DivisionCalculation";
};
DivisionCalculationAction.prototype=new CalculationAction();
function DivisionCalculationSwapOrderAction(){
this.m_sAction="Division";
this.m_menuBuilderClass="DivisionCalculationSwapOrder";
this.m_swapSelectionOrder=true;
};
DivisionCalculationSwapOrderAction.prototype=new CalculationAction();
function ConstantOperandCalculationAction(){
this.m_action=null;
};
ConstantOperandCalculationAction.prototype=new CognosViewerAction();
ConstantOperandCalculationAction.prototype.setRequestParms=function(_16ca){
this.m_action=_16ca;
};
ConstantOperandCalculationAction.prototype.execute=function(){
var _16cb=getCognosViewerObjectString(this.m_oCV.getId());
var _16cc=this.m_action;
var _16cd=this.m_oCV.getCalculation(_16cc);
var _16ce=_16cd.getMenuItemString(true);
var _16cf=RV_RES.IDS_JS_CALCULATE_ENTER_NUMBER_TITLE;
var _16d0=RV_RES.IDS_JS_CALCULATE_ENTER_NUMBER_DESCRIPTION;
_16d0=_16d0.substring(0,_16d0.indexOf("{0}"))+_16ce+_16d0.substring(_16d0.indexOf("{0}")+3);
var _16d1=RV_RES.IDS_JS_CALCULATE_ENTER_NUMBER;
var _16d2=this.m_oCV.envParams["contentLocale"];
var _16d3=new viewer.dialogs.CalculationDialog({sTitle:_16cf,sLabel:_16d1,sDescription:_16d0,sContentLocale:_16d2,okHandler:function(value){
window[_16cb].executeAction(_16cc,{constant:value});
},cancelHandler:function(){
}});
_16d3.startup();
window.setTimeout(function(){
_16d3.show();
},0);
};
function FilterAction(){
this.m_sAction="Filter";
this.m_sType="";
this.m_sItem="";
this.m_sFormattedNumber="";
this.m_sFormattedEndNumber="";
this.m_jsonDetails="";
};
FilterAction.prototype=new ModifyReportAction();
FilterAction.prototype.execute=function(){
ModifyReportAction.prototype.execute.apply(this,arguments);
if(this.m_sType.indexOf("remove")!=-1){
this.getCognosViewer().getViewerWidget().clearRAPCache();
}
};
FilterAction.prototype.genSelectionContextWithUniqueCTXIDs=function(){
return true;
};
FilterAction.prototype.getUndoHint=function(){
if(this.m_sType.indexOf("remove")!=-1){
return RV_RES.IDS_JS_REMOVE_FILTER;
}else{
return RV_RES.IDS_JS_FILTER;
}
};
FilterAction.prototype.setRequestParms=function(parms){
if(parms.type!=null&&typeof parms.type!="undefined"){
this.m_sType=parms.type;
if(parms.id!=null&&typeof parms.id!="undefined"){
this.m_sId=parms.id;
}
if(parms.item!=null&&typeof parms.item!="undefined"){
this.m_sItem=parms.item;
}
if(parms.details){
this.m_jsonDetails=parms.details;
}
if(parms.formattedNumber!=null&&typeof parms.formattedNumber!="undefined"){
this.m_sFormattedNumber=parms.formattedNumber;
}
if(parms.formattedEndNumber!=null&&typeof parms.formattedEndNumber!="undefined"){
this.m_sFormattedEndNumber=parms.formattedEndNumber;
}
}else{
this.m_sType=parms;
}
};
FilterAction.prototype.addActionContextAdditionalParms=function(){
var parms="<type>"+this.m_sType+"</type>";
if(this.m_sId!=null&&typeof this.m_sId!="undefined"){
parms+=("<id>"+xml_encode(this.m_sId)+"</id>");
}
if(this.m_sItem!=null&&typeof this.m_sItem!="undefined"&&this.m_sItem!=""){
parms+=("<item>"+xml_encode(this.m_sItem)+"</item>");
}
if(this.m_jsonDetails&&this.m_jsonDetails!=""){
parms+="<details>"+xml_encode(this.m_jsonDetails)+"</details>";
}
if(this.m_sFormattedNumber!=null&&typeof this.m_sFormattedNumber!="undefined"&&this.m_sFormattedNumber!=""){
parms+=("<formattedNumber>"+this.m_sFormattedNumber+"</formattedNumber>");
}
if(this.m_sFormattedEndNumber!=null&&typeof this.m_sFormattedEndNumber!="undefined"&&this.m_sFormattedEndNumber!=""){
parms+=("<formattedEndNumber>"+this.m_sFormattedEndNumber+"</formattedEndNumber>");
}
return parms;
};
FilterAction.prototype.buildSelectedItemsString=function(_16d7){
var _16d8="";
var _16d9=_16d7.length;
var _16da=_16d9>5?5:_16d9;
for(var index=0;index<_16d9;++index){
var value=this.getItemLabel(_16d7[index]);
if(typeof value=="undefined"||value==""){
return "";
}
if((index)<_16da){
_16d8+=value;
}
if((index+1)<_16da){
_16d8+=", ";
}
}
if(_16d9>5){
_16d8+=", ++";
}
return _16d8;
};
FilterAction.prototype.getItemLabel=function(_16dd){
var value=_16dd.getDisplayValues()[0];
if(typeof value=="undefined"){
value=_16dd.getUseValues()[0][0];
}
return value;
};
FilterAction.prototype.toggleMenu=function(_16df,_16e0){
if(_16e0){
_16df.iconClass="filter";
_16df.disabled=false;
}else{
_16df.iconClass="filterDisabled";
_16df.disabled=true;
}
return _16df;
};
FilterAction.prototype.updateMenu=function(_16e1){
_16e1.visible=(this.ifContainsInteractiveDataContainer()&&!this.detailFilteringIsDisabled());
var _16e2=_16e1;
if(_16e1.visible){
var _16e3=(this.m_oCV.getSelectionController().getAllSelectedObjects().length>0||this.isSelectionFilterable()||this.isRemoveAllValid());
if(!_16e3){
_16e2=this.toggleMenu(_16e1,false);
}else{
this.buildMenu(_16e1);
if(_16e1.disabled==true){
_16e2=this.toggleMenu(_16e1,false);
}else{
_16e2=this.buildDynamicMenuItem(_16e1,"Filter");
}
}
}
return _16e2;
};
FilterAction.prototype.detailFilteringIsDisabled=function(){
var _16e4=this.getCognosViewer().getRAPReportInfo();
if(_16e4){
return _16e4.isDetailFilteringDisabled();
}
return false;
};
FilterAction.prototype.buildMenu=function(_16e5){
_16e5.visible=(this.ifContainsInteractiveDataContainer()&&!this.detailFilteringIsDisabled());
if(!_16e5.visible){
return _16e5;
}
var _16e6=this.isSelectionFilterable();
this.toggleMenu(_16e5,_16e6);
var _16e7=[];
var _16e8=false;
var _16e9=false;
var _16ea=this.m_oCV.getSelectionController();
var _16eb=_16ea.getAllSelectedObjects();
if(_16eb.length>0&&_16ea.selectionsInSameDataContainer()&&_16ea.selectionsFromSameDataItem()){
var _16ec=_16eb[0].getDataItems()[0][0];
if(_16e6){
_16e8=this.addFilterValueActionsToMenu(_16ea,_16e7,_16ec);
}
if(this.isRemoveItemFilterValid(_16ec)){
if(_16e8==true){
_16e7.push({separator:true});
_16e9=true;
}
var label=this.getRefDataItemLabel(_16ec);
_16e7.push({name:"RemoveFilterFor",label:RV_RES.IDS_JS_REMOVE_FILTER_FOR+" "+enforceTextDir(label),iconClass:"",action:{name:"Filter",payload:"remove"},items:null});
}
}
if(this.isRemoveAllValid()==true){
if(_16e8&&!_16e9){
_16e7.push({separator:true});
}
_16e7.push({name:"RemoveAllFiltersForWidget",label:RV_RES.IDS_JS_REMOVE_ALL_FILTERS_FOR_WIDGET,iconClass:"",action:{name:"Filter",payload:"removeAllForWidget"},items:null});
}
if(_16e7.length==0){
return this.toggleMenu(_16e5,false);
}else{
_16e5.items=_16e7;
this.toggleMenu(_16e5,true);
return _16e5;
}
};
FilterAction.prototype.getRefDataItemLabel=function(_16ee){
var label=_16ee;
var _16f0=this.m_oCV.getRAPReportInfo();
if(_16f0){
var _16f1=_16f0.getFilterObject(_16ee,true);
if(_16f1){
label=_16f1.itemLabel;
}
}
return label;
};
FilterAction.prototype.addFilterValueActionsToMenu=function(_16f2,_16f3,_16f4){
var _16f5=_16f2.getAllSelectedObjectsWithUniqueCTXIDs();
var _16f6=_16f5.length;
var sel=0;
if(_16f5[0].m_dataContainerType=="list"){
for(sel=0;sel<_16f5.length;++sel){
if(_16f5[sel].m_sLayoutType=="columnTitle"){
_16f6=0;
break;
}
}
}
if(_16f6==0){
return false;
}
var _16f8=this.buildSelectedItemsString(_16f5);
if(_16f8==""){
if(_16f6==1&&_16f5[0].getLayoutType()=="datavalue"){
_16f8=RV_RES.IDS_JS_NULL;
_16f3.push({name:"InFilter",label:CViewerCommon.getMessage(RV_RES.IDS_JS_FILTER_INCLUDE,_16f8),iconClass:"",action:{name:"Filter",payload:"in"},items:null});
_16f3.push({name:"NotInFilter",label:CViewerCommon.getMessage(RV_RES.IDS_JS_FILTER_EXCLUDE,_16f8),iconClass:"",action:{name:"Filter",payload:"not"},items:null});
}
}else{
if(_16f2.selectionsAreDateTime()||(_16f2.selectionsHaveCalculationMetadata()&&!_16f2.selectionsNonMeasureWithMUN())){
for(sel=0;sel<_16f6;++sel){
if(_16f5[sel].m_sLayoutType=="columnTitle"){
return false;
}
}
if(_16f6==1){
if(_16f5[0].getUseValues()[0][0]){
_16f3.push({name:"LessFilter",label:RV_RES.IDS_JS_FILTER_LESS_THAN+" "+_16f8,iconClass:"",action:{name:"Filter",payload:{type:"lessThan",formattedNumber:_16f8}},items:null});
_16f3.push({name:"LessEqualFilter",label:RV_RES.IDS_JS_FILTER_LESS_THAN_EQUAL+" "+_16f8,iconClass:"",action:{name:"Filter",payload:{type:"lessThanEqual",formattedNumber:_16f8}},items:null});
_16f3.push({name:"GreaterEqualFilter",label:RV_RES.IDS_JS_FILTER_GREATER_THAN_EQUAL+" "+_16f8,iconClass:"",action:{name:"Filter",payload:{type:"greaterThanEqual",formattedNumber:_16f8}},items:null});
_16f3.push({name:"GreaterFilter",label:RV_RES.IDS_JS_FILTER_GREATER_THAN+" "+_16f8,iconClass:"",action:{name:"Filter",payload:{type:"greaterThan",formattedNumber:_16f8}},items:null});
}
}else{
if(_16f6==2){
if(_16f5[0].getUseValues()[0][0]&&_16f5[1].getUseValues()[0][0]){
var _16f9=this.getItemLabel(_16f5[0]);
var _16fa=this.getItemLabel(_16f5[1]);
_16f3.push({name:"BetweenFilter",label:CViewerCommon.getMessage(RV_RES.IDS_JS_FILTER_BETWEEN,[_16f9,_16fa]),iconClass:"",action:{name:"Filter",payload:{type:"between",formattedNumber:_16f9,formattedEndNumber:_16fa}},items:null});
_16f3.push({name:"NotBetweenFilter",label:CViewerCommon.getMessage(RV_RES.IDS_JS_FILTER_NOT_BETWEEN,[_16f9,_16fa]),iconClass:"",action:{name:"Filter",payload:{type:"notBetween",formattedNumber:_16f9,formattedEndNumber:_16fa}},items:null});
}
}else{
return false;
}
}
}else{
var _16fb=_16f2.getDataContainerType();
if(_16fb=="crosstab"&&_16f5[0].getLayoutType()=="columnTitle"){
if(this.isSelectSingleMember(_16f5[0])==true){
return false;
}
}
_16f3.push({name:"InFilter",label:CViewerCommon.getMessage(RV_RES.IDS_JS_FILTER_INCLUDE,enforceTextDir(_16f8)),iconClass:"",action:{name:"Filter",payload:"in"},items:null});
_16f3.push({name:"NotInFilter",label:CViewerCommon.getMessage(RV_RES.IDS_JS_FILTER_EXCLUDE,enforceTextDir(_16f8)),iconClass:"",action:{name:"Filter",payload:"not"},items:null});
}
}
return true;
};
FilterAction.prototype.isRemoveAllValid=function(){
var _16fc=this.m_oCV.getRAPReportInfo();
if(_16fc){
return _16fc.containsFilters();
}
return false;
};
FilterAction.prototype.isRemoveItemFilterValid=function(_16fd){
var _16fe=this.getContainerId(this.m_oCV.getSelectionController());
var _16ff=this.m_oCV.getRAPReportInfo();
if(_16fe!=null&&_16ff){
var _1700=_16ff.getFilterObjectFromContainer(_16fe,_16fd,false);
return _1700?true:false;
}
return false;
};
FilterAction.prototype.isSelectionFilterable=function(){
var _1701=this.m_oCV.getSelectionController();
var _1702=_1701.getAllSelectedObjects();
if(_1702.length>0){
var _1703=_1702[0].getCellRef();
if(_1703&&_1703.getAttribute&&_1703.getAttribute("no_data_item_column")==="true"){
return false;
}
if(_1701.hasSelectedChartNodes()){
var _1704=false;
if(_1701.selectionsAreDateTime()||(_1701.selectionsHaveCalculationMetadata()&&!_1701.selectionsNonMeasureWithMUN())){
_1704=true;
}
for(var sel=0;sel<_1702.length;++sel){
if(_1702[sel].getLayoutType()){
if(_1702[sel].getLayoutType().match("Title$")=="Title"){
return false;
}
if(_1704&&_1702[sel].getLayoutType().match("Label$")=="Label"){
return false;
}
}
}
}
}
return true;
};
function GetFilterInfoAction(){
this.m_requestParms=null;
};
GetFilterInfoAction.prototype=new ModifyReportAction();
GetFilterInfoAction.prototype.isUndoable=function(){
return false;
};
GetFilterInfoAction.prototype.canBeQueued=function(){
return true;
};
GetFilterInfoAction.prototype.setRequestParms=function(parms){
this.m_requestParms=parms;
};
GetFilterInfoAction.prototype.runReport=function(){
return false;
};
GetFilterInfoAction.prototype.updateInfoBar=function(){
return false;
};
GetFilterInfoAction.prototype.fireModifiedReportEvent=function(){
};
GetFilterInfoAction.prototype.buildActionContextAdditionalParmsXML=function(){
var _1707=XMLBuilderCreateXMLDocument("item");
var _1708=_1707.documentElement;
for(var parm in this.m_requestParms){
if(this.m_requestParms.hasOwnProperty(parm)){
var _170a=_1707.createElement(parm);
_170a.appendChild(_1707.createTextNode(this.m_requestParms[parm]));
_1708.appendChild(_170a);
}
}
return _1707;
};
GetFilterInfoAction.prototype.addActionContextAdditionalParms=function(){
if(this.m_requestParms===null){
return "";
}
return XMLBuilderSerializeNode(this.buildActionContextAdditionalParmsXML());
};
GetFilterInfoAction.prototype.createFilterInfoDispatcherEntry=function(){
var _170b=new ReportInfoDispatcherEntry(this.m_oCV);
_170b.initializeAction(this);
return _170b;
};
GetFilterInfoAction.prototype.execute=function(){
this.getCognosViewer().setKeepFocus(this.keepFocusOnWidget());
var _170c=this.createFilterInfoDispatcherEntry();
this.m_oCV.dispatchRequest(_170c);
this.fireModifiedReportEvent();
};
GetFilterInfoAction.prototype.getOnPromptingCallback=function(){
return this.getOnCompleteCallback();
};
function GetFilterValuesAction(){
this.m_sAction="CollectFilterValues";
this.m_sRetryClass="GetFilterValues";
};
GetFilterValuesAction.prototype=new GetFilterInfoAction();
GetFilterValuesAction.prototype.addActionContextAdditionalParms=function(){
if(this.m_requestParms===null){
return "";
}
var _170d=this.buildActionContextAdditionalParmsXML();
var _170e=_170d.documentElement;
for(var parm in this.m_requestParms){
if(parm=="name"){
var _1710=this.m_oCV.getSelectionController();
if(typeof _1710!="undefined"&&typeof _1710.getCCDManager()!="undefined"){
var _1711=_1710.getCCDManager().GetPageMinMaxForRDI(this.m_requestParms[parm]);
if(typeof _1711!="undefined"){
var _1712=_170d.createElement("pageMin");
_1712.appendChild(_170d.createTextNode(_1711.pageMin));
var _1713=_170d.createElement("pageMax");
_1713.appendChild(_170d.createTextNode(_1711.pageMax));
_170e.appendChild(_1712);
_170e.appendChild(_1713);
}
if(this.m_oCV.isSinglePageReport()==true){
var _1714=_170d.createElement("singlePageReport");
_170e.appendChild(_1714);
}
}
break;
}
}
var _1715=XMLBuilderSerializeNode(_170d);
return (_1715+this.addClientContextData(3));
};
GetFilterValuesAction.prototype.getOnCompleteCallback=function(){
var _1716=this.getCognosViewer();
var _1717=_1716.getViewerWidget();
var _1718=this.m_requestParms;
var _1719=function(_171a){
_1717.handleGetFilterValuesResponse(_171a,_1718);
};
return _1719;
};
GetFilterValuesAction.prototype.canBeQueued=function(){
return true;
};
GetFilterValuesAction.prototype.getActionKey=function(){
if(typeof this.m_requestParms!="undefined"&&typeof this.m_requestParms.source!="undefined"){
return this.m_sAction+this.m_requestParms.source;
}
return null;
};
function GetFilterableItemsAction(){
this.m_sAction="CollectFilterableItems";
};
GetFilterableItemsAction.prototype=new GetFilterInfoAction();
GetFilterableItemsAction.prototype.addActionContextAdditionalParms=function(){
return this.addClientContextData(3);
};
GetFilterableItemsAction.prototype.getOnCompleteCallback=function(){
var _171b=this.getCognosViewer();
var _171c=_171b.getViewerWidget();
var _171d=function(_171e){
_171c.handleGetFilterableItemsResponse(_171e);
};
return _171d;
};
function UpdateDataFilterAction(){
this.m_sAction="UpdateDataFilter";
this.m_bForceRunSpec=false;
};
UpdateDataFilterAction.prototype=new ModifyReportAction();
UpdateDataFilterAction.prototype.runReport=function(){
return this.getViewerWidget().shouldReportBeRunOnAction();
};
UpdateDataFilterAction.prototype.getActionKey=function(){
if(typeof this.m_requestParams!="undefined"){
try{
var parms=eval("("+this.m_requestParams+")");
if(parms.clientId!==null){
return this.m_sAction+parms.clientId;
}
}
catch(e){
}
}
return null;
};
UpdateDataFilterAction.prototype.canBeQueued=function(){
return true;
};
UpdateDataFilterAction.prototype.keepFocusOnWidget=function(){
return false;
};
UpdateDataFilterAction.prototype.isUndoable=function(){
return false;
};
UpdateDataFilterAction.prototype.setRequestParms=function(parms){
this.m_requestParams=parms.filterPayload;
this.m_drillResetHUN=parms.drillResetHUN;
this.m_isFacet=parms.isFacet;
if(parms.forceCleanup){
this.m_sForceCleanup=parms.forceCleanup;
}
};
UpdateDataFilterAction.prototype.forceRunSpecRequest=function(){
return this.m_bForceRunSpec;
};
UpdateDataFilterAction.prototype.preProcessContextValues=function(){
var _1721=[];
var _1722=dojo.fromJson(this.m_requestParams);
if(_1722&&_1722["com.ibm.widget.context"]&&(_1722["com.ibm.widget.context"]["values"]||_1722["com.ibm.widget.context"]["ranges"])){
var _1723=this.m_oCV.m_RAPReportInfo;
var _1724=_1723.getContainers();
if(!_1724){
_1721;
}
var key="";
var _1726="";
if(_1722["com.ibm.widget.context"]["values"]){
key="values";
_1726=_1722["com.ibm.widget.context"]["values"];
}else{
key="ranges";
_1726=_1722["com.ibm.widget.context"]["ranges"];
}
var _1727=_1723.collectSliderSetFromReportInfo();
for(dataItem in _1726){
if(_1723&&_1723.isReferenced(dataItem)){
var _1728=dojo.clone(_1722);
var _1729={};
_1729[dataItem]=_1722["com.ibm.widget.context"][key][dataItem];
_1728["com.ibm.widget.context"][key]=_1729;
if(_1722["com.ibm.widget.context.bux.selectValueControl"]&&_1722["com.ibm.widget.context.bux.selectValueControl"]["selectValueControl"]&&_1722["com.ibm.widget.context.bux.selectValueControl"]["selectValueControl"]["itemSpecification"]){
var _172a={};
_1728["com.ibm.widget.context.bux.selectValueControl"]["selectValueControl"]["itemSpecification"]={};
var _172b=document.forms["formWarpRequest"+this.m_oCV.getId()].packageBase.value;
for(modelItem in _1722["com.ibm.widget.context.bux.selectValueControl"]["selectValueControl"]["itemSpecification"]){
if(modelItem.indexOf(_172b)!=-1){
_172a[dataItem]=_1722["com.ibm.widget.context.bux.selectValueControl"]["selectValueControl"]["itemSpecification"][modelItem][dataItem];
if(_172a[dataItem]){
_1728["com.ibm.widget.context.bux.selectValueControl"]["selectValueControl"]["itemSpecification"][modelItem]=_172a;
break;
}
}
}
}
var _172c=_1726[dataItem]&&key!=="ranges"?_1726[dataItem].length:0;
if(this.checkIfFilterExpressionChanged(dataItem,_1722.clientId,_172c,_1727)){
this.m_bForceRunSpec=true;
}
_1721.push(dojo.toJson(_1728));
}
}
}else{
_1721.push(dojo.toJson(_1722));
}
return _1721;
};
UpdateDataFilterAction.prototype.checkIfFilterExpressionChanged=function(_172d,_172e,_172f,_1730){
if(!_1730||!_1730[_172e]||_1730[_172e].name!=_172d){
return true;
}
var _1731=_1730[_172e].values?_1730[_172e].values.length:0;
if(_172f==_1731){
return false;
}
return (_172f===1)!==(_1731===1);
};
UpdateDataFilterAction.prototype.addActionContext=function(){
var _1732="<reportActions";
var _1733="";
if(!this.runReport()){
_1732+=" run=\"false\"";
_1733="<inlineValues/>";
}
_1732+=">";
if(this.m_drillResetHUN&&this.m_drillResetHUN.length>0){
_1732+=this._getDrillResetActionContext();
}
if(this.m_sForceCleanup){
_1732+="<reportAction name=\""+this.m_sAction+"\">"+dojo.toJson(this.m_sForceCleanup)+"</reportAction>";
}
var _1734;
var _1735=(this.m_requestParams.charAt(0)==="<");
if(this.m_isFacet||_1735){
_1734=[this.m_requestParams];
}else{
_1734=this.preProcessContextValues();
}
for(var idx=0;idx<_1734.length;++idx){
var _1737=_1734[idx];
_1732+="<reportAction name=\""+this.m_sAction+"\">"+_1733;
_1732+=(_1735)?_1737:xml_encode(_1737);
if(idx>0){
_1732+="<augment>true</augment>";
}
if(!this.m_isFacet){
_1732+=this.addClientContextData(3);
}
_1732+="</reportAction>";
_1732+="<reportAction name=\"GetInfo\"><include><sliders/></include>";
_1732+="</reportAction>";
}
_1732+="</reportActions>";
return _1732;
};
UpdateDataFilterAction.prototype._getDrillResetActionContext=function(){
var _1738=new DrillResetAction();
_1738.setCognosViewer(this.getCognosViewer());
var _1739={drilledResetHUNs:this.m_drillResetHUN};
_1738.setRequestParms(_1739);
_1738.setUpdateInfoBar(false);
var _173a=_1738.getReportActionContext();
return _173a;
};
function CognosViewerSort(event,oCV){
this.m_oCV=oCV;
if(event){
this.m_oEvent=event;
this.m_oNode=getCrossBrowserNode(event,true);
}
};
CognosViewerSort.prototype.setNode=function(node){
this.m_oNode=node;
};
CognosViewerSort.prototype.getNode=function(){
return this.m_oNode;
};
CognosViewerSort.prototype.isSort=function(){
if(this.m_oNode&&this.m_oNode.nodeName=="IMG"&&(this.m_oNode.id).indexOf("sortimg")>=0){
return true;
}else{
return false;
}
};
CognosViewerSort.prototype.execute=function(){
var _173e=getCognosViewerSCObjectRef(this.m_oCV.getId());
_173e.selectSingleDomNode(this.m_oNode.parentNode);
var _173f=this.getSortAction();
_173f.setCognosViewer(this.m_oCV);
_173f.execute();
if(window.gViewerLogger){
window.gViewerLogger.addContextInfo(_173e);
}
};
CognosViewerSort.prototype.getSortAction=function(){
var _1740=this.m_oCV.getAction("Sort");
var _1741=this.m_oNode.getAttribute("sortOrder");
if(_1741.indexOf("nosort")!=-1){
_1740.setRequestParms({order:"ascending",type:"value"});
}else{
if(_1741.indexOf("ascending")!=-1){
_1740.setRequestParms({order:"descending",type:"value"});
}else{
if(_1741.indexOf("descending")!=-1){
_1740.setRequestParms({order:"none",type:"value"});
}
}
}
return _1740;
};
function SortAction(){
this.m_sAction="Sort";
this.m_sortOrder="none";
this.m_sortType="";
this.m_sItem="";
this.m_sId="";
};
SortAction.prototype=new ModifyReportAction();
SortAction.prototype.doExecute=function(){
if(this.m_sortOrder==="none"){
if(this.getContainerId(this.m_oCV.getSelectionController())){
var _1742=this.getCurrentSortFromSelection();
if(this.m_sortType==="value"&&_1742.indexOf("sortByValue")===-1){
return false;
}else{
if(this.m_sortType==="label"&&_1742.indexOf("sortByLabel")===-1){
return false;
}
}
}
}
return true;
};
SortAction.prototype.execute=function(){
if(this.doExecute()){
ModifyReportAction.prototype.execute.call(this);
}
};
SortAction.prototype.getUndoHint=function(){
if(this.m_sortOrder=="none"){
return RV_RES.IDS_JS_DONT_SORT;
}else{
return RV_RES.IDS_JS_SORT;
}
};
SortAction.prototype.setRequestParms=function(_1743){
this.m_sortOrder=_1743.order;
this.m_sortType=_1743.type;
if(_1743.id!=null&&typeof _1743.id!="undefined"){
this.m_sId=_1743.id;
}
if(_1743.item!=null&&typeof _1743.item!="undefined"){
this.m_sItem=_1743.item;
}
};
SortAction.prototype.addActionContextAdditionalParms=function(){
var _1744=this.m_oCV.getSelectionController();
var parms="<order>"+this.m_sortOrder+"</order>";
if(this.m_sortType=="label"){
parms+="<byLabel/>";
}
if(this.getContainerId(_1744)==""&&this.m_sId!=null&&typeof this.m_sId!="undefined"&&this.m_sId!=""){
parms+=("<id>"+xml_encode(this.m_sId)+"</id>");
}
if(this.m_sItem!=null&&typeof this.m_sItem!="undefined"&&this.m_sItem!=""){
parms+=("<item>"+xml_encode(this.m_sItem)+"</item>");
}
parms+=this.addClientContextData(3);
parms+=this.getSelectedCellTags();
return parms;
};
SortAction.prototype.toggleMenu=function(_1746,_1747){
if(_1747){
_1746.iconClass="sort";
_1746.disabled=false;
}else{
_1746.iconClass="sortDisabled";
_1746.disabled=true;
}
return _1746;
};
SortAction.prototype.updateMenu=function(_1748){
_1748.visible=this.ifContainsInteractiveDataContainer();
if(!_1748.visible){
return _1748;
}
this.buildMenu(_1748);
if(_1748.disabled==true){
return this.toggleMenu(_1748,false);
}
return this.buildDynamicMenuItem(this.toggleMenu(_1748,true),"Sort");
};
SortAction.prototype.buildSelectedItemsString=function(_1749,_174a,_174b){
try{
var _174c=_1749[_1749.length-1];
if(_174a){
var _174d=_174c.getDisplayValues()[0];
if(typeof _174d=="undefined"){
_174d=_174c.getUseValues()[0][0];
}
return _174d;
}else{
return _174c.getDataItemDisplayValue(_174b);
}
}
catch(e){
if(console&&console.log){
console.log(e);
}
}
};
SortAction.prototype.buildMenu=function(_174e){
_174e.visible=this.ifContainsInteractiveDataContainer();
if(!_174e.visible){
return _174e;
}
if(!this.isSelectionSortable()){
return this.toggleMenu(_174e,false);
}
_174e=this.toggleMenu(_174e,true);
var _174f=[];
var _1750=this.m_oCV.getSelectionController();
var _1751=_1750.getAllSelectedObjects();
if(_1751.length==1&&_1751[0].isHomeCell()==false){
var _1752=_1750.getDataContainerType();
var _1753=this.getContainerId(_1750);
var _1754=this.getReportInfo(_1753);
if(_1752==""&&!this.isSelectionOnChart()&&_1751[0].getLayoutType()=="section"){
if(_1754!=null){
_1752=_1754.displayTypeId;
}
}
var _1755,_1756,_1757;
var _1758=this.getCurrentSortFromSelection();
var _1759=this.isSelectionOnChart();
var _175a=_1758.indexOf("sortByValue")!=-1;
var _175b=_1758.indexOf("sortByValueAscending")!=-1;
var _175c=_1758.indexOf("sortByValueDescending")!=-1;
var _175d=this.m_oCV.isIWidgetMobile();
if(_1752=="list"){
var _175e={name:"SortAscending",label:RV_RES.IDS_JS_SORT_ASCENDING,action:{name:"Sort",payload:{order:"ascending",type:"value"}},items:null};
this.addMenuItemChecked(_175b,_175e,"sortAscending");
_174f.push(_175e);
var _175f={name:"SortDescending",label:RV_RES.IDS_JS_SORT_DESCENDING,action:{name:"Sort",payload:{order:"descending",type:"value"}},items:null};
this.addMenuItemChecked(_175c,_175f,"sortDescending");
_174f.push(_175f);
var _1760={name:"DontSort",label:RV_RES.IDS_JS_DONT_SORT,action:{name:"Sort",payload:{order:"none",type:"value"}},items:null};
this.addMenuItemChecked(!_175a,_1760,"sortNone");
_174f.push(_1760);
}else{
if(_1752=="crosstab"||_1759){
if(_1751[0].getLayoutType()=="columnTitle"||_1759){
_1755=this.m_oCV.getRAPReportInfo();
if(this.canSortByValueOnCrosstab(_1751[0],_1755)){
_1756=RV_RES.IDS_JS_SORT_BY_VALUE;
if(_1759){
_1757=this.buildSelectedItemsString(_1751,true,_1754);
if(typeof _1757!=="undefined"){
_1756+=":"+_1757;
}
}
var _1761={name:"SortByValue",label:_1756,action:null,items:[{name:"Ascending",label:RV_RES.IDS_JS_SORT_BY_ASCENDING,action:{name:"Sort",payload:{order:"ascending",type:"value"}},items:null},{name:"Descending",label:RV_RES.IDS_JS_SORT_BY_DESCENDING,action:{name:"Sort",payload:{order:"descending",type:"value"}},items:null},{name:"SortNone",label:RV_RES.IDS_JS_DONT_SORT,action:{name:"Sort",payload:{order:"none",type:"value"}},items:null}]};
this.addMenuItemChecked(_175a,_1761);
this.addMenuItemChecked(_175b,_1761.items[0],"sortAscending");
this.addMenuItemChecked(_175c,_1761.items[1],"sortDescending");
this.addMenuItemChecked(!_175a,_1761.items[2],"sortNone");
if(_175d){
_1761.flatten=true;
}
_174f.push(_1761);
}
if(this.canSortByLabelOnCrosstab(_1751[0])){
_1756=RV_RES.IDS_JS_SORT_BY_LABEL;
if(_1759){
_1757=this.buildSelectedItemsString(_1751,false,_1754);
if(typeof _1757!=="undefined"){
_1756+=":"+_1757;
}
}
var _1762={name:"SortByLabel",label:_1756,action:null,items:[{name:"Ascending",label:RV_RES.IDS_JS_SORT_BY_ASCENDING,action:{name:"Sort",payload:{order:"ascending",type:"label"}},items:null},{name:"Descending",label:RV_RES.IDS_JS_SORT_BY_DESCENDING,action:{name:"Sort",payload:{order:"descending",type:"label"}},items:null},{name:"SortNone",label:RV_RES.IDS_JS_DONT_SORT,action:{name:"Sort",payload:{order:"none",type:"label"}},items:null}]};
var _1763=_1758.indexOf("sortByLabel")!=-1;
this.addMenuItemChecked(_1763,_1762);
this.addMenuItemChecked(_1758.indexOf("sortByLabelAscending")!=-1,_1762.items[0],"sortAscending");
this.addMenuItemChecked(_1758.indexOf("sortByLabelDescending")!=-1,_1762.items[1],"sortDescending");
this.addMenuItemChecked(!_1763,_1762.items[2],"sortNone");
if(_175d){
_1762.flatten=true;
}
_174f.push(_1762);
}
}
}
}
}
if(_174f.length==0){
this.toggleMenu(_174e,false);
}else{
if(_175d){
if(_1752=="crosstab"||_1759){
_174e.useChildrenItems=true;
}else{
_174e.flatten=true;
}
}
_174e.items=_174f;
this.toggleMenu(_174e,true);
}
return _174e;
};
SortAction.prototype.isSelectionSortable=function(){
var _1764=this.m_oCV.getSelectionController();
var _1765=_1764.getAllSelectedObjects();
if(_1765.length==1){
var _1766=_1765[0];
if(_1764.getDataContainerType()=="crosstab"&&_1766.getLayoutType()=="datavalue"){
return false;
}
if(_1764.hasSelectedChartNodes()){
var node=_1766.getArea();
if(node.nodeName=="AREA"||node.nodeName=="IMG"){
return _1765[0].getLayoutType()=="ordinalAxisLabel"||_1765[0].getLayoutType()=="legendLabel";
}
}else{
var data=_1766.getDataItems();
if(_1766.getCellRef().getAttribute("type")=="datavalue"&&!(data&&data.length)){
return false;
}
var oCell=_1766.getCellRef();
if(oCell.getAttribute("no_data_item_column")==="true"){
return false;
}
if(oCell.getAttribute("canSort")!="false"){
return true;
}
}
}
return false;
};
SortAction.prototype.getCurrentSortFromSelection=function(){
var _176a=this.getContainerId(this.m_oCV.getSelectionController());
var _176b=this.m_oCV.getRAPReportInfo();
var _176c="";
if(_176a!=""&&_176b){
var _176d=_176b.getContainer(_176a);
if(typeof _176d.sort!="undefined"){
var _176e=this.m_oCV.getSelectionController();
var _176f=_176e.getAllSelectedObjects();
if(_176f.length==1){
var _1770=_176f[0].getDataItems();
if(_1770.length<1){
return _176c;
}
var _1771=_1770[0][0];
for(var index=0;index<_176d.sort.length;++index){
var _1773=_176d.sort[index];
if(typeof _1773.labels=="string"&&_1773.labels==_1771){
_176c+=_1773.order=="descending"?"sortByLabelDescending":"sortByLabelAscending";
}
if(typeof _1773.valuesOf=="string"&&(_1773.valuesOf==_1771||this.isSortedValueOnRenamedColumn(_176f[0],_1773))){
_176c+=_1773.order=="descending"?"sortByValueDescending":"sortByValueAscending";
}else{
if(_1773.valuesOf instanceof Array){
var match=true;
for(var _1775=0;_1775<_1773.valuesOf.length;++_1775){
if(_1775<_176f[0].m_contextIds[0].length){
var ctx=_176f[0].m_contextIds[0][_1775];
var _1777=_176e.getDisplayValue(ctx);
var _1778=this.findItemLabel(_176d,_1773.valuesOf[_1775].item);
if(_1778!=_1777){
match=false;
break;
}
}
}
if(match){
_176c+=_1773.valuesOf[0].order=="descending"?"sortByValueDescending":"sortByValueAscending";
}
}
}
}
}
}
}
return _176c;
};
SortAction.prototype.isSortedValueOnRenamedColumn=function(_1779,_177a){
if(_177a&&_1779){
return (_177a.valuesOf===_1779.getColumnRP_Name()&&_1779.getLayoutType()==="columnTitle");
}
};
SortAction.prototype.findItemLabel=function(_177b,item){
var _177d=_177b.itemInfo;
if(_177d){
for(var i=0;i<_177d.length;i++){
if(_177d[i].item===item){
if(_177d[i].itemLabel){
return _177d[i].itemLabel;
}
break;
}
}
}
return item;
};
SortAction.prototype.canSortByValueOnCrosstab=function(_177f,_1780){
var _1781=this.m_oCV.getSelectionController();
var _1782=this.getContainerId(this.m_oCV.getSelectionController());
if(_1781.isRelational()==true){
return false;
}
if(_1781.selectionsHaveCalculationMetadata()&&this.selectedObjectIsLeaf(_1782,_177f,_1780)){
var aMuns=_177f.getMuns()[0];
for(var index=0;index<aMuns.length;++index){
if(aMuns[index]!=null&&aMuns[index].indexOf("uuid:")>=0){
return false;
}
}
return true;
}
return false;
};
SortAction.prototype.selectedObjectIsLeaf=function(_1785,_1786,_1787){
if(_1787){
var _1788=_1786.getDataItems();
if(_1788!=null&&typeof _1788!="undefined"&&_1788.length>0){
var _1789=_1787.getDrillability(_1785,_1788[0][0]);
if(_1789){
return _1789.leaf==true;
}
}
}
return false;
};
SortAction.prototype.canSortByLabelOnCrosstab=function(_178a){
var _178b=this.m_oCV.getSelectionController();
var _178c=_178b.getAllSelectedObjects();
if(_178c.length==1){
var _178a=_178c[0];
if(this.isSelectSingleMember(_178a)==false){
if(_178b.selectionsNonMeasureWithMUN()||!_178b.selectionsHaveCalculationMetadata()){
return true;
}
}
}
return false;
};
function RedrawAction(){
this.m_specUpdated=false;
};
RedrawAction.prototype=new ModifyReportAction();
RedrawAction.prototype.reuseQuery=function(){
return true;
};
RedrawAction.prototype.keepRAPCache=function(){
return false;
};
RedrawAction.prototype.setSpecUpdated=function(flag){
this.m_specUpdated=flag;
};
RedrawAction.prototype.getUndoHint=function(){
return RV_RES.IDS_JS_ADVANCED_EDITING;
};
RedrawAction.prototype.addActionContext=function(){
if(this.m_specUpdated){
return "<reportActions><GetInfo><specUpdatedInBUA/></GetInfo></reportActions>";
}
return "<reportActions><GetInfo/></reportActions>";
};
function EditContentAction(){
this._oMissingMemberRecoveryMode=null;
};
EditContentAction.prototype=new CognosViewerAction();
EditContentAction.superclass=CognosViewerAction.prototype;
EditContentAction.prototype.execute=function(){
if(typeof this.preferencesChanged!="undefined"&&this.preferencesChanged!==null&&this.preferencesChanged===true){
this.deleteCWAContainer();
return;
}
window.CVEditContentActionInstance=this;
var _178e=window.viewerCWAContainer?true:false;
if(!window.viewerCWAContainer){
this.createCWAContainer();
}
this.addWindowEventListeners();
this.buildBUAObjects();
window.viewerCWAContainer.show();
if(_178e){
window.BUAEvent("appReady");
}
};
EditContentAction.prototype.createCWAContainer=function(){
this.deleteCWAContainer();
var _178f=this.createCWAIFrame();
var _1790=this.createBlocker();
window.viewerCWAContainer={"type":"iframe","containerDiv":_178f,"blocker":_1790,"iframePadding":"18","show":function(){
this.resize();
this.containerDiv.style.display="block";
this.blocker.style.display="block";
},"hide":function(){
this.blocker.style.display="none";
this.containerDiv.style.display="none";
},"resize":function(){
var _1791=dojo.window.getBox();
this.containerDiv.style.height=_1791.h-this.iframePadding+"px";
this.containerDiv.style.width=_1791.w-this.iframePadding+"px";
}};
};
EditContentAction.prototype.deleteCWAContainer=function(){
var _1792=window.viewerCWAContainer;
if(_1792){
_1792.hide();
document.body.removeChild(_1792.containerDiv);
document.body.removeChild(_1792.blocker);
delete window.viewerCWAContainer;
window.viewerCWAContainer=null;
}
};
EditContentAction.prototype.hideCWAContainer=function(){
this.removeWindowEventListeners();
if(window.viewerCWAContainer){
window.viewerCWAContainer.hide();
}
window.CVEditContentActionInstance=null;
};
EditContentAction.prototype.createCWAIFrame=function(){
var _1793=document.createElement("div");
_1793.className="buaContainer";
document.body.appendChild(_1793);
var _1794=document.createElement("iframe");
_1794.setAttribute("id","buaIframe");
_1794.setAttribute("src",this.getWebContent()+"/pat/rsapp.htm");
_1794.setAttribute("name","buaIframe");
_1794.setAttribute("frameborder","0");
_1794.className="buaIframe";
_1793.appendChild(_1794);
return _1793;
};
EditContentAction.prototype.createBlocker=function(){
var _1795=document.createElement("div");
_1795.setAttribute("id","reportBlocker");
_1795.setAttribute("name","reportBlocker");
_1795.setAttribute("tabIndex","1");
_1795.className="reportBlocker";
document.body.appendChild(_1795);
return _1795;
};
EditContentAction.prototype.buildBUAObjects=function(){
window.RSParameters={"rs_UIProfile":"BUA","ui.action":"edit","gateway":location.protocol+"//"+location.host+this.getGateway(),"theme":"corporate","capabilitiesXML":this.getCapabilitiesXml(),"cafcontextid":this.getCafContextId(),"paneOnRight":this.getViewerIWidget().getPaneOnRight()};
var _1796=this.getViewerIWidget();
if(_1796!==null){
var _1797=_1796.getAttributeValue("gateway");
if(_1797){
window.RSParameters["cv.gateway"]=_1797;
}
var _1798=_1796.getAttributeValue("webcontent");
if(_1798){
window.RSParameters["cv.webcontent"]=_1798;
}
}
this.addExtraLaunchParameters(window.RSParameters);
};
EditContentAction.prototype.getBUAIframe=function(){
return document.getElementById("buaIframe");
};
EditContentAction.prototype.getBUAWindow=function(){
var _1799=null;
var _179a=this.getBUAIframe();
if(_179a!==null){
_1799=_179a.contentWindow;
}
return _1799;
};
EditContentAction.prototype.setReportSettings=function(){
var oCV=this.getCognosViewer();
var _179c=oCV.getViewerWidget();
_179c.fireEvent("com.ibm.bux.widget.getDisplayTitle",null,{callback:function(_179d){
window.CVEditContentActionInstance.openReportWithBUA(_179d);
}});
};
EditContentAction.prototype.openReportWithBUA=function(_179e){
var _179f=this.m_oCV.envParams["ui.spec"].indexOf("<?xml version=\"1.0\" encoding=\"UTF-8\"?>");
if(_179f==-1){
_179f=0;
}else{
_179f="<?xml version=\"1.0\" encoding=\"UTF-8\"?>".length;
}
var _17a0=this.m_oCV.envParams["ui.spec"].substr(_179f,this.m_oCV.envParams["ui.spec"].length);
var _17a1={"displayName":xml_decode(_179e),"parameterValues":this.m_oCV.getExecutionParameters(),"reportXML":_17a0,"showOpenTransition":false};
if(this.ifPassTrackingtoBUA()){
_17a1.tracking=this.m_oCV.getTracking();
}
var _17a2=this.getBUAWindow();
_17a2.Application.SetBUAContext(_17a1);
};
EditContentAction.prototype.getViewerIWidget=function(){
return this.m_oCV.getViewerWidget();
};
EditContentAction.prototype.getGateway=function(){
return this.m_oCV.getGateway();
};
EditContentAction.prototype.getCapabilitiesXml=function(){
return this.m_oCV.capabilitiesXML;
};
EditContentAction.prototype.getCafContextId=function(){
return typeof this.m_oCV.cafContextId!="undefined"?this.m_oCV.cafContextId:"";
};
EditContentAction.prototype.getWebContent=function(){
return this.getCognosViewer().getWebContentRoot();
};
EditContentAction.prototype.addExtraLaunchParameters=function(_17a3){
};
EditContentAction.prototype.runUpdatedReportFromBUA=function(){
var _17a4=this.getBUAWindow();
var _17a5=this.m_oCV.envParams["ui.spec"];
var _17a6=_17a4.Application.GetBUAContext();
if(_17a6.isSpecModified){
this.m_oCV.envParams["ui.spec"]=_17a6.reportXML;
this.m_oCV.setTracking(_17a6.tracking);
this.m_oCV.setExecutionParameters(_17a6.parameterValues);
this._invokeRedrawAction(_17a5);
}
};
EditContentAction.prototype._invokeRedrawAction=function(_17a7){
this.getUndoRedoQueue().setOriginalSpec(_17a7);
var _17a8=this.m_oCV.getAction("Redraw");
_17a8.setSpecUpdated(true);
this.m_oCV.getViewerWidget().setPromptParametersRetrieved(false);
_17a8.execute();
};
EditContentAction.prototype.ifPassTrackingtoBUA=function(){
if(this.m_oCV.getRAPReportInfo()){
return this.m_oCV.getRAPReportInfo().getPassTrackingtoBUA();
}
return true;
};
EditContentAction.prototype.setRequestParms=function(_17a9){
EditContentAction.superclass.setRequestParms(_17a9);
if(_17a9){
if(_17a9.preferencesChanged){
this.preferencesChanged=_17a9.preferencesChanged;
}
if(_17a9.MissingMemberRecoveryMode){
this._oMissingMemberRecoveryMode=_17a9.MissingMemberRecoveryMode;
}
}
};
EditContentAction.prototype.runUpdatedReportFromBUA_MissingMemberRecoveryMode=function(){
var _17aa=this.getBUAWindow();
var _17ab=this.m_oCV.envParams["ui.spec"];
var _17ac=_17aa.Application.GetBUAContext();
this.m_oCV.setTracking(_17ac.tracking);
this.m_oCV.envParams["ui.spec"]=_17ac.reportXML;
this.m_oCV.setExecutionParameters(_17ac.parameterValues);
if(this._oMissingMemberRecoveryMode&&this._oMissingMemberRecoveryMode.oFaultDialog){
this._oMissingMemberRecoveryMode.oFaultDialog.hide();
}
this._invokeRedrawAction(_17ab);
};
EditContentAction.prototype.cancelPressed=function(){
};
EditContentAction.prototype.addWindowEventListeners=function(){
if(window.attachEvent){
window.attachEvent("onresize",window.CVEditContentActionInstance.onWindowResize);
}else{
window.addEventListener("resize",window.CVEditContentActionInstance.onWindowResize,false);
}
};
EditContentAction.prototype.removeWindowEventListeners=function(){
if(window.detachEvent){
window.detachEvent("onresize",window.CVEditContentActionInstance.onWindowResize);
}else{
window.removeEventListener("resize",window.CVEditContentActionInstance.onWindowResize,false);
}
};
EditContentAction.prototype.onWindowResize=function(){
var _17ad=window.viewerCWAContainer;
if(_17ad){
_17ad.resize();
}
};
function BUAEvent(_17ae){
var _17af=window.CVEditContentActionInstance;
switch(_17ae){
case "appReady":
_17af.setReportSettings();
break;
case "donePressed":
_17af.hideCWAContainer();
if(_17af._oMissingMemberRecoveryMode){
_17af.runUpdatedReportFromBUA_MissingMemberRecoveryMode();
}else{
_17af.runUpdatedReportFromBUA();
}
break;
case "cancelPressed":
_17af.cancelPressed();
_17af.hideCWAContainer();
break;
}
};
function NewReportAction(){
this._viewerIWidget=null;
this._packageSearchPath=null;
this._webContentRoot=null;
this._gateway=null;
this._capabilitiesXml=null;
this._cafContextId=null;
};
NewReportAction.prototype=new EditContentAction();
NewReportAction.prototype.parent=EditContentAction.prototype;
NewReportAction.prototype.clearSelections=function(){
};
NewReportAction.prototype.getCognosViewer=function(){
return this.getViewerIWidget().getViewerObject();
};
NewReportAction.prototype.setRequestParms=function(_17b0){
this.parent.setRequestParms.call(this,_17b0);
this._packageSearchPath=_17b0.packageSearchPath;
this._viewerIWidget=_17b0.viewerIWidget;
this._webContentRoot=_17b0.webContentRoot;
this._gateway=_17b0.gateway;
this._capabilitiesXml=_17b0.capabilitiesXml;
this._cafContextId=_17b0.cafContextId;
};
NewReportAction.prototype.getViewerIWidget=function(){
return this._viewerIWidget;
};
NewReportAction.prototype.getGateway=function(){
return this._gateway;
};
NewReportAction.prototype.getCapabilitiesXml=function(){
return this._capabilitiesXml;
};
NewReportAction.prototype.getCafContextId=function(){
return this._cafContextId?this._cafContextId:"";
};
NewReportAction.prototype.getWebContent=function(){
return this._webContentRoot;
};
NewReportAction.prototype.setReportSettings=function(){
var _17b1={"showOpenTransition":false,"model":this._packageSearchPath};
var _17b2=this.getBUAWindow();
_17b2.Application.SetBUAContext(_17b1);
};
NewReportAction.prototype.addExtraLaunchParameters=function(_17b3){
_17b3.model=this._packageSearchPath;
};
NewReportAction.prototype.cancelPressed=function(){
this.getViewerIWidget().iContext.iEvents.fireEvent("com.ibm.bux.widget.action",null,{action:"deleteWidget"});
};
NewReportAction.prototype.runUpdatedReportFromBUA=function(){
var _17b4=this.getViewerIWidget();
_17b4.setAttributeValue("reportCreatedInCW","true");
var _17b5=this.getBUAWindow().Application.GetBUAContext();
_17b4.setNewReportInfo({"ui.spec":_17b5.reportXML,"m_tracking":_17b5.tracking?_17b5.tracking:"","parameterValues":_17b5.parameterValues?_17b5.parameterValues:""});
_17b4.onLoad();
};
function AuthoredDrillAction(){
this.m_drillTargetSpecification="";
};
AuthoredDrillAction.prototype=new CognosViewerAction();
AuthoredDrillAction.prototype.setRequestParms=function(_17b6){
this.m_drillTargetSpecification=_17b6;
};
AuthoredDrillAction.prototype.executeDrillTarget=function(_17b7){
var _17b8=XMLHelper_GetFirstChildElement(XMLBuilderLoadXMLFromString(_17b7));
var _17b9=encodeURIComponent(_17b8.getAttribute("bookmarkRef"));
var _17ba=_17b8.getAttribute("path");
var _17bb=this._shouldShowInNewWindow(_17b8);
var oCV=this.getCognosViewer();
if((_17b9!==null&&_17b9!=="")&&(_17ba===null||_17ba==="")){
var _17bd=_17b8.getAttribute("bookmarkPage");
if(_17bd&&_17bd!==""){
oCV.executeAction("GotoPage",{"pageNumber":_17bd,"anchorName":_17b9});
}else{
document.location="#"+_17b9;
}
}else{
var _17be="";
if(_17bb){
_17be="_blank";
}
var _17bf=[];
var _17c0=[];
_17c0.push("obj");
_17c0.push(_17ba);
_17bf[_17bf.length]=_17c0;
var _17c1=false;
var _17c2,_17c3,_17c4,sName,sNil;
var _17c7=XMLHelper_FindChildrenByTagName(_17b8,"drillParameter",false);
for(var index=0;index<_17c7.length;++index){
_17c2=[];
_17c3=_17c7[index];
_17c4=_17c3.getAttribute("value");
sName=_17c3.getAttribute("name");
if(_17c4!==null&&_17c4!==""){
_17c2.push("p_"+sName);
_17c2.push(this.buildSelectionChoicesSpecification(_17c3));
}
sNil=_17c3.getAttribute("nil");
if(sNil!==null&&sNil!==""){
_17c2.push("p_"+sName);
_17c2.push(this.buildSelectionChoicesNilSpecification());
}
if(_17c2.length>0){
_17bf[_17bf.length]=_17c2;
}
if(!_17c1){
var _17c9=_17c3.getAttribute("propertyToPass");
_17c1=(_17c9&&_17c9.length>0)?true:false;
}
}
var _17ca=_17b8.getAttribute("method");
var _17cb=_17b8.getAttribute("outputFormat");
var _17cc=_17b8.getAttribute("outputLocale");
var _17cd=_17b8.getAttribute("prompt");
var _17ce=_17b8.getAttribute("dynamicDrill");
var _17cf=this.getXMLNodeAsString(_17b8,"parameters");
var _17d0=this.getXMLNodeAsString(_17b8,"objectPaths");
var oCVId=oCV.getId();
var _17d2=document.forms["formWarpRequest"+oCVId];
var _17d3=oCV.getAdvancedServerProperty("VIEWER_JS_CALL_FORWARD_DRILLTHROUGH_TO_SELF");
if((!_17d3||_17d3.toLowerCase()!=="false")&&_17cd!="true"&&this.isSameReport(_17d2,_17ba)&&this.isSameReportFormat(_17cb)&&!_17bb&&!_17c1){
var _17d4=new ViewerDispatcherEntry(oCV);
_17d4.addFormField("ui.action","forward");
if(oCV!==null&&typeof oCV.rvMainWnd!="undefined"){
oCV.rvMainWnd.addCurrentReportToReportHistory();
var _17d5=oCV.rvMainWnd.saveReportHistoryAsXML();
_17d4.addFormField("cv.previousReports",_17d5);
}
for(index=0;index<_17c7.length;++index){
_17c2=[];
_17c3=_17c7[index];
_17c4=_17c3.getAttribute("value");
sName=_17c3.getAttribute("name");
sNil=_17c3.getAttribute("nil");
if((sNil===null||sNil==="")&&(_17c4===null||_17c4==="")){
_17c2.push("p_"+sName);
_17c2.push(this.buildSelectionChoicesNilSpecification());
}
if(_17c2.length>0){
_17bf[_17bf.length]=_17c2;
}
}
for(index=1;index<_17bf.length;index++){
_17d4.addFormField(_17bf[index][0],_17bf[index][1]);
}
_17d4.addFormField("_drillThroughToSelf","true");
if(oCV.m_tabsPayload&&oCV.m_tabsPayload.tabs){
_17d4.addFormField("generic.anyURI.http://developer.cognos.com/ceba/constants/runOptionEnum#pageGroup",oCV.m_tabsPayload.tabs[0].id);
}
oCV.setUsePageRequest(true);
oCV.dispatchRequest(_17d4);
if(typeof oCV.m_viewerFragment=="undefined"){
var _17d6=getCognosViewerObjectRefAsString(oCVId);
setTimeout(_17d6+".getRequestIndicator().show()",10);
}
}else{
doSingleDrill(_17be,_17bf,_17ca,_17cb,_17cc,_17b9,_17cf,_17d0,this.getCognosViewer().getId(),_17cd,_17ce);
}
}
};
AuthoredDrillAction.prototype._shouldShowInNewWindow=function(_17d7){
return _17d7.getAttribute("showInNewWindow")=="true";
};
AuthoredDrillAction.prototype.isSameReport=function(_17d8,_17d9){
if(_17d8["ui.object"]&&_17d9==_17d8["ui.object"].value){
return true;
}
return false;
};
AuthoredDrillAction.prototype.isSameReportFormat=function(_17da){
var _17db=this.getCognosViewer().envParams["run.outputFormat"];
if(_17db){
if(_17da==_17db){
return true;
}else{
if(_17db=="HTML"&&_17da=="HTMLFragment"){
return true;
}
}
}
return false;
};
AuthoredDrillAction.prototype.getXMLNodeAsString=function(_17dc,_17dd){
var sXML="";
if(_17dc!=null){
var node=XMLHelper_FindChildByTagName(_17dc,_17dd,false);
if(node!=null){
sXML=XMLBuilderSerializeNode(node);
}
}
return sXML;
};
AuthoredDrillAction.prototype.execute=function(_17e0){
if(this.m_drillTargetSpecification!=""){
this.executeDrillTarget(this.m_drillTargetSpecification);
}else{
if(typeof _17e0!="undefined"){
var _17e1=this.getCognosViewer().getDrillTargets();
var _17e2=this.getAuthoredDrillThroughContext(_17e0,_17e1);
var _17e3=_17e2.childNodes;
if(_17e3.length==1){
this.executeDrillTarget(XMLBuilderSerializeNode(_17e3[0]));
}else{
doMultipleDrills(XMLBuilderSerializeNode(_17e2),this.getCognosViewer().getId());
}
}
}
};
AuthoredDrillAction.prototype.showDrillTargets=function(_17e4){
var _17e5="<context>";
for(var index=0;index<_17e4.length;++index){
var _17e7=_17e4[index];
_17e5+="<member>";
var sName=_17e7.getAttribute("label");
_17e5+="<name>";
_17e5+=sXmlEncode(sName);
_17e5+="</name>";
var _17e9=_17e7.getAttribute("path");
_17e5+="<drillThroughSearchPath>";
_17e5+=sXmlEncode(_17e9);
_17e5+="</drillThroughSearchPath>";
var _17ea=_17e7.getAttribute("method");
_17e5+="<drillThroughAction>";
_17e5+=sXmlEncode(_17ea);
_17e5+="</drillThroughAction>";
var _17eb=_17e7.getAttribute("outputFormat");
_17e5+="<drillThroughFormat>";
_17e5+=sXmlEncode(_17eb);
_17e5+="</drillThroughFormat>";
var sData="parent."+this.getTargetReportRequestString(_17e7);
_17e5+="<data>";
_17e5+=sXmlEncode(sData);
_17e5+="</data>";
_17e5+="</member>";
}
_17e5+="</context>";
};
AuthoredDrillAction.prototype.populateContextMenu=function(_17ed){
var _17ee=this.getCognosViewer();
var _17ef=_17ee.rvMainWnd.getToolbarControl();
var _17f0=null;
if(typeof _17ef!="undefined"&&_17ef!=null){
var _17f1=_17ef.getItem("goto");
if(_17f1){
_17f0=_17f1.getMenu();
}
}
var _17f2=_17ee.rvMainWnd.getContextMenu();
var _17f3=null;
if(typeof _17f2!="undefined"&&_17f2!=null){
_17f3=_17f2.getGoToMenuItem().getMenu();
}
if(_17f0!=null||_17f3!=null){
var _17f4=this.getCognosViewer().getDrillTargets();
var _17f5=this.getAuthoredDrillThroughContext(_17ed,_17f4);
var _17f6=_17f5.childNodes;
if(_17f6.length>0){
for(var index=0;index<_17f6.length;++index){
var _17f8=_17f6[index];
var _17f9=getCognosViewerObjectRefAsString(this.getCognosViewer().getId())+".m_oDrillMgr.executeAuthoredDrill(\""+encodeURIComponent(XMLBuilderSerializeNode(_17f8))+"\");";
var _17fa=this.getTargetReportIconPath(_17f8);
var _17fb=_17f8.getAttribute("label");
if(isViewerBidiEnabled()){
var bidi=BidiUtils.getInstance();
_17fb=bidi.btdInjectUCCIntoStr(_17fb,getViewerBaseTextDirection());
}
if(_17f0!=null){
new CMenuItem(_17f0,_17fb,_17f9,_17fa,gMenuItemStyle,_17ee.getWebContentRoot(),_17ee.getSkin());
}
if(_17f3!=null){
new CMenuItem(_17f3,_17fb,_17f9,_17fa,gMenuItemStyle,_17ee.getWebContentRoot(),_17ee.getSkin());
}
}
}
}
};
AuthoredDrillAction.prototype.buildSelectionChoicesNilSpecification=function(){
return "<selectChoices/>";
};
AuthoredDrillAction.prototype.buildSelectionChoicesSpecification=function(_17fd){
var _17fe="";
var _17ff=_17fd.getAttribute("value");
if(_17ff!=null){
var _1800=_17fd.getAttribute("propertyToPass");
_17fe+="<selectChoices";
if(_1800!=null&&_1800!=""){
_17fe+=" propertyToPass=\"";
_17fe+=sXmlEncode(_1800);
_17fe+="\"";
}
_17fe+=">";
if(_17ff.indexOf("<selectChoices>")!=-1){
_17fe+=_17ff.substring(_17ff.indexOf("<selectChoices>")+15);
}else{
if(_17ff!=""){
_17fe+="<selectOption ";
var sMun=_17fd.getAttribute("mun");
if(sMun!=null&&sMun!=""){
var _1802=sXmlEncode(sMun);
_17fe+="useValue=\"";
_17fe+=_1802;
_17fe+="\" ";
_17fe+="mun=\"";
_17fe+=_1802;
_17fe+="\" ";
_17fe+="displayValue=\"";
_17fe+=sXmlEncode(_17ff);
_17fe+="\"";
}else{
_17fe+="useValue=\"";
_17fe+=sXmlEncode(_17ff);
_17fe+="\" ";
var _1803=_17fd.getAttribute("displayValue");
if(_1803==null||_1803==""){
_1803=_17ff;
}
_17fe+="displayValue=\"";
_17fe+=sXmlEncode(_1803);
_17fe+="\"";
}
_17fe+="/>";
_17fe+="</selectChoices>";
}
}
}
return _17fe;
};
AuthoredDrillAction.prototype.getPropertyToPass=function(_1804,_1805){
if(_1804!=null&&_1804!=""&&_1805!=null){
var _1806=_1805.childNodes;
if(_1806!=null){
for(var index=0;index<_1806.length;++index){
var _1808=_1806[index];
var sName="";
if(_1808.getAttribute("name")!=null){
sName=_1808.getAttribute("name");
}
if(sName==_1804){
return _1808.getAttribute("propertyToPass");
}
}
}
}
return "";
};
AuthoredDrillAction.prototype.getTargetReportRequestString=function(_180a){
var _180b="";
var _180c=_180a.getAttribute("bookmarkRef");
var _180d=_180a.getAttribute("path");
var _180e=_180a.getAttribute("showInNewWindow");
if((_180c!=null&&_180c!="")&&(_180d==null||_180d=="")){
_180b+="document.location=\"#";
_180b+=_180c;
_180b+="\";";
}else{
_180b+="doSingleDrill(";
if(_180e=="true"){
_180b+="\"_blank\",";
}else{
_180b+="\"\",";
}
_180b+="[[\"obj\",\"";
_180b+=encodeURIComponent(_180d);
_180b+="\"]";
var _180f=XMLHelper_FindChildrenByTagName(_180a,"drillParameter",false);
for(var index=0;index<_180f.length;++index){
var _1811=_180f[index];
var _1812=_1811.getAttribute("value");
var sName=_1811.getAttribute("name");
if(_1812!=null&&_1812!=""){
_180b+=", [\"p_"+sName+"\",\""+encodeURIComponent(this.buildSelectionChoicesSpecification(_1811))+"\"]";
}
var sNil=_1811.getAttribute("nil");
if(sNil!=null&&sNil!=""){
_180b+="\", [\"p_"+sName+"\",\""+encodeURIComponent(this.buildSelectionChoicesNilSpecification())+"\"]";
}
}
_180b+="],";
var _1815=_180a.getAttribute("method");
_180b+="\""+encodeURIComponent(_1815)+"\",";
var _1816=_180a.getAttribute("outputFormat");
_180b+="\""+encodeURIComponent(_1816)+"\",";
var _1817=_180a.getAttribute("outputLocale");
_180b+="\""+encodeURIComponent(_1817)+"\",";
_180b+="\""+encodeURIComponent(_180c)+"\",";
var _1818=XMLBuilderSerializeNode(XMLHelper_FindChildByTagName(_180a,"parameters",false));
_180b+="\""+encodeURIComponent(_1818)+"\",";
var _1819=XMLBuilderSerializeNode(XMLHelper_FindChildByTagName(_180a,"objectPaths",false));
_180b+="\""+encodeURIComponent(_1819)+"\",";
_180b+="\""+encodeURIComponent(this.getCognosViewer().getId())+"\",";
var _181a=_180a.getAttribute("prompt");
_180b+="\""+encodeURIComponent(_181a)+"\",";
var _181b=_180a.getAttribute("dynamicDrill");
_180b+=" "+encodeURIComponent(_181b);
_180b+=");";
}
return _180b;
};
AuthoredDrillAction.prototype.getTargetReportIconPath=function(_181c){
var _181d="";
var _181e=_181c.getAttribute("bookmarkRef");
var _181f=XMLHelper_FindChildByTagName(_181c,"drillParameter",false);
if((_181e!=null&&_181e!="")&&_181f==null){
_181d="/common/images/spacer.gif";
}else{
var _1820=_181c.getAttribute("method");
switch(_1820){
case "editAnalysis":
_181d="/ps/portal/images/icon_ps_analysis.gif";
break;
case "editQuery":
_181d="/ps/portal/images/icon_qs_query.gif";
break;
case "execute":
_181d="/ps/portal/images/action_run.gif";
break;
case "view":
var _1821=_181c.getAttribute("outputFormat");
switch(_1821){
case "HTML":
case "XHTML":
case "HTMLFragment":
_181d="/ps/portal/images/icon_result_html.gif";
break;
case "PDF":
_181d="/ps/portal/images/icon_result_pdf.gif";
break;
case "XML":
_181d="/ps/portal/images/icon_result_xml.gif";
break;
case "CSV":
_181d="/ps/portal/images/icon_result_csv.gif";
break;
case "XLS":
_181d="/ps/portal/images/icon_result_excel.gif";
break;
case "SingleXLS":
_181d="/ps/portal/images/icon_result_excel_single.gif";
break;
case "XLWA":
_181d="/ps/portal/images/icon_result_excel_web_arch.gif";
break;
default:
_181d="/common/images/spacer.gif";
}
break;
default:
_181d="/common/images/spacer.gif";
}
}
return this.getCognosViewer().getWebContentRoot()+_181d;
};
AuthoredDrillAction.prototype.getAuthoredDrillThroughContext=function(_1822,_1823){
if(typeof _1822!="string"||typeof _1823!="object"){
return null;
}
var _1824=XMLBuilderLoadXMLFromString(_1822);
if(_1824==null||_1824.firstChild==null){
return null;
}
var _1825=XMLHelper_GetFirstChildElement(_1824);
if(XMLHelper_GetLocalName(_1825)!="AuthoredDrillTargets"){
return null;
}
var _1826=XMLHelper_GetFirstChildElement(_1825);
if(XMLHelper_GetLocalName(_1826)!="rvDrillTargets"){
return null;
}
var _1827=_1826.childNodes;
if(_1827===null||_1827.length===0){
return null;
}
var _1828=self.XMLBuilderCreateXMLDocument("rvDrillTargets");
for(var _1829=0;_1829<_1827.length;++_1829){
if(typeof _1827[_1829].getAttribute=="undefined"){
continue;
}
var _182a=_1828.createElement("drillTarget");
_1828.documentElement.appendChild(_182a);
var _182b=_1827[_1829].getAttribute("bookmarkRef");
if(_182b===null){
_182a.setAttribute("bookmarkRef","");
}else{
_182a.setAttribute("bookmarkRef",_182b);
}
var _182c=_1827[_1829].getAttribute("bookmarkPage");
if(_182c===null){
_182a.setAttribute("bookmarkPage","");
}else{
_182a.setAttribute("bookmarkPage",_182c);
}
var _182d=_1827[_1829].getAttribute("drillIdx");
if(_182d==null){
continue;
}
if(_182d>=_1823.length){
continue;
}
var _182e=_1823[_182d];
if(typeof _182e!="object"){
continue;
}
_182a.setAttribute("outputFormat",_182e.getOutputFormat());
_182a.setAttribute("outputLocale",_182e.getOutputLocale());
_182a.setAttribute("prompt",_182e.getPrompt());
_182a.setAttribute("dynamicDrill",_182e.isDynamicDrillThrough()?"true":"false");
var _182f=_1827[_1829].getAttribute("label");
if(_182f===null||_182f===""){
_182f=_182e.getLabel();
}
_182a.setAttribute("label",_182f);
_182a.setAttribute("path",_182e.getPath());
_182a.setAttribute("showInNewWindow",_182e.getShowInNewWindow());
_182a.setAttribute("method",_182e.getMethod());
var _1830=_1826;
var _1831="";
var _1832=_182e.getParameterProperties();
if(typeof _1832!="undefined"&&_1832!=null&&_1832!=""){
_1831=XMLHelper_GetFirstChildElement(XMLBuilderLoadXMLFromString(_182e.getParameterProperties()));
}
while(_1830){
var _1833=_1830.childNodes[_1829].childNodes;
for(var _1834=0;_1834<_1833.length;++_1834){
var _1835=_1833[_1834].cloneNode(true);
if(_1831){
var _1836=this.getPropertyToPass(_1835.getAttribute("name"),_1831);
if(_1836!=null&&_1836!=""){
_1835.setAttribute("propertyToPass",_1836);
}
}
_182a.appendChild(_1835);
}
_1830=_1830.nextSibling;
}
var _1837="<root xmlns:bus=\"http://developer.cognos.com/schemas/bibus/3/\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">";
var _1838="</root>";
var _1839=_1837+_182e.getParameters()+_1838;
var _183a=XMLBuilderLoadXMLFromString(_1839);
var _183b=XMLHelper_GetFirstChildElement(XMLHelper_GetFirstChildElement(_183a));
if(_183b){
_182a.appendChild(_183b.cloneNode(true));
}
var _183c=_1837+_182e.getObjectPaths()+_1838;
var _183d=XMLBuilderLoadXMLFromString(_183c);
_183b=XMLHelper_GetFirstChildElement(XMLHelper_GetFirstChildElement(_183d));
if(_183b){
_182a.appendChild(_183b.cloneNode(true));
}
}
return XMLHelper_GetFirstChildElement(_1828);
};
function ChangeDisplayTypeAction(){
this.m_requestParams=null;
this.m_sAction="ChangeDataContainerType";
this.m_iMAX_NUM_SUGGESTED_DISPLAY_TYPES=5;
};
ChangeDisplayTypeAction.prototype=new ModifyReportAction();
ChangeDisplayTypeAction.prototype.getUndoHint=function(){
return RV_RES.IDS_JS_CHANGE_DISPLAY;
};
ChangeDisplayTypeAction.prototype.setRequestParms=function(parms){
this.m_requestParams=parms;
};
ChangeDisplayTypeAction.prototype.addActionContextAdditionalParms=function(){
this._cleaerPinAndFreeze();
var _183f=false;
if(this.m_requestParams.bestVisualization){
_183f=true;
}else{
if(((this.m_requestParams.targetType.targetType==undefined)||(this.m_requestParams.targetType.targetType=="undefined"))&&(this.m_requestParams.targetType.templateId==undefined)){
var _1840=eval("("+this.m_requestParams.targetType+")");
}else{
var _1840=this.m_requestParams.targetType;
}
}
var _1841=this.m_oCV.getViewerWidget().findContainerDiv();
var _1842="";
if(_1841){
_1842="<widgetWidth>"+(parseInt(_1841.style.width,10)-ResizeChartAction.PADDING.getWidth())+"px</widgetWidth>"+"<widgetHeight>"+(parseInt(_1841.style.height,10)-ResizeChartAction.PADDING.getHeight())+"px</widgetHeight>";
}
var _1843="";
if(_183f){
_1843+="<bestVisualization>true</bestVisualization>";
_1843+=this.getDataItemInfoMap();
}else{
_1843+="<target>";
_1843+=_1840.targetType;
_1843+="</target>";
if(_1840.templateId){
_1843+="<templateId>";
_1843+=((_1840.templateId)?_1840.templateId:"");
_1843+="</templateId>";
_1843+="<variationId>";
_1843+=((_1840.variationId)?_1840.variationId:"");
_1843+="</variationId>";
_1843+=this.getDataItemInfoMap();
}
_1843+="<label>";
_1843+=_1840.label;
_1843+="</label>";
}
_1843+=_1842;
_1843+=this.addClientContextData(3);
return (_1843);
};
ChangeDisplayTypeAction.prototype._cleaerPinAndFreeze=function(){
var _1844=this.m_oCV.getPinFreezeManager();
if(_1844){
var _1845=this.getContainerId(this.m_oCV.getSelectionController());
_1844.clearPinInfo(_1845);
}
};
ChangeDisplayTypeAction.prototype.updateMenu=function(_1846){
var _1847=this.getCognosViewer().getRAPReportInfo();
_1846.visible=(_1847)?_1847.containsInteractiveDataContainer():_1846.visible;
if(!_1846.visible){
return _1846;
}
var _1848=this.getSelectedReportInfo();
_1846.disabled=(_1848==null||_1848.displayTypeId==null||!this.isInteractiveDataContainer(_1848.displayTypeId));
if(_1846.disabled){
_1846.iconClass="chartTypesDisabled";
return _1846;
}
_1846.iconClass="chartTypes";
return this.buildDynamicMenuItem(_1846,"ChangeDisplayType");
};
ChangeDisplayTypeAction.prototype.createEmptyMenuItem=function(){
return {name:"None",label:RV_RES.IDS_JS_CHANGE_DISPLAY_SELECT_DATA,iconClass:"",action:null,items:null};
};
ChangeDisplayTypeAction.prototype.getActionContextString=function(_1849){
var _184a="<getInfoActions>";
_184a+="<getInfoAction name=\"GetInfo\">";
_184a+="<include><suggestedDisplayTypes/></include>";
_184a+=this.getDataItemInfoMap();
_184a+="<groupId>";
_184a+=_1849;
_184a+="</groupId>";
_184a+=this.addClientContextData(3);
_184a+="</getInfoAction>";
_184a+="</getInfoActions>";
return _184a;
};
ChangeDisplayTypeAction.prototype.fetchSuggestedDisplayTypes=function(_184b){
var oCV=this.getCognosViewer();
var _184d=new AsynchJSONDispatcherEntry(oCV);
_184d.addFormField("ui.action","getInfoFromReportSpec");
_184d.addFormField("bux","true");
_184d.addFormField("ui.object",oCV.envParams["ui.object"]);
_184d.addFormField("cv.actionContext",this.getActionContextString(_184b));
_184d.addDefinedFormField("ui.spec",oCV.envParams["ui.spec"]);
_184d.addNonEmptyStringFormField("modelPath",oCV.getModelPath());
if(_184b=="undefined"){
_184d.setCallbacks({"complete":{"object":this,"method":this.handleSuggestedDisplayTypesResponse}});
}else{
_184d.setCallbacks({"complete":{"object":this,"method":this.handleSuggestedDisplayVariationsResponse}});
}
oCV.dispatchRequest(_184d);
};
ChangeDisplayTypeAction.prototype.handleSuggestedDisplayTypesResponse=function(_184e){
var _184f=this.getCognosViewer();
var _1850=_184f.getViewerWidget();
this.addSuggestedDisplayTypesMenuItems(_184e.getResult());
};
ChangeDisplayTypeAction.prototype.addSuggestedDisplayTypesMenuItems=function(_1851){
var _1852=this.getCognosViewer().findToolbarItem("ChangeDisplayType");
if(_1852){
_1852.open=false;
}
var _1853=[];
var _1854=this.getSelectedReportInfo();
var _1855=undefined;
for(var x=0;x<_1851.containers.length;x++){
if(_1854.container==_1851.containers[x].container){
_1855=_1851.containers[x];
break;
}
}
if(_1855==undefined){
return;
}
var _1857=_1855.suggestedDisplayTypes.length<=this.m_iMAX_NUM_SUGGESTED_DISPLAY_TYPES?_1855.suggestedDisplayTypes.length:this.m_iMAX_NUM_SUGGESTED_DISPLAY_TYPES;
_1853.push({title:RV_RES.IDS_JS_CHANGE_DISPLAY_RECOMMENDED});
_1853.push({separator:true});
for(var i=0;i<_1857;i++){
_1853.push({name:_1855.suggestedDisplayTypes[i].name,label:_1855.suggestedDisplayTypes[i].title,description:_1855.suggestedDisplayTypes[i].description,iconClass:_1855.suggestedDisplayTypes[i].iconClass,action:{name:"ChangeDisplayType",payload:{targetType:{templateId:_1855.suggestedDisplayTypes[i].templateId},label:_1855.suggestedDisplayTypes[i].title}},items:null});
}
_1853.push({separator:true});
_1853.push({name:"ChangeDisplayMore",label:RV_RES.IDS_JS_CHANGE_DISPLAY_TYPE_MORE,iconClass:"ChartTypeOther",action:{name:"InvokeChangeDisplayTypeDialog",payload:{}},items:null});
_1852.open=true;
_1852.items=_1853;
var _1859=[];
_1859.push(_1852);
this.getCognosViewer().getViewerWidget().fireEvent("com.ibm.bux.widgetchrome.toolbar.update",null,_1859);
return _1853;
};
ChangeDisplayTypeAction.prototype.buildMenu=function(_185a){
var _185b=this.getCognosViewer().getRAPReportInfo();
_185a.visible=(_185b)?_185b.containsInteractiveDataContainer():_185a.visible;
if(!_185a.visible){
return _185a;
}
var _185c=this.getSelectedReportInfo();
_185a.disabled=(_185c==null||_185c.displayTypeId==null||!this.isInteractiveDataContainer(_185c.displayTypeId));
if(_185a.disabled){
_185a.iconClass="chartTypesDisabled";
}else{
_185a.iconClass="chartTypes";
var _185d=this.getCognosViewer().getAdvancedServerProperty("VIEWER_JS_enableVisCoach");
if(_185d!=="false"&&(typeof _185c.suggestedDisplayTypesEnabled!="undefined")&&(_185c.suggestedDisplayTypesEnabled!=null)&&(_185c.suggestedDisplayTypesEnabled=="true")){
this.fetchSuggestedDisplayTypes("undefined");
return this.buildDynamicMenuItem(_185a,"ChangeDisplayType");
}else{
_185a.items=[];
var isV2=(_185c.displayTypeId.match("v2_")!=null||_185c.displayTypeId=="crosstab"||_185c.displayTypeId=="list");
if(isV2){
_185a.items.push({name:"ChangeDisplayBar",label:RV_RES.IDS_JS_CHANGE_DISPLAY_TYPE_BAR,iconClass:"ChartTypeBar",action:{name:"ChangeDisplayType",payload:{targetType:"v2_bar_rectangle_clustered"}},items:null});
_185a.items.push({name:"ChangeDisplayColumn",label:RV_RES.IDS_JS_CHANGE_DISPLAY_TYPE_COLUMN,iconClass:"ChartTypeColumn",action:{name:"ChangeDisplayType",payload:{targetType:"v2_column_rectangle_clustered"}},items:null});
_185a.items.push({name:"ChangeDisplayLine",label:RV_RES.IDS_JS_CHANGE_DISPLAY_TYPE_LINE,iconClass:"ChartTypeLine",action:{name:"ChangeDisplayType",payload:{targetType:"v2_line_clustered_markers"}},items:null});
_185a.items.push({name:"ChangeDisplayPie",label:RV_RES.IDS_JS_CHANGE_DISPLAY_TYPE_PIE,iconClass:"ChartTypePie",action:{name:"ChangeDisplayType",payload:{targetType:"v2_pie"}},items:null});
_185a.items.push({name:"ChangeDisplayCrosstab",label:RV_RES.IDS_JS_CHANGE_DISPLAY_TYPE_CROSSTAB,iconClass:"ChartTypeCrosstab",action:{name:"ChangeDisplayType",payload:{targetType:"Crosstab"}},items:null});
_185a.items.push({name:"ChangeDisplayList",label:RV_RES.IDS_JS_CHANGE_DISPLAY_TYPE_LIST,iconClass:"ChartTypeList",action:{name:"ChangeDisplayType",payload:{targetType:"List"}},items:null});
_185a.items.push({name:"ChangeDisplayMore",label:RV_RES.IDS_JS_CHANGE_DISPLAY_TYPE_MORE,iconClass:"ChartTypeOther",action:{name:"InvokeChangeDisplayTypeDialog",payload:""},items:null});
}else{
_185a.items.push({name:"ChangeDisplayBar",label:RV_RES.IDS_JS_CHANGE_DISPLAY_TYPE_BAR,iconClass:"ChartTypeBar",action:{name:"ChangeDisplayType",payload:{targetType:"bar_clustered_flat"}},items:null});
_185a.items.push({name:"ChangeDisplayColumn",label:RV_RES.IDS_JS_CHANGE_DISPLAY_TYPE_COLUMN,iconClass:"ChartTypeColumn",action:{name:"ChangeDisplayType",payload:{targetType:"column_clustered_flat"}},items:null});
_185a.items.push({name:"ChangeDisplayLine",label:RV_RES.IDS_JS_CHANGE_DISPLAY_TYPE_LINE,iconClass:"ChartTypeLine",action:{name:"ChangeDisplayType",payload:{targetType:"line_clustered_flat_markers"}},items:null});
_185a.items.push({name:"ChangeDisplayPie",label:RV_RES.IDS_JS_CHANGE_DISPLAY_TYPE_PIE,iconClass:"ChartTypePie",action:{name:"ChangeDisplayType",payload:{targetType:"pie_flat"}},items:null});
_185a.items.push({name:"ChangeDisplayCrosstab",label:RV_RES.IDS_JS_CHANGE_DISPLAY_TYPE_CROSSTAB,iconClass:"ChartTypeCrosstab",action:{name:"ChangeDisplayType",payload:{targetType:"Crosstab"}},items:null});
_185a.items.push({name:"ChangeDisplayList",label:RV_RES.IDS_JS_CHANGE_DISPLAY_TYPE_LIST,iconClass:"ChartTypeList",action:{name:"ChangeDisplayType",payload:{targetType:"List"}},items:null});
_185a.items.push({name:"ChangeDisplayMore",label:RV_RES.IDS_JS_CHANGE_DISPLAY_TYPE_MORE,iconClass:"ChartTypeOther",action:{name:"InvokeChangeDisplayTypeDialog",payload:""},items:null});
}
}
for(var i in _185a.items){
_185a.items[i].action.payload={targetType:_185a.items[i].action.payload};
_185a.items[i].action.payload.targetType.label=_185a.items[i].label;
}
}
return _185a;
};
function ChangeDisplayVariationsAction(){
};
ChangeDisplayVariationsAction.prototype=new CognosViewerAction();
function ChangeDisplayVariationsAction(){
this.m_requestParams=null;
};
ChangeDisplayVariationsAction.prototype.setRequestParms=function(parms){
this.m_requestParams=parms;
};
ChangeDisplayVariationsAction.prototype.execute=function(){
var _1861=this.m_requestParams.groupId;
var _1862=this.getCognosViewer();
var _1863=this.getSelectedReportInfo();
if(_1863){
var _1864=_1862.getViewerWidget();
if(typeof _1863.suggestedDisplayVariations=="undefined"){
var _1865=new AsynchJSONDispatcherEntry(this.m_oCV);
_1865.setCallbacks({"complete":{"object":this,"method":this.handleResponse}});
_1865.setRequestIndicator(_1862.getRequestIndicator());
_1865.addFormField("ui.action","getInfoFromReportSpec");
_1865.addFormField("bux","true");
_1865.addNonEmptyStringFormField("modelPath",this.m_oCV.getModelPath());
_1865.addFormField("ui.object",this.m_oCV.envParams["ui.object"]);
_1865.addDefinedFormField("ui.spec",this.m_oCV.envParams["ui.spec"]);
_1865.addFormField("cv.actionContext",this.addActionContext(_1861));
_1862.dispatchRequest(_1865);
}else{
_1864.updateDisplayTypeDialogVariations(_1863.possibleDisplayTypes,_1863.suggestedDisplayVariations);
}
}
};
ChangeDisplayVariationsAction.prototype.handleResponse=function(_1866){
var _1867=this.getCognosViewer();
var _1868=_1867.getViewerWidget();
var _1869=_1866.getResult();
for(var i in _1869.containers){
var _186b=this.getReportInfo(_1869.containers[i].container);
_186b.possibleDisplayTypes=_1869.containers[i].possibleDisplayTypes;
_186b.variationGroups=_1869.containers[i].variationGroups;
}
var _186c=this.getSelectedReportInfo();
_1868.updateDisplayTypeDialogVariations(_186c.possibleDisplayTypes,_186c.variationGroups);
};
ChangeDisplayVariationsAction.prototype.addActionContext=function(_186d){
var _186e="<getInfoActions>";
_186e+="<getInfoAction name=\"GetInfo\">";
_186e+="<include><suggestedDisplayVariations/></include>";
_186e+=this.getDataItemInfoMap();
_186e+=this.addClientContextData(3);
_186e+="<groupId>";
_186e+=_186d;
_186e+="</groupId>";
_186e+="</getInfoAction>";
_186e+="</getInfoActions>";
return _186e;
};
function ChangePaletteAction(){
this.m_sAction="ChangePalette";
this.m_palette="";
this.m_runReport=true;
this.m_aPaletteNames=["Flow","Classic","Contemporary","Contrast","Corporate","Dynamic","Excel","Excel 2007","Gradients","Grey Scale","Jazz","Legacy","Metro","Mixed","Modern","Patterns"];
this.m_aPaletteIcons=["changePaletteFlow","changePaletteClassic","changePaletteContemporary","changePaletteContrast","changePaletteCorporate","changePaletteDynamic","changePaletteExcel","changePaletteExcel2007","changePaletteGradients","changePaletteGreyScale","changePaletteJazz","changePaletteLegacy","changePaletteMetro","changePaletteMixed","changePaletteModern","changePalettePatterns"];
};
ChangePaletteAction.prototype=new ModifyReportAction();
ChangePaletteAction.baseclass=ModifyReportAction.prototype;
ChangePaletteAction.prototype.reuseQuery=function(){
return true;
};
ChangePaletteAction.prototype.preProcess=function(){
this.updateRunReport();
if(this.m_runReport==false){
var _186f=this.getLayoutComponents();
for(var index=0;index<_186f.length;++index){
var _1871=_186f[index];
if(_1871.getAttribute("flashChart")!=null){
if(this.m_palette==""){
_1871.setPalette("Flow");
}else{
_1871.setPalette(this.m_palette);
}
}
}
}
};
ChangePaletteAction.prototype.updateRunReport=function(){
this.m_runReport=true;
var _1872=document.getElementById("rt"+this.m_oCV.getId());
if(_1872!=null){
var _1873=getElementsByAttribute(_1872,"*","chartcontainer","true");
if(_1873.length==0){
this.m_runReport=false;
}
}
};
ChangePaletteAction.prototype.runReport=function(){
return this.m_runReport;
};
ChangePaletteAction.prototype.updateInfoBar=function(){
return false;
};
ChangePaletteAction.prototype.getUndoHint=function(){
return RV_RES.IDS_JS_CHANGE_PALETTE;
};
ChangePaletteAction.prototype.setRequestParms=function(_1874){
if(typeof _1874=="string"){
this.m_palette=_1874;
if(this.m_oCV!=null&&typeof this.m_oCV!="undefined"){
this.m_oCV.m_sPalette=_1874;
}
}
};
ChangePaletteAction.prototype.addActionContextAdditionalParms=function(){
if(this.m_palette!=""){
return "<name>"+this.m_palette+"</name>";
}
return "";
};
ChangePaletteAction.prototype.updateMenu=function(_1875){
_1875.visible=this.ifContainsInteractiveDataContainer();
if(!_1875.visible){
return _1875;
}
var _1876=this.getSelectedReportInfo();
if(_1876!=null&&_1876.displayTypeId.indexOf("Chart")>=0){
_1875.disabled=false;
return _1875;
}
_1875.disabled=true;
return _1875;
};
ChangePaletteAction.reset=function(oCV){
delete (oCV.m_sPalette);
};
function DragDropAction(){
this.m_source=null;
this.m_target=null;
this.m_insertBefore=false;
this.m_sAction="Reorder";
};
DragDropAction.prototype=new ModifyReportAction();
DragDropAction.prototype.getUndoHint=function(){
return RV_RES.IDS_JS_MOVE;
};
DragDropAction.prototype.getOffsetCoords=function(_1878){
var _1879=document.getElementById("rt"+this.getCognosViewer().getId());
var _187a=_1878;
var _187b=0;
var _187c=0;
while(_187a!=_1879){
_187b+=_187a.offsetTop;
_187c+=_187a.offsetLeft;
_187a=_187a.offsetParent;
}
return {left:_187c,top:_187b};
};
DragDropAction.prototype.showDragDropCaret=function(evt,cell,_187f){
var _1880=document.getElementById("VDDC"+this.getCognosViewer().getId());
if(_1880==null){
_1880=document.createElement("span");
_1880.setAttribute("id","VDDC"+this.getCognosViewer().getId());
_1880.className="dropCaret";
if(_1880.attachEvent){
_1880.attachEvent("onmousemove",stopEventBubble);
}else{
_1880.addEventListener("mousemove",stopEventBubble,false);
}
_1880.style.width="8px";
_1880.innerHTML="<img style=\"margin:1px;width:2px;height:100%;\" src=\""+this.getCognosViewer().getWebContentRoot()+"/rv/images/drop_caret.gif\"/>";
_187f.appendChild(_1880);
}
var _1881=this.getOffsetCoords(_187f);
_1880.style.top=(_1881.top-1)+"px";
var _1882;
if(typeof evt.offsetX=="undefined"){
_1882=evt.layerX;
}else{
_1881=this.getOffsetCoords(evt.srcElement);
_1882=evt.offsetX+_1881.left;
}
_1881=this.getOffsetCoords(cell);
var _1883=_1881.left+(cell.clientWidth/2);
this.m_insertBefore=(_1882<_1883);
_1880.style.height=_187f.clientHeight+"px";
if(this.m_insertBefore==false){
_1880.style.left=(_1881.left+cell.clientWidth+1)+"px";
}else{
_1880.style.left=_1881.left+"px";
}
_1880.style.display="inline";
};
DragDropAction.prototype.showDragDropIndicators=function(evt){
if(this.m_target!=null){
var cell=this.m_target.getCellRef();
var _1886=cell;
while(_1886.getAttribute("lid")==null){
_1886=_1886.parentNode;
}
this.showDragDropCaret(evt,cell,_1886);
}
};
DragDropAction.prototype.showDragDropToolTip=function(evt){
var _1888="";
if(this.canDrop()==true){
_1888="/rv/images/cursor_move.gif";
}else{
_1888="/rv/images/cursor_nodrop.gif";
}
this.showCustomCursor(evt,"viewerTooltipSpan",_1888);
};
DragDropAction.prototype.canMove=function(){
if(this.m_oCV.isBlacklisted("Move")){
return false;
}
var _1889=this.getCognosViewer().getSelectionController();
this.m_source=_1889.getAllSelectedObjects();
if(this.m_source!=null&&this.m_source.length>0){
if(typeof this.m_source[0].m_dataContainerType!="undefined"&&this.m_source[0].m_dataContainerType=="list"&&this.m_source[0].getLayoutType()!="summary"){
return true;
}
}
return false;
};
DragDropAction.prototype.onDrag=function(evt){
clearTextSelection();
var _188b=getNodeFromEvent(evt);
var _188c=this.getCognosViewer().getSelectionController();
this.m_target=_188c.buildSelectionObject(_188b,evt);
this.showDragDropToolTip(evt);
if(this.canDrop()){
this.showDragDropIndicators(evt);
}else{
this.hideDropIndicators();
}
};
DragDropAction.prototype.hideDropIndicators=function(){
var _188d=document.getElementById("VDDC"+this.getCognosViewer().getId());
if(_188d!=null){
_188d.style.display="none";
}
};
DragDropAction.prototype.onMouseDown=function(evt){
if(this.canMove()){
window.oCVDragDropObject={action:this,x:evt.clientX,y:evt.clientY,dragging:false};
}
};
DragDropAction.prototype.canDrop=function(){
return this.m_target!=null&&this.m_source!=null&&this.m_target.getLayoutType()!="summary"&&(this.m_target.getLayoutElementId()==this.m_source[0].getLayoutElementId());
};
DragDropAction.prototype.onDrop=function(evt){
this.hideCustomCursor("viewerTooltipSpan");
this.hideDropIndicators();
if(this.canDrop(evt)){
var _1890=true;
var _1891;
var first=parseInt(this.m_source[0].getColumnRef(),10);
var last=first;
var _1894=true;
for(var index=0;index<this.m_source.length;++index){
_1891=parseInt(this.m_source[index].getColumnRef(),10);
if(index>0&&_1891!==last+1){
_1894=false;
break;
}
last=_1891;
}
if(_1894){
var _1896=parseInt(this.m_target.getColumnRef(),10);
_1896+=this.m_insertBefore?0:1;
if(_1896>=first&&_1896<=last+1){
_1890=false;
}
}
if(_1890){
this.execute();
}
}
};
DragDropAction.prototype.addActionContextAdditionalParms=function(){
var tag=this.m_insertBefore==true?"before":"after";
var _1898=this.m_target.getCellRef();
var _1899=this.getRAPLayoutTag(_1898);
_1899=(_1899!=null)?_1899:this.m_target.getColumnName();
return this.getSelectedCellTags()+"<"+tag+">"+xml_encode(_1899)+"</"+tag+">";
};
function DragDropAction_isDragging(evt){
var _189b=window.oCVDragDropObject;
if(_189b){
var _189c=evt.clientX;
var _189d=evt.clientY;
var _189e=_189b.x;
var _189f=_189b.y;
if((_189c>=(_189e+2))||(_189c<=(_189e-2))||(_189d>=(_189f+2))||(_189d<=(_189f-2))){
_189b.dragging=true;
}
return _189b.dragging;
}
return false;
};
function DragDropAction_onmouseup(evt){
if(DragDropAction_isDragging(evt)){
window.oCVDragDropObject.action.onDrop(evt);
}
window.oCVDragDropObject=null;
};
function DragDropAction_onmousemove(evt){
if(DragDropAction_isDragging(evt)){
window.oCVDragDropObject.action.onDrag(evt);
}
};
function DrillAction(){
this.m_bUseReportInfoSelection=false;
this.m_aDrillSelectedObjects=[];
this.m_useMARequest=false;
this.m_userSelectedDrillItem=null;
};
DrillAction.prototype=new ModifyReportAction();
DrillAction.prototype.getHoverClassName=function(){
return "";
};
DrillAction.prototype.setRequestParms=function(parms){
if(parms){
this.m_userSelectedDrillItem=parms.userSelectedDrillItem;
}
};
DrillAction.prototype.setKeepFocusOnWidget=function(_18a3){
this.m_bKeepFocusOnWidget=_18a3;
};
DrillAction.prototype.keepFocusOnWidget=function(){
if(typeof this.m_bKeepFocusOnWidget!="undefined"){
return this.m_bKeepFocusOnWidget;
}
return true;
};
DrillAction.prototype.getDrillabilityForItemFromReportInfo=function(_18a4){
if(!this.m_oCV){
return null;
}
var _18a5=this.m_oCV.getRAPReportInfo();
if(!_18a5){
return null;
}
var _18a6=_18a5.getContainers();
for(var _18a7 in _18a6){
var _18a8=_18a5.getDrillability(_18a7);
if(_18a8[_18a4]){
return _18a8[_18a4];
}
}
return null;
};
DrillAction.prototype.onDoubleClick=function(evt){
this.execute();
};
DrillAction.prototype.preProcess=function(){
if(typeof this.m_drillSpec==="undefined"||this.m_drillSpec===null){
var _18aa=this.generateDrillSpecObjects();
if(!_18aa){
return null;
}
var _18ab=this.getCognosViewer();
var _18ac=_18ab.getViewerWidget();
if(_18ac){
var _18ad=_18ab.getModelPath();
_18ac.getWidgetContextManager().raiseDrillEvent(_18aa,this.m_sAction,_18ad);
}
}
};
DrillAction.prototype.generateDrillSpecObjects=function(){
try{
var _18ae=[];
var oCV=this.getCognosViewer();
var _18b0=oCV.getDrillMgr();
var _18b1=oCV.getSelectionController();
var _18b2=true;
var _18b3=_18b0.getDrillParameters(this.m_drillOption,true,_18b2,this.m_userSelectedDrillItem);
if(_18b3.length===0){
return null;
}
var _18b4=_18b0.getSelectedObject();
if(_18b3.length>3*4&&(_18b4.getDataContainerType()=="crosstab"||_18b4.getLayoutType()=="chartElement")){
_18b3.length=3*4;
}
var _18b5=_18b0.getSelectedObject().getSelectedContextIds();
for(var i=0,_18b7=0;_18b7<_18b5.length&&i<_18b3.length;++_18b7){
var _18b8=_18b5[_18b7][0];
var _18b9=_18b1.getRefDataItem(_18b8);
var sMUN=_18b1.getMun(_18b8);
var _18bb=_18b1.getDisplayValue(_18b8);
if(_18b1.getDrillFlagForMember(_18b8)===0){
i=i+4;
continue;
}
var _18bc={"dataItem":_18b3[i++],"mun":_18b3[i++],"lun":_18b3[i++],"hun":_18b3[i++]};
if(_18b9!=""&&_18bb!=""){
if(_18bc.dataItem===_18b9){
_18bc.displayValue=_18bb;
}
}
var _18bd=_18b1.getUsageInfo(_18b8);
_18bc.isMeasure=(_18bd==="2")?"true":"false";
var _18be=false;
if(sMUN!=""&&_18bd!="2"){
var _18bf=this.getDrillabilityForItemFromReportInfo(_18b9);
if((_18bf!=null&&_18bf.disableDown==true)||this.m_oCV.getSelectionController().getDrillFlagForMember(_18b8)==1){
_18be=true;
}
}
if(_18be){
if(_18bc.dataItem===_18b9){
_18bc.summary="true";
}
}
_18ae.push(_18bc);
}
return (_18ae.length>0)?_18ae:null;
}
catch(e){
return null;
}
};
DrillAction.prototype.parseDrillSpec=function(evt){
try{
var oCV=this.getCognosViewer();
if(oCV.getStatus()!=="complete"||oCV.getConversation()===""){
return false;
}
this.m_drillSpec=evt.payload.drillSpec;
var _18c2=XMLBuilderLoadXMLFromString(this.m_drillSpec);
var _18c3=_18c2.firstChild;
var _18c4=getCognosViewerSCObjectRef(oCV.getId());
_18c4.m_aSelectedObjects=[];
if(_18c4.hasSelectedChartNodes()){
_18c4.clearSelectionData();
}
var _18c5=XMLHelper_FindChildrenByTagName(_18c3,"DrillGroup",false);
for(var _18c6=0;_18c6<_18c5.length;++_18c6){
var _18c7=XMLHelper_FindChildByTagName(_18c5[_18c6],"MUN",false);
var sMun=XMLHelper_GetText(_18c7);
var sLun="";
var sHun="";
var _18cb="";
var _18cc="";
var _18cd=XMLHelper_FindChildByTagName(_18c5[_18c6],"DisplayValue",false);
if(_18cd!=null){
_18cb=XMLHelper_GetText(_18cd);
}
var _18ce=XMLHelper_FindChildByTagName(_18c5[_18c6],"LUN",false);
if(_18ce!=null){
sLun=XMLHelper_GetText(_18ce);
}
var _18cf=XMLHelper_FindChildByTagName(_18c5[_18c6],"HUN",false);
if(_18cf!=null){
sHun=XMLHelper_GetText(_18cf);
}
var _18d0=XMLHelper_FindChildByTagName(_18c5[_18c6],"Summary",false);
if(_18d0!=null){
_18cc=XMLHelper_GetText(_18d0);
}
this.selectObject(sMun,sLun,sHun,_18cb,_18cc,_18c4);
}
}
catch(e){
return false;
}
return (_18c4.m_aSelectedObjects.length>0);
};
DrillAction.prototype.parseDrillSpecObjects=function(_18d1){
if(this.useReportInfoSelection()){
return this.parseDrillSpecObjectsWithReportInfo(_18d1);
}
try{
var oCV=this.getCognosViewer();
if(oCV.getStatus()!=="complete"||oCV.getConversation()===""){
return false;
}
this.m_drillSpec="";
var _18d3=getCognosViewerSCObjectRef(oCV.getId());
_18d3.m_aSelectedObjects=[];
if(_18d3.hasSelectedChartNodes()){
_18d3.clearSelectionData();
}
for(var i in _18d1){
var oSpec=_18d1[i];
var _18d6=(oSpec.summary)?oSpec.summary:"";
var _18d7=true;
this.selectObject(oSpec.mun,oSpec.lun,oSpec.hun,oSpec.displayValue,_18d6,_18d3,_18d7);
}
}
catch(e){
return false;
}
return (_18d3.m_aSelectedObjects.length>0);
};
DrillAction.prototype.getDrillabilityForCtxValue=function(_18d8){
if(console&&console.log){
console.log("Required method, getDrillabilityForCtxValue, not implemented.");
}
};
DrillAction.prototype.setDrillabilityForSelectObject=function(_18d9){
this.drillability=this.getDrillabilityForCtxValue(_18d9);
};
DrillAction.prototype.canDrillDown=function(){
if(console&&console.log){
console.log("Required method, canDrillDown, not implemented.");
}
};
DrillAction.prototype.canDrilUp=function(){
if(console&&console.log){
console.log("Required method, canDrilUp, not implemented.");
}
};
DrillAction.prototype.selectObject=function(sMun,sLun,sHun,_18dd,_18de,_18df,_18e0){
var _18e1=sHun;
var _18e2=sLun;
var _18e3=sMun;
var _18e4=false;
var _18e5=_18df.getCtxIdFromMun(sMun);
var _18e6=_18e5;
if(_18e5===""){
var _18e7=_18df.replaceNamespaceForSharedTM1DimensionOnly(sLun,sHun,sMun);
_18e2=_18e7.lun;
_18e1=_18e7.hun;
if(_18e1!==sHun){
_18e3=this._replaceNamespace(sMun,_18e1);
}
_18e4=(_18e0==true);
_18e5=_18df.getCtxIdFromMetaData(_18e2,_18e1,_18e4);
if(_18e5===""){
return false;
}
}
this.setDrillabilityForSelectObject(_18e5);
if((_18e4==true)||(this.m_sAction=="DrillDown"&&this.canDrillDown())||(this.m_sAction=="DrillUp"&&this.canDrillUp())){
var _18e8=_18df.getSelections().length;
_18df.selectObject(_18e3,_18e2,_18e1,_18e4);
var _18e9=_18df.getSelections();
if(_18e6===""&&_18e9.length>_18e8){
var aMuns=_18e9[_18e9.length-1].m_aMuns;
aMuns[aMuns.length]=[];
aMuns[aMuns.length-1].push(_18e3);
var _18eb=_18e9[_18e9.length-1].m_aDisplayValues;
_18eb.push(_18dd);
_18e9[_18e9.length-1].useDisplayValueFromObject=true;
}
if(_18de=="true"){
_18e9=_18df.getSelections();
_18e9[_18e9.length-1].onSummary=true;
}
}
};
DrillAction.prototype._replaceNamespace=function(mun,_18ed){
var _18ee=null;
if(_18ed){
var _18ef=_18ed.substr(0,_18ed.indexOf("].[")+1);
if(mun&&_18ef&&!(mun.match("^"+_18ef))){
var _18f0=mun.indexOf("].[");
_18ee=_18ef+mun.substr(_18f0+1,mun.length);
}
}
return _18ee||mun;
};
DrillAction.prototype.addActionContextAdditionalParms=function(){
var _18f1="";
var _18f2=(this.useReportInfoSelection())?this.m_aDrillSelectedObjects:this.getCognosViewer().getSelectionController().getSelections();
var sItem=null;
for(var i=0;i<_18f2.length;++i){
if(_18f2[i].onSummary){
sItem=(this.useReportInfoSelection())?_18f2[i].item:_18f2[i].getDataItems()[0][0];
_18f1+="<dataItem>"+xml_encode(sItem)+"</dataItem>";
}
}
if(_18f1!=""){
_18f1="<onSummary>"+_18f1+"</onSummary>";
}
if(this.m_userSelectedDrillItem){
_18f1+=("<userSelectedDrillItem>"+this.m_userSelectedDrillItem+"</userSelectedDrillItem>");
}
if(this.m_useMARequest===true){
_18f1=_18f1+"<useMAGetChildRequest>false</useMAGetChildRequest>";
_18f1=_18f1+"<useMAGetParentRequest>false</useMAGetParentRequest>";
}
_18f1+=this.addClientContextData(3);
return _18f1;
};
DrillAction.prototype.getDrillOptionsAsString=function(){
var _18f5=this.getViewerWidget();
var _18f6="";
if(_18f5){
_18f6="<addSummaryMembers>"+_18f5.getDrillOptions().addSummaryMembers+"</addSummaryMembers>";
_18f6=_18f6+"<backwardsCompatible>"+_18f5.getDrillOptions().backwardsCompatible+"</backwardsCompatible>";
}
return _18f6;
};
DrillAction.prototype.getItemInfo=function(_18f7,_18f8){
var _18f9=_18f7.getRAPReportInfo();
if(!_18f9){
return null;
}
var _18fa=_18f9.getContainers();
for(var _18fb in _18fa){
var _18fc=_18f9.getItemInfo(_18fb);
if(_18fc[_18f8]){
return _18fc[_18f8];
}
}
return null;
};
DrillAction.prototype.isSelectionFilterEnabled=function(){
var _18fd=this.getViewerWidget();
if(!_18fd){
return false;
}
return _18fd.isSelectionFilterEnabled();
};
DrillAction.prototype.getHierarchyHasExpandedSet=function(_18fe,_18ff){
var _1900=this.getItemInfo(_18fe,_18ff);
return (_1900&&_1900.hierarchyHasExpandedMembers);
};
DrillAction.prototype.getIsRSDrillParent=function(_1901,_1902){
var _1903=this.getItemInfo(_1901,_1902);
return (_1903&&_1903.isRSDrillParent);
};
DrillAction.prototype.setUseReportInfoSelection=function(bFlag){
this.m_bUseReportInfoSelection=bFlag;
};
DrillAction.prototype.useReportInfoSelection=function(){
return this.m_bUseReportInfoSelection;
};
DrillAction.prototype.parseDrillSpecObjectsWithReportInfo=function(_1905){
try{
var _1906=this.m_oCV.getRAPReportInfo();
if(!_1906){
return null;
}
this.m_drillSpec="";
this.m_aDrillSelectedObjects=[];
for(var i in _1905){
this.populateSelectObjectWithReportInfo(_1905[i],_1906);
}
}
catch(e){
return false;
}
return (this.m_aDrillSelectedObjects.length>0);
};
DrillAction.prototype.populateSelectObjectWithReportInfo=function(oSpec,_1909){
var _190a=_1909.getItemDetails(oSpec.dataItem,oSpec.hun);
if(!_190a){
_190a=_1909.getItemDetailsByHun(oSpec.hun);
if(!_190a){
return null;
}
}
if(oSpec.mun){
_190a.mun=oSpec.mun;
}
if(oSpec.lun){
_190a.lun=oSpec.lun;
}
if(oSpec.displayValue){
_190a.displayValue=oSpec.displayValue;
}
if(oSpec.isMeasure==="true"){
_190a.isMeasure=true;
}
if(oSpec.summary==="true"){
_190a.onSummary=true;
}
this.m_aDrillSelectedObjects.push(_190a);
};
DrillAction.prototype.getSelectionContext=function(){
if(this.useReportInfoSelection()){
return this.genLeanSelection();
}else{
return CognosViewerAction.prototype.getSelectionContext.call(this);
}
};
DrillAction.prototype.genLeanSelection=function(){
if(this.m_aDrillSelectedObjects.length==0){
return "";
}
var _190b="";
for(var idx in this.m_aDrillSelectedObjects){
var obj=this.m_aDrillSelectedObjects[idx];
_190b+="<selectedCell>";
_190b+=("<name>"+obj.item+"</name>"+"<display>"+obj.displayValue+"</display>"+"<rapLayoutTag>"+obj.lid+"</rapLayoutTag>"+"<queryName>"+obj.queryName+"</queryName>");
if(obj.mun){
_190b+=("<nodeUse>"+obj.mun+"</nodeUse>");
_190b+=("<nodeType>memberUniqueName</nodeType>");
}
if(obj.hun){
_190b+=("<nodeHierarchyUniqueName>"+obj.hun+"</nodeHierarchyUniqueName>");
}
var _190e=(obj.isMeasure)?"measure":"nonMeasure";
_190b+=("<nodeUsage>"+_190e+"</nodeUsage>");
_190b+="</selectedCell>";
}
return ("<selection>"+_190b+"</selection>");
};
DrillAction.prototype.runReport=function(){
if(this.getViewerWidget()){
return this.getViewerWidget().shouldReportBeRunOnAction();
}else{
return true;
}
};
DrillAction.prototype.canBeQueued=function(){
if(this.getViewerWidget()){
return !(this.getViewerWidget().isVisible());
}else{
return false;
}
};
function DrillUpDownAction(){
this.m_sAction="DrillDown";
this.m_drillOption="drillDown";
this.undoTooltip="";
};
DrillUpDownAction.prototype=new DrillAction();
DrillUpDownAction.prototype.getHoverClassName=function(){
return "dl";
};
DrillUpDownAction.prototype.getUndoHint=function(){
return this.undoTooltip;
};
DrillUpDownAction.prototype.keepRAPCache=function(){
return false;
};
DrillUpDownAction.prototype.updateDrillability=function(_190f,_1910){
this.m_oCV=_190f;
var _1911=_1910.getAttribute("ctx");
this.drillability=0;
if(_1911){
var _1912=_1911.split("::");
if(_1912&&_1912.length>0){
if(_1912.length>2){
this.drillability=this.getDrillabilityForIntersection(_1912[1].split(":")[0],_1912[2].split(":")[0]);
}else{
if(_1912.length===2){
this.drillability=this.getDrillabilityForCtxValue(_1912[1].split(":")[0]);
}else{
this.drillability=this.getDrillabilityForCtxValue(_1912[0].split(":")[0]);
}
}
}
}
if(this.isDefaultDrillUp(_1910)){
this.m_sAction="DrillUp";
this.m_drillOption="drillUp";
this.undoTooltip=RV_RES.RV_DRILL_UP;
}else{
this.m_sAction="DrillDown";
this.m_drillOption="drillDown";
this.undoTooltip=RV_RES.RV_DRILL_DOWN;
}
return this.drillability;
};
DrillUpDownAction.prototype.updateDrillabilityFromSelections=function(){
var _1913=this.m_oCV.getSelectionController();
var _1914=_1913.getAllSelectedObjects();
this.drillability=0;
if(_1914!=null&&typeof _1914!="undefined"&&_1914.length==1&&_1914[0].m_contextIds!=null){
if(_1914[0].getLayoutType()=="section"){
this.drillability=0;
}else{
if(_1914[0].m_contextIds.length==0){
this.drillability=0;
}else{
if(typeof DrillContextMenuHelper!=="undefined"&&DrillContextMenuHelper.needsDrillSubMenu(this.m_oCV)){
this.drillability=this.getDrillabilityForAll(_1914[0].m_contextIds);
}else{
if(_1914[0].m_contextIds.length>2){
this.drillability=this.getDrillabilityForIntersection(_1914[0].m_contextIds[1][0],_1914[0].m_contextIds[2][0]);
}else{
this.drillability=this.getDrillabilityForCtxValue(_1914[0].m_contextIds[0][0]);
}
}
}
}
}
return this.drillability;
};
DrillUpDownAction.prototype.getDrillabilityForCtxValue=function(_1915){
var _1916=0;
var _1917=this.m_oCV.getSelectionController();
var _1918=_1917.getRefDataItem(_1915);
if(this.getHierarchyHasExpandedSet(this.m_oCV,_1918)&&this.getIsRSDrillParent(this.m_oCV,_1918)){
_1916=1;
return _1916;
}
if(_1917.getMun(_1915)!==""&&_1917.getUsageInfo(_1915)!=="2"){
_1916=(+_1917.getDrillFlagForMember(_1915));
var _1919=this.getDrillabilityForItemFromReportInfo(_1917.getRefDataItem(_1915));
if(_1919!=null){
if(_1919.disableDown==true||_1919.isolated==true){
if(_1916==1||_1916>=3||_1919.isolated==true){
_1916=1;
}else{
_1916=0;
}
}
if(_1919.disableUp==true){
if(_1916>=2){
_1916=2;
}else{
_1916=0;
}
}
}
}
return _1916;
};
DrillUpDownAction.prototype.getDrillabilityForIntersection=function(_191a,_191b){
var _191c=this.getDrillabilityForCtxValue(_191a);
return this.mergeDrillability(_191c,_191b);
};
DrillUpDownAction.prototype.getDrillabilityForAll=function(_191d){
var _191e=(_191d.length>=2)?1:0;
var _191f;
if(_191d.length==2){
_191f=1;
}else{
if(_191d.length>2){
_191f=2;
}else{
_191f=0;
}
}
var _1920=0;
for(var iDim=_191e;iDim<=_191f;++iDim){
for(var _1922=0;_1922<_191d[iDim].length;++_1922){
_1920=this.mergeDrillability(_1920,_191d[iDim][_1922]);
}
}
return _1920;
};
DrillUpDownAction.prototype.mergeDrillability=function(_1923,_1924){
var _1925=this.getDrillabilityForCtxValue(_1924);
if(_1923==_1925){
return _1923;
}
if(_1923>_1925){
var temp=_1923;
_1923=_1925;
_1925=temp;
}
if(_1923==1&&_1925==2){
return 3;
}
return _1925;
};
DrillUpDownAction.prototype.hasPermission=function(){
if(this.m_oCV){
if(this.m_oCV.isDrillBlackListed()){
return false;
}
var _1927=this.m_oCV.envParams;
if(_1927){
return !(this.m_oCV.isLimitedInteractiveMode()||(_1927["cv.objectPermissions"].indexOf("read")===-1));
}
}
return false;
};
DrillUpDownAction.prototype.canDrillUp=function(){
return ((this.drillability==1||this.drillability==3||this.drillability==4)&&this.hasPermission());
};
DrillUpDownAction.prototype.canDrillDown=function(){
return ((this.drillability==2||this.drillability==3||this.drillability==4)&&this.hasPermission());
};
DrillUpDownAction.prototype.isDefaultDrillUp=function(_1928){
if(this.drillability==1||this.drillability==4||(_1928&&_1928.getAttribute("ischarttitle")==="true")){
return true;
}else{
return false;
}
};
DrillUpDownAction.prototype.doOnMouseOver=function(evt){
if(this.drillability>0&&!this.getCognosViewer().isLimitedInteractiveMode()){
var _192a=getCtxNodeFromEvent(evt);
this.addDrillableClass(_192a);
if(evt.toElement&&evt.toElement.nodeName&&evt.toElement.nodeName.toLowerCase()=="img"){
this.addDrillableClass(evt.toElement);
}
}
};
DrillUpDownAction.prototype.doOnMouseOut=function(evt){
var _192c=getCtxNodeFromEvent(evt);
if(_192c){
this.removeDrillableClass(_192c);
if(evt.toElement&&evt.toElement.nodeName&&evt.toElement.nodeName.toLowerCase()=="img"){
this.removeDrillableClass(evt.toElement);
}
}
};
DrillUpDownAction.prototype.onMouseOver=function(evt){
this.doOnMouseOver(evt);
};
DrillUpDownAction.prototype.onMouseOut=function(evt){
this.doOnMouseOut(evt);
};
DrillUpDownAction.prototype.onDoubleClick=function(evt){
if(this.drillability>0&&this.hasPermission()&&!this.isSelectionFilterEnabled()){
this.execute();
var _1930=getCtxNodeFromEvent(evt);
if(_1930!=null){
this.removeDrillableClass(_1930);
}
}
};
DrillUpDownAction.prototype.addDrillableClass=function(node){
if(!node.className.match(new RegExp("(\\s|^)"+this.getHoverClassName()+"(\\s|$)"))){
node.className+=" "+this.getHoverClassName();
}
};
DrillUpDownAction.prototype.removeDrillableClass=function(node){
var _1933=node.className;
_1933=_1933.replace(new RegExp("(\\s|^)"+this.getHoverClassName()+"(\\s|$)")," ");
node.className=_1933.replace(/^\s*/,"").replace(/\s*$/,"");
};
function DrillUpDownOrThroughAction(){
this.m_hasAuthoredDrillTargets=false;
this.m_canDrillUpDown=false;
};
DrillUpDownOrThroughAction.prototype=new DrillUpDownAction();
DrillUpDownOrThroughAction.prototype.init=function(_1934,_1935){
if(this.getCognosViewer()){
var _1936=this.getCognosViewer().getViewerWidget();
if(_1936&&_1936.isSelectionFilterEnabled()){
return;
}else{
if(this.m_oCV.isDrillBlackListed()){
return;
}
}
}
this.m_hasAuthoredDrillTargets=_1934;
this.m_canDrillUpDown=_1935;
};
DrillUpDownOrThroughAction.prototype.updateDrillabilityInfo=function(_1937,_1938){
if(this.m_canDrillUpDown){
return this.updateDrillability(_1937,_1938);
}
return null;
};
DrillUpDownOrThroughAction.prototype.onMouseOver=function(evt){
if(this.m_hasAuthoredDrillTargets){
var _193a=getCtxNodeFromEvent(evt);
if(_193a){
this.addDrillableClass(_193a);
this._set_chartImage_drillThroughCursor_IE("pointer",evt);
}
}
if(this.m_canDrillUpDown&&!this.isSelectionFilterEnabled()&&!this.m_oCV.isDrillBlackListed()){
this.doOnMouseOver(evt);
}
};
DrillUpDownOrThroughAction.prototype.onMouseOut=function(evt){
if(this.m_hasAuthoredDrillTargets){
var _193c=getCtxNodeFromEvent(evt);
if(_193c){
this.removeDrillableClass(_193c);
this._set_chartImage_drillThroughCursor_IE("default",evt);
}
}
if(this.m_canDrillUpDown&&!this.isSelectionFilterEnabled()&&!this.m_oCV.isDrillBlackListed()){
this.doOnMouseOut(evt);
}
};
DrillUpDownOrThroughAction.prototype._getDrillThroughChartImage_from_chartArea=function(evt){
var _193e=getCrossBrowserNode(evt);
if(_193e){
var _193f=this.m_oCV.getSelectionController();
return _193f.getSelectedChartImageFromChartArea(_193e);
}
};
DrillUpDownOrThroughAction.prototype._set_chartImage_drillThroughCursor_IE=function(_1940,evt){
if(dojo.isIE||dojo.isTrident){
var oImg=this._getDrillThroughChartImage_from_chartArea(evt);
if(oImg){
oImg.style.cursor=_1940;
}
}
};
function DrillDownAction(){
this.m_sAction="DrillDown";
this.m_drillOption="drillDown";
};
DrillDownAction.prototype=new DrillUpDownAction();
DrillDownAction.prototype.getUndoHint=function(){
return RV_RES.RV_DRILL_DOWN;
};
DrillDownAction.prototype.getHoverClassName=function(){
return "dl";
};
DrillDownAction.prototype.updateMenu=function(_1943){
_1943.visible=this.ifContainsInteractiveDataContainer();
if(!_1943.visible){
return _1943;
}
this.updateDrillabilityFromSelections();
if(!this.canDrillDown()){
_1943.disabled=true;
}else{
_1943.disabled=false;
DrillContextMenuHelper.updateDrillMenuItems(_1943,this.m_oCV,this.m_sAction);
}
return _1943;
};
function DrillUpAction(){
this.m_sAction="DrillUp";
this.m_drillOption="drillUp";
};
DrillUpAction.prototype=new DrillUpDownAction();
DrillUpAction.prototype.getHoverClassName=function(){
return "dl";
};
DrillUpAction.prototype.getUndoHint=function(){
return RV_RES.RV_DRILL_UP;
};
DrillUpAction.prototype.updateMenu=function(_1944){
_1944.visible=this.ifContainsInteractiveDataContainer();
if(!_1944.visible){
return _1944;
}
this.updateDrillabilityFromSelections();
if(!this.canDrillUp()){
_1944.disabled=true;
}else{
_1944.disabled=false;
DrillContextMenuHelper.updateDrillMenuItems(_1944,this.m_oCV,this.m_sAction);
}
return _1944;
};
function DeleteAction(){
this.m_sAction="Delete";
};
DeleteAction.prototype=new ModifyReportAction();
DeleteAction.baseclass=ModifyReportAction.prototype;
DeleteAction.prototype.getUndoHint=function(){
return RV_RES.IDS_JS_DELETE;
};
DeleteAction.prototype.canDelete=function(){
if(!this.m_oCV.isLimitedInteractiveMode()){
var _1945=this.m_oCV.getSelectionController().getAllSelectedObjects();
if(_1945.length>0){
for(var i=0;i<_1945.length;++i){
var _1947=_1945[i];
var _1948=_1947.getCellRef();
if(!_1947.hasContextInformation()||_1947.isHomeCell()||(_1947.getLayoutType()!="columnTitle"&&_1947.getDataContainerType()!="list")||_1948.getAttribute("cc")=="true"){
return false;
}
}
return true;
}
}
return false;
};
DeleteAction.prototype.execute=function(){
DeleteAction.baseclass.execute.call(this);
this.m_oCV.getSelectionController().clearSelectionData();
this.m_oCV.getViewerWidget().onContextMenu(null);
};
DeleteAction.prototype.keepRAPCache=function(){
return false;
};
DeleteAction.prototype.updateMenu=function(_1949){
_1949.visible=this.ifContainsInteractiveDataContainer();
if(!_1949.visible){
return _1949;
}
_1949.disabled=!this.canDelete();
return _1949;
};
DeleteAction.prototype.addActionContextAdditionalParms=function(){
return this.getSelectedCellTags();
};
function UndoableClientActionBase(){
};
UndoableClientActionBase.prototype=new CognosViewerAction();
UndoableClientActionBase.prototype.setContainerId=function(_194a){
this.m_sContainerId=_194a;
};
UndoableClientActionBase.prototype.doRedo=function(_194b){
this.setContainerId(_194b);
this.execute();
};
UndoableClientActionBase.prototype.doUndo=function(_194c){
factory=this.getCognosViewer().getActionFactory();
var _194d=factory.load(this.getUndoClass());
_194d.setContainerId(_194c);
_194d.execute();
};
UndoableClientActionBase.prototype.getSelectedContainerId=function(){
var _194e=this.m_oCV.getSelectionController().getAllSelectedObjects();
if(_194e&&_194e.length){
var lid=_194e[0].getLayoutElementId();
if(lid){
return this.removeNamespace(lid);
}
}
return null;
};
function FreezeRowHeadingsAction(){
};
FreezeRowHeadingsAction.prototype=new UndoableClientActionBase();
FreezeRowHeadingsAction.superclass=UndoableClientActionBase.prototype;
FreezeRowHeadingsAction.prototype.execute=function(){
var _1950=this.m_sContainerId?this.m_sContainerId:this.getSelectedCrosstabContainerId();
if(_1950){
this.m_oCV.getSelectionController().resetSelections();
this.m_oCV.getPinFreezeManager().freezeContainerRowHeadings(_1950);
this.addClientSideUndo(this,[_1950]);
}
};
FreezeRowHeadingsAction.prototype.getUndoHint=function(){
return RV_RES.IDS_JS_FREEZEROWHEADINGS;
};
FreezeRowHeadingsAction.prototype.getUndoClass=function(){
return "UnfreezeRowHeadings";
};
FreezeRowHeadingsAction.prototype.getSelectedCrosstabContainerLid=function(){
var _1951=this.m_oCV.getSelectionController().getAllSelectedObjects();
if(_1951&&_1951.length&&_1951[0].getDataContainerType()=="crosstab"){
var lid=(_1951[0].getLayoutElementId());
if(lid){
return lid;
}
}
return null;
};
FreezeRowHeadingsAction.prototype.getSelectedCrosstabContainerId=function(){
var lid=this.getSelectedCrosstabContainerLid();
if(lid){
return this.removeNamespace(lid);
}
return null;
};
FreezeRowHeadingsAction.prototype.canFreezeRowHeadings=function(){
var _1954=this.m_oCV.getPinFreezeManager();
if(_1954){
var _1955=this.getSelectedCrosstabContainerId();
if(_1955){
if(!_1954.hasFrozenRowHeadings(_1955)&&_1954.getValidSelectedContainerId(false)){
return true;
}
}
}
return false;
};
FreezeRowHeadingsAction.prototype.updateMenu=function(_1956){
_1956.visible=this.canFreezeRowHeadings();
return _1956;
};
function UnfreezeRowHeadingsAction(){
};
UnfreezeRowHeadingsAction.prototype=new UndoableClientActionBase();
UnfreezeRowHeadingsAction.superclass=UndoableClientActionBase.prototype;
UnfreezeRowHeadingsAction.prototype.execute=function(){
if(this.m_oCV.getPinFreezeManager()){
var _1957=document.getElementById("CVReport"+this.m_oCV.getId());
var _1958=this.m_sContainerId?this.m_sContainerId:this.getSelectedContainerId();
this.m_oCV.getSelectionController().resetSelections();
this.m_oCV.getPinFreezeManager().unfreezeContainerRowHeadings(_1958,_1957);
this.addClientSideUndo(this,[_1958]);
}
};
UnfreezeRowHeadingsAction.prototype.getUndoHint=function(){
return RV_RES.IDS_JS_UNFREEZEROWHEADINGS;
};
UnfreezeRowHeadingsAction.prototype.getUndoClass=function(){
return "FreezeRowHeadings";
};
UnfreezeRowHeadingsAction.prototype.areRowHeadingsFrozen=function(){
if(this.m_oCV.getPinFreezeManager()&&this.m_oCV.getPinFreezeManager().hasFrozenRowHeadings(this.getSelectedContainerId())){
return true;
}
return false;
};
UnfreezeRowHeadingsAction.prototype.updateMenu=function(_1959){
_1959.visible=this.areRowHeadingsFrozen();
return _1959;
};
function FreezeColumnHeadingsAction(){
};
FreezeColumnHeadingsAction.prototype=new UndoableClientActionBase();
FreezeColumnHeadingsAction.superclass=UndoableClientActionBase.prototype;
FreezeColumnHeadingsAction.prototype.execute=function(){
var _195a=this.m_sContainerId?this.m_sContainerId:this.getSelectedCrosstabOrListContainerId();
if(_195a){
this.m_oCV.getSelectionController().resetSelections();
this.m_oCV.getPinFreezeManager().freezeContainerColumnHeadings(_195a);
this.addClientSideUndo(this,[_195a]);
}
};
FreezeColumnHeadingsAction.prototype.getUndoHint=function(){
return RV_RES.IDS_JS_FREEZECOLUMNHEADINGS;
};
FreezeColumnHeadingsAction.prototype.getUndoClass=function(){
return "UnfreezeColumnHeadings";
};
FreezeColumnHeadingsAction.prototype.getSelectedCrosstabOrListContainerLid=function(){
var _195b=this.m_oCV.getSelectionController().getAllSelectedObjects();
if(_195b&&_195b.length&&(_195b[0].getDataContainerType()=="crosstab"||_195b[0].getDataContainerType()=="list")){
var lid=(_195b[0].getLayoutElementId());
if(lid){
return lid;
}
}
return null;
};
FreezeColumnHeadingsAction.prototype.getSelectedCrosstabOrListContainerId=function(){
var lid=this.getSelectedCrosstabOrListContainerLid();
if(lid){
return this.removeNamespace(lid);
}
return null;
};
FreezeColumnHeadingsAction.prototype.canFreezeColumnHeadings=function(){
var _195e=this.m_oCV.getPinFreezeManager();
if(_195e){
var _195f=this.getSelectedCrosstabOrListContainerId();
if(_195f){
if(!_195e.hasFrozenColumnHeadings(_195f)&&_195e.getValidSelectedContainerId(true)){
return true;
}
}
return false;
}
};
FreezeColumnHeadingsAction.prototype.updateMenu=function(_1960){
_1960.visible=this.canFreezeColumnHeadings();
return _1960;
};
function UnfreezeColumnHeadingsAction(){
};
UnfreezeColumnHeadingsAction.prototype=new UndoableClientActionBase();
UnfreezeColumnHeadingsAction.superclass=UndoableClientActionBase.prototype;
UnfreezeColumnHeadingsAction.prototype.execute=function(){
if(this.m_oCV.getPinFreezeManager()){
var _1961=document.getElementById("CVReport"+this.m_oCV.getId());
var _1962=this.m_sContainerId?this.m_sContainerId:this.getSelectedContainerId();
this.m_oCV.getSelectionController().resetSelections();
this.m_oCV.getPinFreezeManager().unfreezeContainerColumnHeadings(_1962,_1961);
this.addClientSideUndo(this,[_1962]);
}
};
UnfreezeColumnHeadingsAction.prototype.getUndoHint=function(){
return RV_RES.IDS_JS_UNFREEZECOLUMNHEADINGS;
};
UnfreezeColumnHeadingsAction.prototype.getUndoClass=function(){
return "FreezeColumnHeadings";
};
UnfreezeColumnHeadingsAction.prototype.areColumnHeadingsFrozen=function(){
if(this.m_oCV.getPinFreezeManager()&&this.m_oCV.getPinFreezeManager().hasFrozenColumnHeadings(this.getSelectedContainerId())){
return true;
}
return false;
};
UnfreezeColumnHeadingsAction.prototype.updateMenu=function(_1963){
_1963.visible=this.areColumnHeadingsFrozen();
return _1963;
};
function GlossaryAction(){
};
GlossaryAction.prototype=new CognosViewerAction();
GlossaryAction.prototype.execute=function(){
var _1964=this.getCognosViewer();
_1964.loadExtra();
var _1965=_1964.getSelectionController();
var _1966=_1965.getAllSelectedObjects();
if(_1966.length>0){
var _1967=null;
if(typeof MDSRV_CognosConfiguration!="undefined"){
_1967=new MDSRV_CognosConfiguration();
var _1968="";
if(_1964.envParams["glossaryURI"]){
_1968=_1964.envParams["glossaryURI"];
}
_1967.addProperty("glossaryURI",_1968);
_1967.addProperty("gatewayURI",_1964.getGateway());
}
var _1969=_1964.envParams["ui.object"];
var _196a=getViewerSelectionContext(_1965,new CSelectionContext(_1969));
var _196b=new MDSRV_BusinessGlossary(_1967,_196a);
_196b.open();
}
};
GlossaryAction.prototype.updateMenu=function(_196c){
if(!this.getCognosViewer().bCanUseGlossary){
return "";
}
var _196d=this.selectionHasContext();
if(!_196d||this.getCognosViewer().envParams["glossaryURI"]==null||this.getCognosViewer().envParams["glossaryURI"]==""){
_196c.disabled=true;
}else{
_196c.disabled=false;
}
return _196c;
};
function GroupAction(){
this.m_sAction="GroupColumn";
};
GroupAction.prototype=new ModifyReportAction();
GroupAction.prototype.getUndoHint=function(){
return RV_RES.IDS_JS_GROUP_UNGROUP;
};
GroupAction.prototype.updateMenu=function(_196e){
_196e.visible=this.ifContainsInteractiveDataContainer();
if(!_196e.visible){
return _196e;
}
var _196f=this.m_oCV.getSelectionController();
var _1970=_196f.getAllSelectedObjects();
if(_1970.length===0||_196f.getDataContainerType()!="list"){
return this.disableMenuItem(_196e);
}
if(_1970[0].getCellRef().getAttribute("no_data_item_column")==="true"){
return this.disableMenuItem(_196e);
}
var _1971=!_196f.isRelational();
for(var index=0;index<_1970.length;++index){
if(_196f.getUsageInfo(_1970[index].getSelectedContextIds()[0][0])==_196f.c_usageMeasure&&(_1971||_1970[index].getLayoutType()==="summary")){
return this.disableMenuItem(_196e);
}
}
_196e.disabled=false;
_196e.iconClass="group";
return _196e;
};
GroupAction.prototype.disableMenuItem=function(_1973){
_1973.disabled=true;
_1973.iconClass="groupDisabled";
return _1973;
};
GroupAction.prototype.addActionContextAdditionalParms=function(){
return this.addClientContextData(3);
};
function LoadMenuAction(){
this.m_action=null;
};
LoadMenuAction.prototype=new CognosViewerAction();
LoadMenuAction.prototype.FROM_TOOLBAR="toolbar";
LoadMenuAction.prototype.FROM_TOOLBAR_BLUEDOTMENU="toolbarBlueDotMenu";
LoadMenuAction.prototype.FROM_CONTEXTMENU="contextMenu";
LoadMenuAction.prototype.FROM_CONTEXTMENU_MOREACTIONS="contextMenuMoreActions";
LoadMenuAction.prototype.TOOLBAR_UPDATE_EVENT="com.ibm.bux.widgetchrome.toolbar.update";
LoadMenuAction.prototype.CONTEXTMENU_UPDATE_EVENT="com.ibm.bux.widget.contextMenu.update";
LoadMenuAction.prototype.setRequestParms=function(_1974){
this.m_action=_1974.action;
this.m_sFrom=(_1974.from)?_1974.from:this.FROM_TOOLBAR;
};
LoadMenuAction.prototype.execute=function(){
var _1975=this.m_oCV.getActionFactory();
var _1976=_1975.load(this.m_action);
var _1977=this.getMenuSpec();
var _1978=GUtil.generateCallback(this.buildMenuCallback,[_1977],this);
_1977=_1976.buildMenu(_1977,_1978);
if(_1977!=null){
this.buildMenuCallback(_1977);
}
};
LoadMenuAction.prototype.buildMenuCallback=function(_1979){
_1979.open=true;
_1979.action=null;
this.fireEvent(_1979);
};
LoadMenuAction.prototype.getMenuSpec=function(){
var oCV=this.m_oCV;
var sFrom=this.m_sFrom;
if(!sFrom||!oCV){
return null;
}
var _197c=null;
var _197d=null;
switch(sFrom){
case this.FROM_TOOLBAR:
_197c=oCV.getToolbar();
break;
case this.FROM_TOOLBAR_BLUEDOTMENU:
_197c=oCV.findBlueDotMenu();
break;
case this.FROM_CONTEXTMENU_MOREACTIONS:
_197c=oCV.findToolbarItem("MoreActions",oCV.getContextMenu());
break;
}
if(_197c){
_197d=oCV.findToolbarItem(this.m_action,_197c);
}
if(_197d){
_197d.from=sFrom;
}
return _197d;
};
LoadMenuAction.prototype.fireEvent=function(_197e){
var _197f=[];
if(_197e){
_197f.push(_197e);
}
var _1980=this.m_oCV.getViewerWidget();
var sFrom=_197e.from;
switch(sFrom){
case this.FROM_TOOLBAR:
case this.FROM_TOOLBAR_BLUEDOTMENU:
_1980.fireEvent(this.TOOLBAR_UPDATE_EVENT,null,_197f);
break;
case this.FROM_CONTEXTMENU_MOREACTIONS:
_1980.fireEvent(this.CONTEXTMENU_UPDATE_EVENT,null,_197f);
break;
}
};
function MoveAction(){
this.m_sAction="Reorder";
};
MoveAction.prototype=new DragDropAction();
MoveAction.prototype.setRequestParms=function(_1982){
this.m_order=_1982.order;
};
MoveAction.prototype.canMoveLeftRight=function(_1983){
var _1984=this.m_oCV.getSelectionController();
if(_1984&&_1984.getAllSelectedObjects().length==1){
var _1985=_1984.getAllSelectedObjects()[0].getCellRef();
if(_1983=="right"&&_1985.nextSibling){
return true;
}else{
if(_1983=="left"&&_1985.previousSibling){
return true;
}
}
}
return false;
};
MoveAction.prototype.updateMenu=function(_1986){
if(!this.canMove()){
_1986="";
}else{
var _1987=this.m_oCV.getSelectionController();
if(_1987&&_1987.getAllSelectedObjects().length>1){
_1986.disabled=true;
_1986.items=null;
}else{
_1986.disabled=false;
_1986.items=[];
_1986.items.push({disabled:!this.canMoveLeftRight("left"),name:"Move",label:RV_RES.IDS_JS_LEFT,iconClass:"moveLeft",action:{name:"Move",payload:{order:"left"}},items:null});
_1986.items.push({disabled:!this.canMoveLeftRight("right"),name:"Move",label:RV_RES.IDS_JS_RIGHT,iconClass:"moveRight",action:{name:"Move",payload:{order:"right"}},items:null});
}
}
return _1986;
};
MoveAction.prototype.addActionContextAdditionalParms=function(){
var _1988=this.getCognosViewer().getSelectionController();
var _1989=null;
if(this.m_order=="right"){
_1989=_1988.getAllSelectedObjects()[0].getCellRef().nextSibling;
}else{
_1989=_1988.getAllSelectedObjects()[0].getCellRef().previousSibling;
}
var _198a=_1988.buildSelectionObject(_1989,null);
var tag=this.m_order=="right"?"after":"before";
var _198c=this.getRAPLayoutTag(_1989);
_198c=(_198c!=null)?_198c:_198a.getColumnName();
return this.getSelectedCellTags()+"<"+tag+">"+xml_encode(_198c)+"</"+tag+">";
};
function RefreshViewAction(){
this.m_bCanvasRefreshEvent=false;
};
RefreshViewAction.prototype=new CognosViewerAction();
RefreshViewAction.prototype.addCommonOptions=function(_198d){
var _198e=this.getCognosViewer().getViewerWidget();
if(this.m_bCanvasRefreshEvent&&_198e.getSavedOutputSearchPath()!=null){
_198d.addFormField("ui.savedOutputSearchPath",encodeURIComponent(_198e.getSavedOutputSearchPath()));
}else{
_198e.setSavedOutputsCMResponse(null);
_198e.setSavedOutputSearchPath(null);
}
_198d.addFormField("run.outputFormat","HTML");
_198d.addFormField("widget.reloadToolbar","true");
_198e.clearPropertiesDialog();
var _198f=document.getElementById("formWarpRequest"+this.getCognosViewer().getId());
_198d.addFormField("ui.object",_198f["reRunObj"].value);
};
RefreshViewAction.prototype.execute=function(){
var _1990=this.createCognosViewerDispatcherEntry("buxDropReportOnCanvas");
this.addCommonOptions(_1990);
var oCV=this.getCognosViewer();
var _1992=oCV.getViewerWidget();
if(oCV.getCurrentlySelectedTab()&&_1992.getSavedOutput()){
oCV.setKeepTabSelected(oCV.getCurrentlySelectedTab());
}
this.getCognosViewer().dispatchRequest(_1990);
};
RefreshViewAction.prototype.doAddActionContext=function(){
return false;
};
RefreshViewAction.prototype.updateMenu=function(_1993){
_1993.disabled=false;
var oCV=this.getCognosViewer();
if(oCV){
var _1995=oCV.getViewerWidget();
if(_1995&&_1995.getSavedOutputSearchPath()!=null){
_1993.disabled=true;
}
}
return _1993;
};
function RefreshViewEventAction(){
this.m_bCanvasRefreshEvent=true;
};
RefreshViewEventAction.prototype=new RefreshViewAction();
function RenameDataItemAction(){
this.m_sAction="Rename";
this.m_newLabel="";
this.m_prevLabel="";
this.m_containerId="";
this.m_bUndoAdded=false;
};
RenameDataItemAction.prototype=new ModifyReportAction();
RenameDataItemAction.prototype.getUndoHint=function(){
return RV_RES.IDS_JS_RENAME;
};
RenameDataItemAction.prototype.saveSpecForUndo=function(){
return true;
};
RenameDataItemAction.prototype.getContainerId=function(){
return this.m_containerId;
};
RenameDataItemAction.prototype.addActionContextAdditionalParms=function(){
var _1996=this.getSelectedCellTags();
return (_1996+"<prevName>"+xml_encode(this.m_prevLabel)+"</prevName>"+"<toName>"+xml_encode(this.m_newLabel)+"</toName>");
};
RenameDataItemAction.prototype.onMouseOver=function(evt){
var _1998=getCtxNodeFromEvent(evt);
_1998.style.cursor=this.canRename()?"text":"default";
};
RenameDataItemAction.prototype.onMouseOut=function(evt){
var _199a=getCtxNodeFromEvent(evt);
_199a.style.cursor="default";
};
RenameDataItemAction.prototype.onDoubleClick=function(evt){
if(this.canRename()){
var _199c=getCtxNodeFromEvent(evt);
this.insertTextArea(_199c);
}
};
RenameDataItemAction.prototype.canRename=function(){
if(this.m_oCV.isBlacklisted("RenameFromContextMenu")){
return false;
}
var _199d=this.m_oCV.getSelectionController();
var _199e=_199d.getAllSelectedObjects().length;
if(_199e==1&&!this.m_oCV.isLimitedInteractiveMode()){
var _199f=_199d.getAllSelectedObjects()[0];
if(_199f.hasContextInformation()){
var _19a0=_199f.getSelectedContextIds()[0][0];
var _19a1=_199f.getCellRef();
return this.checkRenamableConditions(_199f,_19a1,_19a0,_199d);
}
}
return false;
};
RenameDataItemAction.prototype.checkRenamableConditions=function(_19a2,_19a3,_19a4,_19a5){
if(_19a2.isHomeCell()){
return false;
}
if(_19a2.getLayoutType()=="columnTitle"&&_19a5.selectionsHaveCalculationMetadata()){
if(_19a2.getDataContainerType()=="crosstab"&&!_19a5.areSelectionsMeasureOrCalculation()){
return false;
}
return true;
}
if(_19a2.getLayoutType()=="columnTitle"&&_19a2.getDataContainerType()=="crosstab"){
return false;
}
if(_19a2.getLayoutType()!="columnTitle"){
return false;
}
if(_19a3.getAttribute("cc")=="true"){
return false;
}
if(_19a3.getAttribute("CTNM")!=null&&_19a5.getMun(_19a4)!=""){
return false;
}
return true;
};
RenameDataItemAction.prototype.insertTextArea=function(_19a6){
var label=document.createElement("label");
label.style.height="1px";
label.style.width="1px";
label.style.overflow="hidden";
label.style.position="absolute";
label.style.left="0px";
label.style.top="-500px";
label.setAttribute("for","rename"+this.m_oCV.getId());
label.id="renameLabel"+this.m_oCV.getId();
label.innerHTML=RV_RES.IDS_JS_RENAME_LABEL;
var input=document.createElement("input");
input.id="rename"+this.m_oCV.getId();
input.name="rename"+this.m_oCV.getId();
input.type="text";
input.value=_19a6.childNodes[0].nodeValue;
input.style.backgroundColor="transparent";
input.style.borderWidth="0px";
input.style.padding="0px";
input.style.margin="0px";
input.setAttribute("role","textbox");
input.setAttribute("aria-labelledby","renameLabel"+this.m_oCV.getId());
var width=_19a6.parentNode.scrollWidth-10;
var _19aa=_19a6.parentNode.firstChild;
while(_19aa){
if(_19aa!=_19a6){
width-=_19aa.scrollWidth;
}
_19aa=_19aa.nextSibling;
}
input.style.width=width+"px";
input.ctxNode=_19a6;
input.action=this;
input.originalLabel=_19a6.childNodes[0].nodeValue;
if(isIE()){
input.style.fontFamily=_19a6.currentStyle.fontFamily;
input.style.fontSize=_19a6.currentStyle.fontSize;
input.style.fontStyle=_19a6.currentStyle.fontStyle;
input.style.fontVariant=_19a6.currentStyle.fontVariant;
input.style.fontWeight=_19a6.currentStyle.fontWeight;
input.attachEvent("onblur",this.onBlur);
input.attachEvent("onkeydown",this.onKeyDown);
input.style.overflow="hidden";
}else{
input.style.font="inherit";
input.addEventListener("blur",this.onBlur,false);
input.addEventListener("keydown",this.onKeyDown,false);
input.style.overflow="visible";
}
_19a6.innerHTML="";
_19a6.appendChild(label);
_19a6.appendChild(input);
input.focus();
input.select();
};
RenameDataItemAction.prototype.onMouseDown=function(evt){
if(evt){
try{
var node=evt.originalTarget?evt.originalTarget:evt.srcElement;
if(node&&node.getAttribute("id")==="rename"+this.m_oCV.getId()){
return true;
}
}
catch(ex){
}
}
return false;
};
RenameDataItemAction.prototype.onBlur=function(evt){
var node;
if(isIE()){
node=getNodeFromEvent(evt);
}else{
node=this;
}
var _19af=node.ctxNode;
var _19b0=node.action;
var _19b1=node.value!=""?node.value:node.innerHTML;
_19b0.updateLabel(_19af,_19b1,node.originalLabel);
};
RenameDataItemAction.prototype.onKeyDown=function(evt){
var _19b3="";
var node=getNodeFromEvent(evt);
if(evt.keyCode=="13"){
_19b3=node.value!=""?node.value:node.originalLabel;
}else{
if(evt.keyCode=="27"){
_19b3=node.originalLabel;
}
}
if(_19b3!=""){
var _19b5=node.ctxNode;
var _19b6=node.action;
_19b6.updateLabel(_19b5,_19b3,node.originalLabel);
return stopEventBubble(evt);
}else{
return true;
}
};
RenameDataItemAction.prototype.updateLabel=function(_19b7,_19b8,_19b9){
this.m_newLabel=_19b8;
this.m_prevLabel=_19b9;
_19b7.innerHTML="";
_19b7.appendChild(document.createTextNode(_19b8));
var _19ba=this.m_oCV.getSelectionController();
if(_19ba!=null&&_19b8!=_19b9){
var _19bb=new CSelectionObjectFactory(_19ba);
this.m_containerId=this.removeNamespace(_19bb.getLayoutElementId(_19b7));
var _19bc=_19bb.getSelectionObject(_19b7.parentNode);
_19ba.m_aSelectedObjects[0]=_19bc;
var _19bd=_19bc.getCellRef().getElementsByTagName("span");
var span=null;
if(_19bd){
for(var i=0;i<_19bd.length;i++){
span=_19bd[i];
if(span.getAttribute("ctx")!=null&&span.style.visibility!="hidden"){
span.focus();
break;
}
}
}
this.execute();
}
};
RenameDataItemAction.prototype.buildUrl=function(){
var _19c0="b_action=cognosViewer&ui.action=modifyReport&cv.responseFormat=xml";
var _19c1=this.addActionContext();
_19c0+="&cv.actionContext="+encodeURIComponent(_19c1);
if(window.gViewerLogger){
window.gViewerLogger.log("Action context",_19c1,"xml");
}
_19c0+="&ui.object="+encodeURIComponent(this.m_oCV.envParams["ui.object"]);
if(typeof this.m_oCV.envParams["ui.spec"]!="undefined"){
_19c0+="&ui.spec="+encodeURIComponent(this.m_oCV.envParams["ui.spec"]);
}
if(typeof this.m_oCV.getModelPath()!=""){
_19c0+="&modelPath="+encodeURIComponent(this.m_oCV.getModelPath());
}
return _19c0;
};
RenameDataItemAction.prototype.keepRAPCache=function(){
return false;
};
RenameDataItemAction.prototype.reuseQuery=function(){
return true;
};
function RenameFromContextMenuAction(){
};
RenameFromContextMenuAction.prototype=new RenameDataItemAction();
RenameFromContextMenuAction.prototype.canRename=function(_19c2){
if(!_19c2||_19c2.hasContextInformation()==false){
return false;
}
var _19c3=this.m_oCV.getSelectionController();
var _19c4=_19c2.getSelectedContextIds()[0][0];
var _19c5=_19c2.getCellRef();
return this.checkRenamableConditions(_19c2,_19c5,_19c4,_19c3);
};
RenameFromContextMenuAction.prototype.updateMenu=function(_19c6){
_19c6.visible=this.ifContainsInteractiveDataContainer();
if(!_19c6.visible){
return _19c6;
}
var _19c7=this.m_oCV.getSelectionController();
var _19c8=_19c7.getAllSelectedObjects().length;
if(_19c8!=1){
for(var _19c9=0;_19c9<_19c8;_19c9++){
if(!this.canRename(_19c7.getAllSelectedObjects()[_19c9])){
return "";
}
}
_19c6.disabled=true;
}else{
if(!this.canRename(_19c7.getAllSelectedObjects()[0])){
_19c6="";
}else{
_19c6.disabled=false;
}
}
return _19c6;
};
RenameFromContextMenuAction.prototype.getSpanFromCellRef=function(_19ca){
var _19cb=_19ca.getElementsByTagName("span");
var span=null;
if(_19cb){
for(var i=0;i<_19cb.length;i++){
span=_19cb[i];
if(span.getAttribute("ctx")!=null&&span.style.visibility!="hidden"){
break;
}
}
}
return span;
};
RenameFromContextMenuAction.prototype.execute=function(){
var _19ce=this.m_oCV.getSelectionController().getAllSelectedObjects()[0].getCellRef();
if(_19ce){
var span=this.getSpanFromCellRef(_19ce);
var _19d0=this.m_oCV.getAction("RenameDataItem");
_19d0.insertTextArea(span);
}
};
function ResetToOriginalAction(){
};
ResetToOriginalAction.prototype=new CognosViewerAction();
ResetToOriginalAction.prototype.updateMenu=function(_19d1){
var _19d2=this.getCognosViewer().envParams.baseReportAvailable;
_19d1.disabled=(_19d2==="false")?true:_19d1.disabled;
return _19d1;
};
ResetToOriginalAction.prototype.execute=function(){
var _19d3=viewer.dialogs.ConfirmationDialog(RV_RES.IDS_JS_RESET_TO_ORIGINAL,RV_RES.IDS_JS_RESET_TO_ORIGINAL_WARNING,RV_RES.IDS_JS_RESET_TO_ORIGINAL_WARNING_DESC,null,this,this.executeAction);
_19d3.startup();
_19d3.show();
};
ResetToOriginalAction.prototype.executeAction=function(_19d4){
this.gatherFilterInfoBeforeAction("ResetToOriginal");
ChangePaletteAction.reset(this.getCognosViewer());
};
ResetToOriginalAction.prototype.dispatchRequest=function(_19d5){
var _19d6=this.getCognosViewer();
var _19d7=_19d6.getViewerWidget();
_19d7.reset();
var _19d8=_19d7.getAttributeValue("originalReport");
if(!_19d8){
var _19d9=_19d7.getSavedItem();
if(_19d7.isSavedReport(_19d8,_19d9)){
_19d8=_19d9;
}
}
var _19da=_19d7.getAttributeValue("originalReportPart");
var _19db=_19d6.envParams["cv.objectPermissions"];
var _19dc=_19d6.envParams["bpmRestURI"];
var _19dd=_19d6.envParams["glossaryURI"];
var _19de=_19d6.envParams["metadataInformationURI"];
var _19df=_19d6.envParams["ui.routingServerGroup"];
delete _19d6.envParams;
_19d6.envParams={};
_19d6.envParams["ui.object"]=_19d8;
_19d6.envParams["originalReport"]=_19d8;
_19d6.envParams["bux"]="true";
_19d6.envParams["cv.objectPermissions"]=_19db;
_19d6.envParams["ui.routingServerGroup"]=_19df;
if(_19dc){
_19d6.envParams["bpmRestURI"]=_19dc;
}
if(_19dd){
_19d6.envParams["glossaryURI"]=_19dd;
}
if(_19de){
_19d6.envParams["metadataInformationURI"]=_19de;
}
var _19e0=this.createCognosViewerDispatcherEntry("resetToOriginal");
_19e0.addFormField("run.outputFormat","HTML");
_19e0.addFormField("widget.reloadToolbar","true");
_19e0.addFormField("ui.reportDrop","true");
_19d6.resetbHasPromptFlag();
_19e0.addFormField("widget.forceGetParameters","true");
if(_19d5!=""){
_19e0.addFormField("cv.updateDataFilters",_19d5);
}
_19e0.addFormField("run.prompt","false");
var _19e1=(_19da&&_19da.length>0);
if(_19e1){
_19e0.addFormField("reportpart_id",_19da);
}
_19d6.hideReportInfo();
_19d6.dispatchRequest(_19e0);
this.fireModifiedReportEvent();
};
ResetToOriginalAction.prototype.doAddActionContext=function(){
return false;
};
ResetToOriginalAction.prototype.canShowMenuInGlobalArea=function(){
return true;
};
ResetToOriginalAction.prototype.isValidMenuItem=function(){
var _19e2=this.getCognosViewer();
var _19e3=_19e2.getViewerWidget();
if(_19e3.m_isInGlobalArea){
return (this.isPromptWidget()?true:false);
}else{
return (this.isPromptWidget()?false:true);
}
};
function ResizeChartAction(){
this.m_width=0;
this.m_height=0;
this.m_sAction="ChangeDataContainerSize";
this.m_bRunReport=true;
this.m_oChart=null;
};
ResizeChartAction.prototype=new ModifyReportAction();
ResizeChartAction.prototype.isUndoable=function(){
return false;
};
ResizeChartAction.superclass=ModifyReportAction.prototype;
ResizeChartAction.prototype.runReport=function(){
return this.m_bRunReport;
};
ResizeChartAction.prototype.canBeQueued=function(){
return true;
};
ResizeChartAction.prototype.reuseQuery=function(){
return true;
};
ResizeChartAction.PADDING={getWidth:function(){
return 2;
},getHeight:function(){
return 2;
}};
ResizeChartAction.prototype.getActionKey=function(){
return "ResizeChartAction";
};
ResizeChartAction.prototype.setRequestParms=function(_19e4){
if(_19e4&&_19e4.resize){
this.m_width=parseInt(_19e4.resize.w,10)-ResizeChartAction.PADDING.getWidth();
this.m_height=parseInt(_19e4.resize.h,10)-ResizeChartAction.PADDING.getHeight();
}
};
ResizeChartAction.prototype.execute=function(){
if(this.m_oCV.m_readyToRespondToResizeEvent!==true){
return;
}
if(this.m_oCV.getPinFreezeManager()){
this.m_oCV.getPinFreezeManager().resize(this.m_width,this.m_height);
}
if(this.isActionApplicable()){
var _19e5=this.getLayoutComponents();
if(_19e5&&_19e5.length>0){
for(var i=0;i<_19e5.length;++i){
if(_19e5[i].nodeName==="IMG"||_19e5[0].getAttribute("flashChart")!==null){
this.m_oChart=_19e5[i];
break;
}
}
if(this.m_oChart&&this.isNewSizeDifferent()){
if(_19e5[0].getAttribute("flashChart")!==null){
this.m_bRunReport=false;
this.resizeFlashChart();
}else{
this.m_bRunReport=true;
this.resizeChart();
}
}
}
}
};
ResizeChartAction.prototype.isActionApplicable=function(){
var _19e7=this.m_oCV.getRAPReportInfo();
if(_19e7&&_19e7.isSingleContainer()){
return true;
}
return false;
};
ResizeChartAction.prototype.resizeFlashChart=function(){
var size=this.getNewChartSize();
this.m_oChart.setAttribute("width",size.w+"px");
this.m_oChart.setAttribute("height",size.h+"px");
this.resizeChart();
};
ResizeChartAction.prototype.resizeChart=function(){
ResizeChartAction.superclass.execute.call(this);
};
ResizeChartAction.prototype.addActionContextAdditionalParms=function(){
var _19e9="";
var size=this.getNewChartSize();
_19e9+="<height>"+size.h+"px</height>";
_19e9+="<width>"+size.w+"px</width>";
return _19e9;
};
ResizeChartAction.prototype.isNewSizeDifferent=function(){
var _19eb=(this.m_oChart.getAttribute("flashChart")!==null);
var _19ec=_19eb?this.m_oChart.getAttribute("width"):this.m_oChart.style.width;
var _19ed=_19eb?this.m_oChart.getAttribute("height"):this.m_oChart.style.height;
if(!_19ec||_19ec==""){
_19ec=this.m_oChart.width;
_19ed=this.m_oChart.height;
}
return parseInt(_19ec,10)!=this.m_width||parseInt(_19ed,10)!=this.m_height;
};
ResizeChartAction.prototype.getNewChartSize=function(){
var _19ee=this.m_oChart;
var _19ef=0;
var _19f0=0;
var _19f1=0;
var _19f2=0;
var _19f3=0;
var _19f4=0;
var _19f5=0;
var _19f6=0;
var _19f7=0;
var _19f8=0;
var _19f9=0;
var _19fa=0;
require(["dojo/dom-style"],function(_19fb){
_19ef=_19fb.get(_19ee,"marginLeft");
_19f0=_19fb.get(_19ee,"marginRight");
_19f1=_19fb.get(_19ee,"marginTop");
_19f2=_19fb.get(_19ee,"marginBottom");
_19f3=_19fb.get(_19ee,"borderLeftWidth");
_19f4=_19fb.get(_19ee,"borderRightWidth");
_19f5=_19fb.get(_19ee,"borderTopWidth");
_19f6=_19fb.get(_19ee,"borderBottomWidth");
_19f7=_19fb.get(_19ee,"paddingLeft");
_19f8=_19fb.get(_19ee,"paddingRight");
_19f9=_19fb.get(_19ee,"paddingTop");
_19fa=_19fb.get(_19ee,"paddingBottom");
});
this.m_width-=_19f3+_19f4+_19ef+_19f0+_19f7+_19f8;
this.m_height-=_19f5+_19f6+_19f1+_19f2+_19f9+_19fa;
if(this.m_keepRatio){
var ratio=parseInt(this.m_oChart.style.width,10)/parseInt(this.m_oChart.style.height,10);
var _19fd=ratio*this.m_height;
if(_19fd>this.m_width){
this.m_height=this.m_width/ratio;
}
var _19fe=this.m_width/ratio;
if(_19fe>this.m_height){
this.m_width=this.m_height*ratio;
}
}
return {w:this.m_width,h:this.m_height};
};
function RetryRequestAction(){
this.m_lastActionParams=null;
};
RetryRequestAction.prototype=new CognosViewerAction();
RetryRequestAction.prototype.setRequestParms=function(parms){
this.m_lastActionParams=parms;
};
RetryRequestAction.prototype.execute=function(){
if(this.m_lastActionParams){
var _1a00=new ViewerDispatcherEntry(this.m_oCV);
var _1a01=this.m_lastActionParams.keys();
for(var index=0;index<_1a01.length;index++){
_1a00.addFormField(_1a01[index],this.m_lastActionParams.get(_1a01[index]));
}
_1a00.addFormField("cv.responseFormat","data");
_1a00.addFormField("widget.reloadToolbar","true");
_1a00.addNonEmptyStringFormField("limitedInteractiveMode",this.m_oCV.envParams["limitedInteractiveMode"]);
this.m_oCV.dispatchRequest(_1a00);
this.m_oCV.getViewerWidget().setOriginalFormFields(null);
}
};
function RunReportAction(){
this.m_reuseQuery=false;
this.m_promptValues=null;
this.m_sendParameterValues=false;
this.m_clearCascadeParamsList=null;
};
RunReportAction.prototype=new CognosViewerAction();
RunReportAction.prototype.setRequestParams=function(_1a03){
if(!_1a03){
return;
}
this.m_promptValues=_1a03.promptValues;
this.m_clearCascadeParamsList=_1a03.clearCascadeParamsList;
};
RunReportAction.prototype.setSendParameterValues=function(_1a04){
this.m_sendParameterValues=_1a04;
};
RunReportAction.prototype.reuseQuery=function(){
return this.m_reuseQuery;
};
RunReportAction.prototype.setReuseQuery=function(value){
this.m_reuseQuery=value;
};
RunReportAction.prototype.getPromptOption=function(){
return "false";
};
RunReportAction.prototype.canBeQueued=function(){
return false;
};
RunReportAction.prototype.getAction=function(_1a06){
return _1a06?"run":"runSpecification";
};
RunReportAction.prototype.addAdditionalOptions=function(_1a07){
this._addCommonOptions(_1a07);
this._addRunOptionsFromProperties(_1a07);
this._addClearCascadeParams(_1a07);
this._addPromptValuesToRequest(_1a07);
};
RunReportAction.prototype._addClearCascadeParams=function(oReq){
if(!this.m_clearCascadeParamsList||this.m_clearCascadeParamsList.length==0){
return;
}
var _1a09=this.m_clearCascadeParamsList.length;
for(var i=0;i<_1a09;i++){
oReq.addFormField("c"+this.m_clearCascadeParamsList[i],"1");
}
};
RunReportAction.prototype._addPromptValuesToRequest=function(_1a0b){
if(!this.m_promptValues){
return;
}
_1a0b.addFormField("sharedPromptRequest","true");
for(var _1a0c in this.m_promptValues){
_1a0b.addFormField(_1a0c,this.m_promptValues[_1a0c]);
}
};
RunReportAction.prototype._addCommonOptions=function(oReq){
var _1a0e=this.getCognosViewer().isLimitedInteractiveMode();
if(typeof this.m_action==="undefined"){
this.m_action=this.getAction(_1a0e);
}
oReq.addFormField("run.prompt",this.getPromptOption());
oReq.addFormField("ui.action",this.m_action);
if(_1a0e){
oReq.addFormField("run.xslURL","bux.xsl");
}
oReq.addFormField("run.outputFormat","HTML");
if(this.reuseQuery()===true){
oReq.addFormField("reuseResults","true");
}
};
RunReportAction.prototype._addRunOptionsFromProperties=function(oReq){
var _1a10=this.getCognosViewer().getViewerWidget().getProperties();
if(_1a10.getRowsPerPage()!=null){
oReq.addFormField("run.verticalElements",_1a10.getRowsPerPage());
}
};
RunReportAction.prototype.execute=function(){
var oReq=this.createCognosViewerDispatcherEntry(this.m_action);
oReq.setCanBeQueued(this.canBeQueued());
if((this.m_action==="forward"||this.m_action==="back")&&(typeof this.m_bAbortAction==="undefined"||this.m_bAbortAction===true)){
return false;
}
var oCV=this.getCognosViewer();
if(this.m_sendParameterValues&&oCV.envParams["delayedLoadingExecutionParams"]){
oReq.addFormField("delayedLoadingExecutionParams",oCV.envParams["delayedLoadingExecutionParams"]);
delete oCV.envParams["delayedLoadingExecutionParams"];
}
this.getCognosViewer().dispatchRequest(oReq);
return true;
};
RunReportAction.prototype.doAddActionContext=function(){
return false;
};
RunReportAction.prototype.updateMenu=function(json){
json.visible=!this.isPromptWidget();
return json;
};
function BuxRunReportAction(){
BuxRunReportAction.baseConstructor.call();
};
BuxRunReportAction.prototype=new RunReportAction();
BuxRunReportAction.baseConstructor=RunReportAction;
BuxRunReportAction.prototype.canBeQueued=function(){
return true;
};
BuxRunReportAction.prototype.getAction=function(_1a14){
return _1a14?"runBux":"buxRunSpec";
};
function RefreshAction(){
this.m_sAction="Refresh";
};
RefreshAction.prototype=new RunReportAction();
RefreshAction.superclass=RunReportAction.prototype;
RefreshAction.prototype.execute=function(){
RefreshAction.superclass.execute.call(this);
};
function GetParametersAction(){
this.m_payload="";
this.isPrimaryPromptWidget=false;
this.m_requestParamsCopy=null;
};
GetParametersAction.prototype=new RunReportAction();
GetParametersAction.prototype.setRequestParms=function(_1a15){
this.m_payload=_1a15;
};
GetParametersAction.prototype.addRequestOptions=function(_1a16){
_1a16.addFormField("asynch.alwaysIncludePrimaryRequest","false");
_1a16.addFormField("ui.action","getParameters");
_1a16.addFormField("ui.spec",this.m_oCV.envParams["ui.spec"]);
_1a16.addFormField("ui.object",this.m_oCV.envParams["ui.object"]);
_1a16.addFormField("isPrimaryPromptWidget",this.isPrimaryPromptWidget?"true":"false");
_1a16.addFormField("parameterValues",this.m_oCV.getExecutionParameters());
if(this.m_oCV.envParams["bux"]=="true"){
_1a16.addFormField("bux","true");
}
};
GetParametersAction.prototype.execute=function(){
var oCV=this.getCognosViewer();
var _1a18=new AsynchJSONDispatcherEntry(oCV);
_1a18.setCallbacks({"complete":{"object":this,"method":this.handleGetParametersResponse}});
this.addRequestOptions(_1a18);
if(oCV.getActiveRequest()){
this.m_requestFormFieldsCopy=oCV.getActiveRequest().getFormFields();
}
_1a18.sendRequest();
};
GetParametersAction.prototype.handleGetParametersResponse=function(_1a19){
try{
var _1a1a=_1a19.getResult();
var _1a1b=_1a1a.xml;
var _1a1c=this.getCognosViewer();
var _1a1d=_1a1c.getViewerWidget();
if(typeof _1a1b!="undefined"&&_1a1b!=null){
var _1a1e=xml_decode(_1a1b);
this.m_oCV.envParams["reportPrompts"]=_1a1e;
if(this.isPrimaryPromptWidget){
this.m_oCV.raisePromptEvent(_1a1e,this.m_requestFormFieldsCopy);
}else{
_1a1d.sharePrompts(this.m_payload);
}
}
if(typeof _1a1d!="undefined"){
_1a1d.promptParametersRetrieved=true;
var _1a1f=_1a1d.getButtonFromSavedToolbarButtons("Reprompt");
if(typeof _1a1f!="undefined"&&_1a1f!=null){
var _1a20=_1a1c.findBlueDotMenu();
if(_1a1c.addedButtonToToolbar(_1a20,_1a1f.button,"Refresh",_1a1f.position)){
_1a1c.resetbHasPromptFlag();
_1a1d.updateToolbar();
}
_1a1d.removeFromSavedToolbarButtons("Reprompt");
}
}
}
catch(e){
}
};
function RepromptAction(){
this.m_repromptAction=null;
};
RepromptAction.prototype=new CognosViewerAction();
RepromptAction.superclass=CognosViewerAction.prototype;
RepromptAction.prototype.updateMenu=function(_1a21){
var oCV=this.getCognosViewer();
_1a21.visible=(!this.isPromptWidget()&&oCV.hasPrompt());
if(!_1a21.visible){
_1a21.save=true;
}else{
delete _1a21.save;
}
return _1a21;
};
RepromptAction.prototype.setRequestParms=function(_1a23){
RepromptAction.superclass.setRequestParms(_1a23);
if(_1a23&&_1a23["preferencesChanged"]){
this["preferencesChanged"]=_1a23["preferencesChanged"];
}
};
RepromptAction.prototype.execute=function(){
var oCV=this.getCognosViewer();
if(oCV.isLimitedInteractiveMode()){
this.m_repromptAction=new RepromptRunAction();
}else{
this.m_repromptAction=new RepromptRAPAction();
}
this.m_repromptAction.setCognosViewer(oCV);
if(this["preferencesChanged"]){
this.m_repromptAction.reuseConversation(false);
}
this.m_repromptAction.execute();
};
function RepromptRAPAction(){
this.m_sAction="Reprompt";
};
RepromptRAPAction.prototype=new ModifyReportAction();
RepromptRAPAction.prototype.getPromptOption=function(){
return "true";
};
RepromptRAPAction.prototype.isUndoable=function(){
return false;
};
RepromptRAPAction.prototype.reuseQuery=function(){
return false;
};
RepromptRAPAction.prototype.reuseGetParameter=function(){
return false;
};
RepromptRAPAction.prototype.keepFocusOnWidget=function(){
return false;
};
RepromptRAPAction.prototype.preProcess=function(){
var cv=this.getCognosViewer();
cv.m_raiseSharePromptEvent=true;
};
RepromptRAPAction.prototype.addAdditionalOptions=function(_1a26){
_1a26.addFormField("run.outputFormat","HTML");
_1a26.addFormField("bux","true");
};
function RepromptRunAction(){
};
RepromptRunAction.prototype=new RunReportAction();
RepromptRunAction.prototype.reuseQuery=function(){
return false;
};
RepromptRunAction.prototype.reuseGetParameter=function(){
return false;
};
RepromptRunAction.prototype.preProcess=function(){
var cv=this.getCognosViewer();
cv.m_raiseSharePromptEvent=true;
};
RepromptRunAction.prototype.getPromptOption=function(){
return "true";
};
function SelectionAction(){
};
SelectionAction.prototype=new CognosViewerAction();
SelectionAction.prototype.onMouseOver=function(evt){
if(DragDropAction_isDragging(evt)==false){
var _1a29=this.getCognosViewer().getSelectionController();
_1a29.pageHover(evt);
}
};
SelectionAction.prototype.onMouseOut=function(evt){
if(DragDropAction_isDragging(evt)==false){
var _1a2b=this.getCognosViewer().getSelectionController();
_1a2b.pageHover(evt);
}
};
SelectionAction.prototype.hasPermission=function(){
var oCV=this.getCognosViewer();
return !(oCV.isLimitedInteractiveMode()||oCV.envParams["cv.objectPermissions"].indexOf("read")===-1);
};
SelectionAction.prototype.executeDrillUpDown=function(evt){
var oCV=this.getCognosViewer();
var _1a2f=oCV.getViewerWidget();
if(oCV.isDrillBlackListed()||(_1a2f&&_1a2f.isSelectionFilterEnabled())){
return false;
}
if(evt.button==0||evt.button==1||evt.keyCode=="13"){
var _1a30=getCtxNodeFromEvent(evt);
if(_1a30!=null){
var _1a31=this.m_oCV.getSelectionController();
var _1a32=_1a30.getAttribute("type")!=null?_1a30:_1a30.parentNode;
var type=_1a32.getAttribute("type");
var _1a34=_1a30.getAttribute("ctx");
_1a34=_1a34.split("::")[0].split(":")[0];
if((_1a32.getAttribute("CTNM")!=null||type=="datavalue")&&_1a31.getMun(_1a34)!=""){
var _1a35=_1a31.getAllSelectedObjects();
for(var index=0;index<_1a35.length;++index){
var _1a37=_1a35[index];
if(_1a37.getCellRef()==_1a30.parentNode){
if(_1a35.length>1){
_1a31.clearSelectedObjects();
_1a31.addSelectionObject(_1a37);
}
var _1a38=this.m_oCV.getActionFactory();
var _1a39=_1a38.load("DrillUpDown");
_1a39.updateDrillability(this.m_oCV,_1a30);
if(_1a39.drillability>0&&this.hasPermission()){
_1a39.execute();
return true;
}
}
}
}
}
}
return false;
};
SelectionAction.prototype.executeDrillThrough=function(evt){
var _1a3b=this.getCognosViewer().getViewerWidget();
if(_1a3b&&_1a3b.isSelectionFilterEnabled()){
return;
}
var _1a3c=this.getCognosViewer().getDrillMgr();
return _1a3c.getDrillThroughParameters("execute",evt);
};
SelectionAction.prototype.pageClicked=function(evt){
var _1a3e=false;
var _1a3f=evt.which?evt.which==1:evt.button==1;
var _1a40=new CognosViewerSort(evt,this.m_oCV);
var _1a41,_1a42=getCrossBrowserNode(evt);
try{
_1a41=(_1a42&&_1a42.className)||"";
}
catch(ex){
_1a41="";
}
var oCV=this.getCognosViewer();
var _1a44=null;
if(_1a3f&&_1a40.isSort(evt)&&!oCV.isLimitedInteractiveMode()&&!oCV.isBlacklisted("Sort")){
_1a40.execute();
}else{
if(_1a3f&&_1a41.indexOf("expandButton")>-1){
var nNode=_1a42;
if(_1a41.indexOf("expandButtonCaption")>-1){
nNode=nNode.parentNode;
_1a41=nNode.className;
}
_1a44=getCognosViewerSCObjectRef(this.m_oCV.getId());
_1a44.selectSingleDomNode(nNode.parentNode);
var _1a46;
if(_1a41.indexOf("collapse")===-1){
_1a46=new ExpandMemberAction();
}else{
_1a46=new CollapseMemberAction();
}
_1a46.setCognosViewer(oCV);
_1a46.execute();
}else{
_1a44=this.m_oCV.getSelectionController();
if(this.executeDrillUpDown(evt)===false){
var _1a47=this.m_oCV.getViewerWidget();
if(_1a47.isSelectionFilterEnabled()){
if(_1a3f||evt.keyCode===13){
_1a47.preprocessPageClicked(false,evt);
}else{
_1a47.preprocessPageClicked(true);
}
}
if(_1a44.pageClicked(evt)!=false){
this.m_oCV.getViewerWidget().updateToolbar();
_1a44.resetAllowHorizontalDataValueSelection();
}
setNodeFocus(evt);
}
if(_1a3f||evt.keyCode===13){
_1a3e=this.executeDrillThrough(evt);
}
if(_1a3f&&this.m_oCV.getViewerWidget()&&this.m_oCV.getViewerWidget().onSelectionChange){
this.m_oCV.getViewerWidget().onSelectionChange();
}
}
}
return _1a3e;
};
SelectionAction.prototype.mouseActionInvolvesSelection=function(evt){
var _1a49=evt.which?evt.which==1:evt.button==1;
var _1a4a=new CognosViewerSort(evt,this.m_oCV);
if(_1a49&&_1a4a.isSort(evt)){
return false;
}
if(this.executeDrillUpDown(evt)!==false){
return false;
}
return true;
};
SelectionAction.prototype.onMouseDown=function(evt){
this.delegateClickToMouseUp=false;
if(this.mouseActionInvolvesSelection(evt)&&!this.m_oCV.getSelectionController().shouldExecutePageClickedOnMouseDown(evt)){
this.delegateClickToMouseUp=true;
return false;
}
return this.pageClicked(evt);
};
SelectionAction.prototype.onMouseUp=function(evt,_1a4d){
var ret=false;
if(!_1a4d&&this.mouseActionInvolvesSelection(evt)&&this.delegateClickToMouseUp){
ret=this.pageClicked(evt);
}
this.delegateClickToMouseUp=false;
return ret;
};
SelectionAction.prototype.onKeyDown=function(evt){
this.pageClicked(evt);
};
SelectionAction.prototype.onDoubleClick=function(evt){
var _1a51=this.m_oCV;
var _1a52=_1a51.getViewerWidget();
if(_1a51.isDrillBlackListed()||(_1a52&&_1a52.isSelectionFilterEnabled())){
return;
}
if(_1a51.getStatus()=="complete"){
var _1a53=_1a51.getDrillMgr();
var _1a54="DrillDown";
var _1a55="DrillDown";
var _1a56=false;
var _1a57=false;
if(_1a53!=null){
if(!this.hasPermission()){
return true;
}
var _1a58=_1a53.getSelectedObject();
if(_1a58==null||(_1a58.m_dataContainerType=="list"&&_1a58.m_sLayoutType=="columnTitle")){
return true;
}
var _1a59=_1a58.getDrillOptions();
if(typeof _1a59=="undefined"||_1a59==null||!_1a59.length){
return true;
}
_1a56=_1a53.canDrillDown();
if(!_1a56){
_1a57=_1a53.canDrillUp();
if(_1a57){
_1a54="DrillUp";
_1a55="DrillUp";
}
}
if(_1a56||_1a57){
_1a51.executeAction(_1a54,_1a55);
}
}else{
return true;
}
}
};
function SelectionFilterSwitchAction(){
this.m_sAction="SelectionFilterSwitch";
};
SelectionFilterSwitchAction.prototype=new CognosViewerAction();
SelectionFilterSwitchAction.prototype.updateMenu=function(_1a5a){
if(this.getCognosViewer().getViewerWidget().isSelectionFilterEnabled()){
_1a5a.disabled=false;
_1a5a.checked=true;
_1a5a.iconClass="selectionFilterEnabled";
_1a5a.label=RV_RES.IDS_JS_SELECTION_FILTER_SWITCH_DISABLE;
}else{
_1a5a.disabled=false;
_1a5a.checked=false;
_1a5a.iconClass="selectionFilter";
_1a5a.label=RV_RES.IDS_JS_SELECTION_FILTER_SWITCH;
}
return _1a5a;
};
SelectionFilterSwitchAction.prototype.execute=function(){
var oCV=this.getCognosViewer();
var _1a5c=oCV.getViewerWidget();
var _1a5d=_1a5c.isSelectionFilterEnabled();
if(_1a5d){
if(_1a5c.selectionFilterSent()){
_1a5c.clearSelectionFilter();
}
}
_1a5c.toggleSelectionFilterSwitch();
_1a5c.updateToolbar();
_1a5c.onContextMenu({});
if(!_1a5d){
if(_1a5c.somethingSelected()){
_1a5c.broadcastSelectionFilter();
}
}
_1a5c.updateDrillThroughLinks();
_1a5c.fireEvent("com.ibm.bux.widget.modified",null,{"modified":true});
};
function SharePromptAction(){
this.m_bAbortAction=true;
};
SharePromptAction.prototype=new RunReportAction();
SharePromptAction.prototype.preProcess=function(){
var cv=this.getCognosViewer();
cv.disableRaiseSharePromptEvent();
};
SharePromptAction.prototype.setRequestParms=function(_1a5f){
this.m_sharePromptParameters=_1a5f.parameters;
this.m_action="forward";
};
SharePromptAction.prototype.parsePromptParameters=function(){
var _1a60=false;
var _1a61=this.getReportParameterNodes();
if(_1a61){
var _1a62=this.m_sharePromptParameters;
var _1a63={};
var _1a64=[];
for(var i in _1a62){
var _1a66=_1a62[i].parmName;
var _1a67=_1a62[i].modelItem;
var sName=null;
var _1a69=null;
var _1a6a=false;
var _1a6b={};
for(var j in _1a61){
var _1a6d=_1a61[j].getAttribute("parameterName");
var _1a6e=_1a61[j].getAttribute("modelItem");
if((typeof _1a6d!=="undefined"&&_1a6d===_1a66)||(typeof _1a6e!=="undefined"&&_1a67!=="undefined"&&_1a67!==""&&_1a6e===_1a67&&!this.arrayContains(_1a64,_1a6e))){
_1a60=true;
sName="p_"+_1a6d;
_1a69=this.getSharedPromptValue(_1a62[i],_1a61[j]);
if(_1a6d===_1a66){
_1a63[sName]=_1a69;
_1a64.push(_1a6e);
_1a6a=false;
break;
}else{
_1a6b[sName]=_1a69;
_1a6a=true;
}
}
}
if(_1a6a){
for(var x in _1a6b){
_1a63[x]=_1a6b[x];
}
}
}
if(_1a60){
this.m_bAbortAction=false;
this.m_promptValues=_1a63;
}
}
return _1a60;
};
SharePromptAction.prototype.getSharedPromptValue=function(_1a70,_1a71){
var _1a72=null;
var _1a73=_1a70.parmValue;
var _1a74=this._isPromptParamMultiValued(_1a70.multivalued,_1a73);
var _1a75=new RegExp(/^<selectChoices><selectOption/);
if(_1a74&&_1a71.getAttribute("multivalued")==null&&_1a73.match(_1a75)){
var _1a76=new RegExp(/^(<selectChoices><selectOption.*?><)/);
var _1a77=_1a76.exec(_1a73);
_1a72=_1a77[1]+"/selectChoices>";
}else{
_1a72=_1a73;
}
return _1a72;
};
SharePromptAction.prototype.arrayContains=function(array,value){
var found=false;
for(var i=0;i<array.length;i++){
if(array[i]===value){
found=true;
break;
}
}
return found;
};
SharePromptAction.prototype.getPromptValues=function(){
if(!this.m_promptValues){
this.parsePromptParameters();
}
return this.m_promptValues;
};
SharePromptAction.prototype._isPromptParamMultiValued=function(_1a7c,_1a7d){
var _1a7e=false;
if(_1a7c!="undefined"&&_1a7c){
_1a7e=true;
}else{
var _1a7f=new RegExp(/^<selectChoices><selectOption.*?>\s*<selectOption/);
if(_1a7d.match(_1a7f)){
_1a7e=true;
}
}
return _1a7e;
};
SharePromptAction.prototype.getReportParameterNodes=function(){
var cv=this.getCognosViewer();
var _1a81=null;
try{
if(cv.envParams&&cv.envParams.reportPrompts){
var _1a82=cv.envParams.reportPrompts;
var _1a83=XMLBuilderLoadXMLFromString(_1a82);
if(!(_1a83&&_1a83.childNodes&&_1a83.childNodes.length>0&&_1a83.childNodes[0].nodeName==="parsererror")){
var _1a84=_1a83.firstChild;
var _1a85=XMLHelper_FindChildByTagName(_1a84,"reportParameters",true);
_1a81=XMLHelper_FindChildrenByTagName(_1a85,"reportParameter",false);
}
}
}
catch(e){
}
return _1a81;
};
SharePromptAction.prototype.executePrompt=function(){
if(this.getPromptValues()!==null){
this.execute();
return true;
}
return false;
};
function SnapshotsAction(){
};
SnapshotsAction.prototype=new CognosViewerAction();
SnapshotsAction.prototype.updateMenu=function(_1a86){
var _1a87=this.m_oCV.getViewerWidget();
_1a86.disabled=(_1a87.getAttributeValue("reportCreatedInCW")=="true")||(_1a87.getAttributeValue("fromReportPart")=="true")||(this.m_oCV.envParams["reportpart_id"]&&this.m_oCV.envParams["reportpart_id"].length)>0?true:false;
_1a86.visible=!this.isPromptWidget();
return _1a86;
};
SnapshotsAction.prototype.execute=function(){
var oCV=this.getCognosViewer();
var _1a89=oCV.getViewerWidget();
if(_1a89.getSavedOutputsCMResponse()==null){
this.queryCMForSavedOutputs({"complete":{"object":this,"method":this.handleQueryResponse}});
}else{
if(typeof _1a89.savedOutputMenuUpdated!="undefined"&&_1a89.savedOutputMenuUpdated==false){
this.populateMenu(true);
_1a89.savedOutputMenuUpdated=true;
}
}
};
SnapshotsAction.prototype.queryCMForSavedOutputs=function(_1a8a){
var oCV=this.getCognosViewer();
var _1a8c=oCV.getViewerWidget();
var _1a8d="";
var _1a8e=document.getElementById("formWarpRequest"+oCV.getId());
if(oCV.envParams["originalReport"]){
_1a8d=oCV.envParams["originalReport"];
}else{
if(_1a8e&&_1a8e["reRunObj"]!=null&&_1a8e["reRunObj"].value.length>0){
_1a8d=_1a8e["reRunObj"].value;
}else{
_1a8d=oCV.envParams["ui.object"];
}
}
_1a8d+="/reportVersion/*[@format='HTML' or @format='XHTML']/..";
var _1a8f="<CMRequest>"+"<searchPath>"+xml_encode(_1a8d)+"</searchPath>"+"<properties>"+"<property>searchPath</property>"+"<property>creationTime</property>"+"<property>storeID</property>"+"</properties>"+"<sortBy>"+"<sortItem>"+"<property>creationTime</property>"+"<order>descending</order>"+"</sortItem>"+"</sortBy>"+"</CMRequest>";
var _1a90=new DataDispatcherEntry(oCV);
_1a90.addFormField("ui.action","CMRequest");
_1a90.addFormField("cv.responseFormat","CMRequest");
_1a90.addFormField("ui.object",_1a8d);
_1a90.addFormField("CMRequest",_1a8f);
_1a90.setCallbacks(_1a8a);
oCV.dispatchRequest(_1a90);
};
SnapshotsAction.prototype.setSavedOutputsCMResponse=function(_1a91){
var oCV=this.getCognosViewer();
var _1a93=oCV.getViewerWidget();
var _1a94=XMLBuilderLoadXMLFromString(_1a91.getResult());
_1a93.setSavedOutputsCMResponse(_1a94);
};
SnapshotsAction.prototype.handleQueryResponse=function(_1a95){
this.setSavedOutputsCMResponse(_1a95);
this.populateMenu(true);
};
SnapshotsAction.prototype.canShowLiveMenuItem=function(){
var oCV=this.getCognosViewer();
return (oCV.envParams["cv.responseFormat"]!=="activeReport"&&(oCV.isLimitedInteractiveMode()||(oCV.envParams["cv.objectPermissions"]&&oCV.envParams["cv.objectPermissions"].indexOf("execute")!=-1)));
};
SnapshotsAction.prototype.getMenuItemActionClassHandler=function(){
var oCV=this.getCognosViewer();
return oCV.envParams["cv.responseFormat"]==="activeReport"?"ViewActiveReport":"ViewSavedOutput";
};
SnapshotsAction.prototype.populateMenu=function(bOpen){
var oCV=this.getCognosViewer();
var _1a9a=oCV.getViewerWidget();
var _1a9b=oCV.envParams["ui.action"];
var _1a9c=_1a9a.savedOutputsCMResponse;
var root=oCV.findBlueDotMenu();
root.open=bOpen;
var _1a9e=oCV.findToolbarItem("Snapshots",root);
var _1a9f=XMLHelper_FindChildByTagName(_1a9c,"result",true);
var _1aa0=XMLHelper_FindChildrenByTagName(_1a9f,"item",false);
var _1aa1=[];
var _1aa2=null;
var _1aa3=null;
var _1aa4=null;
var _1aa5;
if(this.canShowLiveMenuItem()){
_1aa5=(_1a9b!="view"&&_1a9b!="buxView"&&oCV.getStatus()!=="fault");
_1aa4={name:"live",label:RV_RES.IDS_JS_SNAPSHOTS_LIVE,action:_1aa5?{}:{name:"RunSavedOutputReport",payload:{}},items:null};
this.addMenuItemChecked(_1aa5,_1aa4);
_1aa1.push(_1aa4);
if(_1aa0.length>0){
_1aa1.push({separator:true});
}
}
if(_1aa0.length>0){
var _1aa6=this.getMenuItemActionClassHandler();
var _1aa7=[];
for(var _1aa8=0;_1aa8<_1aa0.length;_1aa8++){
if(_1aa8<5){
var _1aa9=_1aa0[_1aa8];
var _1aaa=XMLHelper_GetText(XMLHelper_FindChildByTagName(_1aa9,"creationTime_localized",true));
_1aaa=enforceTextDir(_1aaa);
var _1aab=XMLHelper_FindChildByTagName(_1aa9,"storeID",true);
var _1aac=XMLHelper_GetText(XMLHelper_FindChildByTagName(_1aab,"value",true));
var _1aad=XMLHelper_FindChildByTagName(_1aa9,"creationTime",true);
var _1aae=XMLHelper_GetText(XMLHelper_FindChildByTagName(_1aad,"value",true));
if(_1aa2==null){
_1aa2=_1aae;
_1aa3=_1aac;
}
_1aa5=(_1a9b=="view"||_1a9b=="buxView")&&oCV.envParams["creationTime"]==_1aae&&_1a9a.getSavedOutputSearchPath()!=null;
_1aa4={name:"savedOutput",label:_1aaa,action:_1aa5?{}:{name:_1aa6,payload:{obj:_1aac,creationTime:_1aae,mostRecent:false}},items:null};
this.addMenuItemChecked(_1aa5,_1aa4);
_1aa7.push(_1aa4);
}else{
_1aa7.push({name:"viewAllSnapshots",label:RV_RES.IDS_JS_VIEW_ALL_SNAPSHOTS,action:{name:"ViewAllSnapshots",payload:{}},items:null});
break;
}
}
_1aa5=false;
if(_1a9a.getSavedOutputSearchPath()==null&&(_1a9b=="view"||_1a9b=="buxView")){
_1aa5=true;
}
_1aa4={name:"savedOutput",label:RV_RES.IDS_JS_MOST_RECENT_SNAPSHOT,action:_1aa5?{}:{name:_1aa6,payload:{obj:_1aa3,creationTime:_1aa2,mostRecent:true}},items:null};
this.addMenuItemChecked(_1aa5,_1aa4);
_1aa1.push(_1aa4);
_1aa1.push({separator:true});
_1aa1=_1aa1.concat(_1aa7);
}
_1a9e.open=bOpen;
_1a9e.items=_1aa1;
var _1aaf=[];
_1aaf.push(_1a9e);
_1a9a.fireEvent("com.ibm.bux.widgetchrome.toolbar.update",null,_1aaf);
};
SnapshotsAction.prototype.resetMenu=function(bOpen){
var oCV=this.getCognosViewer();
var _1ab2=oCV.getViewerWidget();
var root=oCV.findBlueDotMenu();
var _1ab4=oCV.findToolbarItem("Snapshots",root);
if(_1ab4){
_1ab4.open=false;
var _1ab5=[{name:"loadng",label:RV_RES.GOTO_LOADING,iconClass:"loading"}];
_1ab4.items=_1ab5;
var _1ab6=[_1ab4];
_1ab2.fireEvent("com.ibm.bux.widgetchrome.toolbar.update",null,_1ab6);
}
};
function SwapRowsAndColumnsAction(){
this.m_sAction="SwapRowsAndColumns";
};
SwapRowsAndColumnsAction.prototype=new ModifyReportAction();
SwapRowsAndColumnsAction.prototype.getUndoHint=function(){
return RV_RES.IDS_JS_SWAP_ROWS_AND_COLUMNS;
};
SwapRowsAndColumnsAction.M_oDisplayTypeIsUnsupported={winLossChart:true,progressiveChart:true,list:true};
SwapRowsAndColumnsAction.prototype.canSwap=function(){
if(this.reportHasOneObjectOnly()){
return this.isCurrentObject_singlePart_SupportedChartOrCrosstab();
}else{
return this.isSelectedObject_SupportedChartOrCrosstab();
}
};
SwapRowsAndColumnsAction.prototype.reportHasOneObjectOnly=function(){
var _1ab7=this.m_oCV.getRAPReportInfo();
if(_1ab7){
return (_1ab7.getContainerCount()==1);
}
return false;
};
SwapRowsAndColumnsAction.prototype.isSelectedObject_SupportedChartOrCrosstab=function(){
var _1ab8=this.getSelectedReportInfo();
return (_1ab8&&!SwapRowsAndColumnsAction.M_oDisplayTypeIsUnsupported[_1ab8.displayTypeId]);
};
SwapRowsAndColumnsAction.prototype.isCurrentObject_singlePart_SupportedChartOrCrosstab=function(){
var _1ab9=this.m_oCV.getRAPReportInfo();
if(_1ab9){
if(_1ab9.getContainerCount()===1){
var _1aba=_1ab9.getContainerFromPos(0).displayTypeId;
if(_1aba&&!SwapRowsAndColumnsAction.M_oDisplayTypeIsUnsupported[_1aba]){
return true;
}
}
}
return false;
};
SwapRowsAndColumnsAction.prototype.keepRAPCache=function(){
return false;
};
SwapRowsAndColumnsAction.prototype.updateMenu=function(_1abb){
_1abb.visible=this.ifContainsInteractiveDataContainer();
if(!_1abb.visible){
return _1abb;
}
_1abb.disabled=!this.canSwap();
_1abb.iconClass=_1abb.disabled?"disabledSwap":"swap";
return _1abb;
};
function UndoRedoAction(){
};
UndoRedoAction.prototype=new CognosViewerAction();
UndoRedoAction.prototype.dispatchRequest=function(_1abc,_1abd){
var _1abe=null;
var _1abf=null;
var _1ac0=this.getUndoRedoQueue();
if(_1abd=="Undo"){
_1abf=_1ac0.moveBack();
}else{
_1abf=_1ac0.moveForward();
}
if(_1abd=="Undo"&&_1abf&&_1abf.undoCallback){
_1abf.undoCallback();
this.getCognosViewer().getViewerWidget().updateToolbar();
}else{
if(_1abd=="Redo"&&_1abf&&_1abf.redoCallback){
_1abf.redoCallback();
this.getCognosViewer().getViewerWidget().updateToolbar();
}else{
var _1ac1=this.getCognosViewer().getViewerWidget().getProperties();
if(_1ac1&&_1abf.widgetProperties){
_1ac1.doUndo(_1abf.widgetProperties);
}
var _1abe=new ViewerDispatcherEntry(this.getCognosViewer());
if(typeof _1abf.spec!="undefined"){
_1abe.addFormField("ui.action","undoRedo");
_1abe.addFormField("ui.spec",_1abf.spec);
_1abe.addFormField("executionParameters",_1abf.parameters);
}else{
_1abe.addFormField("ui.action","undoRedo");
_1abe.addFormField("ui.conversation",_1abf.conversation);
}
if(typeof _1abf.hasAVSChart!="undefined"){
_1abe.addFormField("hasAVSChart",_1abf.hasAVSChart);
}
if(_1ac1&&_1ac1.getRowsPerPage()!=null){
_1abe.addFormField("run.verticalElements",_1ac1.getRowsPerPage());
}
if(_1abc!=""){
_1abe.addFormField("cv.updateDataFilters",_1abc);
}
if(typeof _1abf.infoBar=="string"){
_1abe.addFormField("rap.reportInfo",_1abf.infoBar);
}else{
_1abe.addFormField("rap.reportInfo","{}");
}
_1abe.addFormField("run.prompt","false");
_1abe.setCallbacks({"closeErrorDlg":{"object":_1ac0,"method":_1ac0.handleCancel}});
this.getCognosViewer().dispatchRequest(_1abe);
}
}
this.fireModifiedReportEvent();
};
UndoRedoAction.prototype.execute=function(){
this.gatherFilterInfoBeforeAction(this.m_sAction);
};
function UndoAction(){
this.m_sAction="Undo";
};
UndoAction.prototype=new UndoRedoAction();
UndoAction.prototype.updateMenu=function(_1ac2){
_1ac2.visible=this.getCognosViewer().isLimitedInteractiveMode()?true:this.ifContainsInteractiveDataContainer();
if(!_1ac2.visible){
return _1ac2;
}
if(this.getUndoRedoQueue().getPosition()>0){
_1ac2.iconClass="undo";
_1ac2.disabled=false;
}else{
_1ac2.iconClass="undoDisabled";
_1ac2.disabled=true;
}
_1ac2.label=this.getUndoRedoQueue().getUndoTooltip();
return _1ac2;
};
function RedoAction(){
this.m_sAction="Redo";
};
RedoAction.prototype=new UndoRedoAction();
RedoAction.prototype.updateMenu=function(_1ac3){
_1ac3.visible=this.getCognosViewer().isLimitedInteractiveMode()?true:this.ifContainsInteractiveDataContainer();
if(!_1ac3.visible){
return _1ac3;
}
if(this.getUndoRedoQueue().getPosition()<(this.getUndoRedoQueue().getLength()-1)){
_1ac3.iconClass="redo";
_1ac3.disabled=false;
}else{
_1ac3.iconClass="redoDisabled";
_1ac3.disabled=true;
}
_1ac3.label=this.getUndoRedoQueue().getRedoTooltip();
return _1ac3;
};
function ViewAllSnapshotsAction(){
};
ViewAllSnapshotsAction.prototype=new SnapshotsAction();
ViewAllSnapshotsAction.prototype.updateMenu=function(_1ac4){
var oCV=this.getCognosViewer();
var _1ac6=oCV.getViewerWidget();
if(_1ac6.m_bNoSavedOutputs==true){
_1ac4.disabled=true;
}
return _1ac4;
};
ViewAllSnapshotsAction.prototype.execute=function(){
if(!this.getCognosViewer().getViewerWidget().getSavedOutputsCMResponse()){
this.queryCMForSavedOutputs({"complete":{"object":this,"method":this.handleQueryResponse}});
}else{
this.showDialog();
}
};
ViewAllSnapshotsAction.prototype.handleQueryResponse=function(_1ac7){
this.setSavedOutputsCMResponse(_1ac7);
this.showDialog();
};
ViewAllSnapshotsAction.prototype.showDialog=function(){
var oCV=this.getCognosViewer();
var _1ac9=oCV.getViewerWidget();
var _1aca=_1ac9.getSavedOutputsCMResponse();
var _1acb=null;
var _1acc=null;
if(_1aca){
_1acb=XMLHelper_FindChildByTagName(_1aca,"result",true);
if(_1acb){
_1acc=XMLHelper_FindChildrenByTagName(_1acb,"item",false);
}
}
if(!_1aca||!_1acc||_1acc.length==0){
_1ac9.m_bNoSavedOutputs=true;
var _1acd=new WarningMessageDialog(oCV,RV_RES.IDS_JS_NO_SAVED_OUTPUTS);
_1acd.renderInlineDialog();
}else{
var _1ace=getCognosViewerObjectString(this.m_oCV.getId());
var _1acf=RV_RES.IDS_JS_SELECT_SNAPSHOT_DIALOG_TITLE;
var _1ad0=RV_RES.IDS_JS_SELECT_SNAPSHOT_DIALOG_DESC;
var _1ad1=this.getCognosViewer().envParams["creationTime"];
this.selectSnapshotDialog=new viewer.dialogs.SelectSnapshot({sTitle:_1acf,sLabel:_1ad0,cmResponse:_1aca,currentSnapshotCreationTime:_1ad1,okHandler:function(_1ad2,_1ad3){
window[_1ace].executeAction("ViewSavedOutput",{obj:_1ad2,creationTime:_1ad3});
},cancelHandler:function(){
}});
this.selectSnapshotDialog.startup();
this.selectSnapshotDialog.show();
}
};
function ViewOriginalLabelAction(){
};
ViewOriginalLabelAction.prototype=new CognosViewerAction();
ViewOriginalLabelAction.prototype.getCellRef=function(){
return this.m_oCV.getSelectionController().getSelections()[0].getCellRef();
};
ViewOriginalLabelAction.prototype.updateMenu=function(_1ad4){
if(this.getNumberOfSelections()==1){
var _1ad5=this.getCellRef();
if(_1ad5.getAttribute("rp_name")){
var _1ad6=[];
_1ad6.push({name:"originalLabel",label:_1ad5.getAttribute("rp_name"),iconClass:"",action:null,items:null});
_1ad4.items=_1ad6;
return _1ad4;
}
}
return "";
};
function ViewSavedOutputAction(){
this.m_obj="";
this.creationTime="";
this.m_mostRecent=false;
};
ViewSavedOutputAction.prototype=new CognosViewerAction();
ViewSavedOutputAction.prototype.addAdditionalRequestParms=function(_1ad7){
};
ViewSavedOutputAction.prototype.setRequestParms=function(_1ad8){
this.m_obj=_1ad8.obj;
this.creationTime=_1ad8.creationTime;
this.m_mostRecent=_1ad8.mostRecent;
};
ViewSavedOutputAction.prototype.updateMenu=function(){
var _1ad9=this.getCognosViewer().getAction("Snapshots");
_1ad9.populateMenu(false);
};
ViewSavedOutputAction.prototype.execute=function(){
var _1ada=this.getCognosViewer();
var _1adb=_1ada.getViewerWidget();
if(_1ada.getStatus()==="fault"){
_1adb.clearErrorDlg();
}
_1ada.getViewerWidget().setPromptParametersRetrieved(false);
_1ada.envParams["reportPrompts"]="";
var _1adc=_1ada.envParams["ui.action"];
var _1add=document.getElementById("formWarpRequest"+_1ada.getId());
if(_1adc=="view"&&_1add&&_1add.reRunObj&&_1add.reRunObj.value){
_1ada.envParams["ui.reRunObj"]=_1add["reRunObj"].value;
}else{
if(_1adc!="view"){
_1ada.envParams["ui.reRunObj"]=_1ada.envParams["ui.object"];
}
}
var _1ade="storeID('"+this.m_obj+"')";
_1ada.envParams["ui.action"]="buxView";
_1ada.envParams["ui.object"]=_1ada.envParams["ui.reRunObj"];
_1ada.envParams["creationTime"]=this.creationTime;
if(this.m_mostRecent===true){
_1adb.setSavedOutputSearchPath(null);
}else{
_1adb.setSavedOutputSearchPath(_1ade);
}
this.updateMenu();
this.getUndoRedoQueue().clearQueue();
_1ada.getViewerWidget().clearPropertiesDialog();
if(_1ada.getCurrentlySelectedTab()&&_1adb.getSavedOutput()){
_1ada.setKeepTabSelected(_1ada.getCurrentlySelectedTab());
}
this.dispatchRequest(_1ade);
this.fireModifiedReportEvent();
};
ViewSavedOutputAction.prototype.dispatchRequest=function(_1adf){
this.m_request=new ViewerDispatcherEntry(this.m_oCV);
this.m_request.addFormField("ui.action","buxView");
this.m_request.addFormField("ui.name",this.m_oCV.envParams["ui.name"]);
this.m_request.addFormField("widget.reloadToolbar","true");
this.m_request.addFormField("cv.objectPermissions",this.m_oCV.envParams["cv.objectPermissions"]);
this.m_request.addFormField("ui.savedOutputSearchPath",_1adf);
this.m_request.setCallbacks({"complete":{"object":this,"method":this.onComplete}});
this.addAdditionalRequestParms(this.m_request);
this.m_oCV.dispatchRequest(this.m_request);
};
ViewSavedOutputAction.prototype.onComplete=function(_1ae0,arg1){
this.m_oCV.setTracking("");
this.m_oCV.setConversation("");
this.m_request.onComplete(_1ae0,arg1);
};
function WatchNewVersionsAction(){
this.m_requestParms={subAction:""};
};
WatchNewVersionsAction.prototype=new CognosViewerAction();
WatchNewVersionsAction.prototype.setRequestParms=function(_1ae2){
this.m_requestParms=_1ae2;
};
WatchNewVersionsAction.prototype.execute=function(){
var _1ae3=this.m_oCV.getSubscriptionManager();
switch(this.m_requestParms.subAction){
case "loadMenu":
this.loadMenu(this.m_requestParms.contextMenu);
break;
case "close":
this.closeMenu();
break;
case "DeleteNotification":
_1ae3.DeleteNotification();
break;
case "AddNotification":
_1ae3.AddNotification();
break;
case "NewSubscription":
_1ae3.NewSubscription();
break;
case "ModifySubscription":
_1ae3.ModifySubscription(this.m_requestParms.subscriptionId);
break;
case "DeleteSubscription":
_1ae3.DeleteSubscription(this.m_requestParms.subscriptionId);
break;
}
};
WatchNewVersionsAction.prototype.closeMenu=function(){
var _1ae4=this.m_oCV.findToolbarItem("WatchNewVersions");
this.resetMenu(_1ae4);
var _1ae5=getCognosViewerObjectRefAsString(this.m_oCV.getId());
setTimeout(_1ae5+".getViewerWidget().fireEvent(\"com.ibm.bux.widgetchrome.toolbar.update\", null, ["+_1ae5+".findToolbarItem(\"WatchNewVersions\")]);",1);
};
WatchNewVersionsAction.prototype.resetMenu=function(_1ae6){
_1ae6.open=false;
_1ae6.action={name:"WatchNewVersions",payload:{subAction:"loadMenu",contextMenu:false}};
_1ae6.closeAction=null;
var _1ae7=[];
_1ae7.push({name:"loadng",label:RV_RES.GOTO_LOADING,iconClass:"loading"});
_1ae6.items=_1ae7;
};
WatchNewVersionsAction.prototype.updateMenu=function(_1ae8){
var items=_1ae8.items;
var _1aea=this.m_oCV.getSubscriptionManager();
if(!items||items.length===0){
_1ae8.visible=_1aea.CanCreateNewWatchRule();
_1ae8.disabled=!(_1aea.IsValidSelectionForNewRule());
}else{
this.resetMenu(_1ae8);
}
return _1ae8;
};
WatchNewVersionsAction.prototype.loadMenu=function(_1aeb){
var _1aec=this.m_oCV.getSubscriptionManager();
var cvId=this.m_oCV.getId();
var oCV=this.m_oCV;
var _1aef=new JSONDispatcherEntry(oCV);
_1aef.addFormField("ui.action","getSubscriptionInfo");
_1aef.addFormField("cv.responseFormat","subscriptionManager");
_1aef.addFormField("contextMenu",_1aeb==true?"true":"false");
_1aec.addCommonFormFields(_1aef,"");
_1aef.setCallbacks({"complete":{"object":this,"method":this.openSubscriptionMenuResponse}});
oCV.dispatchRequest(_1aef);
};
WatchNewVersionsAction.prototype.openSubscriptionMenuResponse=function(_1af0){
var _1af1=this.m_oCV.getSubscriptionManager();
_1af1.Initialize(_1af0);
var _1af2=[];
_1af1.ClearSubscriptionMenu();
var _1af3=false;
if(_1af1.CanGetNotified()){
if(_1af1.m_sQueryNotificationResponse=="on"){
_1af2.push({name:"DeleteNotification",label:RV_RES.RV_DO_NOT_ALERT_NEW_VERSION,iconClass:"deleteNotification",action:{name:"WatchNewVersions",payload:{subAction:"DeleteNotification"}},items:null});
_1af3=true;
}else{
if(_1af1.m_sQueryNotificationResponse=="off"&&_1af1.m_sEmail!=""){
_1af2.push({name:"AddNotification",label:RV_RES.RV_ALERT_NEW_VERSION,iconClass:"addNotification",action:{name:"WatchNewVersions",payload:{subAction:"AddNotification"}},items:null});
_1af3=true;
}
}
}
if(_1af1.CanCreateNewWatchRule()){
if(_1af3){
_1af2.push({separator:true});
}
var _1af4={name:"NewSubscription",label:RV_RES.RV_NEW_WATCH_RULE,iconClass:"newSubscription",action:{name:"WatchNewVersions",payload:{subAction:"NewSubscription"}},items:null};
if(!_1af1.IsValidSelectionForNewRule()){
_1af4.disabled=true;
}
_1af2.push(_1af4);
_1af3=true;
}
var _1af5="";
if(typeof this.m_oCV.UIBlacklist!="undefined"){
_1af5=this.m_oCV.UIBlacklist;
}
if(_1af5.indexOf(" RV_TOOLBAR_BUTTONS_RULES ")==-1){
if(_1af1.m_aWatchRules&&_1af1.m_aWatchRules.length>0){
if(_1af3){
_1af2.push({separator:true});
}
var _1af6=_1af1.CanModifyWatchRule();
for(var sub=0;sub<_1af1.m_aWatchRules.length;++sub){
var menu={name:"WatchRule"+sub,label:_1af1.m_aWatchRules[sub].name,iconClass:"watchRule",action:null,items:[]};
if(_1af6&&_1af5.indexOf(" RV_TOOLBAR_BUTTONS_RULES_MODIFY ")==-1){
menu.items.push({name:"ModifySubscription"+sub,label:RV_RES.RV_MODIFY_WATCH_RULE,iconClass:"modifySubscription",action:{name:"WatchNewVersions",payload:{subAction:"ModifySubscription",subscriptionId:sub}},items:null});
}
if(_1af5.indexOf(" RV_TOOLBAR_BUTTONS_RULES_DELETE ")==-1){
menu.items.push({name:"DeleteSubscription"+sub,label:RV_RES.RV_DELETE_WATCH_RULE,iconClass:"deleteSubscription",action:{name:"WatchNewVersions",payload:{subAction:"DeleteSubscription",subscriptionId:sub}},items:null});
}
_1af2.push(menu);
}
}
}
if(_1af2.length===0){
_1af2.push({name:"NoWatchRules",label:RV_RES.RV_NO_WATCH_RULES,iconClass:"",action:null,items:null,disabled:true});
}
var _1af9=this.m_oCV.findToolbarItem("WatchNewVersions");
if(_1af9){
_1af9.items=_1af2;
_1af9.action=null;
_1af9.open=true;
_1af9.closeAction={name:"WatchNewVersions",payload:{subAction:"close"}};
var _1afa=[];
_1afa.push(_1af9);
this.m_oCV.getViewerWidget().fireEvent("com.ibm.bux.widgetchrome.toolbar.update",null,_1afa);
}
};
function RunSavedOutputReportAction(){
};
RunSavedOutputReportAction.prototype=new CognosViewerAction();
RunSavedOutputReportAction.prototype.updateMenu=function(_1afb){
var _1afc=this.m_oCV.envParams["ui.action"];
var _1afd=(_1afc!="view"&&_1afc!="buxView"&&this.m_oCV.getStatus()!=="fault");
this.addMenuItemChecked(_1afd,_1afb);
return _1afb;
};
RunSavedOutputReportAction.prototype.dispatchRequest=function(_1afe){
var _1aff=this.getCognosViewer();
if(_1aff.envParams["savedReportName"]){
delete _1aff.envParams["savedReportName"];
}
if(_1aff.getStatus()==="fault"){
var _1b00=this.getCognosViewer().getViewerWidget();
_1b00.clearErrorDlg();
}
var _1b01=_1aff.envParams["ui.action"];
var _1b02=document.getElementById("formWarpRequest"+_1aff.getId());
if(_1aff.envParams["ui.reRunObj"]){
_1aff.envParams["ui.object"]=_1aff.envParams["ui.reRunObj"];
}else{
if(_1b01=="view"&&_1b02&&typeof _1b02["reRunObj"]!="undefined"&&_1b02["reRunObj"]!=null&&_1b02["reRunObj"].value.length>0){
_1aff.envParams["ui.object"]=_1b02["reRunObj"].value;
}
}
var oReq=new ViewerDispatcherEntry(_1aff);
oReq.addFormField("ui.action","bux");
oReq.addFormField("widget.runFromSavedOutput","true");
oReq.addFormField("ui.object",_1aff.envParams["ui.object"]);
oReq.addFormField("run.outputFormat","HTML");
oReq.addFormField("ui.primaryAction","");
oReq.addFormField("widget.reloadToolbar","true");
oReq.addDefinedNonNullFormField("cv.objectPermissions",_1aff.envParams["cv.objectPermissions"]);
oReq.addDefinedNonNullFormField("run.prompt",_1aff.envParams["promptOnRerun"]);
oReq.addDefinedNonNullFormField("limitedInteractiveMode",_1aff.envParams["limitedInteractiveMode"]);
oReq.addDefinedNonNullFormField("widget.globalPromptInfo",_1aff.getViewerWidget().getGlobalPromptsInfo());
oReq.addDefinedNonNullFormField("baseReportSearchPath",_1aff.envParams["baseReportSearchPath"]);
oReq.addNonEmptyStringFormField("cv.updateDataFilters",_1afe);
_1aff.getViewerWidget().clearPropertiesDialog();
_1aff.preparePromptValues(oReq);
_1aff.dispatchRequest(oReq);
this.fireModifiedReportEvent();
_1aff.envParams["ui.action"]="run";
};
RunSavedOutputReportAction.prototype.execute=function(){
this.gatherFilterInfoBeforeAction("RunSavedOutputReport");
};
function InvokeChangeDisplayTypeDialogAction(){
};
InvokeChangeDisplayTypeDialogAction.prototype=new CognosViewerAction();
InvokeChangeDisplayTypeDialogAction.prototype.execute=function(){
var _1b04=this.getCognosViewer();
var _1b05=this.getSelectedReportInfo();
if(_1b05){
var _1b06=_1b04.getViewerWidget();
var _1b07=false;
if(_1b05.suggestedDisplayTypesEnabled==true){
_1b07=(typeof _1b05.possibleDisplayTypes=="undefined")||(typeof _1b05.suggestedDisplayTypes=="undefined")?true:false;
}else{
_1b07=(typeof _1b05.possibleDisplayTypes=="undefined");
}
if(_1b07){
var _1b08=new AsynchJSONDispatcherEntry(this.m_oCV);
_1b08.setCallbacks({"complete":{"object":this,"method":this.handleResponse}});
_1b08.setRequestIndicator(_1b04.getRequestIndicator());
_1b08.addFormField("ui.action","getInfoFromReportSpec");
_1b08.addFormField("bux","true");
_1b08.addNonEmptyStringFormField("modelPath",this.m_oCV.getModelPath());
_1b08.addFormField("ui.object",this.m_oCV.envParams["ui.object"]);
_1b08.addDefinedFormField("ui.spec",this.m_oCV.envParams["ui.spec"]);
_1b08.addFormField("cv.actionContext",this.addActionContext());
_1b08.addFormField("ui.conversation",encodeURIComponent(this.m_oCV.getConversation()));
_1b04.dispatchRequest(_1b08);
}else{
_1b06.invokeDisplayTypeDialog(_1b05.possibleDisplayTypes,_1b05.suggestedDisplayTypes);
}
}
};
InvokeChangeDisplayTypeDialogAction.prototype.handleResponse=function(_1b09){
var _1b0a=this.getCognosViewer();
var _1b0b=_1b0a.getViewerWidget();
var _1b0c=_1b09.getResult();
for(var i in _1b0c.containers){
var _1b0e=this.getReportInfo(_1b0c.containers[i].container);
_1b0e.possibleDisplayTypes=_1b0c.containers[i].possibleDisplayTypes;
_1b0e.suggestedDisplayTypes=_1b0c.containers[i].suggestedDisplayTypes;
}
var _1b0f=this.getSelectedReportInfo();
_1b0b.invokeDisplayTypeDialog(_1b0f.possibleDisplayTypes,_1b0f.suggestedDisplayTypes);
};
InvokeChangeDisplayTypeDialogAction.prototype.addActionContext=function(){
var _1b10="<getInfoActions>";
_1b10+="<getInfoAction name=\"GetInfo\">";
_1b10+="<include><possibleDisplayTypes/></include>";
_1b10+="<include><suggestedDisplayTypes/></include>";
_1b10+=this.getDataItemInfoMap();
_1b10+=this.addClientContextData(3);
_1b10+="</getInfoAction>";
_1b10+="</getInfoActions>";
return _1b10;
};
InvokeChangeDisplayTypeDialogAction.prototype.updateMenu=function(_1b11){
var _1b12=this.getCognosViewer().getRAPReportInfo();
_1b11.visible=_1b12.containsInteractiveDataContainer();
if(!_1b11.visible){
return _1b11;
}
var _1b13=this.getSelectedReportInfo();
_1b11.disabled=(_1b13==null||_1b13.displayTypeId==null||!this.isInteractiveDataContainer(_1b13.displayTypeId));
if(_1b11.disabled){
_1b11.iconClass="chartTypesDisabled";
return _1b11;
}
_1b11.iconClass="chartTypes";
return _1b11;
};
function GotoAction(){
};
GotoAction.prototype=new CognosViewerAction();
GotoAction.prototype.execute=function(){
var _1b14=this.m_oCV.getDrillMgr();
_1b14.launchGoToPage();
};
GotoAction.prototype.updateMenu=function(_1b15){
var items=[];
var _1b17=this.m_oCV.getDrillTargets();
var _1b18=this.m_oCV.getDrillMgr();
var _1b19=_1b18.getAuthoredDrillThroughTargets();
if(_1b19.length>0){
var _1b1a="<AuthoredDrillTargets>";
for(var _1b1b=0;_1b1b<_1b19.length;++_1b1b){
_1b1a+=eval("\""+_1b19[_1b1b]+"\"");
}
_1b1a+="</AuthoredDrillTargets>";
var _1b1c=this.m_oCV.getAction("AuthoredDrill");
var _1b1d=_1b1c.getAuthoredDrillThroughContext(_1b1a,_1b17);
var _1b1e=_1b1d.childNodes;
if(_1b1e.length>0){
for(var index=0;index<_1b1e.length;++index){
var _1b20=_1b1e[index];
var _1b21=this.getTargetReportIconClass(_1b20);
var _1b22=_1b20.getAttribute("label");
items.push({name:"AuthoredDrill",label:_1b22,iconClass:_1b21,action:{name:"AuthoredDrill",payload:XMLBuilderSerializeNode(_1b20)},items:null});
}
}
}
if(items.length>0){
items.push({separator:true});
}
var _1b23=false;
if(this.m_oCV.getSelectionController()==null||this.m_oCV.getSelectionController().getModelDrillThroughEnabled()==false){
_1b23=true;
}
items.push({name:"Goto",disabled:_1b23,label:RV_RES.RV_MORE,iconClass:"",action:{name:"Goto",payload:""},items:null});
if(this.m_oCV.isIWidgetMobile()){
_1b15.flatten="true";
}
_1b15.items=items;
return _1b15;
};
GotoAction.prototype.getTargetReportIconClass=function(_1b24){
var _1b25="";
var _1b26=_1b24.getAttribute("method");
switch(_1b26){
case "edit":
_1b25="editContent";
break;
case "execute":
_1b25="runReport";
break;
case "view":
var _1b27=_1b24.getAttribute("outputFormat");
switch(_1b27){
case "HTML":
case "XHTML":
case "HTMLFragment":
_1b25="html";
break;
case "PDF":
_1b25="pdf";
break;
case "XML":
_1b25="xml";
break;
case "CSV":
_1b25="csv";
break;
case "XLS":
_1b25="excel2000";
break;
case "SingleXLS":
_1b25="excelSingleSheet";
break;
case "XLWA":
_1b25="excel2002";
break;
case "spreadsheetML":
_1b25="excel2007";
break;
case "xlsxData":
_1b25="excel2007";
break;
}
break;
}
return _1b25;
};
function AnnotationAction(){
};
AnnotationAction.prototype=new CognosViewerAction();
AnnotationAction.prototype.updateMenu=function(_1b28){
var _1b29=this.m_oCV.getViewerWidget();
var _1b2a=this.m_oCV.aBuxAnnotations;
var _1b2b=[];
for(var _1b2c=0;_1b2c<_1b2a.length;_1b2c++){
var ann=eval("new "+_1b2a[_1b2c]+"()");
ann.setCognosViewer(this.m_oCV);
if(ann&&ann.isEnabled(_1b28.placeType)){
var _1b2e={};
_1b2e.name=_1b2a[_1b2c];
_1b2e.label=ann.getMenuItemString(_1b29.getAttributeValue("itemName"));
_1b2e.action={};
_1b2e.action.name=_1b2a[_1b2c];
_1b2e.action.payload="";
_1b2e.items=null;
_1b2e.iconClass=ann.getMenuItemIconClass();
_1b2b.push(_1b2e);
}
}
_1b28.items=_1b2b;
_1b28.disabled=!(_1b28.items&&_1b28.items.length);
if(_1b28.disabled){
_1b28.iconClass="disabledAnnotation";
}else{
_1b28.iconClass="annotation";
}
return _1b28;
};
AnnotationAction.prototype.execute=function(){
var _1b2f=this.getCognosViewer();
var _1b30=_1b2f.getSelectionController();
var _1b31=_1b30.getSelections();
if(_1b31&&_1b31.length==1){
var _1b32=_1b2f.getViewerWidget();
if(_1b32){
this.executeAction(_1b2f,_1b32,_1b31[0]);
}
}
};
AnnotationAction.prototype.executeAction=function(_1b33,_1b34,_1b35){
};
function DeleteWidgetAnnotationAction(){
};
DeleteWidgetAnnotationAction.prototype=new AnnotationAction();
DeleteWidgetAnnotationAction.prototype.execute=function(){
var _1b36=this.getCognosViewer();
var _1b37=_1b36.getViewerWidget();
if(_1b37){
_1b37.getAnnotationHelper().deleteWidgetComment();
}
};
function EditWidgetAnnotationAction(){
};
EditWidgetAnnotationAction.prototype=new AnnotationAction();
EditWidgetAnnotationAction.prototype.execute=function(){
var _1b38=this.getCognosViewer();
var _1b39=_1b38.getViewerWidget();
if(_1b39){
window.setTimeout(function(){
_1b39.getAnnotationHelper().editWidgetComment();
},0);
}
};
function NewWidgetAnnotationAction(){
};
NewWidgetAnnotationAction.prototype=new AnnotationAction();
NewWidgetAnnotationAction.prototype.execute=function(){
var _1b3a=this.getCognosViewer();
var _1b3b=_1b3a.getViewerWidget();
if(_1b3b){
_1b3b.getAnnotationHelper().addWidgetComment();
}
};
function DeleteAnnotationAction(){
};
DeleteAnnotationAction.prototype=new AnnotationAction();
DeleteAnnotationAction.prototype.executeAction=function(_1b3c,_1b3d,_1b3e){
if(_1b3c&&_1b3d&&_1b3e){
var _1b3f=_1b3e.getCellRef();
var ctxId=_1b3c.findCtx(_1b3f);
_1b3d.getAnnotationHelper().deleteComment(ctxId);
}
};
function EditAnnotationAction(){
};
EditAnnotationAction.prototype=new AnnotationAction();
EditAnnotationAction.prototype.executeAction=function(_1b41,_1b42,_1b43){
if(_1b41&&_1b42&&_1b43){
var _1b44=_1b43.getCellRef();
var ctxId=_1b41.findCtx(_1b44);
window.setTimeout(function(){
_1b42.getAnnotationHelper().editComment(ctxId);
},0);
}
};
function NewAnnotationAction(){
};
NewAnnotationAction.prototype=new AnnotationAction();
NewAnnotationAction.prototype.executeAction=function(_1b46,_1b47,_1b48){
if(_1b46&&_1b47&&_1b48){
var _1b49=_1b48.getCellRef();
var ctxId=_1b46.findCtx(_1b49);
var value=_1b48.getDisplayValues()[0];
window.setTimeout(function(){
_1b47.getAnnotationHelper().addComment(ctxId,value);
},0);
}
};
function ExploreWithAAFAction(){
};
ExploreWithAAFAction.prototype=new CognosViewerAction();
ExploreWithAAFAction.prototype.execute=function(){
window.open(this.m_oCV.getGateway()+this.m_oCV.envParams.aafBaseURL,"_blank");
};
function ViewActiveReportAction(){
};
ViewActiveReportAction.prototype=new ViewSavedOutputAction();
ViewActiveReportAction.prototype.addAdditionalRequestParms=function(_1b4c){
_1b4c.addFormField("cv.responseFormat","CMRequest");
_1b4c.setCallbacks({"complete":{"object":this,"method":this.handleQueryResponse}});
};
ViewActiveReportAction.prototype.handleQueryResponse=function(_1b4d){
var _1b4e=this.m_oCV.getViewerWidget();
_1b4e.showLoading();
var _1b4f=XMLBuilderLoadXMLFromString(_1b4d.getResult());
var _1b50=XMLHelper_FindChildByTagName(_1b4f,"storeID",true);
var _1b51=XMLHelper_GetText(XMLHelper_FindChildByTagName(_1b50,"value",true));
var _1b52=dojo.byId(this.m_oCV.getViewerWidget().getIFrameId());
_1b52.src=this.m_oCV.getGateway()+"/output/cm/"+_1b51+"/";
};
function RefreshActiveReportAction(){
this.m_sAction="RefreshActiveReport";
};
RefreshActiveReportAction.prototype=new CognosViewerAction();
RefreshActiveReportAction.prototype.execute=function(){
var _1b53=this.m_oCV.getViewerWidget();
var _1b54=dojo.byId(_1b53.getIFrameId());
var _1b55=_1b54.src;
_1b54.src=_1b55;
_1b53.showLoading();
};
function ExportAction(){
this.m_format="";
this.m_responseFormat="";
};
ExportAction.prototype=new CognosViewerAction();
ExportAction.prototype.getWindowTitle=function(){
return "";
};
ExportAction.prototype.execute=function(){
if(!this.m_format){
return false;
}
this.initializeForm();
this.insertGenericFormElements();
this.insertSpecializedFormElements();
return this.sendRequest();
};
ExportAction.prototype.addFormField=function(sName,_1b57){
if(console){
console.log("Required method ExportAction.addFormField not implemented");
}
};
ExportAction.prototype.initializeForm=function(){
if(console){
console.log("Required method ExportAction.initializeForm not implemented");
}
};
ExportAction.prototype.sendRequest=function(){
if(console){
console.log("Required method ExportAction.sendRequest not implemented");
}
};
ExportAction.prototype.insertGenericFormElements=function(){
var _1b58="false";
var _1b59="cognosViewer";
this.addFormField("b_action",_1b59);
this.addFormField("cv.toolbar","false");
this.addFormField("cv.header","false");
this.addFormField("ui.windowtitleformat","chromeless_window_action_format");
this.addFormField("ui.name",this.getObjectDisplayName());
this.addFormField("cv.responseFormat",this.m_responseFormat);
this.addFormField("ui.reuseWindow","true");
var _1b5a=this.m_oCV.envParams["ui.spec"];
var _1b5b=this.m_oCV.getConversation();
this.addFormField("ui.action","export");
this.addFormField("ui.conversation",_1b5b);
this.addFormField("run.prompt",_1b58);
this.addFormField("asynch.attachmentEncoding","base64");
this.addFormField("run.outputEncapsulation","URLQueryString");
this.addFormField("ui.spec",_1b5a);
this.addFormField("rap.reportInfo",this.m_oCV.envParams["rapReportInfo"]);
if(this.m_oCV.envParams["ui.routingServerGroup"]){
this.addFormField("ui.routingServerGroup",this.m_oCV.envParams["ui.routingServerGroup"]);
}
var _1b5c=this.m_oCV.getViewerWidget();
if(_1b5c!=null){
dojo.when(_1b5c.getWidgetStoreID(),dojo.hitch(this,function(_1b5d){
if(typeof _1b5d!="undefined"&&_1b5d!=null){
this.addFormField("widgetStoreID",_1b5d);
}
}));
var _1b5e=_1b5c.getAttributeValue("gateway");
if(_1b5e){
this.addFormField("cv.gateway",_1b5e);
}
var _1b5f=_1b5c.getAttributeValue("webcontent");
if(_1b5f){
this.addFormField("cv.webcontent",_1b5f);
}
}
this.addFormField("rap.parametersInfo",CViewerCommon.buildParameterValuesSpec(this.m_oCV));
};
ExportAction.prototype.insertSpecializedFormElements=function(_1b60){
this.addFormField("run.outputFormat",this.m_format);
this.addFormField("ui.windowtitleaction",this.getWindowTitle());
};
ExportAction.prototype.updateMenu=function(json){
json.visible=!this.isPromptWidget();
if(this.m_oCV.isIWidgetMobile()){
json.flatten=true;
}
return json;
};
function ExportFromIframeAction(){
this.m_format="";
this.m_responseFormat="downloadObject";
};
ExportFromIframeAction.prototype=new ExportAction();
ExportFromIframeAction.prototype.initializeForm=function(){
this.oRequest=new HiddenIframeDispatcherEntry(this.getCognosViewer());
this.addFormField("cv.detachRelease","true");
};
ExportFromIframeAction.prototype.addFormField=function(sName,_1b63){
this.oRequest.addFormField(sName,_1b63);
};
ExportFromIframeAction.prototype.sendRequest=function(){
this.getCognosViewer().dispatchRequest(this.oRequest);
return true;
};
function ExportToCSVAction(){
this.m_format="CSV";
};
ExportToCSVAction.prototype=new ExportFromIframeAction();
ExportToCSVAction.prototype.getWindowTitle=function(){
return RV_RES.RV_CSV;
};
function ExportToExcel2000Action(){
this.m_format="XLS";
};
ExportToExcel2000Action.prototype=new ExportFromIframeAction();
ExportToExcel2000Action.prototype.getWindowTitle=function(){
return RV_RES.RV_EXCEL_2000;
};
function ExportToExcel2002Action(){
this.m_format="XLWA";
};
ExportToExcel2002Action.prototype=new ExportFromIframeAction();
ExportToExcel2002Action.prototype.getWindowTitle=function(){
return RV_RES.RV_EXCEL_2002;
};
function ExportToExcel2007Action(){
this.m_format="spreadsheetML";
};
ExportToExcel2007Action.prototype=new ExportFromIframeAction();
ExportToExcel2007Action.prototype.getWindowTitle=function(){
return RV_RES.RV_EXCEL_2007;
};
function ExportToExcel2007DataAction(){
this.m_format="xlsxData";
};
ExportToExcel2007DataAction.prototype=new ExportFromIframeAction();
ExportToExcel2007DataAction.prototype.getWindowTitle=function(){
return RV_RES.RV_EXCEL_2007_DATA;
};
function ExportToExcelSingleSheetAction(){
this.m_format="singleXLS";
};
ExportToExcelSingleSheetAction.prototype=new ExportFromIframeAction();
ExportToExcelSingleSheetAction.prototype.getWindowTitle=function(){
return RV_RES.RV_EXCEL_2000SF;
};
function ExportToPDFAction(){
this.m_format="PDF";
};
ExportToPDFAction.prototype=new ExportFromIframeAction();
ExportToPDFAction.prototype.getWindowTitle=function(){
return RV_RES.RV_PDF;
};
function ExportToXMLAction(){
this.m_format="XML";
};
ExportToXMLAction.prototype=new ExportFromIframeAction();
ExportToXMLAction.prototype.getWindowTitle=function(){
return RV_RES.RV_XML;
};
function PrintAsPDFAction(){
this.m_format="PDF";
this.m_responseFormat="page";
};
PrintAsPDFAction.prototype=new ExportAction();
PrintAsPDFAction.prototype.getWindowTitle=function(){
return RV_RES.IDS_PRINT_AS_PDF;
};
PrintAsPDFAction.prototype.initializeForm=function(){
this.nForm=document.createElement("form");
this.nForm.setAttribute("method","post");
var _1b64=location.protocol+"//"+location.host+this.m_oCV.m_sGateway;
this.nForm.setAttribute("action",_1b64);
};
PrintAsPDFAction.prototype.sendRequest=function(){
var _1b65=this.m_oCV.getId();
var sName="get"+this.m_format+_1b65;
this.nForm.setAttribute("id",sName);
this.nForm.setAttribute("name",sName);
this.nForm.setAttribute("target",this.m_format+"Window"+_1b65);
document.body.appendChild(this.nForm);
var _1b67=this.nForm.getAttribute("target");
window.open("",_1b67,"resizable=yes,menubar=no,directories=no,location=no,status=no,toolbar=no,titlebar=no");
this.nForm.submit();
document.body.removeChild(this.nForm);
this.nForm=null;
return true;
};
PrintAsPDFAction.prototype.addFormField=function(sName,_1b69){
this.nForm.appendChild(createHiddenFormField(sName,_1b69));
};
function ExpandCollapseMemberAction(){
this.m_sAction="ExpandCollapseMember";
this.m_sExpandCollapseType=null;
this.m_RAPReportInfo=null;
this.m_itemInfo=null;
this.m_sPreviousDataItem=null;
};
ExpandCollapseMemberAction.prototype=new ModifyReportAction();
ExpandCollapseMemberAction.baseclass=ModifyReportAction.prototype;
ExpandCollapseMemberAction.prototype._getCanExpand=function(_1b6a){
var _1b6b=this._getItemInfo(_1b6a);
return (_1b6b&&_1b6b.canExpand);
};
ExpandCollapseMemberAction.prototype._isExpanded=function(_1b6c){
var sMUN=this._getSelectedMUN(_1b6c);
if(!sMUN){
return false;
}
var _1b6e=this._getItemInfo(_1b6c);
return (_1b6e&&_1b6e.expandedMembers&&_1b6e.expandedMembers[sMUN]===true);
};
ExpandCollapseMemberAction.prototype._getSelectedMUN=function(_1b6f){
var sMun=null;
var aMuns=_1b6f.getMuns();
if(aMuns&&aMuns.length>0&&aMuns[0].length>0){
sMun=aMuns[0][0];
}
return sMun;
};
ExpandCollapseMemberAction.prototype._getDataItem=function(_1b72){
if(!_1b72){
return null;
}
var _1b73=null;
var _1b74=_1b72.getDataItems();
if(_1b74&&_1b74.length>0&&_1b74[0].length>0){
_1b73=_1b74[0][0];
}
return _1b73;
};
ExpandCollapseMemberAction.prototype._getItemInfo=function(_1b75){
var _1b76=this._getDataItem(_1b75);
if(!_1b76){
return null;
}
var _1b77=this.removeNamespace(_1b75.getLayoutElementId());
this.m_RAPReportInfo=this.m_oCV.getRAPReportInfo();
this.m_itemInfo=this.m_RAPReportInfo.getItemInfo(_1b77,_1b76);
this.m_sPreviousDataItem=_1b76;
return this.m_itemInfo;
};
ExpandCollapseMemberAction.prototype._alwaysCanExpandCollapse=function(_1b78){
var _1b79=this._getItemInfo(_1b78);
return (_1b79&&_1b79.alwaysCanExpandCollapse);
};
ExpandCollapseMemberAction.prototype._canShowMenu=function(_1b7a){
var _1b7b=this._getFirstSelectedObject(_1b7a);
return (_1b7b&&this._hasMUN(_1b7b)&&this._isCrosstab(_1b7b)&&this._isOnEdge(_1b7b)&&!_1b7a.areSelectionsMeasureOrCalculation());
};
ExpandCollapseMemberAction.prototype._getCtxId=function(_1b7c){
var _1b7d=_1b7c.getCellRef();
if(_1b7d&&_1b7d.getAttribute){
var _1b7e=_1b7d.getAttribute("ctx");
if(_1b7e){
_1b7e=_1b7e.split("::")[0].split(":")[0];
return _1b7e;
}
}
return "";
};
ExpandCollapseMemberAction.prototype._hasMUN=function(_1b7f){
var aMuns=_1b7f.getMuns();
return aMuns.length>0?true:false;
};
ExpandCollapseMemberAction.prototype._isCrosstab=function(_1b81){
return _1b81.getDataContainerType()==="crosstab"?true:false;
};
ExpandCollapseMemberAction.prototype._isOnEdge=function(_1b82){
return _1b82.getLayoutType()==="columnTitle"?true:false;
};
ExpandCollapseMemberAction.prototype.keepRAPCache=function(){
return false;
};
ExpandCollapseMemberAction.prototype.updateMenu=function(_1b83){
var _1b84=this.m_oCV.getSelectionController();
_1b83.visible=this._canShowMenu(_1b84);
if(!_1b83.visible){
return _1b83;
}
_1b83.disabled=!this._canEnableMenu(_1b84);
return _1b83;
};
ExpandCollapseMemberAction.prototype._canEnableMenu=function(_1b85){
return true;
};
ExpandCollapseMemberAction.prototype._getFirstSelectedObject=function(_1b86){
var _1b87=_1b86.getAllSelectedObjects();
if(_1b87.length>0){
return _1b87[0];
}
return null;
};
ExpandCollapseMemberAction.prototype._isSingleSelection=function(_1b88){
var _1b89=_1b88.getAllSelectedObjects();
return (_1b89.length===1);
};
ExpandCollapseMemberAction.prototype.addActionContextAdditionalParms=function(){
var _1b8a=this.getCognosViewer().getSelectionController();
var _1b8b=this._getFirstSelectedObject(_1b8a);
var sPUN=_1b8a.getPun(this._getCtxId(_1b8b));
if(sPUN){
sPUN="<PUN>"+sXmlEncode(sPUN)+"</PUN>";
}
var sType="";
if(this.m_sExpandCollapseType){
sType="<ExpandCollapseType>"+this.m_sExpandCollapseType+"</ExpandCollapseType>";
}
return this.getSelectedCellTags()+sPUN+sType;
};
function ExpandMemberAction(){
this.m_sAction="ExpandCollapseMember";
this.m_sExpandCollapseType="ExpandMember";
};
ExpandMemberAction.prototype=new ExpandCollapseMemberAction();
ExpandMemberAction.baseclass=ExpandCollapseMemberAction.prototype;
ExpandMemberAction.prototype.getUndoHint=function(){
return RV_RES.IDS_JS_EXPAND_MEMBER;
};
ExpandMemberAction.prototype._canEnableMenu=function(_1b8e){
if(!this._isSingleSelection(_1b8e)){
return false;
}
var _1b8f=this._getFirstSelectedObject(_1b8e);
if(this._alwaysCanExpandCollapse(_1b8f)){
return true;
}
var ctxId=this._getCtxId(_1b8f);
var _1b91=true;
if(_1b8e.getDrillUpDownEnabled()===true){
_1b91=_1b8e.canDrillDown(ctxId);
}
return (_1b91&&this._getCanExpand(_1b8f)&&!this._isExpanded(_1b8f));
};
function CollapseMemberAction(){
this.m_sAction="ExpandCollapseMember";
this.m_sExpandCollapseType="CollapseMember";
};
CollapseMemberAction.prototype=new ExpandCollapseMemberAction();
CollapseMemberAction.baseclass=ExpandCollapseMemberAction.prototype;
CollapseMemberAction.prototype.getUndoHint=function(){
return RV_RES.IDS_JS_COLLAPSE_MEMBER;
};
CollapseMemberAction.prototype._canDisableMenu=function(_1b92){
if(this._isSingleSelection(_1b92)&&!this._isExpanded()){
return true;
}
return false;
};
CollapseMemberAction.prototype._canEnableMenu=function(_1b93){
var _1b94=this._getFirstSelectedObject(_1b93);
if(this._alwaysCanExpandCollapse(_1b94)){
return true;
}
return (this._isSingleSelection(_1b93)&&this._isExpanded(_1b94));
};
function OpenReportFromClipboardAction(){
this.m_action="bux";
this.m_cv=this.getCognosViewer();
};
OpenReportFromClipboardAction.prototype=new CognosViewerAction();
OpenReportFromClipboardAction.prototype.reuseQuery=function(){
return false;
};
OpenReportFromClipboardAction.prototype.reuseGetParameter=function(){
return false;
};
OpenReportFromClipboardAction.prototype.keepRAPCache=function(){
return false;
};
OpenReportFromClipboardAction.prototype.reuseConversation=function(){
return false;
};
OpenReportFromClipboardAction.prototype.runReport=function(){
return true;
};
OpenReportFromClipboardAction.prototype.isUndoable=function(){
return true;
};
OpenReportFromClipboardAction.prototype.execute=function(){
if(window.clipboardData){
this.openReportForIE();
}else{
this.openReportForNonIE();
}
};
OpenReportFromClipboardAction.prototype.openReportForNonIE=function(){
var _1b95=this;
var _1b96=new viewer.dialogs.ClipboardDialog({sTitle:RV_RES.IDS_JS_CLIPBOARD,okHandler:function(_1b97){
_1b95.executeAction(_1b97);
},cancelHandler:function(){
}});
_1b96.startup();
window.setTimeout(function(){
_1b96.show();
},0);
};
OpenReportFromClipboardAction.prototype.openReportForIE=function(){
var _1b98=window.clipboardData.getData("Text");
this.executeAction(_1b98);
};
OpenReportFromClipboardAction.prototype.getDeleteEnvParamsList=function(){
var _1b99=["modelPath","packageBase","rapReportInfo","rap.state"];
return _1b99;
};
OpenReportFromClipboardAction.prototype.deleteEnvParams=function(){
var _1b9a=this.m_cv.envParams;
var _1b9b=this.getDeleteEnvParamsList();
for(var index in _1b9b){
if(_1b9a[_1b9b[index]]){
delete _1b9a[_1b9b[index]];
}
}
};
OpenReportFromClipboardAction.prototype.cleanUpCognosViewer=function(){
this.m_cv.setExecutionParameters("");
this.m_cv.setConversation("");
this.deleteEnvParams();
};
OpenReportFromClipboardAction.prototype.getRequestParams=function(){
var _1b9d={"run.outputFormat":"HTML","cv.id":this.m_cv.getId(),"widget.reloadToolbar":"true","openReportFromClipboard":"true","ui.reportDrop":"true"};
var _1b9e=this.m_cv.getViewerWidget().getGlobalPromptsInfo();
if(_1b9e!=null){
_1b9d["widget.globalPromptInfo"]=_1b9e;
}
if(this.m_filters!=""){
_1b9d["cv.updateDataFilters"]=this.m_filters;
}
var _1b9f=["cv.objectPermissions","limitedInteractiveMode"];
for(var index in _1b9f){
var _1ba1=_1b9f[index];
var _1ba2=this.m_cv.envParams[_1ba1];
if(_1ba2){
_1b9d[_1ba1]=_1ba2;
}
}
return _1b9d;
};
OpenReportFromClipboardAction.prototype.addAdditionalOptions=function(_1ba3){
var _1ba4=this.getRequestParams();
for(var index in _1ba4){
_1ba3.addFormField(index,_1ba4[index]);
}
};
OpenReportFromClipboardAction.prototype.executeAction=function(_1ba6){
this.m_cv=this.getCognosViewer();
this.m_cv.envParams["ui.spec"]=_1ba6;
this.gatherFilterInfoBeforeAction("OpenReportFromClipboard");
ChangePaletteAction.reset(this.getCognosViewer());
};
OpenReportFromClipboardAction.prototype.dispatchRequest=function(_1ba7){
this.m_cv=this.getCognosViewer();
var _1ba8=this.m_cv.getViewerWidget();
_1ba8.reset();
this.m_filters=_1ba7;
this.cleanUpCognosViewer();
var _1ba9=this.createCognosViewerDispatcherEntry(this.m_action);
this.m_cv.hideReportInfo();
this.m_cv.dispatchRequest(_1ba9);
this.fireModifiedReportEvent();
};
OpenReportFromClipboardAction.prototype.doAddActionContext=function(){
return false;
};
OpenReportFromClipboardAction.prototype.updateMenu=function(json){
json.visible=(window.cognosViewerDebug===true);
return json;
};
function SaveAsReportAction(){
_progressDisplay=null;
};
SaveAsReportAction.prototype=new CognosViewerAction();
SaveAsReportAction.prototype.onSaveCallback=function(){
if(!this._progressDisplay){
dojo["require"]("bux.dialogs.InformationDialog");
this._progressDisplay=new bux.dialogs.Working(BUXMSG.CPN.IDS_CPN_SAVING);
this._progressDisplay.startup();
this._progressDisplay.show();
}
};
SaveAsReportAction.prototype.afterSaveCallback=function(){
if(this._progressDisplay){
this._progressDisplay.destroy();
this._progressDisplay=null;
}
};
SaveAsReportAction.prototype.execute=function(){
this.getCognosViewer().executeAction("RemoveAllDataFilter",{callback:{method:this.doSaveAs,object:this}});
};
SaveAsReportAction.prototype.updateMenu=function(_1bab){
_1bab.visible=this.hasEnvUISpec();
return _1bab;
};
SaveAsReportAction.prototype.hasEnvUISpec=function(){
if(this.m_oCV){
var sSpec=this.m_oCV.envParams["ui.spec"];
return (sSpec&&sSpec.length>0);
}
return false;
};
SaveAsReportAction.prototype.doSaveAs=function(_1bad){
dojo["require"]("bux.dialogs.FileDialog");
dojo["require"]("bux.iwidget.canvas.ReportIOHandler");
this.m_cv=this.getCognosViewer();
var _1bae=_1bad;
var _1baf=this.m_cv.envParams["ui.objectClass"];
var _1bb0=this.onSaveCallback;
var _1bb1=this.afterSaveCallback;
var _1bb2={filter:"content-report",title:RV_RES.IDS_JS_SAVE_AS_FDG_TITLE,sMainActionButtonLabel:RV_RES.IDS_JS_OK,"class":"bux-fileDialog"};
var _1bb3=new bux.iwidget.canvas.ReportIOHandler(_1bae,_1baf,_1bb0,_1bb1,_1bb2);
_1bb3._doSaveAs();
};
function BusinessProcessAction(){
};
BusinessProcessAction.prototype=new CognosViewerAction();
BusinessProcessAction.prototype.updateMenu=function(_1bb4){
var _1bb5=this.getCognosViewer().envParams["bpmRestURI"];
_1bb4.visible=(_1bb5?true:false);
if(_1bb4.visible){
_1bb4.disabled=!this._hasAnyContextInSelectedObjects();
}
return _1bb4;
};
BusinessProcessAction.prototype._initBPMGateway=function(){
var _1bb6=this.getCognosViewer();
this.m_BPMGateway=_1bb6.envParams["bpmRestURI"];
var _1bb7=this.m_BPMGateway.length;
if(this.m_BPMGateway[_1bb7-1]!=="/"){
this.m_BPMGateway+="/";
}
};
BusinessProcessAction.prototype.execute=function(){
this._initBPMGateway();
var _1bb8=this._getBPMProcesses();
};
BusinessProcessAction.prototype._getBPMProcesses=function(){
var _1bb9={complete:{object:this,method:this.handleGetBPMProcessSuccess},fault:{object:this,method:this.handleGetBPMProcessFail}};
var url=this.m_BPMGateway+"exposed/process";
var _1bbb=this._createBPMServerRequest("GET",_1bb9,url);
_1bbb.sendRequest();
};
BusinessProcessAction.prototype._createBPMServerRequest=function(_1bbc,_1bbd,url,_1bbf){
var _1bc0=new XmlHttpObject();
_1bc0.init(_1bbc,this._rewriteURL(url));
_1bc0.setCallbacks(_1bbd);
_1bc0.setHeaders({Accept:"application/json"});
if(_1bbf){
for(var i in _1bbf){
_1bc0.addFormField(_1bbf[i].name,_1bbf[i].value);
}
}
return _1bc0;
};
BusinessProcessAction.prototype._rewriteURL=function(url){
if(bux&&bux.iwidget&&bux.iwidget.canvas&&bux.iwidget.canvas.Helper&&bux.iwidget.canvas.Helper.rewriteUrl){
return bux.iwidget.canvas.Helper.rewriteUrl(url);
}
return url;
};
BusinessProcessAction.prototype.handleGetBPMProcessFail=function(_1bc3){
var _1bc4=RV_RES.IDS_JS_BUSINESS_PROCESS_GET_PROCESSES_FAIL_MSG;
var _1bc5=_1bc3.getResponseText();
this._showErrorMessage(_1bc4,_1bc5);
};
BusinessProcessAction.prototype.handleGetBPMProcessSuccess=function(_1bc6){
var _1bc7=_1bc6.getResponseText();
if(!_1bc7){
return;
}
var _1bc8=dojo.fromJson(_1bc7);
var _1bc9=this._getBusinessProcessesInfo(_1bc8.data.exposedItemsList);
this._showDialog(_1bc9);
};
BusinessProcessAction.prototype._getBusinessProcessesInfo=function(_1bca){
if(!_1bca){
return;
}
var _1bcb=_1bca.length;
var _1bcc=new Array();
var _1bcd={};
for(var i=0;i<_1bcb;i++){
var _1bcf=_1bca[i].display;
var _1bd0=_1bca[i].itemID;
var _1bd1=_1bca[i].processAppID;
if(_1bcf&&!_1bcd[_1bcf]&&_1bd0&&_1bd1){
_1bcd[_1bcf]=true;
_1bcc.push({sCaption:_1bcf,sBPD_ID:_1bd0,sProcessAppID:_1bd1});
}
}
return _1bcc;
};
BusinessProcessAction.prototype._showDialog=function(_1bd2){
var _1bd3=this;
var _1bd4=new viewer.dialogs.SelectBusinessProcess({sTitle:RV_RES.IDS_JS_BUSINESS_PROCESS_SELECT_DIALOG_TITLE,sLabel:RV_RES.IDS_JS_BUSINESS_PROCESS_SELECT_DIALOG_DESC,okHandler:function(){
},cancelHandler:function(){
},BPMProcessesInfo:_1bd2,bpAction:_1bd3});
_1bd4.startup();
_1bd4.show();
};
BusinessProcessAction.prototype.getInputParameter=function(_1bd5){
var obj=null;
var _1bd7=this.getCognosViewer();
var _1bd8=_1bd7.getSelectionController();
var _1bd9=_1bd8.getSelectedObjectsJsonContext();
if(_1bd9){
var value=_1bd9;
if(_1bd5){
value=dojo.toJson(value);
}
obj={"cognosParameter":value};
}
return obj;
};
BusinessProcessAction.prototype.startProcess=function(_1bdb,_1bdc,_1bdd){
var _1bde={customArguments:[_1bdd],complete:{object:this,method:this.handleGetStartProcessSuccessResponse},fault:{object:this,method:this.handleGetStartProcessFailResponse}};
var url=this.m_BPMGateway+"process";
var _1be0=new Array();
_1be0.push({name:"action",value:"start"});
_1be0.push({name:"parts",value:"data"});
if(_1bdb){
_1be0.push({name:"bpdId",value:_1bdb});
}
if(_1bdc){
_1be0.push({name:"processAppId",value:_1bdc});
}
var _1be1=this.getInputParameter(true);
if(_1be1){
_1be0.push({name:"params",value:dojo.toJson(_1be1)});
}
var _1be2=this._createBPMServerRequest("POST",_1bde,url,_1be0);
_1be2.sendRequest();
};
BusinessProcessAction.prototype.handleGetStartProcessSuccessResponse=function(_1be3,_1be4){
var _1be5=_1be3.getResponseText();
if(_1be5){
var _1be6=dojo.fromJson(_1be5);
if(_1be6.status==="200"){
var sMsg=CViewerCommon.getMessage(RV_RES.IDS_JS_BUSINESS_PROCESS_START_PROCESS_SUCCEED_MSG,_1be4);
var _1be8=new ModalInfoMessageDialog({sTitle:RV_RES.IDS_JS_BUSINESS_PROCESS_START_PROCESS_SUCCEED_MSG_TITLE,sMessage:sMsg,sDescription:RV_RES.IDS_JS_BUSINESS_PROCESS_START_PROCESS_SUCCEED_MSG_DETAIL});
_1be8.show();
}
}
};
BusinessProcessAction.prototype.handleGetStartProcessFailResponse=function(_1be9,_1bea){
var _1beb=_1be9.getResponseXml();
if(_1beb&&_1beb.documentElement){
this._handleXMLErrorResponse(_1beb,_1bea);
return;
}
var _1bec=CViewerCommon.getMessage(RV_RES.IDS_JS_BUSINESS_PROCESS_START_PROCESS_FAILED_MSG,_1bea);
var _1bed=_1be9.getResponseText();
try{
var _1bee=dojo.fromJson(_1bed);
_1bed=_1bee.Data.errorMessage;
}
catch(err){
}
this._showErrorMessage(_1bec,_1bed);
};
BusinessProcessAction.prototype._handleXMLErrorResponse=function(_1bef,_1bf0){
var _1bf1=XMLHelper_FindChildrenByTagName(_1bef,"error");
var _1bf2="";
var _1bf3="";
if(_1bf1){
_1bf2=XMLHelper_FindChildrenByTagName(_1bf1,"message").childNodes[0].nodeValue;
_1bf3=XMLHelper_FindChildrenByTagName(_1bf1,"detail").childNodes[0].nodeValue;
}else{
_1bf2=CViewerCommon.getMessage(RV_RES.IDS_JS_BUSINESS_PROCESS_START_PROCESS_FAILED_MSG,_1bf0);
}
this._showErrorMessage(_1bf2,_1bf3);
};
BusinessProcessAction.prototype._showErrorMessage=function(_1bf4,_1bf5){
var _1bf6=new ModalFaultMessageDialog(_1bf4,_1bf5);
_1bf6.show();
};
BusinessProcessAction.prototype._hasAnyContextInSelectedObjects=function(){
var _1bf7=false;
var _1bf8=this.m_oCV.getSelectionController();
var _1bf9=_1bf8.getAllSelectedObjects();
for(var i=0;i<_1bf9.length;i++){
var _1bfb=_1bf9[i].getSelectedContextIds();
if(_1bfb&&_1bfb.length>0){
_1bf7=true;
break;
}
}
return _1bf7;
};
function DrillResetAction(){
this.m_sAction="DrillDown";
this.m_sharePromptValues=null;
this.m_aDrilledResetHUNs=null;
this.m_updateInfoBar=true;
};
DrillResetAction.prototype=new ModifyReportAction();
DrillResetAction.prototype.setRequestParms=function(_1bfc){
this.m_aDrilledResetHUNs=_1bfc.drilledResetHUNs;
this.m_sharePromptValues=_1bfc.promptValues;
};
DrillResetAction.prototype.addAdditionalOptions=function(oReq){
if(!this.m_oCV){
return;
}
if(!this.m_sharePromptValues){
this.m_oCV.preparePromptValues(oReq);
oReq.getRequestHandler().setForceRaiseSharePrompt(true);
}else{
if(!this.m_sharePromptValues){
return;
}
for(var _1bfe in this.m_sharePromptValues){
oReq.addFormField(_1bfe,this.m_sharePromptValues[_1bfe]);
}
}
};
DrillResetAction.prototype.addActionContextAdditionalParms=function(){
var _1bff="<HUNS>";
for(var i=0;i<this.m_aDrilledResetHUNs.length;i++){
_1bff+="<HUN>"+xml_encode(this.m_aDrilledResetHUNs[i])+"</HUN>";
}
_1bff+="</HUNS>";
_1bff+="<action>resetDimension</action>";
return _1bff;
};
DrillResetAction.prototype.setUpdateInfoBar=function(_1c01){
this.m_updateInfoBar=_1c01;
};
DrillResetAction.prototype.updateInfoBar=function(){
this.m_updateInfoBar;
};
function RemoveAllDataFilterAction(){
this.m_sAction="UpdateDataFilter";
};
RemoveAllDataFilterAction.prototype.setCognosViewer=function(oCV){
this.m_oCV=oCV;
};
RemoveAllDataFilterAction.prototype.getCognosViewer=function(oCV){
return this.m_oCV;
};
RemoveAllDataFilterAction.prototype.setRequestParms=function(_1c04){
if(!_1c04||!_1c04.callback){
return;
}
this.m_callbackMethod=_1c04.callback.method;
this.m_callbackObject=_1c04.callback.object;
};
RemoveAllDataFilterAction.prototype.createJSONDispatcherEntry=function(_1c05){
var oReq=new JSONDispatcherEntry(this.getCognosViewer());
oReq.addFormField("ui.action",_1c05);
var _1c07=this.addActionContext();
oReq.addFormField("cv.actionContext",_1c07);
if(window.gViewerLogger){
window.gViewerLogger.log("Action context",_1c07,"xml");
}
if(typeof this.m_oCV.envParams["ui.spec"]!="undefined"){
oReq.addFormField("ui.spec",this.m_oCV.envParams["ui.spec"]);
}
oReq.addFormField("bux","true");
return oReq;
};
RemoveAllDataFilterAction.prototype.addActionContext=function(){
var _1c08="<reportActions";
var _1c09="";
_1c08+=" run=\"false\"";
_1c08+=">";
_1c08+="<reportAction name=\""+this.m_sAction+"\">";
var _1c0a="{ \"removeAll\" :\"true\"}";
_1c08+=xml_encode(_1c0a);
_1c08+="</reportAction>";
_1c08+="</reportActions>";
return _1c08;
};
RemoveAllDataFilterAction.prototype.executeCallback=function(_1c0b){
var _1c0c=GUtil.generateCallback(this.m_callbackMethod,[_1c0b],this.m_callbackObject);
_1c0c();
};
RemoveAllDataFilterAction.prototype.handleServerResponse=function(_1c0d){
if(_1c0d&&_1c0d.getJSONResponseObject()){
this.executeCallback(_1c0d.getJSONResponseObject().reportSpec);
}
};
RemoveAllDataFilterAction.prototype.execute=function(){
var oCV=this.getCognosViewer();
if(!oCV.getRAPReportInfo().hasSlider()){
this.executeCallback(oCV.envParams["ui.spec"]);
}else{
var _1c0f=this.createJSONDispatcherEntry("modifyReport");
_1c0f.setCallbacks({"complete":{"object":this,"method":this.handleServerResponse}});
oCV.dispatchRequest(_1c0f);
}
};
CCognosViewer.prototype.loadExtra=function(){
};
function DrillContextMenuHelper(){
};
DrillContextMenuHelper.updateDrillMenuItems=function(_1c10,oCV,_1c12){
var _1c13=[];
if(DrillContextMenuHelper.needsDrillSubMenu(oCV)){
var _1c14=oCV.getSelectionController();
var _1c15=_1c14.getAllSelectedObjects();
var _1c16=_1c15[0];
if(_1c16.getUseValues().length>1&&typeof RV_RES!="undefined"){
var _1c17={name:_1c12,label:RV_RES.RV_DRILL_DEFAULT,action:{name:_1c12,payload:{}}};
_1c13.push(_1c17);
}
var _1c18=(_1c16.getUseValues().length>1)?1:0;
var _1c19=_1c16.getUseValues().length-1;
_1c19=(_1c19>2)?2:_1c19;
for(var iDim=_1c18;iDim<=_1c19;++iDim){
DrillContextMenuHelper.addSubMenuItem(_1c12,_1c13,_1c16,iDim,0);
}
var _1c1b=false;
for(var iDim=_1c18;iDim<=_1c19;++iDim){
for(var _1c1c=1;_1c1c<_1c16.getUseValues()[iDim].length;++_1c1c){
if(_1c1b==false){
_1c13.push({separator:true});
_1c1b=true;
}
DrillContextMenuHelper.addSubMenuItem(_1c12,_1c13,_1c16,iDim,_1c1c);
}
}
}
DrillContextMenuHelper.completeDrillMenu(_1c12,_1c13,_1c10);
};
DrillContextMenuHelper.needsDrillSubMenu=function(oCV){
var _1c1e=(oCV&&oCV.getSelectionController());
if(_1c1e){
var _1c1f=_1c1e.getAllSelectedObjects();
if(_1c1f.length==1&&_1c1f[0].isHomeCell&&_1c1f[0].isHomeCell()==false){
var _1c20=_1c1f[0].isSelectionOnVizChart();
if(!_1c20){
var _1c21=oCV.getAdvancedServerProperty("VIEWER_JS_ENABLE_DRILL_SUBMENU");
_1c20=(_1c21=="charts"&&_1c1e.hasSelectedChartNodes());
}
if(_1c20){
var _1c22=_1c1f[0];
return (_1c20&&_1c22.getUseValues()&&(_1c22.getUseValues().length>1||_1c22.getUseValues()[0].length>1));
}
}
}
return false;
};
DrillContextMenuHelper.addSubMenuItem=function(_1c23,_1c24,_1c25,iDim,_1c27){
var _1c28=_1c25.getDrillOptions()[iDim][_1c27];
if(DrillContextMenuHelper.isOptionDrillable(_1c23,_1c28)){
var _1c29=DrillContextMenuHelper.getItemValue(_1c25,iDim,_1c27);
if(_1c29){
var _1c2a=_1c25.getDataItems()[iDim][_1c27];
var _1c2b={name:_1c23,label:_1c29,action:{name:_1c23,payload:{userSelectedDrillItem:_1c2a}}};
_1c24.push(_1c2b);
}
}
};
DrillContextMenuHelper.completeDrillMenu=function(_1c2c,_1c2d,_1c2e){
if(_1c2d.length>0){
_1c2e.items=_1c2d;
}else{
_1c2e.items=null;
if(_1c2e.action==null){
_1c2e.action={name:_1c2c,action:{name:_1c2c}};
}
}
};
DrillContextMenuHelper.isOptionDrillable=function(_1c2f,_1c30){
return (_1c30>=3||(_1c2f=="DrillDown"&&_1c30==2)||(_1c2f=="DrillUp"&&_1c30==1));
};
DrillContextMenuHelper.getItemValue=function(_1c31,iDim,_1c33){
var _1c34=(_1c33==0)?_1c31.getDisplayValues()[iDim]:null;
return ((_1c34)?_1c34:_1c31.getUseValues()[iDim][_1c33]);
};
dojo.provide("viewer.dialogs.ClipboardDialog");
dojo.require("bux.dialogs.BaseCustomContentDialog");
dojo.require("bux.layout.TableContainer");
dojo.require("dijit.form.Textarea");
dojo.require("dijit.form.Button");
dojo.declare("viewer.dialogs.ClipboardDialog",bux.dialogs.BaseCustomContentDialog,{sTitle:null,okHandler:null,cancelHandler:null,startup:function(){
this.updateTitle(this.sTitle);
this.inherited(arguments);
var _1c35=new bux.layout.TableContainer({classname:"bux-InformationDialog"},this.contentContainer);
var cell=null,row=null;
this._textField=new dijit.form.SimpleTextarea({required:true,rows:10,cols:50,style:"width:auto"});
row=new bux.layout.TableContainerRow({parentContainer:_1c35});
cell=new bux.layout.TableContainerCell({classname:"bux-dialog-field",parentContainer:row});
cell.addContent(this._textField.domNode);
},onOK:function(){
if(this._textField.state!="Error"){
this.inherited(arguments);
this.okHandler(this._textField.get("value"));
this.hide();
}
}});
dojo.provide("bux.reportViewer.chart");
dojo.declare("bux.reportViewer.chart",null,{m_displayTypeDialogDefinition:null,constructor:function(){
this.initialize();
},initialize:function(){
if(this.m_displayTypeDialogDefinition!==null){
return;
}
this.m_displayTypeDialogDefinition=[{label:RV_RES.IDS_JS_CHART_TABLE,image:"images/dialog/displayOptionsDialog/type_icons/table.gif",options:[{label:RV_RES.IDS_JS_CHART_CROSSTAB,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/crosstab_48.gif",value:"crosstab"},{label:RV_RES.IDS_JS_CHART_LIST_TABLE,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/List_48.gif",value:"list"}]},{label:RV_RES.IDS_JS_CHART_COLUMN,image:"images/dialog/displayOptionsDialog/type_icons/column.gif",options:[{label:RV_RES.IDS_JS_CHART_COLUMN,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_column_clustered_flat.gif",value:"column_clustered_flat"},{label:RV_RES.IDS_JS_CHART_COLUMN_3D,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_column_clustered.gif",value:"column_clustered"},{label:RV_RES.IDS_JS_CHART_STACKED_COLUMN,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_column_stacked_flat.gif",value:"column_stacked_flat"},{label:RV_RES.IDS_JS_CHART_STACKED_COLUMN_3D,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_column_stacked.gif",value:"column_stacked"},{label:RV_RES.IDS_JS_CHART_PERCENT_STACKED_COLUMN,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_column_percent_flat.gif",value:"column_percent_flat"},{label:RV_RES.IDS_JS_CHART_PERCENT_STACKED_COLUMN_3D,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_column_percent.gif",value:"column_percent"},{label:RV_RES.IDS_JS_CHART_3D_AXIS_COLUMN,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_column_3daxis.gif",value:"column_3daxis"},{label:RV_RES.IDS_JS_CHART_COLUMN,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_v2_column_rectangle_clustered.jpg",value:"v2_column_rectangle_clustered"},{label:RV_RES.IDS_JS_CHART_COLUMN_3D,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_v2_column_box_clustered_depth.jpg",value:"v2_column_box_clustered_depth"},{label:RV_RES.IDS_JS_CHART_STACKED_COLUMN,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_v2_column_rectangle_stacked.jpg",value:"v2_column_rectangle_stacked"},{label:RV_RES.IDS_JS_CHART_STACKED_COLUMN_3D,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_v2_column_box_stacked_depth.jpg",value:"v2_column_box_stacked_depth"},{label:RV_RES.IDS_JS_CHART_PERCENT_STACKED_COLUMN,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_v2_column_rectangle_percent.jpg",value:"v2_column_rectangle_percent"},{label:RV_RES.IDS_JS_CHART_PERCENT_STACKED_COLUMN_3D,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_v2_column_box_percent_depth.jpg",value:"v2_column_box_percent_depth"}]},{label:RV_RES.IDS_JS_CHART_BAR,image:"images/dialog/displayOptionsDialog/type_icons/bar.gif",options:[{label:RV_RES.IDS_JS_CHART_BAR,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_bar_clustered_flat.gif",value:"bar_clustered_flat"},{label:RV_RES.IDS_JS_CHART_BAR_3D,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_bar_clustered.gif",value:"bar_clustered"},{label:RV_RES.IDS_JS_CHART_STACKED_BAR,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_bar_stacked_flat.gif",value:"bar_stacked_flat"},{label:RV_RES.IDS_JS_CHART_STACKED_BAR_3D,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_bar_stacked.gif",value:"bar_stacked"},{label:RV_RES.IDS_JS_CHART_PERCENT_STACKED_BAR,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_bar_percent_flat.gif",value:"bar_percent_flat"},{label:RV_RES.IDS_JS_CHART_PERCENT_STACKED_BAR_3D,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_bar_percent.gif",value:"bar_percent"},{label:RV_RES.IDS_JS_CHART_BAR,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_v2_bar_rectangle_clustered.jpg",value:"v2_bar_rectangle_clustered"},{label:RV_RES.IDS_JS_CHART_BAR_3D,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_v2_bar_box_clustered_depth.jpg",value:"v2_bar_box_clustered_depth"},{label:RV_RES.IDS_JS_CHART_STACKED_BAR,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_v2_bar_rectangle_stacked.jpg",value:"v2_bar_rectangle_stacked"},{label:RV_RES.IDS_JS_CHART_STACKED_BAR_3D,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_v2_bar_box_stacked_depth.jpg",value:"v2_bar_box_stacked_depth"},{label:RV_RES.IDS_JS_CHART_PERCENT_STACKED_BAR,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_v2_bar_rectangle_percent.jpg",value:"v2_bar_rectangle_percent"},{label:RV_RES.IDS_JS_CHART_PERCENT_STACKED_BAR_3D,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_v2_bar_box_percent_depth.jpg",value:"v2_bar_box_percent_depth"}]},{label:RV_RES.IDS_JS_CHART_LINE,image:"images/dialog/displayOptionsDialog/type_icons/line.gif",options:[{label:RV_RES.IDS_JS_CHART_LINE_WITH_MARKERS,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_line_clustered_flat_markers.gif",value:"line_clustered_flat_markers"},{label:RV_RES.IDS_JS_CHART_LINE,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_line_clustered_flat.gif",value:"line_clustered_flat"},{label:RV_RES.IDS_JS_CHART_LINE_3D,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_line_clustered.gif",value:"line_clustered"},{label:RV_RES.IDS_JS_CHART_STEP_LINE_MARKERS,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_line_stepAtPoint_clustered_flat_markers.gif",value:"line_stepAtPoint_clustered_flat_markers"},{label:RV_RES.IDS_JS_CHART_STEP_LINE,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_line_stepAtPoint_clustered_flat.gif",value:"line_stepAtPoint_clustered_flat"},{label:RV_RES.IDS_JS_CHART_STACKED_LINE_MARKERS,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_line_stacked_flat_markers.gif",value:"line_stacked_flat_markers"},{label:RV_RES.IDS_JS_CHART_STACKED_LINE,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_line_stacked_flat.gif",value:"line_stacked_flat"},{label:RV_RES.IDS_JS_CHART_STACKED_LINE_3D,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_line_stacked.gif",value:"line_stacked"},{label:RV_RES.IDS_JS_CHART_PERCENT_STACKED_LINE_MARKERS,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_line_percent_flat_markers.gif",value:"line_percent_flat_markers"},{label:RV_RES.IDS_JS_CHART_PERCENT_STACKED_LINE,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_line_percent_flat.gif",value:"line_percent_flat"},{label:RV_RES.IDS_JS_CHART_PERCENT_STACKED_LINE__3D,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_line_percent.gif",value:"line_percent"},{label:RV_RES.IDS_JS_CHART_3D_AXIS_LINE,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_line_3daxis.gif",value:"line_3daxis"},{label:RV_RES.IDS_JS_CHART_LINE,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_v2_line_clustered.jpg",value:"v2_line_clustered"},{label:RV_RES.IDS_JS_CHART_LINE_3D,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_v2_line_clustered_depth.jpg",value:"v2_line_clustered_depth"},{label:RV_RES.IDS_JS_CHART_LINE_WITH_MARKERS,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_v2_line_clustered_markers.jpg",value:"v2_line_clustered_markers"},{label:RV_RES.IDS_JS_CHART_LINE_WITH_3D_MARKERS,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_v2_line_clustered_3dmarkers.jpg",value:"v2_line_clustered_3dmarkers"},{label:RV_RES.IDS_JS_CHART_STEP_LINE,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_v2_stepped_line_at_points_clustered.jpg",value:"v2_stepped_line_at_points_clustered"},{label:RV_RES.IDS_JS_CHART_STEP_LINE_3D,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_v2_stepped_line_at_points_clustered_depth.jpg",value:"v2_stepped_line_at_points_clustered_depth"}]},{label:RV_RES.IDS_JS_CHART_PIE_DONUT,image:"images/dialog/displayOptionsDialog/type_icons/pie.gif",options:[{label:RV_RES.IDS_JS_CHART_PIE,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_pie_flat.gif",value:"pie_flat"},{label:RV_RES.IDS_JS_CHART_DONUT,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_pie_flat_hole.gif",value:"pie_flat_hole"},{label:RV_RES.IDS_JS_CHART_PIE_3D,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_pie.gif",value:"pie"},{label:RV_RES.IDS_JS_CHART_DONUT_3D,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_pie_hole.gif",value:"pie_hole"},{label:RV_RES.IDS_JS_CHART_PIE,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_v2_pie_flat.jpg",value:"v2_pie"},{label:RV_RES.IDS_JS_CHART_PIE_3D,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_v2_pie.jpg",value:"v2_pie_depth_round"},{label:RV_RES.IDS_JS_CHART_DONUT,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_v2_pie_hole_flat.jpg",value:"v2_donut"},{label:RV_RES.IDS_JS_CHART_DONUT_3D,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_v2_pie_hole.jpg",value:"v2_donut_depth_round"}]},{label:RV_RES.IDS_JS_CHART_AREA,image:"images/dialog/displayOptionsDialog/type_icons/area.gif",options:[{label:RV_RES.IDS_JS_CHART_AREA,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_area_clustered_flat.gif",value:"area_clustered_flat"},{label:RV_RES.IDS_JS_CHART_AREA_3D,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_area_clustered.gif",value:"area_clustered"},{label:RV_RES.IDS_JS_CHART_STACKED_AREA,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_area_stacked_flat.gif",value:"area_stacked_flat"},{label:RV_RES.IDS_JS_CHART_STACKED_AREA_3D,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_area_stacked.gif",value:"area_stacked"},{label:RV_RES.IDS_JS_CHART_PERCENT_AREA,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_area_percent_flat.gif",value:"area_percent_flat"},{label:RV_RES.IDS_JS_CHART_PERCENT_AREA_3D,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_area_percent.gif",value:"area_percent"},{label:RV_RES.IDS_JS_CHART_3D_AXIS_AREA,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_area_3daxis.gif",value:"area_3daxis"},{label:RV_RES.IDS_JS_CHART_STACKED_AREA,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_v2_area_flat_point_to_point.gif",value:"v2_area_stacked_flat"},{label:RV_RES.IDS_JS_CHART_STACKED_AREA_3D,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_v2_area_depth_point_to_point.gif",value:"v2_area_stacked"},{label:RV_RES.IDS_JS_CHART_PERCENT_AREA,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_v2_area_flat_percent_point_to_point.gif",value:"v2_area_percent_flat"},{label:RV_RES.IDS_JS_CHART_PERCENT_AREA_3D,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_v2_area_depth_percent_point_to_point.gif",value:"v2_area_percent"}]},{label:RV_RES.IDS_JS_CHART_SCATTER_BUBBLE_POINT,image:"images/dialog/displayOptionsDialog/type_icons/scatter.gif",options:[{label:RV_RES.IDS_JS_CHART_SCATTER,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_scatter.gif",value:"scatter"},{label:RV_RES.IDS_JS_CHART_BUBBLE,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_bubble.gif",value:"bubble"},{label:RV_RES.IDS_JS_CHART_BUBBLE_WITH_EXCEL_BUBBLE_SIZING,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_bubble_excel.gif",value:"bubble_zeroBased"},{label:RV_RES.IDS_JS_CHART_POINT,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_point_clustered.gif",value:"point_clustered"},{label:RV_RES.IDS_JS_CHART_3D_SCATTER,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_scatter_3daxis.gif",value:"scatter_3daxis"},{label:RV_RES.IDS_JS_CHART_SCATTER,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_v2_scatter.gif",value:"v2_scatter"},{label:RV_RES.IDS_JS_CHART_BUBBLE,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_v2_bubble.gif",value:"v2_bubble"},{label:RV_RES.IDS_JS_CHART_BUBBLE_3D,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_v2_bubble_3dmarkers.gif",value:"v2_bubble_3d"},{label:RV_RES.IDS_JS_CHART_POINT,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_v2_point_clustered_markers.jpg",value:"v2_point_clustered_markers"},{label:RV_RES.IDS_JS_CHART_POINT_3D,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_v2_point_clustered_3dmarkers.jpg",value:"v2_point_clustered_3dmarkers"}]},{label:RV_RES.IDS_JS_CHART_GAUGE,image:"images/dialog/displayOptionsDialog/type_icons/gauge.gif",options:[{label:RV_RES.IDS_JS_CHART_DIAL_GAUGE,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_gauge_dial.gif",value:"gauge_dial"},{label:RV_RES.IDS_JS_CHART_DIAL_GAUGE,Description:"",image:"images/dialog/displayOptionsDialog/chart_thumbnails/type_v2_gauge.gif",value:"v2_gauge"}]}];
},getDisplayTypeDialogDefinition:function(_1c38){
var _1c39=[];
for(var j in this.m_displayTypeDialogDefinition){
var _1c3b=this.m_displayTypeDialogDefinition[j];
var _1c3c={};
_1c3c.image=this.m_displayTypeDialogDefinition[j].image;
_1c3c.label=this.m_displayTypeDialogDefinition[j].label;
_1c3c.options=[];
var _1c3d=_1c3b.options;
for(var k in _1c3d){
var chart=_1c3d[k];
for(var i in _1c38){
var _1c41=_1c38[i];
if(chart.value===_1c41){
var _1c42={label:chart.label,Description:chart.Description,image:chart.image,value:"{targetType:'"+chart.value+"', label:'"+chart.label+"'}"};
_1c3c.options.push(_1c42);
}
}
}
if(_1c3c.options.length>0){
_1c39.push(_1c3c);
}
}
return _1c39;
}});
function ActionFormFields(_1c43){
this.m_dispatcherEntry=_1c43;
this.m_oCV=_1c43.getViewer();
};
ActionFormFields.prototype.addFormFields=function(){
var _1c44=this.m_dispatcherEntry;
var _1c45=_1c44.getAction();
_1c45.preProcess();
_1c44.addFormField("ui.action","modifyReport");
if(this.m_oCV.getModelPath()!==""){
_1c44.addFormField("modelPath",this.m_oCV.getModelPath());
if(typeof this.m_oCV.envParams["metaDataModelModificationTime"]!="undefined"){
_1c44.addFormField("metaDataModelModificationTime",this.m_oCV.envParams["metaDataModelModificationTime"]);
}
}
if(_1c45.doAddActionContext()===true){
var _1c46=_1c45.addActionContext();
_1c44.addFormField("cv.actionContext",_1c46);
if(window.gViewerLogger){
window.gViewerLogger.log("Action context",_1c46,"xml");
}
}
var isBux=this.m_oCV.envParams["bux"]=="true";
if(isBux){
_1c44.addFormField("cv.showFaultPage","false");
}else{
_1c44.addFormField("cv.showFaultPage","true");
}
_1c44.addFormField("ui.object",this.m_oCV.envParams["ui.object"]);
_1c44.addDefinedFormField("ui.spec",this.m_oCV.envParams["ui.spec"]);
_1c44.addDefinedFormField("modelPath",this.m_oCV.envParams["modelPath"]);
_1c44.addDefinedFormField("packageBase",this.m_oCV.envParams["packageBase"]);
_1c44.addDefinedFormField("rap.state",this.m_oCV.envParams["rap.state"]);
_1c44.addDefinedFormField("rap.reportInfo",this.m_oCV.envParams["rapReportInfo"]);
_1c44.addDefinedFormField("ui.primaryAction",this.m_oCV.envParams["ui.primaryAction"]);
_1c44.addNonNullFormField("cv.debugDirectory",this.m_oCV.envParams["cv.debugDirectory"]);
_1c44.addNonNullFormField("ui.objectClass",this.m_oCV.envParams["ui.objectClass"]);
_1c44.addNonNullFormField("bux",this.m_oCV.envParams["bux"]);
_1c44.addNonNullFormField("baseReportModificationTime",this.m_oCV.envParams["baseReportModificationTime"]);
_1c44.addNonNullFormField("originalReport",this.m_oCV.envParams["originalReport"]);
var _1c48=this.m_oCV.getFlashChartOption();
if(_1c48!=null){
_1c44.addFormField("savedFlashChartOption",_1c48);
if(_1c48&&_1c45!=null&&typeof (_1c45.m_requestParams)!="undefined"&&typeof (_1c45.m_requestParams.targetType)!="undefined"){
var _1c49=false;
var _1c4a=null;
if(typeof (_1c45.m_requestParams.targetType.targetType)!="undefined"){
_1c4a=_1c45.m_requestParams.targetType.targetType;
}else{
_1c4a=_1c45.m_requestParams.targetType;
}
if(_1c4a.match("v2_")!=null||_1c4a.match("_v2")!=null){
_1c49=true;
}else{
var _1c4b=this.m_oCV.getRAPReportInfo();
var _1c4c=_1c45.getSelectedReportInfo();
if(_1c4b&&_1c4c){
var _1c4d=_1c4b.getDisplayTypes(_1c4c.container);
if(_1c4d.match("v2_")!=null||_1c4d.match("_v2")!=null){
_1c49=true;
}
}
}
_1c44.addFormField("hasAVSChart",_1c49);
}else{
_1c44.addFormField("hasAVSChart",this.m_oCV.hasAVSChart());
}
}
var sEP=this.m_oCV.getExecutionParameters();
if(sEP){
_1c44.addFormField("executionParameters",encodeURIComponent(sEP));
}
_1c44.addFormField("ui.conversation",encodeURIComponent(this.m_oCV.getConversation()));
_1c44.addFormField("m_tracking",encodeURIComponent(this.m_oCV.getTracking()));
var sCAF=this.m_oCV.getCAFContext();
if(sCAF){
_1c44.addFormField("ui.cafcontextid",sCAF);
}
if(_1c45.forceRunSpecRequest()){
_1c44.addFormField("widget.forceRunSpec","true");
}
};
HiddenIframeDispatcherEntry.IFRAME_ID_PREFIX="viewerHiddenRequest";
HiddenIframeDispatcherEntry.FORM_NAME="viewerHiddenFormRequest";
function HiddenIframeDispatcherEntry(oCV){
HiddenIframeDispatcherEntry.baseConstructor.call(this,oCV);
if(oCV){
HiddenIframeDispatcherEntry.prototype.setDefaultFormFields.call(this);
this.setRequestHandler(new RequestHandler(oCV));
this.setWorkingDialog(oCV.getWorkingDialog());
this.setRequestIndicator(oCV.getRequestIndicator());
this.m_httpRequestConfig=oCV.getConfig()&&oCV.getConfig().getHttpRequestConfig()?oCV.getConfig().getHttpRequestConfig():null;
this.setIframeId(HiddenIframeDispatcherEntry.IFRAME_ID_PREFIX+oCV.getId());
this.originalGetViewerConfiguration=null;
}
};
HiddenIframeDispatcherEntry.prototype=new DispatcherEntry();
HiddenIframeDispatcherEntry.baseConstructor=DispatcherEntry;
HiddenIframeDispatcherEntry.prototype.setDefaultFormFields=function(){
var oCV=this.getViewer();
var sCAF=oCV.getCAFContext();
this.addDefinedNonNullFormField("ui.cafcontextid",sCAF);
};
HiddenIframeDispatcherEntry.prototype.sendRequest=function(){
this._createHiddenIframe();
var form=this._createForm();
this._setupCallbacks();
this.onPreHttpRequest(this.getRequest());
form.submit();
};
HiddenIframeDispatcherEntry.prototype._iframeRequestComplete=function(){
window.getViewerConfiguration=this.originalGetViewerConfiguration;
this.onPostHttpRequest();
this.onEntryComplete();
};
HiddenIframeDispatcherEntry.prototype._setupCallbacks=function(){
this.originalGetViewerConfiguration=window.getViewerConfiguration;
if(this.getFormField("cv.useAjax")!="false"){
var _1c54=this;
var _1c55=this.getRequestHandler().getRequestIndicator();
var _1c56=this.getRequestHandler().getWorkingDialog();
window.getViewerConfiguration=function(){
var _1c57={"httpRequestCallbacks":{"reportStatus":{"complete":function(){
_1c54.onComplete();
},"working":function(){
_1c54.onWorking();
},"prompting":function(){
_1c54.onPrompting();
}}}};
return _1c57;
};
}
};
HiddenIframeDispatcherEntry.prototype.setIframeId=function(id){
this._iframeId=id;
};
HiddenIframeDispatcherEntry.prototype.getIframeId=function(){
return this._iframeId;
};
HiddenIframeDispatcherEntry.prototype._createForm=function(_1c59){
var oCV=this.getViewer();
var _1c5b=HiddenIframeDispatcherEntry.FORM_NAME+oCV.getId();
var _1c5c=document.getElementById(_1c5b);
if(_1c5c){
_1c5c.parentNode.removeChild(_1c5c);
_1c5c=null;
}
var _1c5d=location.protocol+"//"+location.host+oCV.m_sGateway;
_1c5c=document.createElement("form");
_1c5c.setAttribute("method","post");
_1c5c.setAttribute("action",_1c5d);
_1c5c.setAttribute("target",this.getIframeId());
_1c5c.setAttribute("id",_1c5b);
_1c5c.style.display="none";
var _1c5e=this.getRequest().getFormFields();
var _1c5f=_1c5e.keys();
for(var index=0;index<_1c5f.length;index++){
_1c5c.appendChild(createHiddenFormField(_1c5f[index],_1c5e.get(_1c5f[index])));
}
document.body.appendChild(_1c5c);
return _1c5c;
};
HiddenIframeDispatcherEntry.prototype._createHiddenIframe=function(){
var oCV=this.getViewer();
var _1c62=this.getIframeId();
var _1c63=document.getElementById(_1c62);
if(_1c63){
_1c63.parentNode.parentNode.removeChild(_1c63.parentNode);
}
var div=document.createElement("div");
div.style.position="absolute";
div.style.left="0px";
div.style.top="0px";
div.style.display="none";
document.body.appendChild(div);
div.innerHTML="<iframe frameborder=\"0\" id=\""+_1c62+"\" name=\""+_1c62+"\"></iframe>";
_1c63=document.getElementById(_1c62);
var _1c65=this;
var func=function(){
HiddenIframeDispatcherEntry.handleIframeLoad(_1c65);
};
if(_1c63.attachEvent){
_1c63.attachEvent("onload",func);
}else{
_1c63.addEventListener("load",func,true);
}
};
HiddenIframeDispatcherEntry.hideIframe=function(cvId){
var _1c68=document.getElementById(HiddenIframeDispatcherEntry.IFRAME_ID_PREFIX+cvId);
if(_1c68){
_1c68.parentNode.style.display="none";
}
};
HiddenIframeDispatcherEntry.showIframeContentsInWindow=function(cvId){
var _1c6a=document.getElementById(HiddenIframeDispatcherEntry.IFRAME_ID_PREFIX+cvId);
if(!_1c6a){
return;
}
var html=_1c6a.contentWindow.document.getElementsByTagName("html")[0].innerHTML;
var _1c6c=window.open("","","height=400,width=500");
if(_1c6c){
_1c6c.document.write("<html>"+html+"</html>");
}
};
HiddenIframeDispatcherEntry.handleIframeLoad=function(_1c6d){
if(!_1c6d){
return;
}
var _1c6e=document.getElementById(_1c6d.getIframeId());
if(!_1c6e){
return;
}
var oCV=_1c6e.contentWindow.window.gaRV_INSTANCES?_1c6e.contentWindow.window.gaRV_INSTANCES[0]:null;
var _1c70=oCV?oCV.getStatus():null;
if(_1c70=="complete"){
_1c6d.onComplete();
}
if(_1c70=="working"){
_1c6d.onWorking();
}
if(_1c70=="prompting"){
_1c6d.onPrompting();
}
if(!oCV||_1c70=="fault"||_1c70==""){
_1c6d.onFault();
}
};
HiddenIframeDispatcherEntry.prototype.onFault=function(){
this._iframeRequestComplete();
HiddenIframeDispatcherEntry.showIframeContentsInWindow(this.getViewer().getId());
};
HiddenIframeDispatcherEntry.prototype.onPrompting=function(){
this._iframeRequestComplete();
if(this.m_httpRequestConfig){
var _1c71=this.m_httpRequestConfig.getReportStatusCallback("prompting");
if(typeof _1c71=="function"){
_1c71();
}
}
HiddenIframeDispatcherEntry.showIframeContentsInWindow(this.getViewer().getId());
};
HiddenIframeDispatcherEntry.prototype.onComplete=function(){
this._iframeRequestComplete();
if(this.m_httpRequestConfig){
var _1c72=this.m_httpRequestConfig.getReportStatusCallback("complete");
if(typeof _1c72=="function"){
_1c72();
}
}
var _1c73=document.getElementById(this.getIframeId());
if(typeof _1c73.contentWindow.detachLeavingRV=="function"){
_1c73.contentWindow.detachLeavingRV();
}
var _1c74=_1c73.parentNode;
_1c74.style.display="none";
if(this.getCallbacks()&&this.getCallbacks()["complete"]){
HiddenIframeDispatcherEntry.executeCallback(this.getCallbacks()["complete"]);
}
};
HiddenIframeDispatcherEntry.prototype.cancelRequest=function(_1c75){
this._iframeRequestComplete();
if(!this.m_bCancelCalled){
this.m_bCancelCalled=true;
var _1c76=document.getElementById(this.getIframeId());
if(!_1c76){
return;
}
var oCV=_1c76.contentWindow[getCognosViewerObjectString(this.getViewer().getId())];
if(oCV){
oCV.cancel();
}
}
};
HiddenIframeDispatcherEntry.executeCallback=function(_1c78){
if(_1c78){
var _1c79=GUtil.generateCallback(_1c78.method,_1c78.params,_1c78.object);
_1c79();
}
};
HiddenIframeDispatcherEntry.getIframe=function(cvId){
var _1c7b=document.getElementById(HiddenIframeDispatcherEntry.IFRAME_ID_PREFIX+cvId);
return _1c7b;
};
function ReportInfoDispatcherEntry(oCV){
ReportInfoDispatcherEntry.baseConstructor.call(this,oCV);
if(oCV){
this.setCallbacks({"complete":{"object":this,"method":this.onComplete},"prompting":{"object":this,"method":this.onPrompting}});
this.getRequestHandler().setFaultDialog(new ModalFaultDialog(oCV));
}
};
ReportInfoDispatcherEntry.prototype=new AsynchJSONDispatcherEntry();
ReportInfoDispatcherEntry.baseConstructor=AsynchJSONDispatcherEntry;
ReportInfoDispatcherEntry.prototype.initializeAction=function(_1c7d){
this.setKey(_1c7d.getActionKey());
this.setCanBeQueued(_1c7d.canBeQueued());
this.m_action=_1c7d;
};
ReportInfoDispatcherEntry.prototype.getAction=function(){
return this.m_action;
};
ReportInfoDispatcherEntry.prototype.prepareRequest=function(){
var _1c7e=new ActionFormFields(this);
_1c7e.addFormFields();
};
ReportInfoDispatcherEntry.prototype.onComplete=function(_1c7f,arg1){
if(this.m_oCV.getViewerDispatcher().queueIsEmpty()==true){
var _1c81=this.m_action.getOnCompleteCallback();
_1c81(_1c7f);
}
};
ReportInfoDispatcherEntry.prototype.onPrompting=function(_1c82,arg1){
var _1c84=this.m_action.getOnPromptingCallback();
_1c84(_1c82);
};
ReportInfoDispatcherEntry.prototype.onPostEntryComplete=function(){
var oCV=this.getViewer();
if(oCV&&oCV.getViewerWidget()){
var _1c86=oCV.getViewerWidget();
_1c86.getLoadManager().processQueue();
}
};
function ModifyReportDispatcherEntry(oCV){
ModifyReportDispatcherEntry.baseConstructor.call(this,oCV);
this.m_action=null;
if(oCV){
this.m_viewerWidget=oCV.getViewerWidget();
this.setRequestHandler(new RequestHandler(oCV));
this.setWorkingDialog(oCV.getWorkingDialog());
this.setRequestIndicator(oCV.getRequestIndicator());
this.setCallbacks({"complete":{"object":this,"method":this.onComplete},"prompting":{"object":this,"method":this.onPrompting}});
}
};
ModifyReportDispatcherEntry.prototype=new AsynchDataDispatcherEntry();
ModifyReportDispatcherEntry.baseConstructor=AsynchDataDispatcherEntry;
ModifyReportDispatcherEntry.prototype.parent=AsynchDataDispatcherEntry.prototype;
ModifyReportDispatcherEntry.prototype.initializeAction=function(_1c88){
this.setKey(_1c88.getActionKey());
this.setCanBeQueued(_1c88.canBeQueued());
this.m_action=_1c88;
};
ModifyReportDispatcherEntry.prototype.getAction=function(){
return this.m_action;
};
ModifyReportDispatcherEntry.prototype.prepareRequest=function(){
if(this.m_viewerWidget){
DispatcherEntry.addWidgetInfoToFormFields(this.m_viewerWidget,this);
}
var _1c89=new ActionFormFields(this);
_1c89.addFormFields();
if(this.m_viewerWidget){
this.addFormField("cv.id",this.m_viewerWidget.getViewerId());
}
this.addFormField("keepIterators","true");
this.addFormField("run.prompt",this.m_action.getPromptOption());
if(this.m_action.reuseQuery()===true){
this.addFormField("reuseResults","true");
}else{
if(this.m_action.reuseGetParameter()===true){
this.addFormField("reuseResults","paramInfo");
}
}
if(this.m_action.keepRAPCache()===false&&this.m_viewerWidget){
this.m_viewerWidget.clearRAPCache();
}
if(this.m_action.reuseConversation()===true){
this.addFormField("cv.reuseConversation","true");
}
if(this.m_action.isUndoable()&&this.m_action.getUndoRedoQueue()){
this.m_action.getUndoRedoQueue().initUndoObj({"tooltip":this.m_action.getUndoHint(),"saveSpec":this.m_action.saveSpecForUndo()});
}
if(this.getViewer().getCurrentlySelectedTab()&&!this.formFieldExists("generic.anyURI.http://developer.cognos.com/ceba/constants/runOptionEnum#pageGroup")){
this.addFormField("generic.anyURI.http://developer.cognos.com/ceba/constants/runOptionEnum#pageGroup",this.getViewer().getCurrentlySelectedTab());
}
this.getViewer().clearTabs();
};
ModifyReportDispatcherEntry.prototype.onComplete=function(_1c8a,arg1){
if(this.getRequestHandler()){
this.getRequestHandler().onComplete(_1c8a);
}
};
ModifyReportDispatcherEntry.prototype.onPrompting=function(_1c8c){
if(this.getRequestHandler()){
this.getRequestHandler().onPrompting(_1c8c);
}
};
ModifyReportDispatcherEntry.prototype.onWorking=function(_1c8d,arg1){
this.parent.onWorking.call(this,_1c8d,arg1);
var _1c8f=_1c8d.getResponseState();
if(this.getRequestHandler()){
this.getRequestHandler().updateViewerState(_1c8f);
}
};
dojo.provide("ModalInfoMessageDialog");
dojo.declare("ModalInfoMessageDialog",null,{sMessage:"",sDescription:"",sTitle:"",constructor:function(args){
dojo.safeMixin(this,args);
},getMessage:function(){
return this.sMessage;
},getDescription:function(){
return this.sDescription;
},getTitle:function(){
return this.sTitle;
},show:function(){
dojo["require"]("bux.dialogs.InformationDialog");
var _1c91=new bux.dialogs.InformationDialog({title:this.getTitle(),sMainMessage:this.getMessage(),sDescription:this.getDescription(),sInfoIconClass:"bux-informationDialog-info-icon"});
_1c91.show();
}});
function CCognosViewerSaveReport(_1c92,_1c93){
this.m_cognosViewer=_1c92;
this.m_params=null;
this.dashboardToSaveIn=_1c93.cm$storeID;
this.m_doSaveAsOnFault=false;
};
CCognosViewerSaveReport.prototype.canSave=function(_1c94){
return (this.doSaveAs()||_1c94&&_1c94.indexOf("write")!==-1);
};
CCognosViewerSaveReport.prototype.isSavedOutput=function(){
var _1c95=this.m_cognosViewer.envParams["ui.action"];
return (typeof _1c95!=="undefined"&&_1c95==="view");
};
CCognosViewerSaveReport.prototype.doSaveAs=function(){
var _1c96=(this.m_doSaveAsOnFault||!this.m_cognosViewer.envParams["savedReportName"]||!this.isSameDashboard());
return _1c96;
};
CCognosViewerSaveReport.prototype.isSameDashboard=function(){
var _1c97=(this.m_cognosViewer.envParams["ui.object"].indexOf(this.dashboardToSaveIn)!==-1);
return _1c97;
};
CCognosViewerSaveReport.prototype.getUIAction=function(){
return (this.doSaveAs()?"saveInDashboard":"updateSavedReport");
};
CCognosViewerSaveReport.prototype.populateRequestParams=function(_1c98){
_1c98.addFormField("ui.action",this.getUIAction());
_1c98.addFormField("cv.ignoreState","true");
_1c98.addFormField("dashboard-id",this.dashboardToSaveIn);
_1c98.addNonEmptyStringFormField("executionParameters",this.m_cognosViewer.m_sParameters);
for(var param in this.m_cognosViewer.envParams){
if(param.indexOf("frag-")==0||param=="cv.actionState"||param=="ui.primaryAction"||param=="dashboard"||param=="ui.action"||param=="cv.responseFormat"||param=="b_action"){
continue;
}
_1c98.addFormField(param,this.m_cognosViewer.envParams[param]);
}
};
CCognosViewerSaveReport.prototype.getCognosViewer=function(){
return this.m_cognosViewer;
};
CCognosViewerSaveReport.prototype.getViewerWidget=function(){
return this.getCognosViewer().getViewerWidget();
};
CCognosViewerSaveReport.prototype.dispatchRequest=function(){
var _1c9a=this.m_cognosViewer;
var _1c9b=this.getViewerWidget();
var _1c9c={"complete":{"object":_1c9b,"method":_1c9b.handleWidgetSaveDone},"fault":{"object":this,"method":this.onFault}};
var _1c9d=new AsynchJSONDispatcherEntry(_1c9a);
_1c9d.setCallbacks(_1c9c);
this.populateRequestParams(_1c9d);
_1c9a.dispatchRequest(_1c9d);
};
CCognosViewerSaveReport.prototype.onFault=function(_1c9e,arg1){
var _1ca0=this.m_cognosViewer;
var _1ca1=this.getViewerWidget();
var _1ca2=_1c9e.getSoapFault();
var _1ca3=XMLHelper_FindChildByTagName(_1ca2,"Fault",true);
if(this.ifIsEmptySelectionFault(_1ca3)){
this.handleEmptySelectionFault();
return;
}
var _1ca4=_1ca2.createElement("allowRetry");
_1ca4.appendChild(_1ca2.createTextNode("false"));
_1ca3.appendChild(_1ca4);
var _1ca5=XMLBuilderSerializeNode(_1ca3);
_1ca0.setSoapFault(_1ca5);
_1ca1.handleFault();
var _1ca6={"status":false};
_1ca1.iContext.iEvents.fireEvent("com.ibm.bux.widget.save.done",null,_1ca6);
};
CCognosViewerSaveReport.prototype.ifIsEmptySelectionFault=function(_1ca7){
if(_1ca7){
var _1ca8=XMLHelper_FindChildByTagName(_1ca7,"errorCode",true);
if(_1ca8){
var _1ca9=XMLHelper_GetText(_1ca8,false);
return (_1ca9==="cmEmptySelection");
}
}
return false;
};
CCognosViewerSaveReport.prototype.handleEmptySelectionFault=function(){
delete (this.m_cognosViewer.envParams["savedReportName"]);
this.m_doSaveAsOnFault=true;
this.dispatchRequest();
};
SAVE_REPORT_TYPE={reportView:"application/x-ibmcognos_v5reportview+xml",report:"application/x-ibmcognos_v5report+xml"};
function ViewerIWidgetSave(_1caa,_1cab){
this.m_ViewerWidget=_1caa;
this.m_payload=_1cab;
this._setIsSavedDashboard();
};
ViewerIWidgetSave.prototype.setDoCWCopy=function(value){
this._doCWCopy=value;
};
ViewerIWidgetSave.prototype._getSavedReport=function(){
var _1cad=this._getWidgetAttributeValue("savedReportPath");
if(!_1cad){
_1cad=this._getWidgetAttributeValue("savedReportName");
}
return _1cad;
};
ViewerIWidgetSave.prototype._setIsSavedDashboard=function(){
var _1cae=this._getSavedReport();
this._bIsSavedDashboard=(_1cae!==null&&_1cae!==undefined&&_1cae.length!==0);
};
ViewerIWidgetSave.prototype._isSavedDashboard=function(){
return this._bIsSavedDashboard;
};
ViewerIWidgetSave.prototype.canSave=function(_1caf){
return (this._doSaveNewOrSaveAs()||_1caf&&_1caf.indexOf("write")!==-1||this.m_ViewerWidget.isDropped());
};
ViewerIWidgetSave.prototype.isSavedOutput=function(){
var _1cb0=this.m_cognosViewer.envParams["ui.action"];
return (typeof _1cb0!=="undefined"&&_1cb0==="view");
};
ViewerIWidgetSave.prototype._doSaveNewOrSaveAs=function(){
var _1cb1=(this.m_payload.operation==="save"&&!this._isSavedDashboard())||(this.m_payload.operation==="saveAs");
return _1cb1;
};
ViewerIWidgetSave.prototype._getWidgetAttributeValue=function(_1cb2){
return this._getViewerWidget().getAttributeValue(_1cb2);
};
ViewerIWidgetSave.prototype._getEnvParam=function(_1cb3){
return this._getViewerWidget().getEnvParam(_1cb3);
};
ViewerIWidgetSave.prototype._getViewerWidget=function(){
return this.m_ViewerWidget;
};
ViewerIWidgetSave.prototype._isLimitedInteractiveMode=function(){
return this._getViewerWidget().isLimitedInteractiveMode();
};
ViewerIWidgetSave.prototype._getDefaultReportName=function(){
return this._getEnvParam("ui.name");
};
ViewerIWidgetSave.prototype._getReportSpec=function(){
return this._getEnvParam("ui.spec");
};
ViewerIWidgetSave.prototype._getCurrentReportIsReportView=function(){
return (this._getEnvParam("ui.objectClass")==="reportView");
};
ViewerIWidgetSave.prototype.doGetSavePropertiesFromServer=function(){
this.delayedLoadingContext=this._getViewerWidget().getLoadManager().getDelayedLoadingContext();
if(this._getEnvParam("delayedLoadingExecutionParams")){
return true;
}
return (this.delayedLoadingContext&&this.delayedLoadingContext.getPromptValues()!==null);
};
ViewerIWidgetSave.prototype.getSavePropertiesFromServer=function(){
var oCV=this._getViewerWidget().getViewerObject();
var _1cb5=new JSONDispatcherEntry(oCV);
var _1cb6=this._getViewerWidget();
_1cb5.setCallbacks({customArguments:[this.m_payload],complete:{"object":_1cb6,"method":_1cb6.handleGetSavePropertiesFromServerResponse}});
this._addRequestOptions(_1cb5);
_1cb5.sendRequest();
};
ViewerIWidgetSave.prototype._addRequestOptions=function(_1cb7){
_1cb7.addFormField("ui.action","noOp");
_1cb7.addFormField("bux","true");
_1cb7.addFormField("cv.responseFormat","IWidgetSavePropertiesJSON");
if(this._getEnvParam("delayedLoadingExecutionParams")){
_1cb7.addFormField("delayedLoadingExecutionParams",this._getEnvParam("delayedLoadingExecutionParams"));
}else{
_1cb7.addFormField("ui.conversation",this._getViewerWidget().getViewerObject().getConversation());
}
var _1cb8=this.delayedLoadingContext.getPromptValues();
for(var _1cb9 in _1cb8){
_1cb7.addFormField(_1cb9,_1cb8[_1cb9]);
}
};
ViewerIWidgetSave.prototype._getExecutionParameters=function(){
return this._getViewerWidget().getViewerObject().getExecutionParameters();
};
ViewerIWidgetSave.prototype._setExecutionParameters=function(body){
var _1cbb=this._getExecutionParameters();
var doc=XMLBuilderLoadXMLFromString(_1cbb);
if(!doc.documentElement){
return;
}
var root=XMLBuilderCreateXMLDocument("root");
var _1cbe=root.createElement("parameters");
XMLBuilderSetAttributeNodeNS(_1cbe,"xmlns:SOAP-ENC","http://schemas.xmlsoap.org/soap/encoding/");
XMLBuilderSetAttributeNodeNS(_1cbe,"xsi:type","bus:parameterValueArrayProp","http://www.w3.org/2001/XMLSchema-instance");
XMLBuilderSetAttributeNodeNS(_1cbe,"xmlns:bus","http://developer.cognos.com/schemas/bibus/3/");
XMLBuilderSetAttributeNodeNS(_1cbe,"xmlns:xs","http://www.w3.org/2001/XMLSchema");
root.documentElement.appendChild(_1cbe);
var _1cbf=XMLHelper_FindChildrenByTagName(doc.documentElement,"item",false);
var _1cc0=root.createElement("value");
XMLBuilderSetAttributeNodeNS(_1cc0,"xsi:type","SOAP-ENC:Array","http://www.w3.org/2001/XMLSchema-instance");
_1cbe.appendChild(_1cc0);
var _1cc1=_1cbf.length;
for(var i=0;i<_1cbf.length;i++){
var eName=XMLHelper_FindChildByTagName(_1cbf[i],"name",false);
if(eName&&eName.childNodes[0].nodeValue.indexOf("credential:")!==-1){
_1cc1--;
continue;
}
_1cc0.appendChild(_1cbf[i]);
}
XMLBuilderSetAttributeNodeNS(_1cc0,"SOAP-ENC:arrayType","bus:parameterValue["+_1cc1+"]","http://schemas.xmlsoap.org/soap/encoding/");
body.parameters=XMLBuilderSerializeNode(_1cbe);
};
ViewerIWidgetSave.prototype._setSourceObject=function(_1cc4,_1cc5){
var _1cc6=(_1cc5===true)?this._getEnvParam("ui.object"):this._getEnvParam("originalReport");
if(_1cc6){
_1cc4.sourceObject=_1cc6;
}
};
ViewerIWidgetSave.prototype._setReportTypeToReportView=function(_1cc7){
_1cc7.type=SAVE_REPORT_TYPE.reportView;
};
ViewerIWidgetSave.prototype._setReportTypeToReport=function(_1cc8){
_1cc8.type=SAVE_REPORT_TYPE.report;
};
ViewerIWidgetSave.prototype._setReportSpec=function(body){
body.specification=this._getReportSpec();
};
ViewerIWidgetSave.prototype._setResourceForSave=function(_1cca){
if(!this._getCurrentReportIsReportView()&&!this._isLimitedInteractiveMode()){
this._setReportSpec(_1cca.body);
this._setReportTypeToReport(_1cca);
}
return _1cca;
};
ViewerIWidgetSave.prototype._setResourceForCopy=function(_1ccb){
this._setReportSpec(_1ccb.body);
this._setReportTypeToReport(_1ccb);
return _1ccb;
};
ViewerIWidgetSave.prototype._setResourceForSaveNew=function(_1ccc){
var _1ccd=false;
if(this._getEnvParam("originalReport")==null){
_1ccd=true;
}
this._setSourceObject(_1ccc,_1ccd);
if(this._isLimitedInteractiveMode()){
this._setReportTypeToReportView(_1ccc);
}else{
this._setReportTypeToReport(_1ccc);
this._setReportSpec(_1ccc.body);
}
return _1ccc;
};
ViewerIWidgetSave.prototype._setResourceForSaveAs=function(_1cce){
if(this._getCurrentReportIsReportView()){
this._setReportTypeToReportView(_1cce);
this._setSourceObject(_1cce);
}else{
if(this._isLimitedInteractiveMode()){
this._setReportTypeToReportView(_1cce);
this._setSourceObject(_1cce,true);
}else{
this._setReportTypeToReport(_1cce);
this._setSourceObject(_1cce,true);
this._setReportSpec(_1cce.body);
}
}
return _1cce;
};
ViewerIWidgetSave.prototype._getResource=function(){
var _1ccf={};
if(this._doCWCopy===true){
_1ccf.copyOnCreate=true;
}
_1ccf.body={};
var _1cd0=(this.m_payload.operation==="save");
var _1cd1=(this.m_payload.operation==="copy");
if(_1cd1){
this._setResourceForCopy(_1ccf);
}else{
if(_1cd0){
this._setResourceForSave(_1ccf);
}else{
if(this._isSavedDashboard()){
this._setResourceForSaveAs(_1ccf);
}else{
this._setResourceForSaveNew(_1ccf);
}
}
}
this._setExecutionParameters(_1ccf.body);
if(!_1cd1){
_1ccf.itemSetUpdate={name:"savedReportPath",type:"searchPath"};
}
return _1ccf;
};
ViewerIWidgetSave.prototype._getWidgetId=function(){
return this._getViewerWidget().getWidgetId();
};
ViewerIWidgetSave.prototype.getPayload=function(){
var _1cd2={};
_1cd2.resource=new Array();
_1cd2.widgetId=this._getWidgetId();
_1cd2.resource.push(this._getResource());
return _1cd2;
};
dojo.provide("viewer.dialogs.SelectBusinessProcess");
dojo.require("bux.dialogs.BaseCustomContentDialog");
dojo.require("bux.layout.TableContainer");
dojo.require("dijit.form.NumberTextBox");
dojo.require("dijit.form.Button");
dojo.declare("viewer.dialogs.SelectBusinessProcess",bux.dialogs.BaseCustomContentDialog,{sTitle:null,sLabel:null,okHandler:null,cancelHanlder:null,buildRendering:function(){
this.aButtonsSpec=[{label:RV_RES.IDS_JS_BUSINESS_PROCESS_SELECT_DIALOG_START_BUTTON_LABEL,action:dojo.hitch(this,this.onOK),type:"button"},{label:RV_RES.CANCEL,action:dojo.hitch(this,this.onCancel),type:"button"}];
this.inherited(arguments);
if(!this.BPMProcessesInfo||this.BPMProcessesInfo.length===0){
this._buxBaseDialog._aButtonObjects[0].set("disabled",true);
}
},startup:function(){
this.updateTitle(this.sTitle);
this.inherited(arguments);
this.set("role","group");
var _1cd3=new bux.layout.TableContainer({classname:"bux-InformationDialog buxFilterConfigDiscreteValuesTable"},this.contentContainer);
var row=new bux.layout.TableContainerRow({classname:"bux-dialog-label",parentContainer:_1cd3});
var cell=new bux.layout.TableContainerCell({parentContainer:row});
this.generateSelectProcessSection(cell);
cell.addContent(document.createElement("br"));
this.generateViewInputValuesSection(cell);
cell.addContent(document.createElement("br"));
},addDivContainer:function(_1cd6,sID,sRole){
var div=document.createElement("div");
dojo.attr(div,{"class":"buxFilterConfigFilterValue","aria-labelledby":sID,role:sRole});
_1cd6.addContent(div);
return div;
},generateSelectProcessSection:function(_1cda){
var _1cdb=this.id+"_selectProcess_a11ylabel";
this.addTableDescription(_1cda,this.sLabel,_1cdb);
var div=this.addDivContainer(_1cda,_1cdb,"radiogroup");
var _1cdd=new bux.layout.TableContainer({classname:"buxFilterConfigFilterValueTable"});
dojo.style(_1cdd.domNode,"width","325px");
this.addSelectProcessTableHeader(_1cdd);
if(!this.BPMProcessesInfo||this.BPMProcessesInfo.length===0){
this.addEmptySelectProcessTableContent(_1cdd);
}else{
this.addSelectProcessTableContent(_1cdd);
}
div.appendChild(_1cdd.domNode);
},addSelectProcessTableHeader:function(_1cde){
var _1cdf=new bux.layout.TableContainerRow({classname:"buxFilterConfigFilterValueTableHeaderRow",parentContainer:_1cde});
var _1ce0=new bux.layout.TableContainerCell({classname:"buxListHeader buxFilterConfigFilterValueTableHeaderLeft",width:"25px",parentContainer:_1cdf});
var _1ce1=new bux.layout.TableContainerCell({classname:"buxListHeader buxFilterConfigFilterValueTableHeader",width:"300px",parentContainer:_1cdf});
_1ce1.addContent(document.createTextNode(RV_RES.IDS_JS_BUSINESS_PROCESS_SELECT_DIALOG_TABLE_HEADER));
},addEmptySelectProcessTableContent:function(_1ce2){
var _1ce3=this.id+"_processItemsRow_label_none";
var _1ce4=new bux.layout.TableContainerRow({parentContainer:_1ce2});
dojo.attr(_1ce4.domNode,{id:this.id+"_processItemsRow_none","aria-labelledby":_1ce3,tabindex:0});
var _1ce5=this.createA11yLabel(RV_RES.IDS_JS_BUSINESS_PROCESS_SELECT_DIALOG_NO_PROCESS_A11Y,_1ce3,true);
_1ce4.domNode.appendChild(_1ce5);
var cell=new bux.layout.TableContainerCell({parentContainer:_1ce4});
cell.set("colspan",2);
cell.addContent(this.createLabelElement(RV_RES.IDS_JS_BUSINESS_PROCESS_SELECT_DIALOG_NO_PROCESS));
},addSelectProcessTableContent:function(_1ce7){
for(var i=0;i<this.BPMProcessesInfo.length;i++){
var _1ce9=new dijit.form.RadioButton({checked:((i===0)?true:false),name:this.id+"_processItem",disabled:false});
var _1cea=html_encode(this.BPMProcessesInfo[i].sCaption);
var _1ceb=this.BPMProcessesInfo[i].sBPD_ID;
var _1cec=this.BPMProcessesInfo[i].sProcessAppID;
_1ce9.onChange=dojo.hitch(this,"getProcessItemRadioChangeFunction",_1ceb,_1cec,_1cea,_1ce9);
var _1ced=new bux.layout.TableContainerRow({parentContainer:_1ce7,classname:((i===0)?"buxFilterConfigFilterValueRowSelected":"")});
_1ced.set("id",this.id+"_processItemsRow"+_1ce9.id);
var _1cee=new bux.layout.TableContainerCell({align:"center",parentContainer:_1ced});
_1cee.addContent(_1ce9.domNode);
_1cee.set("id",this.id+"_processItemsCell"+i);
var _1cef=new bux.layout.TableContainerCell({classname:"buxFilterConfigFilterItemName text_overflow_ellipsis_ie",width:"300px",valign:"top",parentContainer:_1ced});
var _1cf0=document.createElement("label");
_1cf0.appendChild(document.createTextNode(_1cea));
_1cf0.setAttribute("for",_1ce9.id);
_1cef.addContent(_1cf0);
}
this.setDefaultProcessSelectedInfo();
},setDefaultProcessSelectedInfo:function(){
this._selectedBPD_ID=this.BPMProcessesInfo[0].sBPD_ID;
this._selectedProcessAppId=this.BPMProcessesInfo[0].sProcessAppID;
this._selectedProcessName=html_encode(this.BPMProcessesInfo[0].sCaption);
},getProcessItemRadioChangeFunction:function(_1cf1,_1cf2,_1cf3,radio){
if(radio.get("value")==="on"){
dojo.byId(this.id+"_processItemsRow"+radio.id).className="buxFilterConfigFilterValueRowSelected";
this._selectedBPD_ID=_1cf1;
this._selectedProcessAppId=_1cf2;
this._selectedProcessName=_1cf3;
}else{
dojo.byId(this.id+"_processItemsRow"+radio.id).className="";
}
},generateViewInputValuesSection:function(_1cf5){
var _1cf6=this.id+"_viewInputValues_a11ylabel";
this.addTableDescription(_1cf5,RV_RES.IDS_JS_BUSINESS_PROCESS_VIEW_INPUT_VALUES_TABLE_DESCRIPTION,_1cf6);
this.addViewInputValuesTable(_1cf5,_1cf6);
},addViewInputValuesTable:function(_1cf7,_1cf8){
_1cf7.addContent(this.generateViewInputValuesTable(_1cf8));
},addTableDescription:function(_1cf9,_1cfa,sID){
var div=document.createElement("div");
dojo.attr(div,{"class":"bux-label",id:sID});
div.appendChild(document.createTextNode(html_encode(_1cfa)));
_1cf9.addContent(div);
},generateViewInputValuesTable:function(_1cfd){
var _1cfe=this.bpAction.getInputParameter();
var div=document.createElement("div");
dojo.attr(div,{"class":"buxFilterConfigFilterValue",style:"height:80px",role:"group","aria-labelledby":_1cfd});
var _1d00=new bux.layout.TableContainer({classname:"buxFilterConfigFilterValueTable"});
dojo.style(_1d00.domNode,"width","335px");
_1d00.set("role","list");
div.appendChild(_1d00.domNode);
var _1d01=new bux.layout.TableContainerRow({classname:"buxFilterConfigFilterValueTableHeaderRow",parentContainer:_1d00});
var _1d02=new bux.layout.TableContainerCell({classname:"buxListHeader buxFilterConfigFilterValueTableHeaderLeft",width:"40%",parentContainer:_1d01});
_1d02.addContent(document.createTextNode(RV_RES.IDS_JS_BUSINESS_PROCESS_VIEW_INPUT_VALUES_TABLE_COLUMN_HEADER_DATA_ITEM));
var _1d03=new bux.layout.TableContainerCell({classname:"buxListHeader buxFilterConfigFilterValueTableHeader",width:"60%",parentContainer:_1d01});
_1d03.addContent(document.createTextNode(RV_RES.IDS_JS_BUSINESS_PROCESS_VIEW_INPUT_VALUES_TABLE_COLUMN_HEADER_DISPLAY_VALUE_HEADER));
var _1d04=_1cfe.cognosParameter;
var _1d05=false;
for(var i=0;i<_1d04.length;i++){
var _1d07=0;
var _1d08=this.getWidgetContextValues(_1d04[i]);
for(var _1d09 in _1d08){
var row=new bux.layout.TableContainerRow({parentContainer:_1d00});
var _1d0b={id:this.id+"_inputValueRow_"+_1d07,role:"listitem"};
if(!_1d05){
_1d0b.tabindex=0;
_1d05=true;
}
dojo.attr(row.domNode,_1d0b);
this.addRowAccessibility(row,_1d07,_1d09,_1d08[_1d09]);
var _1d0c=new bux.layout.TableContainerCell({classname:"buxFilterConfigFilterItemName text_overflow_ellipsis_ie",width:"40%",valign:"top",parentContainer:row});
_1d0c.set("id",this.id+"_dataItem_"+i);
_1d0c.addContent(this.createLabelElement(_1d09));
var _1d0d=new bux.layout.TableContainerCell({classname:"buxFilterConfigFilterItemName text_overflow_ellipsis_ie",width:"60%",valign:"top",parentContainer:row});
_1d0d.set("id",this.id+"_displayValue_"+i);
_1d0d.addContent(this.createLabelElement(_1d08[_1d09][0]));
_1d07++;
}
}
return div;
},getWidgetContextValues:function(_1d0e){
return values=_1d0e["com.ibm.widget.context"].values;
},addRowAccessibility:function(row,_1d10,_1d11,_1d12){
var _1d13=this.id+"_inputValueRow_label_"+_1d10;
dojo.attr(row.domNode,{"aria-labelledby":_1d13});
var _1d14=RV_RES.IDS_JS_BUSINESS_PROCESS_VIEW_INPUT_VALUES_TABLE_COLUMN_HEADER_DATA_ITEM+" "+_1d11+" "+RV_RES.IDS_JS_BUSINESS_PROCESS_START_PROCESS_A11Y_DESC_VALUE+" "+_1d12;
row.domNode.appendChild(this.createA11yLabel(_1d14,_1d13,true));
dojo.connect(row.domNode,"onkeypress",dojo.hitch(this,this._rowOnKeyPress));
},_rowOnKeyPress:function(evt){
switch(evt.keyCode){
case dojo.keys.DOWN_ARROW:
this.changeNodeFocus(evt,evt.target,evt.target.nextSibling);
break;
case dojo.keys.UP_ARROW:
this.changeNodeFocus(evt,evt.target,evt.target.previousSibling);
break;
}
},changeNodeFocus:function(evt,_1d17,_1d18){
if(!_1d18||(_1d18&&_1d18.id&&_1d18.id.indexOf("_inputValueRow_")===-1)){
return;
}
dojo.attr(_1d17,{tabindex:-1});
dojo.attr(_1d18,{tabindex:0});
dijit.focus(_1d18);
if(dojo.isIE||dojo.isTrident){
evt.keyCode=0;
}
dojo.stopEvent(evt);
},createA11yLabel:function(_1d19,_1d1a,_1d1b){
var _1d1c=this.createLabelElement(_1d19);
var _1d1d={id:_1d1a};
if(_1d1b){
_1d1d.style="visibility:hidden;display:none";
}
dojo.attr(_1d1c,_1d1d);
return _1d1c;
},createLabelElement:function(_1d1e){
var _1d1f=document.createElement("span");
_1d1f.appendChild(document.createTextNode(html_encode(_1d1e)));
return _1d1f;
},onOK:function(){
this.hide();
this.bpAction.startProcess(this._selectedBPD_ID,this._selectedProcessAppId,this._selectedProcessName);
}});

